<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>æ‘¸ä¸€ä¸ªç®€å•çš„ Unity Log Console (1)</title>
    <url>/2020/05/31/20200531-CloneUnityConsole1/</url>
    <content><![CDATA[<p>æœ¬èœç‹—åœ¨ä¸Šå‘¨é¢†äº†ä¸€ä¸ªåšLogManagerçš„ä»»åŠ¡ã€‚å¾ˆé«˜å…´ä¹Ÿå¾ˆæ…Œï¼Œæ¯•ç«Ÿä»æ¥æ²¡åšè¿‡ç¼–è¾‘å™¨å¼€å‘ï¼Œäºæ˜¯é¢å‘æœç´¢å¼•æ“ç¼–ç¨‹å¼€å§‹è¾£ï¼Œæ‰¾äº†ä¸€äº›æ•™ç¨‹å­¦ç€åšï¼Œé¡ºä¾¿åˆ†äº«ä¸€ä¸‹ã€‚</p>
<h1 id="éœ€æ±‚åˆ†æï¼ˆï¼Ÿ"><a href="#éœ€æ±‚åˆ†æï¼ˆï¼Ÿ" class="headerlink" title="éœ€æ±‚åˆ†æï¼ˆï¼Ÿ"></a>éœ€æ±‚åˆ†æï¼ˆï¼Ÿ</h1><p>ç»„é‡Œå¯¹è¿™ä¸ªLogManagerçš„è¦æ±‚æ˜¯åœ¨UnityåŸæ¥çš„LogåŠŸèƒ½ä¸Šå†åŠ ä¸Šæ ¹æ®æ ‡ç­¾å’Œå±é™©åº¦(?)æ¥ç­›é€‰ã€‚<br>ä»”ç»†æƒ³æƒ³è¿˜æŒºéº»çƒ¦ã€‚éœ€è¦ç­›é€‰çš„è¯ï¼Œé‚£è‡ªç„¶éœ€è¦ä¸€ä¸ªConsoleé¢æ¿ï¼Œä¼¼ä¹UnityåŸæœ¬çš„Consoleä¸æ–¹ä¾¿æ‰©å±•ï¼Œç´¢æ€§è·Ÿç€ç½‘ä¸Šçš„æ•™ç¨‹é‡æ–°åšä¸€ä¸ªã€‚</p>
<h1 id="å¼¹å‡ºçª—å£"><a href="#å¼¹å‡ºçª—å£" class="headerlink" title="å¼¹å‡ºçª—å£"></a>å¼¹å‡ºçª—å£</h1><p>é¦–å…ˆæˆ‘ä»¬å…ˆæŠŠçª—å£å¼¹å‡ºæ¥ã€‚ä»£ç å¾ˆç®€å•ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä»Unityå¤´é¡¶çš„èœå•æ ä¸­çš„Windowä¸­æ‰¾åˆ°è¿™ä¸ªé¢æ¿å¹¶æ‰“å¼€ã€‚æ‰“å¼€äº†æ˜¯ç©ºç™½çš„ï¼Œå½“ç„¶å•¦ï¼Œå› ä¸ºè¿˜ä»€ä¹ˆéƒ½æ²¡ç”»ä¸Šå»ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TempConsoleWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">	[<span class="meta">MenuItem(<span class="meta-string">"Window/Temp Console"</span>)</span>]</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OpenWindow</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		TempConsoleWindow window = GetWindow&lt;TempConsoleWindow&gt;();</span><br><span class="line">		GUIContent titleContent = <span class="keyword">new</span> GUIContent(<span class="string">"TempConsole"</span>, EditorGUIUtility.Load(<span class="string">"icons/UnityEditor.ConsoleWindow.png"</span>) <span class="keyword">as</span> Texture2D, <span class="string">"a clone sonsole"</span>);</span><br><span class="line">		window.titleContent = titleContent;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="åˆ†å‰²åŒºå—"><a href="#åˆ†å‰²åŒºå—" class="headerlink" title="åˆ†å‰²åŒºå—"></a>åˆ†å‰²åŒºå—</h1><img src="/2020/05/31/20200531-CloneUnityConsole1/20200531-Unity01.png" class="" title="split">
<p>æˆ‘ä»¬æŠŠåŸæœ¬çš„é¢æ¿åˆ†æˆ4å—ï¼š1.èœå•æ ï¼›2. LogåŒºï¼›3. è°ƒæ•´æ£’(ä¸Šä¸‹ç§»åŠ¨è°ƒæ•´åŒºåŸŸå¤§å°)ï¼›4. è¯¦æƒ…åŒºã€‚äºæ˜¯ä¹æˆ‘ä»¬ç»™è¿™ä¸ª4ä¸ªåŒºåˆ›å»ºå“åº”çš„å˜é‡ä¸ºäº†æ–¹ä¾¿ç»˜åˆ¶ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Rect m_menuUpperBar = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">private</span> Rect m_upperPanel = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">private</span> Rect m_lowerPanel = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">private</span> Rect m_resizer = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> <span class="keyword">float</span> MENU_BAR_HEIGHT = <span class="number">20.0f</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> m_upperSizeRatio = <span class="number">0.5f</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> <span class="keyword">float</span> RESIZER_HEIGHT = <span class="number">4.0f</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> PanelGroupHeight =&gt; position.height - MENU_BAR_HEIGHT;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">bool</span> m_isResizing = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>
<h1 id="å·çš®"><a href="#å·çš®" class="headerlink" title="å·çš®"></a>å·çš®</h1><p>Unityçš„ç»˜åˆ¶GUIæ–¹æ³•ä¸­å¯ä»¥å¡«å†™é£æ ¼å‚æ•°ï¼Œæˆ‘ä»¬ç»˜åˆ¶å››ä¸ªåŒºå—çš„æ—¶å€™è‡ªç„¶ä¹Ÿéœ€è¦ä¸ºåŒºå—å‡†å¤‡çš®å’Œæ–‡å­—é¢œè‰²ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// logåŒºé£æ ¼ä»¥åŠlogåŒºçš„æ ‡é¢˜é£æ ¼</span></span><br><span class="line"><span class="keyword">private</span> GUIStyle m_panelLabelStyle = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">private</span> GUIStyle m_panelStyle = <span class="keyword">default</span>;</span><br><span class="line"><span class="comment">// è°ƒæ•´æ£’å„¿çš„é£æ ¼</span></span><br><span class="line"><span class="keyword">private</span> GUIStyle m_resizerStyle = <span class="keyword">default</span>;</span><br><span class="line"><span class="comment">// box item å…¶å®æ˜¯åœ¨logåŒºæ˜¾ç¤ºçš„æ¯ä¸€ä¸ªlog item</span></span><br><span class="line"><span class="keyword">private</span> GUIStyle m_boxItemStyle = <span class="keyword">default</span>;</span><br><span class="line"><span class="comment">// è¿™æ˜¯ logè¯¦æƒ…çš„æ–‡å­—é£æ ¼</span></span><br><span class="line"><span class="keyword">private</span> GUIStyle m_textAreaStyle = <span class="keyword">default</span>;</span><br><span class="line"><span class="comment">// è¿™æ˜¯ä¸€ä¸ªæ— è¾¹æ¡†çš„æŒ‰é’®é£æ ¼ï¼Œä¸ºä»£ç è·³è½¬å‡†å¤‡</span></span><br><span class="line"><span class="keyword">private</span> GUIStyle m_labelButtonStyle = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å„ç§å›¾æ ‡</span></span><br><span class="line"><span class="keyword">private</span> Texture2D m_infoIcon = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> Texture2D m_infoIconSmall = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> Texture2D m_warningIcon = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> Texture2D m_warningIconSmall = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> Texture2D m_errorIcon = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> Texture2D m_errorIconSmall = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Texture2D m_boxBgOdd = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> Texture2D m_boxBgEven = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> Texture2D m_boxBgSelected = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> Texture2D m_boxIcon = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å„ç§çš®</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GetAssets</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_panelLabelStyle = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">    m_panelLabelStyle.fixedHeight = <span class="number">30.0f</span>;</span><br><span class="line">    m_panelLabelStyle.richText = <span class="literal">true</span>;</span><br><span class="line">    m_panelLabelStyle.normal.textColor = Color.white;</span><br><span class="line">    m_panelLabelStyle.fontSize = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    m_infoIcon = EditorGUIUtility.Load(<span class="string">"icons/console.infoicon.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">    m_infoIconSmall = EditorGUIUtility.Load(<span class="string">"icons/console.infoicon.sml.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">    m_warningIcon = EditorGUIUtility.Load(<span class="string">"icons/console.warnicon.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">    m_warningIconSmall = EditorGUIUtility.Load(<span class="string">"icons/console.warnicon.sml.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">    m_errorIcon = EditorGUIUtility.Load(<span class="string">"icons/console.erroricon.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">    m_errorIconSmall = EditorGUIUtility.Load(<span class="string">"icons/console.erroricon.sml.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line"></span><br><span class="line">    m_resizerStyle = <span class="keyword">new</span> GUIStyle();</span><br><span class="line"></span><br><span class="line">    m_panelStyle = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">    m_panelStyle.normal.background = EditorGUIUtility.Load(<span class="string">"builtin skins/darkskin/images/projectbrowsericonareabg.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">    <span class="comment">// è¿™è¡Œæ˜¯åŒäº‹å‘Šè¯‰æˆ‘çš„ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸ç®¡ç”¨ï¼Œç›´æ¥ç”¨ä¼šæœ‰ç©ºå¼•ç”¨æŠ¥é”™ï¼Œè¦åœ¨GUIé‡Œç”¨</span></span><br><span class="line">    <span class="comment">// m_panelStyle.normal.background = GUI.skin.window.normal.background; </span></span><br><span class="line"></span><br><span class="line">    m_boxItemStyle = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">    m_boxItemStyle.normal.textColor = <span class="keyword">new</span> Color(<span class="number">0.7f</span>, <span class="number">0.7f</span>, <span class="number">0.7f</span>);</span><br><span class="line"></span><br><span class="line">    m_boxBgOdd = EditorGUIUtility.Load(<span class="string">"builtin skins/darkskin/images/cn entrybackodd.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">    m_boxBgEven = EditorGUIUtility.Load(<span class="string">"builtin skins/darkskin/images/cnentrybackeven.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">    m_boxBgSelected = EditorGUIUtility.Load(<span class="string">"builtin skins/darkskin/images/menuitemhover.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line"></span><br><span class="line">    m_textAreaStyle = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">    m_textAreaStyle.normal.textColor = <span class="keyword">new</span> Color(<span class="number">0.9f</span>, <span class="number">0.9f</span>, <span class="number">0.9f</span>);</span><br><span class="line">    m_textAreaStyle.normal.background = EditorGUIUtility.Load(<span class="string">"builtin skins/darkskin/images/projectbrowsericonareabg.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line"></span><br><span class="line">    m_labelButtonStyle = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">    m_labelButtonStyle.normal.textColor = Color.green;</span><br><span class="line">    m_labelButtonStyle.normal.background = m_textAreaStyle.normal.background;</span><br><span class="line">    m_labelButtonStyle.alignment = TextAnchor.MiddleLeft;</span><br><span class="line">    m_labelButtonStyle.stretchWidth = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> b = m_labelButtonStyle.border;</span><br><span class="line">    b.left = <span class="number">0</span>;</span><br><span class="line">    b.right = <span class="number">0</span>;</span><br><span class="line">    b.top = <span class="number">0</span>;</span><br><span class="line">    b.bottom = <span class="number">0</span>;</span><br><span class="line">    m_labelButtonStyle.border = b;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    GetAssets();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·å–å›¾åƒçš„å‚æ•°éƒ½æ˜¯magic numberï¼Œè¿™é‡Œä¸å¤šæã€‚å›¾æ ‡æµè§ˆå’Œè·å–å‚æ•°å¯ä»¥å‚è€ƒä¸‹é¢ä¸¤ä¸ªé¡µé¢ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥å‡†å¤‡è‡ªå·±çš„ç´ æã€‚</p>
<p><a href="https://unitylist.com/p/5c3/Unity-editor-icons" target="_blank" rel="noopener">https://unitylist.com/p/5c3/Unity-editor-icons</a><br><a href="https://gist.github.com/rus89/375e107ed8c6db79d0c41b8612e5dbf3" target="_blank" rel="noopener">https://gist.github.com/rus89/375e107ed8c6db79d0c41b8612e5dbf3</a></p>
<h1 id="ç»˜åˆ¶èœå•æ "><a href="#ç»˜åˆ¶èœå•æ " class="headerlink" title="ç»˜åˆ¶èœå•æ "></a>ç»˜åˆ¶èœå•æ </h1><p>èœå•æ ä¸Šæœ‰å‡ ä¸ªæŒ‰é’®ï¼Œæˆ‘ä»¬æŠŠæœ€å¸¸ç”¨çš„å¦‚æ¸…ç†ï¼ŒPlayå¼€å§‹æ¸…é™¤ä»¥åŠå³è¾¹ä¸‰ä¸ªFilteré€‰é¡¹ã€‚é™¤äº†â€™Clearâ€™æ˜¯Buttonï¼Œå…¶å®ƒçš„éƒ½æ˜¯Toggleã€‚æ‰€ä»¥å¾—å‡†å¤‡ä¸€äº›å¸ƒå°”å˜é‡ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">bool</span> m_isClearOnPlay = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">bool</span> m_isClearOnBuild = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">bool</span> IsClearOnBuild =&gt; m_isClearOnBuild;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">bool</span> m_isErrorPause = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">bool</span> m_isShowLog = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">bool</span> m_isShowWarning = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">bool</span> m_isShowError = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> m_normalLogCount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> m_warningLogCount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> m_errorLogCount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> HashSet&lt;LogType&gt; m_logTypeForUnshow = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<p>å‡†å¤‡å¥½äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¼€å§‹ç»˜åˆ¶èœå•æ äº†ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawMenuUpperBar</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_menuUpperBar = <span class="keyword">new</span> Rect(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="keyword">this</span>.position.width, MENU_BAR_HEIGHT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹ç»˜åˆ¶</span></span><br><span class="line">    GUILayout.BeginArea(m_menuUpperBar, EditorStyles.toolbar);</span><br><span class="line">    <span class="comment">// æ¨ªå‘ç»˜åˆ¶ï¼ï¼ï¼</span></span><br><span class="line">    GUILayout.BeginHorizontal();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (GUILayout.Button(<span class="keyword">new</span> GUIContent(<span class="string">"Clear"</span>), EditorStyles.toolbarButton, GUILayout.Width(<span class="number">40.0f</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ç”¨äºæ¸…ç©ºæ‰€æœ‰çš„ log</span></span><br><span class="line">        ClearLogs();</span><br><span class="line">    &#125;</span><br><span class="line">    GUILayout.Space(<span class="number">5.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// m_isCollapse = GUILayout.Toggle(m_isCollapse, new GUIContent("Collapse"), EditorStyles.toolbarButton, GUILayout.Width(55.0f));</span></span><br><span class="line">    m_isClearOnPlay = GUILayout.Toggle(m_isClearOnPlay, <span class="keyword">new</span> GUIContent(<span class="string">"Clear On Play"</span>), EditorStyles.toolbarButton, GUILayout.Width(<span class="number">80.0f</span>));</span><br><span class="line">    m_isClearOnBuild = GUILayout.Toggle(m_isClearOnBuild, <span class="keyword">new</span> GUIContent(<span class="string">"Clear On Build"</span>), EditorStyles.toolbarButton, GUILayout.Width(<span class="number">85.0f</span>));</span><br><span class="line">    m_isErrorPause = GUILayout.Toggle(m_isErrorPause, <span class="keyword">new</span> GUIContent(<span class="string">"Error Pause"</span>), EditorStyles.toolbarButton, GUILayout.Width(<span class="number">70.0f</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼¹æ€§ç©ºç™½ï¼Œæˆ‘ä¸å¤ªæ¸…æ¥šåº”è¯¥æ€ä¹ˆæè¿°ï¼Œä½†æ˜¯å®ƒå¯ä»¥æŠŠåé¢çš„å‡ ä¸ªToggleéƒ½å°½å¯èƒ½å¾€åé¢æ¨</span></span><br><span class="line">    GUILayout.FlexibleSpace();</span><br><span class="line"></span><br><span class="line">    m_normalLogCount = Mathf.Clamp(m_normalLogCount, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">    m_warningLogCount = Mathf.Clamp(m_warningLogCount, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">    m_errorLogCount = Mathf.Clamp(m_errorLogCount, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">    m_isShowLog = GUILayout.Toggle(m_isShowLog, <span class="keyword">new</span> GUIContent(m_numStrs[m_normalLogCount], m_infoIconSmall), EditorStyles.toolbarButton, GUILayout.Width(<span class="number">30.0f</span>));</span><br><span class="line">    m_isShowWarning = GUILayout.Toggle(m_isShowWarning, <span class="keyword">new</span> GUIContent(m_numStrs[m_warningLogCount], m_warningIconSmall), EditorStyles.toolbarButton, GUILayout.Width(<span class="number">30.0f</span>));</span><br><span class="line">    m_isShowError = GUILayout.Toggle(m_isShowError, <span class="keyword">new</span> GUIContent(m_numStrs[m_errorLogCount], m_errorIconSmall), EditorStyles.toolbarButton, GUILayout.Width(<span class="number">30.0f</span>));</span><br><span class="line"></span><br><span class="line">    m_logTypeForUnshow.Clear();</span><br><span class="line">    <span class="keyword">if</span> (!m_isShowLog)</span><br><span class="line">    &#123;</span><br><span class="line">        m_logTypeForUnshow.Add(LogType.Log);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!m_isShowWarning)</span><br><span class="line">    &#123;</span><br><span class="line">        m_logTypeForUnshow.Add(LogType.Warning);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!m_isShowError)</span><br><span class="line">    &#123;</span><br><span class="line">        m_logTypeForUnshow.Add(LogType.Error);</span><br><span class="line">        m_logTypeForUnshow.Add(LogType.Assert);</span><br><span class="line">        m_logTypeForUnshow.Add(LogType.Exception);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨ªå‘ç»˜åˆ¶ç»“æŸ</span></span><br><span class="line">    GUILayout.EndHorizontal();</span><br><span class="line">    <span class="comment">// åŒºåŸŸç»˜åˆ¶ç»“æŸ</span></span><br><span class="line">    GUILayout.EndArea();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®é™…è°ƒç”¨ç»˜åˆ¶</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DrawMenuUpperBar();</span><br><span class="line">    <span class="comment">//DrawUpperPanel();</span></span><br><span class="line">    <span class="comment">//DrawLowerPanel();</span></span><br><span class="line">    <span class="comment">//DrawResizer();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±æŠŠèœå•æ ç»˜åˆ¶å¥½äº†ã€‚</p>
<h1 id="ç®€å•ç»˜åˆ¶ä¸Šä¸‹åŒºæ "><a href="#ç®€å•ç»˜åˆ¶ä¸Šä¸‹åŒºæ " class="headerlink" title="ç®€å•ç»˜åˆ¶ä¸Šä¸‹åŒºæ "></a>ç®€å•ç»˜åˆ¶ä¸Šä¸‹åŒºæ </h1><p>æ¥ä¸‹æ¥å†ç»˜åˆ¶è°ƒæ•´æ£’ä¹‹å‰å…ˆç®€å•ç»˜åˆ¶ä¸Šä¸‹åŒºï¼Œå¾…ä¼šå„¿åšå¥½è°ƒæ•´æ£’ä¹‹åå°±èƒ½ç›´æ¥æµ‹è¯•æ•ˆæœã€‚è¦æ³¨æ„ç»™èœå•æ ä»¥åŠè°ƒæ•´ç‰ˆé¢„ç•™çš„é«˜åº¦ï¼Œä¸ç„¶ä¼šå¾—åˆ°é”™è¯¯çš„åŒºåŸŸå¤§å°ï¼Œæ·»åŠ è°ƒæ•´æ£’åä¼šæ›´ä¼šå‡ºç°å¥‡æ€ªç°è±¡ã€‚<br>ç°åœ¨åªéœ€è¦ç»™ä¸Šä¸‹åŒºç»˜åˆ¶ç©ºç™½å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawUpperPanel</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_upperPanel = <span class="keyword">new</span> Rect(<span class="number">0</span>, MENU_BAR_HEIGHT, <span class="keyword">this</span>.position.width, (<span class="keyword">this</span>.position.height - MENU_BAR_HEIGHT) * m_upperSizeRatio);</span><br><span class="line">    GUILayout.BeginArea(m_upperPanel, m_panelStyle);</span><br><span class="line">    GUILayout.Label(<span class="string">"Log"</span>, m_panelLabelStyle);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ºäº†ç”»log itemè€Œå‡†å¤‡çš„ ScrollView</span></span><br><span class="line">    m_upperPanelScroll = GUILayout.BeginScrollView(m_upperPanelScroll);</span><br><span class="line">    GUILayout.EndScrollView();</span><br><span class="line"></span><br><span class="line">    GUILayout.EndArea();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawLowerPanel</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> yPos = PanelGroupHeight * m_upperSizeRatio + MENU_BAR_HEIGHT + RESIZER_HEIGHT;</span><br><span class="line">    m_lowerPanel = <span class="keyword">new</span> Rect(<span class="number">0</span>, yPos, <span class="keyword">this</span>.position.width, PanelGroupHeight * (<span class="number">1.0f</span> - m_upperSizeRatio));</span><br><span class="line">    GUILayout.BeginArea(m_lowerPanel, m_panelStyle);</span><br><span class="line">    GUILayout.Label(<span class="string">"Log Detail"</span>, m_panelLabelStyle);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸º logè¯¦æƒ…å‡†å¤‡çš„ ScrollView</span></span><br><span class="line">    m_lowerPanelScroll = GUILayout.BeginScrollView(m_lowerPanelScroll);</span><br><span class="line">    GUILayout.EndScrollView();</span><br><span class="line"></span><br><span class="line">    GUILayout.EndArea();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®é™…è°ƒç”¨ç»˜åˆ¶</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DrawMenuUpperBar();</span><br><span class="line">    DrawUpperPanel();</span><br><span class="line">    DrawLowerPanel();</span><br><span class="line">    <span class="comment">//DrawResizer();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ç»˜åˆ¶è°ƒæ•´æ£’-æ·»åŠ åŒºåŸŸè°ƒæ•´"><a href="#ç»˜åˆ¶è°ƒæ•´æ£’-æ·»åŠ åŒºåŸŸè°ƒæ•´" class="headerlink" title="ç»˜åˆ¶è°ƒæ•´æ£’ æ·»åŠ åŒºåŸŸè°ƒæ•´"></a>ç»˜åˆ¶è°ƒæ•´æ£’ æ·»åŠ åŒºåŸŸè°ƒæ•´</h1><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawResizer</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> yPos = (<span class="keyword">this</span>.position.height - MENU_BAR_HEIGHT) * m_upperSizeRatio + MENU_BAR_HEIGHT;</span><br><span class="line">    m_resizer = <span class="keyword">new</span> Rect(<span class="number">0</span>, yPos, <span class="keyword">this</span>.position.width, RESIZER_HEIGHT);</span><br><span class="line"></span><br><span class="line">    GUILayout.BeginArea(<span class="keyword">new</span> Rect(m_resizer.position + (Vector2.up * RESIZER_HEIGHT), <span class="keyword">new</span> Vector2(<span class="keyword">this</span>.position.width, <span class="number">2.0f</span>)), m_resizerStyle);</span><br><span class="line">    GUILayout.EndArea();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠŠ m_resizer åŒºåŸŸå†…çš„å…‰æ ‡æ¢æˆæ‹‰ä¼¸æŒ‡ç¤ºå…‰æ ‡</span></span><br><span class="line">    EditorGUIUtility.AddCursorRect(m_resizer, MouseCursor.ResizeVertical);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Resize</span>(<span class="params">Event currentEvent</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_isResizing)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡é¼ æ ‡ä½ç½®æ”¹å˜è°ƒæ•´æ£’ä½ç½®</span></span><br><span class="line">        <span class="keyword">float</span> pos = currentEvent.mousePosition.y - MENU_BAR_HEIGHT;</span><br><span class="line"></span><br><span class="line">        m_upperSizeRatio = pos / PanelGroupHeight;</span><br><span class="line">        m_upperSizeRatio = Mathf.Clamp(m_upperSizeRatio, <span class="number">0.5f</span>, <span class="number">0.8f</span>);</span><br><span class="line">        <span class="comment">//Debug.Log($"next upper ratio &#123;m_upperSizeRatio&#125;");</span></span><br><span class="line">        Repaint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ProcessEvents</span>(<span class="params">Event currentEvent</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (EventType.MouseDown == currentEvent.type)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// if press mouse left in resizer</span></span><br><span class="line">        m_isResizing = (<span class="number">0</span> == currentEvent.button &amp;&amp; m_resizer.Contains(currentEvent.mousePosition));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (EventType.MouseUp == currentEvent.type)</span><br><span class="line">    &#123;</span><br><span class="line">        m_isResizing = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Resize(currentEvent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¶å®æ„Ÿè§‰ç¼–è¾‘å™¨å¼€å‘æŒºéº»çƒ¦çš„ï¼Œé™¤äº†åŒºåŸŸç»˜åˆ¶è¦æ³¨æ„ï¼Œè¿˜æœ‰ä¸€å †APIä¸å¥½æŸ¥ä¸ä¼šç”¨ã€‚ä¸‹ä¸€æœŸå°†ä¼šå°†Logä¿¡æ¯æ•è·å¹¶æ˜¾ç¤ºåœ¨æˆ‘ä»¬è‡ªå·±çš„è¿™ä¸ªConsoleä¸Šã€‚</p>
<hr>
<p>å®Œæ•´å·¥ç¨‹é“¾æ¥(æŒç»­æ›´æ–°ä¸­) :<br><a href="https://github.com/2C2C2C/TempUnityLogConsoleClone" target="_blank" rel="noopener">https://github.com/2C2C2C/TempUnityLogConsoleClone</a></p>
<p>P.S : æˆ‘åœ¨åšçš„æ—¶å€™æ˜¯å‚è€ƒäº†æŸä¸ªæ¸¸æˆå·¥ä½œå®¤å‘å¸ƒçš„æ•™ç¨‹ï¼Œæˆ‘ä¹Ÿé¡ºä¾¿æŠŠè¿™ä¸ªæ•™ç¨‹åˆ†äº«å‡ºæ¥ã€‚<br><a href="https://gram.gs/gramlog/creating-editor-windows-in-unity/" target="_blank" rel="noopener">https://gram.gs/gramlog/creating-editor-windows-in-unity/</a></p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»™Gitä¸Šä¸ªä»£ç†è¯•è¯•æé€Ÿ</title>
    <url>/2020/05/03/20200503-git-add-proxy/</url>
    <content><![CDATA[<h1 id="ç»™GITç”¨ä¸Šä»£ç†"><a href="#ç»™GITç”¨ä¸Šä»£ç†" class="headerlink" title="ç»™GITç”¨ä¸Šä»£ç†"></a>ç»™GITç”¨ä¸Šä»£ç†</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨çœ‹ç€æ•™ç¨‹æ­å»ºè¿™ä¸ªåšå®¢çš„æ—¶å€™ï¼Œæˆ‘åœ¨GITä¸Šä¹Ÿæ‹–äº†ä¸å°‘çš„åŒ…ã€‚ç›´è¿æœ‰æ—¶å€™çœŸçš„é€Ÿåº¦æ…¢åˆ°åè¡€ï¼ŒåŸå› å¾ˆå¤æ‚ä¹Ÿè«å¾—åŠæ³•ã€‚<br>ä¸è¿‡è¿˜å¥½ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥ç»™GITä¸Šä¸ªä»£ç†ï¼Œè¿™æ ·èƒ½ç»™é€Ÿåº¦ä¸€äº›æ”¹å–„ã€‚</p>
<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>æˆ‘æ˜¯åœ¨æœ¬æœºå™¨å®‰è£…æœ‰ä»£ç†å®¢æˆ·ç«¯ï¼Œå°ğŸ›©å’ŒV2éƒ½å½³äºã€‚<br>æˆ‘è¿™è¾¹çš„æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œå°é£æœºèµ°SOCK5ä»£ç†ï¼ŒV2èµ°çš„HTTPä»£ç†ã€‚<br>å› ä¸ºå¹³æ—¶æˆ‘åªå¯èƒ½å¼€ç€ä¸€ä¸ªï¼Œæ‰€ä»¥ç«¯å£éƒ½æ˜¯1080ã€‚</p>
<h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><p>åºŸè¯ä¸å¤šè¯´äº†ï¼Œç›´æ¥ä¸Šå‘½ä»¤ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹å·²æœ‰çš„è®¾ç½®.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å…¨å±€é…ç½®ä¸­çš„ä»£ç†</span></span><br><span class="line">git config --global --get http.proxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç”Ÿæ•ˆé…ç½®ä¸­çš„ä»£ç†</span></span><br><span class="line">git config --get http.proxy</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬åŠ ä¸Šè‡ªå·±çš„ä»£ç†ã€‚<br>å½“å‰æˆ‘ä»¬å‡è®¾çš„çŠ¶æ€æ˜¯æœ¬æœºå¼€ç€å°âœˆæˆ–è€…V2ï¼Œä¸”ä»£ç†ç«¯å£ä¸º1080çš„æƒ…å†µã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‹¬å·ä¸­çš„éƒ½æ˜¯å¯é€‰é¡¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‹¥ç”¨çš„å°é£æœº, --global æ„å‘³ç€åº”ç”¨åˆ°å…¨å±€è®¾ç½®</span></span><br><span class="line">git config (--global) http.proxy sock5://127.0.0.1:1080</span><br><span class="line">git config (--global) https.proxy sock5://127.0.0.1:1080</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ ·åº”ç”¨åï¼Œæ²¡å¼€ä»£ç†GITå°±ä¼šæŠ½é£äº†ï¼Œæ‰€ä»¥å¦‚æœå¹³æ—¶é€Ÿåº¦è¿˜ä¸é”™çš„è¯è®°å¾—ç”¨å®Œå–æ¶ˆä»£ç†</span></span><br><span class="line">git config (--global) --<span class="built_in">unset</span> http.proxy (sock5://127.0.0.1:1080)</span><br><span class="line">git config (--global) --<span class="built_in">unset</span> https.proxy (sock5://127.0.0.1:1080)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‹¥ç”¨çš„V2, --global æ„å‘³ç€åº”ç”¨åˆ°å…¨å±€è®¾ç½®</span></span><br><span class="line">git config (--global) http.proxy  http://127.0.0.1:1080</span><br><span class="line">git config (--global) https.proxy https://127.0.0.1:1080</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–æ¶ˆ</span></span><br><span class="line">git config (--global) --<span class="built_in">unset</span> http.proxy  ï¼ˆhttp://127.0.0.1:1080ï¼‰</span><br><span class="line">git config (--global) --<span class="built_in">unset</span> https.proxy ï¼ˆhttps://127.0.0.1:1080ï¼‰</span><br></pre></td></tr></table></figure>
<p>æŒ‚äº†ä»£ç†çœŸçš„é£é€Ÿï¼Œçˆ½åˆ°ã€‚</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>Misc</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»™Unityä¸Šä»£ç†</title>
    <url>/2020/05/18/20200518-unity-hub-w-proxy/</url>
    <content><![CDATA[<h1 id="ç»™Unityç”¨ä¸Šä»£ç†"><a href="#ç»™Unityç”¨ä¸Šä»£ç†" class="headerlink" title="ç»™Unityç”¨ä¸Šä»£ç†"></a>ç»™Unityç”¨ä¸Šä»£ç†</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰æœ‰æ®µæ—¶é—´å…¬å¸çš„ç½‘ç»œä¸æ˜¯å¾ˆç¨³å®šï¼Œä»UnityHubä¸Šæ‹–ä¸œè¥¿99%å¤±è´¥ã€‚è‡ªå·±åˆå¤ªèœä¸æƒ³å®‰è£…Android Studioæ‰‹åŠ¨è®¾ç½®å®‰å“æ‰“åŒ…çš„ä¸œè¥¿ï¼Œäºæ˜¯ä¹åªèƒ½æƒ³åŠæ³•ç»™ä¸‹è½½åŠ é€Ÿã€‚</p>
<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>é¦–å…ˆä½ è¦æœ‰é‚£ä¸ªï¼Œå°±æ˜¯é‚£ä¸ªä½ ä¸ºäº†çœ‹PHæ‰å¼„çš„å°å·¥å…·ï¼šï¼‰</p>
<h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><p>é¦–å…ˆé»˜è®¤æˆ‘ä»¬çš„å°âœˆä»£ç†ç«¯å£æ˜¯1080ã€‚<br>ä¼¼ä¹V2å¯ä»¥åŒæ—¶æœ‰SOCK5å’ŒHTTPä»£ç†çš„æ ·å­ï¼Œé‚£ä¹ŸæŠŠHTTPä»£ç†çš„ç«¯å£è®¾ç½®æˆ1080.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ä»£ç†</span></span><br><span class="line"><span class="built_in">set</span> HTTP_PROXY=http://127.0.0.1:1080</span><br><span class="line"><span class="built_in">set</span> HTTPS_PROXY=http://127.0.0.1:1080</span><br><span class="line"></span><br><span class="line">start <span class="string">""</span> <span class="string">"your unity hub path"</span></span><br><span class="line"><span class="comment"># like path is like -&gt; D:\Unity\Unity Hub\Unity Hub.exe</span></span><br></pre></td></tr></table></figure>
<h2 id="çˆ†ç‚¸"><a href="#çˆ†ç‚¸" class="headerlink" title="çˆ†ç‚¸"></a>çˆ†ç‚¸</h2><p>éå¸¸ç®€å•å°±æ˜¯è¿™æ ·ã€‚</p>
<p>å…¶å®ä¸œè¥¿éƒ½æ˜¯ä»æœ‰æœ¨æ¡‘åšå®¢çœ‹æ¥çš„<br><a href="https://www.yomunchan.moe/archives/320" target="_blank" rel="noopener">https://www.yomunchan.moe/archives/320</a></p>
<p>è¿™è¾¹æœ‰è›®å¤šæ¸¸æˆå¼€å‘ç›¸å…³çš„æ–‡ç« ï¼Œå¸®äº†æˆ‘ä¸å°‘ï¼Œååˆ†æ„Ÿè°¢äº†ã€‚</p>
]]></content>
      <tags>
        <tag>Misc</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‘¸ä¸€ä¸ªç®€å•çš„ Unity Log Console (2)</title>
    <url>/2020/05/31/20200531-CloneUnityConsole2/</url>
    <content><![CDATA[<p>ä¸Šä¸€æœŸæˆ‘ä»¬åšå®Œäº†åŸºæœ¬çš„é¢æ¿ç»˜åˆ¶ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¾€é‡Œé¢æ·»åŠ ç®€å•çš„å†…å®¹äº†ã€‚</p>
<h1 id="å®šä¹‰æ˜¾ç¤ºå•ä½"><a href="#å®šä¹‰æ˜¾ç¤ºå•ä½" class="headerlink" title="å®šä¹‰æ˜¾ç¤ºå•ä½"></a>å®šä¹‰æ˜¾ç¤ºå•ä½</h1><p>æ—¢ç„¶æˆ‘ä»¬è¦æ˜¾ç¤ºLogï¼Œé‚£å°±å®šä¹‰ä¸€äº›æ•°æ®ç»“æ„ç”¨äºå­˜å‚¨è¿™äº›Logã€‚å› ä¸ºè¿™äº›ä¸œè¥¿åœ¨æˆ‘ä»¬çš„consoleä¸­åªéœ€è¦æ˜¾ç¤ºå°±è¡Œäº†ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰åªè¯»çš„æ•°æ®å°±å¯ä»¥ï¼Œæˆ–è®¸è¿˜èƒ½æé«˜æ€§èƒ½ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LogItem</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> IsSelected &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> <span class="keyword">string</span> LogInfo = <span class="keyword">string</span>.Empty; <span class="comment">// Logç®€è¦ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> <span class="keyword">string</span> LogMessage = <span class="keyword">string</span>.Empty; <span class="comment">// Log è°ƒç”¨æ ˆï¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> LogType GetLogType = LogType.Log;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LogItem</span>(<span class="params"><span class="keyword">bool</span> isSelected, <span class="keyword">string</span> info, <span class="keyword">string</span> message, LogType type</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        IsSelected = isSelected;</span><br><span class="line">        <span class="comment">// è®°å¾—åŠ ä¸Šæ—¶é—´ï¼ï¼ï¼</span></span><br><span class="line">        LogInfo = <span class="keyword">string</span>.Format(<span class="string">"[&#123;0&#125;] &#123;1&#125;"</span>, System.DateTime.Now.ToLongTimeString(), info);</span><br><span class="line">        LogMessage = message;</span><br><span class="line">        GetLogType = type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TempConsoleWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LogMessageReceived</span>(<span class="params"><span class="keyword">string</span> condition, <span class="keyword">string</span> stackTrace, LogType type</span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">            LogItem log = <span class="keyword">new</span> LogItem(<span class="literal">false</span>, condition, stackTrace, type);</span><br><span class="line">            m_logItems.Add(log);</span><br><span class="line">            <span class="keyword">switch</span> (type)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> LogType.Error:</span><br><span class="line">                    m_errorLogCount++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> LogType.Assert:</span><br><span class="line">                    m_errorLogCount++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> LogType.Warning:</span><br><span class="line">                    m_warningLogCount++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> LogType.Log:</span><br><span class="line">                    m_normalLogCount++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> LogType.Exception:</span><br><span class="line">                    m_errorLogCount++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    m_errorLogCount++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¸»åŠ¨åˆ·æ–°ï¼Œå› ä¸ºå½“æ­¤çª—å£æ²¡æœ‰ç„¦ç‚¹æ—¶ä¼¼ä¹æ— æ³•èµ° OnGUI() åˆ·æ–°ã€‚</span></span><br><span class="line">            Repaint();</span><br><span class="line">            <span class="comment">//GUI.changed = true;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="comment">// ....</span></span><br><span class="line">		<span class="comment">// ç›‘å¬æ­¤äº‹ä»¶ï¼Œå½“Debug.Log("")è¢«è°ƒç”¨çš„æ—¶å€™å°±ä¼šå“åº”</span></span><br><span class="line">		Application.logMessageReceived += LogMessageReceived;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDestroy</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>	&#123;</span><br><span class="line">		<span class="comment">// ....</span></span><br><span class="line">		Application.logMessageReceived -= LogMessageReceived;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨ä¸Šéƒ¨é¢æ¿æ˜¾ç¤ºLog"><a href="#åœ¨ä¸Šéƒ¨é¢æ¿æ˜¾ç¤ºLog" class="headerlink" title="åœ¨ä¸Šéƒ¨é¢æ¿æ˜¾ç¤ºLog"></a>åœ¨ä¸Šéƒ¨é¢æ¿æ˜¾ç¤ºLog</h1><p>åƒåŸæœ¬Unity Consoleä¸€æ ·ï¼Œæ¯ä¸€æ¡Logä»¥ä¸€ä¸ªæ–¹æ¡itemçš„å½¢å¼æ˜¾ç¤ºåœ¨ä¸ŠåŠéƒ¨åˆ†é¢æ¿ã€‚<br>æˆ‘ä»¬å…ˆæŠŠè¿™ä¸ªitemç”»å‡ºæ¥ã€‚<br>m_selectedLogItem æ˜¯æˆ‘ä»¬é€‰ä¸­çš„ LogItemã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">bool</span> <span class="title">DrawLogBox</span>(<span class="params"><span class="keyword">in</span> <span class="keyword">string</span> content, LogType logType, <span class="keyword">bool</span> isOdd, <span class="keyword">bool</span> isSelected</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isSelected)</span><br><span class="line">    &#123;</span><br><span class="line">        m_boxItemStyle.normal.background = m_boxBgSelected;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (isOdd)</span><br><span class="line">        &#123;</span><br><span class="line">            m_boxItemStyle.normal.background = m_boxBgOdd;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            m_boxItemStyle.normal.background = m_boxBgEven;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (logType)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> LogType.Error:</span><br><span class="line">            m_boxIcon = m_errorIcon;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LogType.Assert:</span><br><span class="line">            m_boxIcon = m_errorIcon;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LogType.Warning:</span><br><span class="line">            m_boxIcon = m_warningIcon;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LogType.Log:</span><br><span class="line">            m_boxIcon = m_infoIcon;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LogType.Exception:</span><br><span class="line">            m_boxIcon = m_errorIcon;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªæŒ‰é’®æ˜¯å› ä¸ºè¿™æ¡box itemæ˜¯å¯ä»¥è¢«ç‚¹å‡»é€‰æ‹©çš„ï¼ï¼ï¼</span></span><br><span class="line">    <span class="keyword">return</span> GUILayout.Button(<span class="keyword">new</span> GUIContent(content, m_boxIcon), m_boxItemStyle, GUILayout.ExpandWidth(<span class="literal">true</span>), GUILayout.Height(<span class="number">30.0f</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawUpperPanel</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_upperPanel = <span class="keyword">new</span> Rect(<span class="number">0</span>, MENU_BAR_HEIGHT, <span class="keyword">this</span>.position.width, (<span class="keyword">this</span>.position.height - MENU_BAR_HEIGHT) * m_upperSizeRatio);</span><br><span class="line">    GUILayout.BeginArea(m_upperPanel, m_panelStyle);</span><br><span class="line">    GUILayout.Label(<span class="string">"Log"</span>, m_panelLabelStyle);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨scrollviewé‡Œå¡«å……logï¼Œunity</span></span><br><span class="line">    m_upperPanelScroll = GUILayout.BeginScrollView(m_upperPanelScroll);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_logItems.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_logTypeForUnshow.Contains(m_logItems[i].GetLogType))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”»çš„æ—¶å€™ï¼Œé¡ºä¾¿æ¥å—itemçš„ç‚¹å‡»çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (DrawLogBox(m_logItems[i].LogInfo, m_logItems[i].GetLogType, i % <span class="number">2</span> == <span class="number">0</span>, m_logItems[i].IsSelected))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != m_selectedLogItem)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (m_logItems[i] == m_selectedLogItem)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// click a some one, open code</span></span><br><span class="line">                    <span class="comment">// JumpToCurrentLogPos(); // è·³è½¬åˆ°ä½ ç‚¹å‡»çš„Logçš„é¡¶éƒ¨çš„ä»£ç æ–‡ä»¶ï¼ˆå¦‚æœå¯ä»¥</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    m_selectedLogItem.IsSelected = <span class="literal">false</span>;</span><br><span class="line">                    m_selectedLogItem = m_logItems[i];</span><br><span class="line">                    m_selectedLogItem.IsSelected = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                m_selectedLogItem = m_logItems[i];</span><br><span class="line">                m_selectedLogItem.IsSelected = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å‡†å¤‡åˆ·æ–°</span></span><br><span class="line">            GUI.changed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    GUILayout.EndScrollView();</span><br><span class="line">    GUILayout.EndArea();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// .....</span></span><br><span class="line">    <span class="keyword">if</span> (GUI.changed)</span><br><span class="line">    &#123;</span><br><span class="line">        Repaint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ˜¾ç¤ºLogè¯¦æƒ…ä»¥åŠè°ƒç”¨æ ˆ"><a href="#æ˜¾ç¤ºLogè¯¦æƒ…ä»¥åŠè°ƒç”¨æ ˆ" class="headerlink" title="æ˜¾ç¤ºLogè¯¦æƒ…ä»¥åŠè°ƒç”¨æ ˆ"></a>æ˜¾ç¤ºLogè¯¦æƒ…ä»¥åŠè°ƒç”¨æ ˆ</h1><p>ç”±äºæˆ‘è„‘å­ä¸å¥½ä½¿ï¼Œæˆ‘ä¸çŸ¥é“å¦‚ä½•å®Œç¾å¤åˆ»Unity Consoleçš„è¯¦æƒ…ï¼ŒUnityè‡ªå¸¦Consoleä¸­æ˜¾ç¤ºçš„ä»£ç é“¾æ¥æ—¢å¯ä»¥å¤åˆ¶ä¹Ÿå¯ä»¥ç‚¹å‡»è·³è½¬ï¼Œæˆ‘åªåšäº†ç®€å•çš„è·³è½¬ã€‚å¦‚æœæœ‰æ¯”è¾ƒç†Ÿæ‚‰ç¼–è¾‘å™¨å¼€å‘çš„æœ‹å‹ï¼Œå¯ä»¥æä¾›ä¿®æ”¹çš„æ–¹æ³•ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawLowerPanel</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> yPos = PanelGroupHeight * m_upperSizeRatio + MENU_BAR_HEIGHT + RESIZER_HEIGHT;</span><br><span class="line">    m_lowerPanel = <span class="keyword">new</span> Rect(<span class="number">0</span>, yPos, <span class="keyword">this</span>.position.width, PanelGroupHeight * (<span class="number">1.0f</span> - m_upperSizeRatio));</span><br><span class="line">    GUILayout.BeginArea(m_lowerPanel, m_panelStyle);</span><br><span class="line">    GUILayout.Label(<span class="string">"Log Detail"</span>, m_panelLabelStyle);</span><br><span class="line"></span><br><span class="line">    m_lowerPanelScroll = GUILayout.BeginScrollView(m_lowerPanelScroll);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">string</span> logDetail = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">string</span>[] logDetailMutiLine = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO : code clean here</span></span><br><span class="line">    <span class="keyword">string</span> pathline = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">string</span> tempCase = <span class="string">".cs:"</span>;</span><br><span class="line">    <span class="keyword">string</span> path = <span class="keyword">string</span>.Empty;</span><br><span class="line">    <span class="keyword">int</span> line = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> splitwa = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != m_selectedLogItem)</span><br><span class="line">    &#123;</span><br><span class="line">        logDetail = m_selectedLogItem.LogMessage;</span><br><span class="line">        GUILayout.TextArea(<span class="keyword">string</span>.Format(<span class="string">"&#123;0&#125;\n"</span>, m_selectedLogItem.LogInfo), m_textAreaStyle);</span><br><span class="line"></span><br><span class="line">        logDetailMutiLine = logDetail.Split(<span class="string">'\n'</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; logDetailMutiLine.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Regex match 'at xxx'</span></span><br><span class="line">            Match matches = Regex.Match(logDetailMutiLine[i], <span class="string">@"\(at (.+)\)"</span>, RegexOptions.Multiline);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (matches.Success)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">while</span> (matches.Success)</span><br><span class="line">                &#123;</span><br><span class="line">                    pathline = matches.Groups[<span class="number">1</span>].Value;</span><br><span class="line">                    <span class="keyword">if</span> (pathline.Contains(tempCase))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">int</span> splitIndex = pathline.LastIndexOf(<span class="string">":"</span>);</span><br><span class="line">                        path = pathline.Substring(<span class="number">0</span>, splitIndex);</span><br><span class="line">                        line = Convert.ToInt32(pathline.Substring(splitIndex + <span class="number">1</span>));</span><br><span class="line">                        <span class="keyword">string</span> fullpath = Application.dataPath.Substring(<span class="number">0</span>, Application.dataPath.LastIndexOf(<span class="string">"Assets"</span>));</span><br><span class="line">                        fullpath = fullpath + path;</span><br><span class="line">                        splitwa = logDetailMutiLine[i].LastIndexOf(<span class="string">"("</span>);</span><br><span class="line">                        logDetailMutiLine[i] = logDetailMutiLine[i].Substring(<span class="number">0</span>, splitwa);</span><br><span class="line"></span><br><span class="line">                        GUILayout.BeginHorizontal();</span><br><span class="line">                        GUILayout.TextArea(<span class="keyword">string</span>.Format(<span class="string">" (at : &#123;0&#125;)\n"</span>, logDetailMutiLine[i]), m_textAreaStyle);</span><br><span class="line">                        <span class="keyword">if</span> (GUILayout.Button(<span class="keyword">string</span>.Format(<span class="string">" ( &#123;0&#125; )\n"</span>, pathline), m_labelButtonStyle))</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// æ‰“å¼€æ–‡ä»¶çš„é­”æ³•</span></span><br><span class="line">                            UnityEditorInternal.InternalEditorUtility.OpenFileAtLineExternal(fullpath.Replace(<span class="string">'/'</span>, <span class="string">'\\'</span>), line);</span><br><span class="line">                        &#125;</span><br><span class="line">                        GUILayout.FlexibleSpace();</span><br><span class="line">                        GUILayout.EndHorizontal();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                GUILayout.TextArea(logDetailMutiLine[i], m_textAreaStyle);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    GUILayout.EndScrollView();</span><br><span class="line">    GUILayout.EndArea();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™è¾¹ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…å»å¯»æ‰¾ä»£ç æ–‡ä»¶ï¼Œæ˜¯ä»ç½‘ä¸ŠæŸ¥åˆ°çš„ï¼Œæˆ‘ç”¨ç€è¿˜ä¸å¤ªç†Ÿç»ƒã€‚æ‰€ä»¥å†™å¾—å¾ˆä¹±ï¼Œåç»­ä¼šåœ¨å·¥ç¨‹ä¸­æ›´æ–°å¹²å‡€äº›çš„ç‰ˆæœ¬ã€‚</p>
<h1 id="å®Œå–„èœå•æ åŠŸèƒ½"><a href="#å®Œå–„èœå•æ åŠŸèƒ½" class="headerlink" title="å®Œå–„èœå•æ åŠŸèƒ½"></a>å®Œå–„èœå•æ åŠŸèƒ½</h1><p>æ—¢ç„¶æˆ‘ä»¬èƒ½æ˜¾ç¤ºLogäº†ï¼Œé‚£å°±åˆ«å¿˜äº†è¡¥ä¸Šæ¸…é™¤Logçš„åŠŸèƒ½ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ClearLogs</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != m_selectedLogItem)</span><br><span class="line">    &#123;</span><br><span class="line">        m_selectedLogItem.IsSelected = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    m_selectedLogItem = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    m_normalLogCount = <span class="number">0</span>;</span><br><span class="line">    m_warningLogCount = <span class="number">0</span>;</span><br><span class="line">    m_errorLogCount = <span class="number">0</span>;</span><br><span class="line">    m_logItems.Clear();</span><br><span class="line">    GUI.changed = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawMenuUpperBar</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// .....</span></span><br><span class="line">    <span class="keyword">if</span> (GUILayout.Button(<span class="keyword">new</span> GUIContent(<span class="string">"Clear"</span>), EditorStyles.toolbarButton, GUILayout.Width(<span class="number">40.0f</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ç”¨äºæ¸…ç©ºæ‰€æœ‰çš„ log</span></span><br><span class="line">        ClearLogs();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// .....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ä¸€æœŸå°±åˆ°è¿™é‡Œã€‚æ„Ÿè§‰å·¥å…·å¼€å‘ä¹Ÿæœ‰ç‚¹æ¬ç –ï¼Œä½†æ˜¯ä¼šç”¨åˆ°å„ç§å„æ ·çš„æ¬ç –å·¥å…·å»æ¬è¿å¥‘åˆä¸åŒçš„ç –ï¼Œèƒ½æ¥è§¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œè¿˜è›®æœ‰è¶£çš„ã€‚<br>ä¸‹ä¸€æœŸæˆ‘ä¼šå°è¯•æŠŠå½“å‰è¿™ä¸ªä¹ä¸Log Consoleçš„åŠŸèƒ½éƒ½è¡¥é½ã€‚<br>ä»£ç æœ‰ç¼ºæ¼å¯ä»¥å…ˆå‚è€ƒå·¥ç¨‹ã€‚</p>
<hr>
<p>å®Œæ•´å·¥ç¨‹é“¾æ¥</p>
<p><a href="https://github.com/2C2C2C/TempUnityLogConsoleClone" target="_blank" rel="noopener">https://github.com/2C2C2C/TempUnityLogConsoleClone</a></p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>UnityObject ç©ºå¼•ç”¨æ£€æŸ¥å°æµ‹è¯•</title>
    <url>/2020/06/20/20200620-unity-obj-null-check/</url>
    <content><![CDATA[<blockquote>
<p>Classes deriving from Unity. Object inherit equality operators that change the behaviour of the == and != operators.<br>While these operators will perform standard . NET reference equality, if comparing one side to null, these operators will call native code to check if the underlying native engine object is still alive. </p>
</blockquote>
<p>è¿™æ®µè§£é‡Šæ¥è‡ªRiderçš„æç¤ºï¼š<br><a href="https://github.com/JetBrains/resharper-unity/wiki/Avoid-null-comparisons-against-UnityEngine.Object-subclasses" target="_blank" rel="noopener">https://github.com/JetBrains/resharper-unity/wiki/Avoid-null-comparisons-against-UnityEngine.Object-subclasses</a></p>
<p>UnityEngine åº•å±‚æ˜¯C++å†™çš„ï¼Œæ‰€ä»¥è¯´ï¼Œå…¶å®æˆ‘ä»¬å¯¹UnityObjectçš„ç©ºå¼•ç”¨æ£€æŸ¥éƒ½ä¼šå†æ·±å…¥åˆ°é‡Œé¢C++é‚£ä¸€å±‚å»å†æ£€æŸ¥ï¼Œè¿™ä¸ªæ£€æŸ¥æ˜¯æ¯”è¾ƒæ¶ˆè€—çš„ã€‚<br>ä¹‹å‰æ›¾ç»é‡åˆ°å› ä¸ºä½¿ç”¨äº† ?. è¯­æ³•ç³–è€Œå¯¼è‡´çš„ this æŒ‡é’ˆä¸ºnullçš„å¥‡å¦™bugï¼Œå¤§æ¦‚ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªåŸå› ã€‚</p>
<p>ç°åœ¨çš„å…¬å¸æ˜¯åšæ‰‹æ¸¸çš„ï¼Œå¤§å®¶å¯¹æ€§èƒ½éƒ½æ¯”è¾ƒçœ‹é‡ï¼Œä¸è¿‡æˆ‘ä¹ŸçœŸçš„å¥½å¥‡è¿™ä¸ªæ£€æŸ¥åˆ°åº•æœ‰å¤šæ¶ˆè€—ï¼Œå†³å®šè·‘ä¸€è·‘è¯•è¯•ã€‚</p>
<h1 id="Test-Case"><a href="#Test-Case" class="headerlink" title="Test Case"></a>Test Case</h1><p>å› ä¸ºæ˜¯åšæ‰‹æ¸¸ï¼Œéšæ„å¹²è„†å°±åœ¨æ‰‹æœºä¸Šæµ‹è¯•å¥½äº†ã€‚<br>å¤§æ¦‚æ˜¯è¿™æ ·çš„ç¯å¢ƒ:<br>Unity 2019.4 LTS</p>
<p>ç§»åŠ¨è®¾å¤‡è¿™è¾¹æ˜¯<br>Google Pixel Verzion(ä¿ºç©·ä¹°ç¾ç‰ˆ)<br>Android 9 (å·²è·å–Rootæƒé™)</p>
<p>TestCase è¿™è¾¹å…¶å®æˆ‘éƒ½æ˜¯çå¼„çš„ã€‚</p>
<p>åˆ†åˆ«è¿›è¡Œä¸‰ç§æµ‹è¯•ï¼š<br>Unity Object çš„ç©ºå¼•ç”¨æ£€æŸ¥ï¼›<br>POCO Object çš„ç©ºå¼•ç”¨æ£€æŸ¥ï¼›<br>bool çš„ç›´æ¥æ£€æŸ¥ï¼›(å› ä¸ºæˆ‘è§‰å¾—è¿™æ˜¯ä¸€ä¸ªä»£æ›¿Unity Objectç©ºå¼•ç”¨æ£€æŸ¥çš„ä¸€ä¸ªæ–¹æ³•</p>
<p>æ¯ä¸€ç§æ£€æŸ¥éƒ½æœ‰æ£€æŸ¥åˆ°trueå’Œfalseçš„ä¸¤ç§æƒ…å†µï¼Œå¹¶å¾ªç¯è·‘å¤šæ¬¡ã€‚</p>
<p>ç„¶åï¼Œä¸Šä»£ç ï¼</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">TempCheckTest</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TempObjA</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> m_tempNum = <span class="number">56</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NullCheckTester</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// unity obj null check</span></span><br><span class="line">        <span class="keyword">private</span> Transform m_emptyTransform = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">private</span> Transform m_selfTransform = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// poco obj null check</span></span><br><span class="line">        <span class="keyword">private</span> TempObjA m_emptyObjA = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">private</span> TempObjA m_objA = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// bool check</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> m_boolTrue = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> m_boolFalse = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"test"</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> m_checkTimes = <span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"UI side"</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> UnityEngine.UI.Text m_outPutText = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> UnityEngine.UI.Button m_doUnityObjTestButton = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> UnityEngine.UI.Button m_doPocoObjTestButton = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> UnityEngine.UI.Button m_doBoolTestButton = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> UnityEngine.UI.InputField m_inputField = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Button(<span class="meta-string">"init awake"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InitTester</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_emptyTransform = <span class="literal">null</span>;</span><br><span class="line">            m_selfTransform = <span class="keyword">this</span>.transform;</span><br><span class="line"></span><br><span class="line">            m_emptyObjA = <span class="literal">null</span>;</span><br><span class="line">            m_objA = <span class="keyword">new</span> TempObjA();</span><br><span class="line"></span><br><span class="line">            m_boolTrue = <span class="literal">true</span>;</span><br><span class="line">            m_boolFalse = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            m_outPutText.text = <span class="keyword">string</span>.Empty;</span><br><span class="line"></span><br><span class="line">            m_doUnityObjTestButton.onClick.RemoveAllListeners();</span><br><span class="line">            m_doPocoObjTestButton.onClick.RemoveAllListeners();</span><br><span class="line">            m_doBoolTestButton.onClick.RemoveAllListeners();</span><br><span class="line"></span><br><span class="line">            m_doUnityObjTestButton.onClick.AddListener(DoUnityObjNullCheckTest);</span><br><span class="line">            m_doPocoObjTestButton.onClick.AddListener(DoPOCOObjNullCheckTest);</span><br><span class="line">            m_doBoolTestButton.onClick.AddListener(DoBoolObjNullCheckTest);</span><br><span class="line"></span><br><span class="line">            m_inputField.onValueChanged.RemoveAllListeners();</span><br><span class="line">            m_inputField.onValueChanged.AddListener(OnInputNumberChanged);</span><br><span class="line">            m_checkTimes = <span class="number">100000</span>;</span><br><span class="line">            m_inputField.text = m_checkTimes.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Button(<span class="meta-string">"do unity.object null check test"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoUnityObjNullCheckTest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            System.Diagnostics.Stopwatch watcher = <span class="keyword">new</span> System.Diagnostics.Stopwatch();</span><br><span class="line">            watcher.Start();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_checkTimes; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == m_emptyTransform) &#123;&#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == m_selfTransform) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            watcher.Stop();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> outPut = <span class="string">$"do unity.object null check test 2*<span class="subst">&#123;m_checkTimes&#125;</span> cost <span class="subst">&#123;watcher.ElapsedMilliseconds&#125;</span>ms"</span>;</span><br><span class="line">            m_outPutText.text = outPut;</span><br><span class="line">            Debug.Log(outPut);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Button(<span class="meta-string">"do poco object null check test"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoPOCOObjNullCheckTest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            System.Diagnostics.Stopwatch watcher = <span class="keyword">new</span> System.Diagnostics.Stopwatch();</span><br><span class="line">            watcher.Start();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_checkTimes; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == m_emptyObjA) &#123;&#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == m_objA) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            watcher.Stop();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> outPut = <span class="string">$"do poco object null check test 2*<span class="subst">&#123;m_checkTimes&#125;</span> cost <span class="subst">&#123;watcher.ElapsedMilliseconds&#125;</span>ms"</span>;</span><br><span class="line">            m_outPutText.text = outPut;</span><br><span class="line">            Debug.Log(outPut);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Button(<span class="meta-string">"do bool check test"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoBoolObjNullCheckTest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            System.Diagnostics.Stopwatch watcher = <span class="keyword">new</span> System.Diagnostics.Stopwatch();</span><br><span class="line">            watcher.Start();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_checkTimes; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (m_boolFalse) &#123;&#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (m_boolTrue) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            watcher.Stop();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> outPut = <span class="string">$"do bool check test 2*<span class="subst">&#123;m_checkTimes&#125;</span> cost <span class="subst">&#123;watcher.ElapsedMilliseconds&#125;</span>ms"</span>;</span><br><span class="line">            m_outPutText.text = outPut;</span><br><span class="line">            Debug.Log(outPut);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnInputNumberChanged</span>(<span class="params"><span class="keyword">string</span> arg0</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!Int32.TryParse(arg0, <span class="keyword">out</span> result))</span><br><span class="line">                result = Int32.MaxValue;</span><br><span class="line"></span><br><span class="line">            m_checkTimes = result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> mono method</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitTester();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitTester();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.enabled = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Test-Result"><a href="#Test-Result" class="headerlink" title="Test Result"></a>Test Result</h1><img src="/2020/06/20/20200620-unity-obj-null-check/20200620-pic001.png" class="" title="split">
<p>åˆ†åˆ«è¿›è¡Œ10wæ¬¡å’Œ100wæ¬¡æµ‹è¯•çœ‹çœ‹ç»“æœã€‚</p>
<p>10wæ¬¡:<br>Unity Object null check 4~7ms<br>POCO Object null check 0ms<br>bool check 0ms</p>
<p>100wæ¬¡:<br>Unity Object null check 45~60ms<br>POCO Object null check 3~4ms<br>bool check 2ms</p>
<p>å½“æ£€æµ‹æ•°é‡éå¸¸å¤šçš„æ—¶å€™ï¼ŒUnity Object ç©ºå¼•ç”¨æ£€æŸ¥çš„æ€§èƒ½æ¶ˆè€—æ¯”å…¶ä»–ä¸¤ä¸ªå¤§äº†å¾ˆå¤šå¾ˆå¤šã€‚ç°åœ¨çš„é¡¹ç›®é‡Œå¤§éƒ¨åˆ†ä¸œè¥¿å…¶å®éƒ½æ˜¯POCOçš„ã€‚<br>ä¼¼ä¹æŠŠUnityObject Destroyä¹‹åå†æ‰‹åŠ¨æŠŠå˜é‡ç½®ç©ºæ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼ˆ</p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityOptimization</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity OnAudioFilterRead å­¦ä¹ ç¬”è®°</title>
    <url>/2020/10/17/20201017-unity-onaudiofilterread/</url>
    <content><![CDATA[<p>æœ€è¿‘æƒ³ç€åšä¸€ä¸ªéŸ³ä¹æ¸¸æˆçš„DEMOè¯•è¯•ï¼Œä½†æ˜¯æ¯«æ— å¤´ç»ªä¸çŸ¥é“æ€ä¹ˆå¼€å§‹ã€‚çœ‹äº†ä¸‹é‚¦é‚¦çš„è§†é¢‘å†³å®šå…ˆæŠŠèŠ‚æ‹å™¨åšå‡ºæ¥ï¼Œå†ç”¨èŠ‚æ‹å™¨æä¾›çš„äº‹ä»¶å»æ”¯æ’‘èµ·å…¶å®ƒçš„éƒ¨åˆ†ã€‚</p>
<p>å› ä¸ºå®Œå…¨æ²¡åšè¿‡éŸ³ä¹æ¸¸æˆï¼Œè€Œä¸”ä¹Ÿå¯¹æ¸¸æˆå¼•æ“ä»¥åŠå£°éŸ³æ–¹é¢æ²¡æœ‰ä»€ä¹ˆäº†è§£ï¼Œæ‰€ä»¥å¼€å§‹åœ¨ç½‘ä¸Šæµ·æœèŠ‚æ‹å™¨çš„ä»£ç å¹¶æ‹¿æ¥æµ‹è¯•ã€‚</p>
<p>æœ€åå¾—åˆ°ä¿©è§£å†³æ–¹æ¡ˆï¼š1.åœ¨Unityé‡Œå†™ä¸€ä¸ªï¼›2.ä½¿ç”¨ä¸“ä¸šçš„éŸ³é¢‘æ’ä»¶ï¼ˆå¦‚CRIWAREæˆ–è€…WWISEï¼‰ï¼Œä½¿ç”¨é‡Œé¢çš„èŠ‚æ‹å™¨ã€‚<br>å› ä¸ºåªæ˜¯å°è¯•åšåšDEMOï¼Œå†³å®šå…ˆä¸å¼•å…¥éŸ³é¢‘æ’ä»¶äº†ã€‚</p>
<p>åœ¨å†²æµªæŸ¥è¯¢çš„æ—¶å€™å‘ç°Unityçš„å®˜æ–¹æ–‡æ¡£ä¸­å·²ç»å†™å¥½äº†ä¸€ä¸ªï¼çœŸæ˜¯å¤ªæ£’äº†ï¼Œé©¬ä¸Šå«–è¿‡æ¥ç”¨ã€‚ä¸ºäº†æ–¹ä¾¿ä¹‹åä½¿ç”¨ï¼Œæˆ‘ä¹Ÿå†³å®šæŠŠè¿™ä»½ä»£ç å°½å¯èƒ½çœ‹æ‡‚ã€‚</p>
<p>ä¸‹é¢æ˜¯Unityçš„æºç <br><a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.OnAudioFilterRead.html" target="_blank" rel="noopener">MonoBehaviour.OnAudioFilterRead(float[], int)</a><br><a href="https://docs.unity3d.com/ScriptReference/AudioSettings-dspTime.html" target="_blank" rel="noopener">AudioSettings.dspTime</a></p>
<h1 id="æå–åŸºæœ¬ä»£ç "><a href="#æå–åŸºæœ¬ä»£ç " class="headerlink" title="æå–åŸºæœ¬ä»£ç "></a>æå–åŸºæœ¬ä»£ç </h1><p>é¦–å…ˆæˆ‘å¤§æ¦‚è·‘äº†ä¸€ä¸‹ï¼Œçœ‹äº†ä¸€ä¸‹ï¼Œæå–å‡ºäº†æˆ‘è®¤ä¸ºæ˜¯èŠ‚æ‹å™¨æœ€åŸºæœ¬çš„éƒ¨åˆ†ã€‚</p>
<p>signatureHi / signatureLo =&gt; è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å‡ å‡ æ‹ã€‚<br>signatureHiæ˜¯æ¯å°èŠ‚çš„æ‹å­æ•°ï¼ŒsignatureLoæ˜¯æŒ‡xåˆ†éŸ³ç¬¦ä¸º1æ‹ã€‚accentæ˜¯æŒ‡å½“å‰å°ç»“å†…çš„æ‹å­æ•°ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="meta">RequireComponent(typeof(AudioSource))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MetronomeExample</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> bpm = <span class="number">128.0f</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> signatureHi = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> signatureLo = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> nextTick = <span class="number">0.0F</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> sampleRate = <span class="number">0.0F</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> accent= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> running = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> System.Action&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; OnBeatTick;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        accent = signatureHi;</span><br><span class="line">        sampleRate = AudioSettings.outputSampleRate;</span><br><span class="line">        nextTick = AudioSettings.dspTime * sampleRate;</span><br><span class="line">        running = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnAudioFilterRead</span>(<span class="params"><span class="keyword">float</span>[] data, <span class="keyword">int</span> channels</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!running)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">double</span> samplesPerTick = sampleRate * (<span class="number">60.0f</span> / bpm) * (<span class="number">4.0f</span> / signatureLo);</span><br><span class="line">        <span class="keyword">double</span> sample = AudioSettings.dspTime * sampleRate;</span><br><span class="line">        <span class="keyword">int</span> dataLen = data.Length / channels;</span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (n &lt; dataLen)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span> (sample + n &gt;= nextTick)</span><br><span class="line">            &#123;</span><br><span class="line">                nextTick += samplesPerTick;</span><br><span class="line">                <span class="keyword">if</span> (++accent &gt; signatureHi)</span><br><span class="line">                &#123;</span><br><span class="line">                    accent = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                OnBeatTick?.Invoke(accent, signatureHi);</span><br><span class="line">                Debug.Log(<span class="string">$"Tick: <span class="subst">&#123;accent&#125;</span> / <span class="subst">&#123;signatureHi&#125;</span>"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            n++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">nextTick = AudioSettings.dspTime * sampleRate; </span><br><span class="line">``` </span><br><span class="line">ä» Start() å¼€å§‹ï¼Œå…ˆåšèŠ‚æ‹å™¨çš„åˆå§‹åŒ–ã€‚ å› ä¸ºéœ€è¦å‡†ç¡®çš„éŸ³é¢‘æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šä½¿ç”¨éŸ³é¢‘ç›¸å…³çš„å‡½æ•°æ¥æ“ä½œï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Update()ã€‚</span><br><span class="line">é€šè¿‡å½“å‰çš„æ—¶é—´ * å½“å‰çš„é‡‡æ ·ç‡ï¼Œå¤§æ¦‚å°±èƒ½å¾—åˆ°å½“å‰çš„éŸ³é¢‘ä¿¡æ¯æ€»é‡ã€‚</span><br><span class="line"></span><br><span class="line">``` CSharp</span><br><span class="line">OnAudioFilterRead(<span class="keyword">float</span>[] data, <span class="keyword">int</span> channels)</span><br><span class="line">``` </span><br><span class="line">æ¥ç€æˆ‘ä»¬å¯ä»¥æŠŠ OnAudioFilterRead() çœ‹ä½œ Update() æ¥ä½¿ç”¨ã€‚ </span><br><span class="line">channels å¤§æ¦‚æ˜¯å£°é“æ•°,æ¯”å¦‚æˆ‘å¹³æ—¶ç”¨çš„è¾£é¸¡æœºå™¨æ˜¯åŒå£°é“ï¼ˆå·¦å³çš„ï¼‰ï¼Œé‚£ä¹ˆ channels çš„å€¼å°±æ˜¯<span class="number">2</span>ã€‚</span><br><span class="line">data[] ä¸­å­˜å‚¨çš„æ˜¯å½“å‰è¿™ä¸€æ¬¡éå†çš„éŸ³é¢‘æ•°æ®ï¼Œä¹Ÿä¼šåŒ…å«ä¸åŒå£°é“çš„éŸ³é¢‘ä¿¡æ¯ï¼Œæ¯”å¦‚\[<span class="number">0L</span>, <span class="number">1</span>R, <span class="number">2L</span>, <span class="number">3</span>R....\]ä¹‹ç±»çš„ã€‚</span><br><span class="line"></span><br><span class="line">``` CSharp</span><br><span class="line"><span class="keyword">double</span> samplesPerTick = sampleRate * (<span class="number">60.0f</span> / bpm) * (<span class="number">4.0f</span> / signatureLo);</span><br><span class="line"><span class="keyword">double</span> sample = AudioSettings.dspTime * sampleRate;</span><br><span class="line">``` </span><br><span class="line">è¿™é‡Œæ˜¯ç”¨ä¸è®¡ç®—æ‹å­çš„é—´éš”æ—¶é—´ã€‚(<span class="number">60.0f</span> / bpm) æ‰€è®¡ç®—çš„æ˜¯å¯¹äº <span class="number">4</span>/<span class="number">4</span> æ‹è€Œè¨€çš„æ‹å­é—´éš”æ—¶é—´ã€‚</span><br><span class="line">è€Œ (<span class="number">4.0f</span> / signatureLo) å¯ä»¥ç®—å‡ºä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¹˜ç»™ <span class="number">4</span>/<span class="number">4</span> æ‹è€Œè¨€çš„æ‹å­é—´éš”æ—¶é—´ã€‚</span><br><span class="line">sample å¯ä»¥ç²—æµ…çš„è®¤ä¸ºæ˜¯å½“å‰çš„æ—¶é—´ã€‚</span><br><span class="line"></span><br><span class="line">``` CSharp</span><br><span class="line"><span class="keyword">while</span> (n &lt; dataLen)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (sample + n &gt;= nextTick)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ç”¨èµ·æ¥å°±ç›¸å½“äº</span></span><br><span class="line">        <span class="comment">// nextTime = Time.time * timeInterval; </span></span><br><span class="line">        nextTick += samplesPerTick;</span><br><span class="line">        <span class="keyword">if</span> (++accent &gt; signatureHi)</span><br><span class="line">        &#123;</span><br><span class="line">            accent = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        OnBeatTick?.Invoke(accent, signatureHi);</span><br><span class="line">        Debug.Log(<span class="string">$"Tick: <span class="subst">&#123;accent&#125;</span> / <span class="subst">&#123;signatureHi&#125;</span>"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    n++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™è¾¹éå†ä¸€ä¸‹æ¥ä¸‹æ¥ä¼šæ’­æ”¾çš„éŸ³é¢‘æ•°æ®ã€‚æ ¹æ®æ•°æ®çš„é•¿åº¦æ¥åˆ¤æ–­æ˜¯å¦ä¼šéœ€è¦å‘å‡ºèŠ‚æ‹å™¨çš„ tickã€‚</p>
<h1 id="èŠ‚æ‹å™¨éŸ³æ•ˆ"><a href="#èŠ‚æ‹å™¨éŸ³æ•ˆ" class="headerlink" title="èŠ‚æ‹å™¨éŸ³æ•ˆ"></a>èŠ‚æ‹å™¨éŸ³æ•ˆ</h1><p>åœ¨å®˜æ–¹æºç ä¸­è¿˜ç”¨åˆ°äº†ä¸€äº›å…¶ä»–çš„å˜é‡ï¼Œå¹¶ç»™dataèµ‹å€¼ï¼Œå…¶å®è¿™äº›å°±æ˜¯ä¸ºäº†æ’­æ”¾èŠ‚æ‹å™¨éŸ³æ•ˆè€Œå­˜åœ¨çš„ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">while</span> (n&lt;dataLen)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> x = gain * amp * Mathf.Sin(phase);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; channels)</span><br><span class="line">    &#123;</span><br><span class="line">        data[n * channels + i] += x;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (sample + n &gt;= nextTick)</span><br><span class="line">    &#123;</span><br><span class="line">        nextTick += samplesPerTick;</span><br><span class="line">        amp = <span class="number">1.0F</span>;</span><br><span class="line">        <span class="keyword">if</span> (++accent &gt; signatureHi)</span><br><span class="line">        &#123;</span><br><span class="line">            accent = <span class="number">1</span>;</span><br><span class="line">            amp *= <span class="number">2.0F</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        OnBeatTick?.Invoke(accent, signatureHi);</span><br><span class="line">        Debug.Log(<span class="string">$"Tick: <span class="subst">&#123;accent&#125;</span> / <span class="subst">&#123;signatureHi&#125;</span>"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    phase += amp* <span class="number">0.3F</span>;</span><br><span class="line">    amp *= <span class="number">0.993F</span>;</span><br><span class="line">    n++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ‘¸äº†"><a href="#æ‘¸äº†" class="headerlink" title="æ‘¸äº†"></a>æ‘¸äº†</h1><p>æ„Ÿè§‰è‡ªå·±çš„çŸ¥è¯†é¢åˆçª„åˆæµ…ï¼Œè¿˜æ˜¯éœ€è¦å¤šçœ‹ä¹¦æ‰è¡Œã€‚</p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>Audio</tag>
      </tags>
  </entry>
  <entry>
    <title>UnityEditor EasyButton ç®€æ˜“ç¼–è¾‘å™¨æŒ‰é’®</title>
    <url>/2020/06/05/20200605-Unity-EasyButton/</url>
    <content><![CDATA[<p>ä¸€ä¸ªæ¯”è¾ƒç®€å•ä½†æ˜¯æ–¹ä¾¿çš„ä¸œè¥¿</p>
<h1 id="è¿™æ˜¯å•¥"><a href="#è¿™æ˜¯å•¥" class="headerlink" title="è¿™æ˜¯å•¥"></a>è¿™æ˜¯å•¥</h1><p>æˆ‘ä»¬å¹³æ—¶äº›å†™äº†ä¸€äº›å‡½æ•°åœ¨MonoBehavioré‡Œæƒ³æµ‹è¯•ï¼Œè¿™è¾¹å¯ä»¥æ•´ä¸€ä¸ªç‰¹æ€§æ”¾åœ¨éœ€è¦å¿«é€Ÿè°ƒç”¨çš„æ–¹æ³•ä¸Š(é™äºæ— å‚æ•°çš„å‡½æ•°)ã€‚<br>è¿™è¾¹å¯ä»¥åšä¸€ä¸ªç¼–è¾‘å™¨çš„æŒ‰é’®ï¼Œç›´æ¥æ”¾åœ¨MonoBehaviorçš„ç»„ä»¶é¢æ¿ä¸Šã€‚</p>
<h1 id="ä¸Šä»£ç "><a href="#ä¸Šä»£ç " class="headerlink" title="ä¸Šä»£ç "></a>ä¸Šä»£ç </h1><p>å…ˆå®šä¹‰æˆ‘ä»¬éœ€è¦çš„è¿™ä¸ªç‰¹æ€§ï¼Œæ—¢ç„¶æ˜¯åšä¸ªæŒ‰é’®ï¼Œé‚£å°±å«Buttonå¥½äº†ã€‚é‚£ä¹ˆè¿™ä¸ªç‰¹æ€§å°±åº”è¯¥å«åšButtonAttributeã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">[<span class="meta">AttributeUsage(AttributeTargets.Method)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ButtonAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> m_methodName = <span class="keyword">string</span>.Empty;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ButtonAttribute</span>(<span class="params"><span class="keyword">string</span> methodName</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_methodName = methodName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ—¢ç„¶æˆ‘ä»¬è¦åœ¨Inspectoré¢æ¿ä¸ŠåŠ ä¸œè¥¿ï¼Œé‚£æˆ‘ä»¬ä¹Ÿè¦æ“ä½œä¸€ä¸‹Inspectoré¢æ¿ã€‚<br>æˆ‘ä»¬åšä¸€ä¸ªCustomEditoré¢æ¿ç»™æˆ‘ä»¬çš„MonoBehaviorï¼Œè¿™ä¸ªé¢æ¿ä¼šä½œç”¨äºæ‰€æœ‰çš„MonoBehaviorã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">[<span class="meta">CustomEditor(typeof(MonoBehaviour), true), CanEditMultipleObjects</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BaseEditor</span> : <span class="title">Editor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Type m_targetType = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnInspectorGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// draw default stuff</span></span><br><span class="line">        <span class="keyword">base</span>.OnInspectorGUI();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == m_targetType)</span><br><span class="line">            m_targetType = target.GetType();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (m_targetType != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// try find member function and static function :)</span></span><br><span class="line">            MethodInfo[] methods = m_targetType.GetMethods(BindingFlags.Instance | BindingFlags.Static | BindingFlags.NonPublic | BindingFlags.Public);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> method <span class="keyword">in</span> methods)</span><br><span class="line">            &#123;</span><br><span class="line">                ButtonAttribute button = method.GetCustomAttribute&lt;ButtonAttribute&gt;();</span><br><span class="line">                <span class="keyword">if</span> (button != <span class="literal">null</span> &amp;&amp; method.GetParameters().Length &gt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    EditorGUILayout.HelpBox(<span class="string">"ButtonAttribute: method cant have parameterz."</span>, MessageType.Warning);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (button != <span class="literal">null</span> &amp;&amp; GUILayout.Button(button.m_methodName))</span><br><span class="line">                &#123;</span><br><span class="line">                    method.Invoke(target, <span class="keyword">new</span> <span class="keyword">object</span>[] &#123; &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            m_targetType = m_targetType.BaseType;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ–°å»ºä¸€ä¸ªMonoBehaviorè„šæœ¬ï¼Œè¯•è¯•</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ToxicTester</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Button(<span class="meta-string">"try exec public method"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ExecPublicMethod</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Debug.Log(<span class="string">"try exec public method wa"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Button(<span class="meta-string">"try exec protected method"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">ExecProtectedMethod</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Debug.Log(<span class="string">"try exec protected method wa"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    [<span class="meta">Button(<span class="meta-string">"try exec private method"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ExecPrivateMethod</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Debug.Log(<span class="string">"try exec private method wa"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Button(<span class="meta-string">"try exec public static method"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ExecPublicStaticMethod</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Debug.Log(<span class="string">"try exec public static method wa"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2020/06/05/20200605-Unity-EasyButton/20200605-pic001.png" class="" title="split">
<p>æ•ˆæœå¦‚å›¾</p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®€æ˜“æ£€æµ‹ï¼Œç›®æ ‡æ˜¯å¦åœ¨æ‰‡å½¢åŒºåŸŸ(2D)</title>
    <url>/2020/06/14/20200614-check-target-fan-shape/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨é¡¹ç›®ç»„é‡Œåšä¸€äº›å°æ¸¸æˆåŸå‹ï¼Œæ·±æ„Ÿè‡ªå·±èœå¾—å¦‚è™«è±¸ã€‚ä¸ºäº†æ…¢æ…¢æå‡è¿˜æ˜¯å†³å®šåšä¸€äº›è®°å½•ï¼Œè™½ç„¶åªæ˜¯å¾ˆåƒåœ¾çš„åŠŸèƒ½ã€‚<br>å› ä¸ºåšçš„æ˜¯æ‰‹æ¸¸ï¼Œæ‰€ä»¥å¯¹æ€§èƒ½è›®çœ‹é‡çš„ï¼Œè¯´æ˜¯åŸå‹ï¼Œä¸ºäº†å¿«ä¹Ÿåªæ˜¯é¡¹ç›®é‡Œå¼€äº†ä¸ªå•ç‹¬çš„æ–°åœºæ™¯åšçš„ï¼Œ3Céƒ½æœ‰ï¼Œåšå¥½äº†å¯ä»¥ç›´æ¥æ‰“åŒ…APKè¯•ç©ã€‚<br>åºŸè¯ä¸å¤šè¯´ï¼Œè¿™æ¬¡åšçš„äº‹å¾ˆç®€å•ï¼Œåœ¨æ‰‡å½¢åŒºåŸŸå†…æ£€æµ‹ä¸€äº›ç›®æ ‡ã€‚å› ä¸ºå¬è¯´Vector3. Angle()é‡Œä¼šè·‘å¼€æ–¹çš„è®¡ç®—ï¼Œæ•…å°è¯•é¿å…ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
<img src="/2020/06/14/20200614-check-target-fan-shape/20200614-pic001.png" class="" title="split">
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>éœ€è¦è§£å†³çš„éœ€æ±‚æ˜¯åœ¨æ£€æµ‹è€… å‰æ–¹ çš„ä¸€ä¸ªæ‰‡å½¢å†…æ£€æµ‹ç›®æ ‡ç‰©ä½“ï¼Œå…¶å®å¯ä»¥åŒ–ç®€ä¸º2Då¹³é¢çš„æ£€æµ‹ã€‚<br>æˆ‘å†³å®šå¤šæ¬¡ä½¿ç”¨ç‚¹ä¹˜å’Œå‰ä¹˜æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å·²çŸ¥æ•°æ®ï¼š<br>æ£€æµ‹è€…çš„ä½ç½®ï¼Œæœå‘ï¼Œæ£€æµ‹è§’åº¦å¤§å°ï¼ŒåŠå¾„å¤§å°<br>æ£€æµ‹ç›®æ ‡çš„ä½ç½®</p>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>ç”¨æ£€æµ‹è€…çš„å‰æ–¹å‘é‡å’Œæ£€æµ‹è€…åˆ°ç›®æ ‡çš„æ–¹å‘å‘é‡ç‚¹ä¹˜æ¥åˆ¤æ–­ç›®æ ‡ç‰©ä½“æ˜¯å¦åœ¨æ£€æµ‹è€…å‰æ–¹ã€‚</li>
<li>ç”¨æ£€æµ‹è€…å‰æ–¹æ–¹å‘å‘é‡å’Œæ£€æµ‹åŒºåŸŸçš„ä¸¤ä¸ªè¾¹ç•Œæ–¹å‘åˆ†åˆ«å‰ä¹˜å¾—åˆ°ä¸¤ä¸ªæ³•å‘å‘é‡A,Bã€‚</li>
<li>ç”¨æ£€æµ‹è€…åˆ°ç›®æ ‡çš„æ–¹å‘å‘é‡å’Œæ£€æµ‹åŒºåŸŸçš„ä¸¤ä¸ªè¾¹ç•Œæ–¹å‘åˆ†åˆ«å‰ä¹˜å¾—åˆ°ä¸¤ä¸ªæ³•å‘å‘é‡C,Dã€‚</li>
<li>ç”¨ç‚¹ä¹˜æ£€æµ‹C,Dæ˜¯å¦åŒå‘ï¼Œæ˜¯ï¼Œåˆ™åœ¨æ£€æµ‹åŒºå¤–</li>
<li>æ˜¯å¦åŒæ—¶æ»¡è¶³å‘é‡A,CåŒå‘ï¼Œå‘é‡B,DåŒå‘ï¼Œæ˜¯ï¼Œåˆ™åœ¨æ£€æµ‹åŒºå†…</li>
</ol>
<p>å…¶å®æˆ‘è‡ªå·±éƒ½æ„Ÿè§‰è¿™ä¸­æ–‡ï¼Œå†™å¾—å¾ˆä¹±ï¼Œè¿˜ä¸å¦‚ç›´æ¥çœ‹ä»£ç 23333<br>å…¨éƒ¨ä»£ç ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TargetCheckTester</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Transform m_transform = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> m_checkAngle = <span class="number">60.0f</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> m_checkRadius = <span class="number">6.0f</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Transform m_targetTransform = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CheckTarget1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == m_targetTransform)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        Vector3 myPos = m_transform.position;</span><br><span class="line">        Vector3 myForward = m_transform.forward;</span><br><span class="line">        <span class="keyword">float</span> halfAngle = m_checkAngle * <span class="number">0.5f</span>;</span><br><span class="line">        Vector3 dirUp = Quaternion.Euler(<span class="number">0.0f</span>, -halfAngle, <span class="number">0.0f</span>) * myForward;</span><br><span class="line">        Vector3 dirDown = Quaternion.Euler(<span class="number">0.0f</span>, halfAngle, <span class="number">0.0f</span>) * myForward;</span><br><span class="line"></span><br><span class="line">        Vector3 upCheck = Vector3.Cross(myForward, dirUp);</span><br><span class="line">        Vector3 downCheck = Vector3.Cross(myForward, dirDown);</span><br><span class="line"></span><br><span class="line">        Vector3 targetPos = m_targetTransform.position;</span><br><span class="line">        <span class="comment">// hack, to make them on a 2d plane :)</span></span><br><span class="line">        targetPos.y = myPos.y;</span><br><span class="line">        Vector3 toTargetDir = targetPos - myPos;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// draw line</span></span><br><span class="line">        Vector3 point1 = myPos + dirUp * m_checkRadius;</span><br><span class="line">        Vector3 point2 = myPos + dirDown * m_checkRadius;</span><br><span class="line">        Vector3 point0 = myPos + myForward * m_checkRadius;</span><br><span class="line"></span><br><span class="line">        Debug.DrawLine(myPos, point1, Color.yellow, Time.deltaTime);</span><br><span class="line">        Debug.DrawLine(myPos, point2, Color.yellow, Time.deltaTime);</span><br><span class="line">        Debug.DrawLine(myPos, point0, Color.yellow, Time.deltaTime);</span><br><span class="line">        Debug.DrawLine(point1, point0, Color.yellow, Time.deltaTime);</span><br><span class="line">        Debug.DrawLine(point2, point0, Color.yellow, Time.deltaTime);</span><br><span class="line">        Debug.DrawLine(myPos, targetPos, Color.red, Time.deltaTime);</span><br><span class="line">        <span class="comment">// draw line</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Vector3.Dot(toTargetDir, myForward) &lt; <span class="number">0.0f</span> || toTargetDir.sqrMagnitude &gt; m_checkRadius * m_checkRadius)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        Vector3 targetUpCheck = Vector3.Cross(toTargetDir, dirUp);</span><br><span class="line">        Vector3 targetDownCheck = Vector3.Cross(toTargetDir, dirDown);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> selfCheck = Vector3.Dot(targetUpCheck, targetDownCheck);</span><br><span class="line">        <span class="keyword">float</span> dotCheckUp = Vector3.Dot(upCheck, targetUpCheck);</span><br><span class="line">        <span class="keyword">float</span> dotCheckDown = Vector3.Dot(targetDownCheck, downCheck);</span><br><span class="line">        <span class="keyword">if</span> (selfCheck &lt;= <span class="number">0.0f</span> &amp;&amp; dotCheckUp * dotCheckDown &gt;= <span class="number">0.0f</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">"target in sight"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">region</span> mono method</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_transform = <span class="keyword">this</span>.transform;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        CheckTarget1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2020/06/14/20200614-check-target-fan-shape/20200614-pic002.png" class="" title="split">]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>Gameplay</tag>
      </tags>
  </entry>
  <entry>
    <title>Unityå‡½æ•°Awakeå’ŒOnEnableæ‰§è¡Œé¡ºåºå°å‘</title>
    <url>/2020/06/22/20200622-awake-enable-order/</url>
    <content><![CDATA[<blockquote>
<p>Awake: This function is always called before any Start functions and also just after a prefabis instantiated. (If a GameObject is inactive during start up Awake is not called until it is made active.)</p>
<p>OnEnable: (only called if the Object is active): This function is called just after the object is enabled. This happens when a MonoBehaviour instance is created, such as when a level is loaded or a GameObject with the script component is instantiated.</p>
</blockquote>
<p><a href="https://docs.unity3d.com/Manual/ExecutionOrder.html" target="_blank" rel="noopener">check the exec order here</a></p>
<img src="/2020/06/22/20200622-awake-enable-order/20200622-pic001.png" class="" title="split">
<p>ä»Šå¤©åšå·¥æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨Mono Açš„ Awake ä¸­æŠŠMono Açš„å®ä¾‹ç»‘å®šåˆ°äº†GameManageré‡Œï¼Œç„¶åå†Mono Bçš„ OnEnable ä¸­è·å–Mono Açš„å®ä¾‹ï¼Œç»“æœè·³äº†ä¸ªç©ºå¼•ç”¨å¼‚å¸¸ã€‚<br>æŠŠæˆ‘æƒŠäº†ï¼ŒåŸæ¥è¿™ä¸€å¹´å¤šæ¥æˆ‘ä¸€ç›´åœ¨ä¸€ä¸ªè¯¯åŒºé‡Œã€‚</p>
<p>æˆ‘ä»¥å‰ä¸€ç›´è®¤ä¸ºæ˜¯å½“åœºæ™¯é‡Œæ‰€æœ‰çš„ Awake è·‘å®Œæ‰å¼€å§‹è·‘ OnEnable()ã€‚ä½†å…¶å®ä¸æ˜¯è¿™æ ·çš„ã€‚</p>
<p><strong>å½“ä¸€ä¸ªMonoçš„ Awake è·‘å®Œä»¥åä¼šæ¥ç€è·‘ä»–çš„ OnEnable , æ¥ç€æ‰å»è·‘å…¶ä»–ç‰©ä½“çš„ Awake å’Œ OnEnableã€‚</strong></p>
<p>éšä¾¿å†™ä¸¤è¡Œæµ‹è¯•ä¸€ä¸‹å°±çŸ¥é“äº†ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TesterA1</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Type m_type = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_type = <span class="keyword">this</span>.GetType();</span><br><span class="line">        Debug.Log(<span class="string">$"<span class="subst">&#123;m_type.Name&#125;</span> awake"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Debug.Log(<span class="string">$"<span class="subst">&#123;m_type.Name&#125;</span> on enable"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TesterB1</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="keyword">private</span> Type m_type = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_type = <span class="keyword">this</span>.GetType();</span><br><span class="line">        Debug.Log(<span class="string">$"<span class="subst">&#123;m_type.Name&#125;</span> awake"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Debug.Log(<span class="string">$"<span class="subst">&#123;m_type.Name&#125;</span> on enable"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TesterC1</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Type m_type = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_type = <span class="keyword">this</span>.GetType();</span><br><span class="line">        Debug.Log(<span class="string">$"<span class="subst">&#123;m_type.Name&#125;</span> awake"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Debug.Log(<span class="string">$"<span class="subst">&#123;m_type.Name&#125;</span> on enable"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éƒ½æ•´ä¸Šä¸€æ ·çš„å†…å®¹ï¼ŒAå’ŒCç»‘åœ¨ç‰©ä½“tester01ä¸Šï¼ŒBç»‘åœ¨ç‰©ä½“tester02ä¸Šã€‚</p>
<img src="/2020/06/22/20200622-awake-enable-order/20200622-pic002.png" class="" title="split">
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
      </tags>
  </entry>
  <entry>
    <title>JSè„šæœ¬åˆ é™¤è±†ç“£å¹¿æ’­</title>
    <url>/2020/12/20/20201220-delete-douban-post/</url>
    <content><![CDATA[<h1 id="JSè„šæœ¬åˆ é™¤è±†ç“£å¹¿æ’­"><a href="#JSè„šæœ¬åˆ é™¤è±†ç“£å¹¿æ’­" class="headerlink" title="JSè„šæœ¬åˆ é™¤è±†ç“£å¹¿æ’­"></a>JSè„šæœ¬åˆ é™¤è±†ç“£å¹¿æ’­</h1><p>å¾ˆä¹…ä»¥å‰ä¸ºäº†æ¸…ç†è‡ªå·±SPAMåœ¨å¾®åšçš„ä¸œè¥¿ï¼Œæ‰¾è¿‡æ‰¹é‡åˆ é™¤å¾®åšçš„è„šæœ¬ã€‚ç°åœ¨ä¹Ÿæƒ³é¡ºæ‰‹æ¸…ç†ä¸€ä¸‹è±†ç“£çš„ï¼Œä¸è¿‡æ²¡æ‰¾åˆ°æ¯”è¾ƒå¥½ç”¨çš„ã€‚<br>ä¸è¿‡å®Œå…¨ä¸ä¼šWEBå¼€å‘ï¼Œä¹Ÿåªèƒ½è‡ªå·±æ‹¼å‡‘ä¸€ä¸‹ã€‚</p>
<p>ç›´æ¥ä¸Šä»£ç å§</p>
<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>è±†ç“£æœ‰ä¿æŠ¤æœºåˆ¶çš„ï¼Œå¦‚æœåœ¨çŸ­æ—¶é—´å†…ç–¯ç‹‚å‘é€è¯·æ±‚ï¼Œä¼šåœ¨ä¸€å®šæ—¶é—´å†…è¢«BAN IPï¼ˆäº²èº«ç»å†ï¼‰ã€‚<br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯•ç€ç”¨éšæœºç­‰å¾…çš„æ–¹å¼æ¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// I steal this from somewhere</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleepWait</span>(<span class="params">waitMsec</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> startMsec = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">new</span> <span class="built_in">Date</span>() - startMsec &lt; waitMsec);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execTest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> step = <span class="number">0</span>; step &lt; <span class="number">10</span>; step++) &#123;</span><br><span class="line">        location.reload();</span><br><span class="line">        <span class="keyword">var</span> waitDuration = (<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">10</span>) + <span class="number">1</span>) * <span class="number">10000</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'test log, next exec in'</span> + waitDuration + <span class="string">'ms'</span>);</span><br><span class="line">        sleepWait(waitDuration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤çš„ä»£ç æ˜¯æˆ‘ç™½å«–æ¥çš„ï¼Œåœ¨ æˆ‘çš„å¹¿æ’­ çš„é¡µé¢é‡Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°å¤§æ¦‚å¯ä»¥åˆ é™¤å½“å‰é¡µé¢ä¸­çš„æ‰€æœ‰å¹¿æ’­ã€‚<br>ä¸è¿‡è½¬å‘å¥½åƒä¸ä¸€å®šèƒ½åˆ é™¤ï¼Œä¹‹åè¿˜å¾—æ‰¾åˆ«çš„æ–¹æ³•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// I steal this from somewhere</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execDelTest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123; $.post_withck(<span class="string">"/j/status/delete"</span>, &#123; <span class="attr">sid</span>: c &#125;) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123; $.post_withck(<span class="string">"/j/status/unreshare"</span>, &#123; <span class="attr">sid</span>: c &#125;) &#125;;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">"a[data-reshare-id]"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        b($(<span class="keyword">this</span>).attr(<span class="string">"data-reshare-id"</span>));</span><br><span class="line">        $(<span class="keyword">this</span>).hide()</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">"div[data-sid]"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        a($(<span class="keyword">this</span>).attr(<span class="string">"data-sid"</span>));</span><br><span class="line">        $(<span class="keyword">this</span>).hide()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼Œä¸è¿‡çœŸçš„æ€•è¢«BAN IP å¯ä»¥æŠŠéšæœºç­‰å¾…çš„æ—¶é—´è®¾å®šå¾—é•¿ä¸€äº›</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// I steal this from somewhere</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleepWait</span>(<span class="params">waitMsec</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> startMsec = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">new</span> <span class="built_in">Date</span>() - startMsec &lt; waitMsec);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// I steal this from somewhere</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execDelTest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123; $.post_withck(<span class="string">"/j/status/delete"</span>, &#123; <span class="attr">sid</span>: c &#125;) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123; $.post_withck(<span class="string">"/j/status/unreshare"</span>, &#123; <span class="attr">sid</span>: c &#125;) &#125;;</span><br><span class="line"></span><br><span class="line">    $(<span class="string">"a[data-reshare-id]"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        b($(<span class="keyword">this</span>).attr(<span class="string">"data-reshare-id"</span>));</span><br><span class="line">        $(<span class="keyword">this</span>).hide()</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">"div[data-sid]"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        a($(<span class="keyword">this</span>).attr(<span class="string">"data-sid"</span>));</span><br><span class="line">        $(<span class="keyword">this</span>).hide()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execDelLoop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> step = <span class="number">0</span>; step &lt; <span class="number">10</span>; step++) &#123;</span><br><span class="line">        location.reload();</span><br><span class="line">        <span class="keyword">var</span> waitDuration = (<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">10</span>) + <span class="number">1</span>) * <span class="number">10000</span>;</span><br><span class="line">        sleepWait(waitDuration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// finally execute deletion :D</span></span><br><span class="line">execDelLoop();</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>æ„Ÿè§‰webè¿™è¾¹å¯ä»¥åšè›®å¤šæ–¹ä¾¿æ—¥å¸¸ç”Ÿæ´»ç”¨çš„è„šæœ¬ï¼Œæ”¹å¤©çœŸçš„è¦å¼€å§‹å­¦ä¸€å­¦æ‰è¡Œã€‚</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>å¸¸ç”¨</tag>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿®æ”¹commitæ¶ˆæ¯</title>
    <url>/2021/04/08/20210408-edit-commit-msg/</url>
    <content><![CDATA[<p>å‰å‡ å¤©æ‰“æ¸¸æˆå¤ªç–¯äº†ï¼Œä¸Šç­çš„æ—¶å€™è„‘å­éƒ½ä¸æ¸…é†’ï¼Œcommitçš„æ—¶å€™è¾“é”™äº†ä¸œè¥¿ï¼Œpushçš„æ—¶å€™è¢«blockäº†æ‰å‘ç°ã€‚<br>ç»“æœè¿˜å› ä¸ºä¸ä¼šæ”¹commitæ¶ˆæ¯ï¼Œè¿˜é”™è¯¯åœ°æ“ä½œä½¿å¾—å·¥ä½œå…¨æ²¡äº†ã€‚</p>
<h1 id="ä¿®æ”¹å½“å‰æœ€æ–°çš„ä¸€æ¡commitæ¶ˆæ¯"><a href="#ä¿®æ”¹å½“å‰æœ€æ–°çš„ä¸€æ¡commitæ¶ˆæ¯" class="headerlink" title="ä¿®æ”¹å½“å‰æœ€æ–°çš„ä¸€æ¡commitæ¶ˆæ¯"></a>ä¿®æ”¹å½“å‰æœ€æ–°çš„ä¸€æ¡commitæ¶ˆæ¯</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹å½“å‰æœ€æ–°çš„ä¸€æ¡commitæ¶ˆæ¯</span></span><br><span class="line">git commit --amend</span><br></pre></td></tr></table></figure>
<p>éå¸¸ç®€å•ï¼Œä¸€ä¸ªå‘½ä»¤å°±æå®šäº†ã€‚ç„¶åå°±å¯ä»¥æ­£å¸¸pushäº†ã€‚</p>
<p>å¦‚æœæ˜¯éœ€è¦ä¿®æ”¹å·²ç»æ¨é€åˆ°è¿œç«¯çš„commitï¼Œå¯ä»¥å†è¿™ä¸ªå‘½ä»¤ä¹‹åå°è¯•push â€”forceã€‚<br>ä¸è¿‡æˆ‘è§‰å¾—è¿™æ ·çš„æƒ…æ™¯éå¸¸ä¹‹å°‘ï¼Œéƒ½å·²ç»PUSHä¸Šå»äº†ä¸ºå•¥è¿˜éœ€è¦æ”¹å•Š:(</p>
<h1 id="ä¿®æ”¹å¾€å‰ç¬¬Næ¡commitæ¶ˆæ¯-è¿˜æœªæ¨é€åˆ°è¿œç«¯çš„"><a href="#ä¿®æ”¹å¾€å‰ç¬¬Næ¡commitæ¶ˆæ¯-è¿˜æœªæ¨é€åˆ°è¿œç«¯çš„" class="headerlink" title="ä¿®æ”¹å¾€å‰ç¬¬Næ¡commitæ¶ˆæ¯(è¿˜æœªæ¨é€åˆ°è¿œç«¯çš„)"></a>ä¿®æ”¹å¾€å‰ç¬¬Næ¡commitæ¶ˆæ¯(è¿˜æœªæ¨é€åˆ°è¿œç«¯çš„)</h1><img src="/2021/04/08/20210408-edit-commit-msg/20210408-edit-commit-msg-01.png" class="" title="split">
<p>å¦‚å›¾ï¼Œæˆ‘éœ€è¦ä¿®æ”¹å›¾ä¸­é€‰å®šçš„é‚£ä¸€ä¸ªcommitã€‚ä»æˆ‘å½“å‰ä½ç½®æ•°ï¼Œæ˜¯ç¬¬3ä¸ªcommitã€‚<br>åˆ™Xå°±åº”è¯¥æ˜¯3ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">git rebase -i HEAD~X</span><br><span class="line"><span class="comment"># X is the number of commits to go back</span></span><br><span class="line"><span class="comment"># Move to the line of your commit, change pick into edit,</span></span><br><span class="line"><span class="comment"># then change your commit message:</span></span><br><span class="line">git commit --amend</span><br><span class="line"><span class="comment"># Finish the rebase with:</span></span><br><span class="line">git rebase --<span class="built_in">continue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># :D</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œrebaseåï¼Œä¼šè®©é€‰æ‹©éœ€è¦å¯¹å“ªæ¡commitè¿›è¡Œä»€ä¹ˆæ ·çš„æ“ä½œã€‚</p>
<img src="/2021/04/08/20210408-edit-commit-msg/20210408-edit-commit-msg-02.png" class="" title="split">
<p>éœ€è¦ç¼–è¾‘æ¶ˆæ¯åˆ™å°±æŠŠpickæ”¹æˆeditï¼Œç„¶åä¿å­˜ï¼Œé€€å‡ºæ–‡æœ¬ç¼–è¾‘ã€‚å°±å¯ä»¥ä½¿ç”¨ commit â€”amend æ¥ä¿®æ”¹æ¶ˆæ¯äº†ï¼Œç„¶åå†æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤å®Œæˆrebaseã€‚<br>ç„¶åå°±æ˜¯å¿«ä¹pushã€‚</p>
<p>å…¶å®ä¹Ÿå¯ä»¥åŒæ—¶editå¤šæ¡commitã€‚è¿™æ ·ï¼Œåœ¨ä½¿ç”¨ã€€commit â€”amendã€€æ—¶ä¼šä»æœ€è€çš„commitå¼€å§‹ç¼–è¾‘ã€‚å®Œæˆä¸€æ¡çš„ç¼–è¾‘å°±éœ€è¦ rebase â€”continueã€‚<br>ä¹‹åæ‰èƒ½ç»§ç»­ç¼–è¾‘ä¸‹ä¸€æ¡ã€‚</p>
<img src="/2021/04/08/20210408-edit-commit-msg/20210408-edit-commit-msg-03.png" class="" title="split">
<p>å¦‚æœä¿®æ”¹äº†æ›¾ç»pushè¿‡çš„commitï¼Œå°±éœ€è¦push â€”forceã€‚</p>
<img src="/2021/04/08/20210408-edit-commit-msg/20210408-edit-commit-msg-04.png" class="" title="split">
<img src="/2021/04/08/20210408-edit-commit-msg/20210408-edit-commit-msg-05.png" class="" title="split">]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity è‡ªåˆ¶ Scrollrect å°å‘</title>
    <url>/2021/06/06/20210606-UGuiInputOnScrollkeng/</url>
    <content><![CDATA[<h1 id="é—®é¢˜å‡ºç°"><a href="#é—®é¢˜å‡ºç°" class="headerlink" title="é—®é¢˜å‡ºç°"></a>é—®é¢˜å‡ºç°</h1><p>ç»ˆäºæ”¹æ¥æ”¹å»ï¼Œä¿ºåšçš„è¿™ä¸ªå¾ªç¯æ»šåŠ¨åˆ—è¡¨æˆåŠŸè¿ç”¨åˆ°äº†é¡¹ç›®é‡Œçš„ä»“åº“UIä¸Šã€‚ä½†æ˜¯è¿˜æ˜¯è¢«ä¸€ä¸ªBUGç»™å‡»å®äº†ã€‚</p>
<p>UXç»™åˆ°çš„è®¾è®¡ç¨¿æ˜¯å½“ç©å®¶é¼ æ ‡åœ¨å…¶ä¸­ä¸€ä¸ªç‰©å“ä¸Šæ—¶ï¼Œè¦æœ‰ä¸€ä¸ªå°å¼¹çª—æ˜¾ç¤ºè¿™ä¸ªç‰©å“çš„ä¸€äº›è®¯æ¯ã€‚<br>BUGçš„è¡¨ç°æ˜¯å½“æˆ‘å·²ç»â€™é€‰ä¸­â€™ä¸€ä¸ªç‰©å“åï¼Œç”¨é¼ æ ‡æ»šè½®æ»šåˆ°ä¸‹ä¸€è¡Œï¼Œå°å¼¹çª—æ˜¾ç¤ºçš„è¿˜æ˜¯ä¸Šä¸€ä¸ªç‰©å“çš„è®¯æ¯ã€‚</p>
<h1 id="BUGåŸå› "><a href="#BUGåŸå› " class="headerlink" title="BUGåŸå› "></a>BUGåŸå› </h1><p>æˆ‘åœ¨UIè„šæœ¬ä¸­å†™äº†å…³äºé¼ æ ‡ç§»åŠ¨è¿›å…¥å’Œç¦»å¼€çš„å¤„ç†ï¼Œä½†å…¶å®å½“åˆ—è¡¨æ»šåŠ¨æ—¶å€™ï¼Œé¼ æ ‡ä¸‹é¢çš„ç‰©ä½“è¿˜æ˜¯ä¸Šä¸€ä¸ªç‰©ä½“ï¼Œä½†æ˜¯ç‰©ä½“å†…çš„æ•°æ®å·²ç»æ”¹å˜ï¼Œå´æ²¡æœ‰åˆ·æ–°ã€‚</p>
<h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>å…¶å®ä¹Ÿè¿˜ç®—æœ‰ä¸ªå‡‘åˆçš„è§£å†³æ–¹æ¡ˆã€‚å¯¼å¸ˆä¹‹å‰é‡å†™äº†InputModuleï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šåœ¨è¿™è¾¹åšæ”¹åŠ¨ã€‚<br>å½“å‘ç”Ÿæ»šåŠ¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°åšraycastã€‚<br><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnScrollWheel</span>(<span class="params">InputAction.CallbackContext context</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (IsActive())</span><br><span class="line">    &#123;</span><br><span class="line">        PointerEventData eventData = GetPointerData();</span><br><span class="line">        eventData.button = PointerEventData.InputButton.Middle;</span><br><span class="line">        eventData.Reset();</span><br><span class="line">        eventData.scrollDelta = context.ReadValue&lt;Vector2&gt;()</span><br><span class="line">        GameObject testScrollObject = ExecuteEventExecuteHierarchy(eventData.pointerCurrentRaycasgameObject, eventData, ExecuteEvents.scrollHandler)</span><br><span class="line">        <span class="keyword">if</span> (testScrollObject != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// to re-do the reycast cuz we may scroll a recyclscrollrect</span></span><br><span class="line">            HandlePointerExitAndEnter(eventData, <span class="literal">null</span>);</span><br><span class="line">            m_rayCastDelayFrame = SCROLL_RAYCAST_DELAY;</span><br><span class="line">            <span class="comment">// SCROLL_RAYCAST_DELAY =3 or 5, depends....</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å…ˆæ¸…æ¥šäº†äº‹ä»¶æ•°æ®æ‰€è®¤ä¸ºçš„é¼ æ ‡æ‚¬åœçš„ç‰©ä½“ï¼Œç„¶åè¿‡å‡ å¸§å†é‡æ–°å‘å°„å°„çº¿è¿›è¡Œæ£€æµ‹ã€‚<br>å› ä¸ºæˆ‘çš„å¾ªç¯æ»šåŠ¨åˆ—è¡¨ä¾èµ–äºUnityè‡ªå¸¦çš„æ»šåŠ¨è§†å›¾ï¼Œå¹¶ä¸”å…¶ä½ç½®ä¹Ÿæ˜¯åœ¨LateUpdateä¸­æ›´æ–°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½åœ¨ä¸‹ä¸€å¸§æˆ–è€…æ¥ä¸‹æ¥çš„å‡ å¸§åå†åšå°„çº¿æ£€æµ‹ã€‚ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// will call in update</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Process</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    .....</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    CheckAndDoDelayRaycast();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CheckAndDoDelayRaycast</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_rayCastDelayFrame &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (--m_rayCastDelayFrame == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> eventData = GetPointerData();</span><br><span class="line">        eventSystem.RaycastAll(eventData, m_RaycastResultCache);</span><br><span class="line">        <span class="keyword">var</span> firstRaycast = FindFirstRaycast(m_RaycastResultCache)</span><br><span class="line">        eventData.pointerCurrentRaycast = firstRaycast;</span><br><span class="line">        m_RaycastResultCache.Clear()</span><br><span class="line">        <span class="keyword">var</span> temp = eventData.pointerCurrentRaycast.gameObject;</span><br><span class="line">        HandlePointerExitAndEnter(eventData, temp);</span><br><span class="line">        m_rayCastDelayFrame = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Git æœ¬åœ°å¿½ç•¥æ–‡ä»¶</title>
    <url>/2021/04/23/20210423-gitignore-locally/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨æ‹¼UIï¼Œéœ€è¦å»ºç«‹å‡ ä¸ªä¸´æ—¶çš„åœºæ™¯åœ¨æœ¬åœ°ã€‚è‡ªç„¶ä¸èƒ½ä¸Šä¼ ï¼Œä½†æ˜¯åˆæƒ³æ‰‹è´± git add . è¿˜æ˜¯å†³å®šåœ¨æœ¬åœ°æ‰‹åŠ¨è®¾ç½®å¿½ç•¥ä¸€äº›æ–‡ä»¶ã€‚</p>
<h1 id="è®¾ç½®Git-exclude"><a href="#è®¾ç½®Git-exclude" class="headerlink" title="è®¾ç½®Git exclude"></a>è®¾ç½®Git exclude</h1><p>é¦–å…ˆéœ€è¦æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚</p>
<p>exclude æ–‡ä»¶åœ¨ å¦‚å›¾çš„ç›®å½•ä¸­</p>
<img src="/2021/04/23/20210423-gitignore-locally/20210423-gitignore-locally-pic01.png" class="" title="split">
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\.git\info\</span><br></pre></td></tr></table></figure>
<p>æ‰¾åˆ°ä»¥åä»¥æ–‡æœ¬æ–‡ä»¶çš„å½¢å¼æ‰“å¼€ï¼Œç”¨æ³•å’Œ gitignore å·®ä¸å¤šï¼Œæˆ‘è¿˜ä¹ˆæœ‰æ·±å…¥ç ”ç©¶ï¼Œä½†æˆ‘å·®ä¸å¤šè¿™æ ·ç”¨ã€‚</p>
<img src="/2021/04/23/20210423-gitignore-locally/20210423-gitignore-locally-pic02.png" class="" title="split">
<p>æŠŠæˆ‘éœ€è¦å¿½ç•¥çš„æœ¬åœ°ç›®å½•å¡«ä¸Šå»å°±å¯ä»¥äº†ã€‚<br>é¡ºä¾¿ä¸€è¯´ï¼Œè‹¥ä½¿ç”¨è¿™ä¸ªæ–¹å¼å¿½ç•¥äº†æŸä¸ªç›®å½•ï¼Œå½“æŠŠå·²ç»è¿›è¡Œç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶ä¸¢è¿›è¿™ä¸ªç›®å½•é‡Œæ—¶ï¼ŒGitä¸­ä¼šç”Ÿæˆä¸€ä¸ªdeleteçš„æ”¹åŠ¨ã€‚</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>UnityEditor Scrollview Pagination(åˆ†é¡µ)</title>
    <url>/2020/06/26/20200626-unity-editor-scrollview-pagination/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¹‹å‰åœ¨åšCloneConsoleçš„æ—¶å€™ï¼Œä¼šåœ¨æ¯æ¬¡ç»˜åˆ¶çš„æ—¶å€™å°è¯•ç»˜åˆ¶æ‰€æœ‰çš„logï¼Œç„¶åå†äº¤ç»™UnityEditorè‡ªå·±å»å¤„ç†æ˜¾ç¤ºçš„é€»è¾‘ã€‚å› ä¸ºæˆ‘ä»¬ä¼šå †ç§¯å‡ ç™¾ç”šè‡³å‡ åƒæ¡logï¼Œè¿™æ ·çš„åšæ³•æ— ç–‘ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œç»“æœå°±æ˜¯consoleå¡å¾—ä¸èƒ½ç”¨ã€‚</p>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>å…¶å®æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦ç”»é‚£äº›ä¼šæ˜¾ç¤ºå‡ºæ¥çš„itemå°±è¡Œäº†ã€‚<br>åœ¨è¿™ä¹‹å‰éœ€è¦ç®—å‡ºå“ªäº›itemæ˜¯å¯ä»¥è¢«æ˜¾ç¤ºå‡ºæ¥çš„</p>
<ol>
<li>ç®—å‡ºæ‰€æœ‰çš„itemåŠ èµ·æ¥æœ‰å¤šé«˜</li>
<li>ç”¨å½“å‰æ»‘æ¡çš„ä½ç½®æ¥æ¨ç®—å‡ºå½“å‰éœ€è¦ç»˜åˆ¶çš„ç¬¬ä¸€æ¡itemçš„ç´¢å¼•</li>
<li>ç»˜åˆ¶item</li>
<li>ç»˜åˆ¶æ»‘æ¡å¹¶è®¡ç®—å…¶ä¸‹ä¸€æ¬¡çš„ä½ç½®</li>
</ol>
<p>å…¶å®è¿™ä¸ªæ€è·¯åº”è¯¥ä¹Ÿèƒ½åº”ç”¨åˆ°UGUIä¸Šï¼Œä¸‹æ¬¡æˆ‘ä¹Ÿè¦è¯•è¯•ã€‚</p>
<h1 id="ä¸Šä»£ç "><a href="#ä¸Šä»£ç " class="headerlink" title="ä¸Šä»£ç "></a>ä¸Šä»£ç </h1><p>åœ¨ä¸€ä¸ªæ–°çª—å£ä¸­å°è¯•ç”»ä¸€ç”»å°±å¥½ã€‚<br>é¦–å…ˆè¦å‡†å¤‡å¥½ç”¨æ¥æµ‹è¯•çš„ä¸€äº›æ•°æ®ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">TempDraw</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">System.Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> TempDrawData</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> IconTag;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> TempMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TempDrawWindowTester</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> TempDrawWindowTester _instance = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> TempDrawWindowTester Instance =&gt; _instance;</span><br><span class="line"></span><br><span class="line">        List&lt;TempDrawData&gt; m_data = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// used to give out the data</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> System.Action&lt;List&lt;TempDrawData&gt;&gt; OnDataSpread;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠæµ‹è¯•ç”¨çš„æ•°æ®éƒ½å­˜åœ¨è¿™ä¸ªMonoé‡Œï¼Œå†ç”¨å®ƒçš„é™æ€äº‹ä»¶æŠŠæ•°æ®ä¼ é€’åˆ°çª—å£ä¸­ã€‚<br>ä»£ç é‡Œçš„ Button attribute æ˜¯ç”¨æ¥åœ¨editorä¸Šåˆ›å»ºæŒ‰é’®çš„ã€‚</p>
<p>æµ‹è¯•ç”¨çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬æ¥æ¥è¿›è¡Œç»˜åˆ¶ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">TempDraw</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TempDrawWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">string</span> WINDOW_NAME = <span class="string">"Temp Draw Window"</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> TempDrawWindow _instance = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> TempDrawWindow Instance =&gt; _instance;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> List&lt;TempDrawData&gt; m_data = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">float</span> m_scrollPosition = <span class="number">0.0f</span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> temp element</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">float</span> ELEMENT_HEIGHT = <span class="number">20.0f</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">float</span> ELEMENT_ICON_SIZE = <span class="number">20.0f</span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> icons</span></span><br><span class="line">        <span class="keyword">private</span> Texture2D m_infoIconSmall = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">private</span> Texture2D m_warningIconSmall = <span class="literal">null</span>;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">MenuItem(<span class="meta-string">"Window/Temp Draw Window"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OpenWindow</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            TempDrawWindow window = GetWindow&lt;TempDrawWindow&gt;();</span><br><span class="line">            Texture2D icon = EditorGUIUtility.Load(<span class="string">"icons/UnityEditor.ConsoleWindow.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">            window.titleContent = <span class="keyword">new</span> GUIContent(WINDOW_NAME, icon);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetData</span>(<span class="params">List&lt;TempDrawData&gt; data</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == m_data)</span><br><span class="line">                m_data = <span class="keyword">new</span> List&lt;TempDrawData&gt;();</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                m_data.Clear();</span><br><span class="line"></span><br><span class="line">            m_data.AddRange(data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawTempElement</span>(<span class="params">Rect elementRect, <span class="keyword">int</span> dataIndex</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Rect iconRect = <span class="keyword">new</span> Rect(elementRect.x, elementRect.y, ELEMENT_ICON_SIZE, elementRect.height);</span><br><span class="line">            <span class="keyword">if</span> (m_data[dataIndex].IconTag == <span class="number">0</span>)</span><br><span class="line">                GUI.Label(iconRect, m_infoIconSmall);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                GUI.Label(iconRect, m_warningIconSmall);</span><br><span class="line"></span><br><span class="line">            Rect labelRect = <span class="keyword">new</span> Rect(elementRect.x + ELEMENT_ICON_SIZE, elementRect.y, elementRect.width - ELEMENT_ICON_SIZE, elementRect.height);</span><br><span class="line">            GUI.Label(labelRect, <span class="string">$"Tag: <span class="subst">&#123;m_data[dataIndex].IconTag&#125;</span> ; Message: <span class="subst">&#123;m_data[dataIndex].TempMessage&#125;</span> ;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawTempRect</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// only use half space of this shit window</span></span><br><span class="line">            Rect viewportRect = <span class="keyword">new</span> Rect(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="keyword">this</span>.position.width, <span class="keyword">this</span>.position.height * <span class="number">0.5f</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">float</span> scrollbarWidth = GUI.skin.verticalScrollbar.fixedWidth;</span><br><span class="line">            Rect scrollbarRect = <span class="keyword">new</span> Rect(viewportRect.x + viewportRect.width - scrollbarWidth, viewportRect.y, scrollbarWidth, viewportRect.height);</span><br><span class="line">            Rect currentRect = <span class="keyword">new</span> Rect(<span class="number">0.0f</span>, <span class="number">0.0f</span>, viewportRect.width - scrollbarWidth, viewportRect.height);</span><br><span class="line">            <span class="keyword">float</span> viewportHeight = viewportRect.height;</span><br><span class="line">            <span class="keyword">int</span> elementCount = m_data.Count;</span><br><span class="line"></span><br><span class="line">            GUI.BeginClip(currentRect); <span class="comment">// to clip the overflow stuff</span></span><br><span class="line">            <span class="keyword">int</span> indexOffset = Mathf.FloorToInt(m_scrollPosition / ELEMENT_HEIGHT);</span><br><span class="line">            <span class="keyword">int</span> showCount = Mathf.CeilToInt(currentRect.height / ELEMENT_HEIGHT);</span><br><span class="line">            showCount = showCount &gt; elementCount ? elementCount : showCount;</span><br><span class="line">            <span class="keyword">float</span> startPosY = (indexOffset * ELEMENT_HEIGHT) - m_scrollPosition;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; showCount; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Rect elementRect = <span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span> + startPosY + i * ELEMENT_HEIGHT, currentRect.width, ELEMENT_HEIGHT);</span><br><span class="line">                DrawTempElement(elementRect, indexOffset + i);</span><br><span class="line">            &#125;</span><br><span class="line">            GUI.EndClip();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// do stuff for scroller</span></span><br><span class="line">            <span class="keyword">float</span> fullElementHeight = elementCount * ELEMENT_HEIGHT;</span><br><span class="line">            m_scrollPosition = Mathf.Max(<span class="number">0</span>, GUI.VerticalScrollbar(scrollbarRect, m_scrollPosition, currentRect.height, <span class="number">0</span>, Mathf.Max(fullElementHeight, currentRect.height)));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> controlId = GUIUtility.GetControlID(FocusType.Passive);</span><br><span class="line">            <span class="keyword">float</span> scrollSensitivity = ELEMENT_HEIGHT;</span><br><span class="line">            <span class="keyword">float</span> maxScrollPos = (fullElementHeight &gt; currentRect.height) ? (fullElementHeight - currentRect.height) : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (EventType.ScrollWheel == Event.current.GetTypeForControl(controlId))</span><br><span class="line">            &#123;</span><br><span class="line">                m_scrollPosition = Mathf.Clamp(m_scrollPosition + Event.current.delta.y * scrollSensitivity, <span class="number">0</span>, maxScrollPos);</span><br><span class="line">                Event.current.Use();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GetAsset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_infoIconSmall = EditorGUIUtility.Load(<span class="string">"icons/console.infoicon.sml.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">            m_warningIconSmall = EditorGUIUtility.Load(<span class="string">"icons/console.warnicon.sml.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> life cycle</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            _instance = <span class="keyword">this</span>;</span><br><span class="line">            m_data = <span class="keyword">new</span> List&lt;TempDrawData&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            TempDrawWindowTester.OnDataSpread -= SetData;</span><br><span class="line">            TempDrawWindowTester.OnDataSpread += SetData;</span><br><span class="line">            GetAsset();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            DrawTempRect();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDestroy</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            TempDrawWindowTester.OnDataSpread -= SetData;</span><br><span class="line">            _instance = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2020/06/26/20200626-unity-editor-scrollview-pagination/20200626-pic001.png" class="" title="split">
<img src="/2020/06/26/20200626-unity-editor-scrollview-pagination/20200626-pic002.png" class="" title="split">
<p>æ•ˆæœå¦‚å›¾</p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>Games101 ä½œä¸šwindowsç¯å¢ƒé…ç½®</title>
    <url>/2021/10/04/20211004-games101-env/</url>
    <content><![CDATA[<p>ç»ˆäºå¼€å§‹å­¦ä¹  Games101äº†ã€‚é™¤äº†å¬è¯¾ä»¥å¤–è¿˜æƒ³åšä»–çš„ä½œä¸šå¤šå·©å›ºä¸€ä¸‹ã€‚</p>
<p>ä½†æˆ‘å®åœ¨æ˜¯ä¸æƒ³ç”¨è™šæ‹Ÿæœº(èœï¼Œæƒ³è°ƒè¯•)ï¼Œæ‰€ä»¥æƒ³æ•´ä¸ªwindowsè¿™è¾¹çš„ç¯å¢ƒã€‚<br>æœ€å¼€å§‹æŒ‰ç…§ä¸€äº›æ•™ç¨‹é…Cmakeå•¥çš„ï¼Œç»“æœä½œä¸š1ç¼–è¯‘å°±ç–¯ç‹‚æŠ¥é”™å®åœ¨å—ä¸äº†ã€‚ç¾¤å‹æ¨èäº† vcpkg+vs ä¿ºé©¬ä¸Šæ¥è¯•è¯•ã€‚</p>
<h1 id="vcpkg"><a href="#vcpkg" class="headerlink" title="vcpkg"></a>vcpkg</h1><p><a href="https://github.com/microsoft/vcpkg/blob/master/README_zh_CN.md" target="_blank" rel="noopener">https://github.com/microsoft/vcpkg/blob/master/README_zh_CN.md</a></p>
<p>å®‰è£…å¹¶ä¸éš¾ï¼Œæ‰¾åˆ°äº†å®˜æ–¹çš„ç®€ä¸­æ‰‹å†Œï¼Œç…§ç€è·‘ä¸€è½®å°±è¡Œã€‚</p>
<h1 id="å®‰è£…ä½œä¸šä¾èµ–åŒ…"><a href="#å®‰è£…ä½œä¸šä¾èµ–åŒ…" class="headerlink" title="å®‰è£…ä½œä¸šä¾èµ–åŒ…"></a>å®‰è£…ä½œä¸šä¾èµ–åŒ…</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># install latest packages :D</span></span><br><span class="line">.\vcpkg.exe install opencv:x64-windows</span><br><span class="line">.\vcpkg.exe install eigen3:x64-windows</span><br><span class="line"></span><br><span class="line"><span class="comment"># install for all users</span></span><br><span class="line">vcpkg integrate install</span><br></pre></td></tr></table></figure>
<p>ç»“æœè¿™ä¸ªæ—¶å€™é‡åˆ°äº†ä¸ªå¤©å‘ï¼Œeigen3è¿™è¾¹çš„gitlab ä»“åº“è·‘è·¯äº†(ä¸æ˜¯)ã€‚</p>
<img src="/2021/10/04/20211004-games101-env/20211004-pic000.png" class="" title="split">
<p><a href="https://gitlab.com/libeigen/eigen/-/issues/2336" target="_blank" rel="noopener">https://gitlab.com/libeigen/eigen/-/issues/2336</a></p>
<p>äºæ˜¯ä¹å»æš‚å­˜çš„ä»“åº“ä¸‹è½½æºç ï¼Œç„¶åæ”¾è¿› â€œvcpkg\downloadsâ€ ä¸­ï¼Œåœ¨æ‰§è¡Œä¹‹å‰çš„å®‰è£…å‘½ä»¤å°±å¥½äº†</p>
<p><a href="https://gitlab.com/cantonios/eigen/-/tree/3.3.9" target="_blank" rel="noopener">https://gitlab.com/cantonios/eigen/-/tree/3.3.9</a></p>
<h1 id="ä½œä¸šæ¡†æ¶è®¾ç½®"><a href="#ä½œä¸šæ¡†æ¶è®¾ç½®" class="headerlink" title="ä½œä¸šæ¡†æ¶è®¾ç½®"></a>ä½œä¸šæ¡†æ¶è®¾ç½®</h1><p>æˆ‘æ˜¯è‡ªå·±NEWäº†ä¸€ä¸ªC++çš„ç©ºvså·¥ç¨‹ï¼ŒæŠŠä½œä¸šä»£ç éƒ½ä¸¢è¿›å»ã€‚</p>
<p>ç›®æ ‡å¹³å°é€‰æ‹©x64</p>
<p>å³é”® é¡¹ç›® å±æ€§ -&gt; c/c++ -&gt; è¯­è¨€ -&gt; c++ æ ‡å‡†è¿™è¾¹é€‰æ‹© c++17 (ä½œä¸šè¦æ±‚)</p>
]]></content>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity2020 Graphic å°å‘</title>
    <url>/2021/08/31/20210831-raycast-padding/</url>
    <content><![CDATA[<p>æœ€è¿‘é¡¹ç›®å‡çº§äº†2020.3ï¼ŒGraphicè¿™è¾¹å¤šç»™äº†ä¸€ä¸ªRaycast Paddingçš„è®¾ç½®ã€‚<br>æˆ‘ä»¬æœ‰åœ¨ç”¨ä¸€äº›å®Œå…¨ç©ºç™½çš„å›¾ç‰‡æ¥æ¥å—UIçš„ç‚¹å‡»å“åº”ï¼ŒåŒæ—¶ä¹Ÿæœ‰ä¸€äº›ç”¨å›¾ç‰‡æ¥æ”¶ç‚¹å‡»çš„æŒ‰é’®ã€‚</p>
<p>ä½†å¾ˆå‘çˆ¹çš„æ˜¯ï¼Œæˆ‘å‘ç°æ— è®ºæ€ä¹ˆè®¾ç½®Raycast Paddingçš„å€¼ï¼Œåœºæ™¯é¢„è§ˆä¸­éƒ½æ²¡æœ‰æ˜¾ç¤ºæ¡†æ¡†ï¼Œæ‰€ä»¥æˆ‘å…¶å®æ˜¯å®Œå…¨ä¸çŸ¥é“è¿™ç©æ„å„¿åˆ°åº•æ€ä¹ˆç”¨çš„ã€‚<br>æœç´¢ä¸€ä¸‹æ‰çŸ¥é“åŸæ¥æ˜¯paddingçš„æ•°å€¼æ˜¯è´Ÿæ•°çš„æ—¶å€™æ‰æ˜¯å¾€å¤–æ‰©å¼ ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RaycastTarget</span> : <span class="title">Graphic</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Additionally, If you need a Raycast target that is not a rectangle, you can implement bool Raycast(Vector2 sp, Camera eventCamera) method from Graphic.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">SetMaterialDirty</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">SetVerticesDirty</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Probably not necessary since the chain of calls `Rebuild()`-&gt;`UpdateGeometry()`-&gt;`DoMeshGeneration()`-&gt;`OnPopulateMesh()` won't happen; so here really just as a fail-safe.</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnPopulateMesh</span>(<span class="params">VertexHelper vh</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        vh.Clear();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDrawGizmos</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.enabled)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        RectTransform rectTransform = <span class="keyword">this</span>.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">        Color wireColor = Color.yellow;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.isActiveAndEnabled)</span><br><span class="line">            wireColor.a *= <span class="number">0.7f</span></span><br><span class="line">        <span class="comment">// Padding to be applied to the masking</span></span><br><span class="line">        <span class="comment">// X = Left, Y = Bottom, Z = Right, W = Top</span></span><br><span class="line">        <span class="comment">// if you wanna make it bigger, then the all value shouble be negative</span></span><br><span class="line">        Vector4 padding = <span class="keyword">this</span>.raycastPadding * <span class="number">-1.0f</span>;</span><br><span class="line">        Matrix4x4 localToWorld = rectTransform.localToWorldMatrix</span><br><span class="line">        Vector3 topLeft = SomeUtils.GetOffsetLocalPosition(rectTransform, SomeUtils.UIOffsetType.TopLeft);</span><br><span class="line">        Vector3 topRight = SomeUtils.GetOffsetLocalPosition(rectTransform, SomeUtils.UIOffsetType.TopRight);</span><br><span class="line">        Vector3 bottomLeft = SomeUtils.GetOffsetLocalPosition(rectTransform, SomeUtils.UIOffsetType.BottomLeft);</span><br><span class="line">        Vector3 bottomRight = SomeUtils.GetOffsetLocalPosition(rectTransform, SomeUtils.UIOffsetType.BottomRight)</span><br><span class="line">        topLeft = localToWorld.MultiplyPoint(topLeft + (Vector3.left * padding.x) + (Vector3.up * padding.w));</span><br><span class="line">        topRight = localToWorld.MultiplyPoint(topRight + (Vector3.right * padding.z) + (Vector3.up * padding.w));</span><br><span class="line">        bottomLeft = localToWorld.MultiplyPoint(bottomLeft + (Vector3.left * padding.x) + (Vector3.down * padding.y));</span><br><span class="line">        bottomRight = localToWorld.MultiplyPoint(bottomRight + (Vector3.right * padding.z) + (Vector3.down * padding.y))</span><br><span class="line">        Color tempColor = Gizmos.color;</span><br><span class="line">        Gizmos.color = wireColor</span><br><span class="line">        Gizmos.DrawLine(topLeft, topRight);</span><br><span class="line">        Gizmos.DrawLine(topLeft, bottomLeft);</span><br><span class="line">        Gizmos.DrawLine(bottomRight, topRight);</span><br><span class="line">        Gizmos.DrawLine(bottomRight, bottomLeft);</span><br><span class="line">        Gizmos.color = tempColor</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç©ºç™½raycast targetçš„å¯ä»¥åœ¨Gizmoé‡Œç”»ï¼Œä½†æ˜¯Imageæœ¬èº«çš„ä¸æ˜¯é‚£ä¹ˆå¥½ç”»ï¼Œå› ä¸ºæ— æ³•ç›´æ¥è¦†å†™åŸæœ¬çš„Editorã€‚<br>ä¸€ä¸ªç¬¨åŠæ³•å°±æ˜¯åšä¸€ä¸ªè‡ªå·±çš„Iamgeç„¶åä¹Ÿåœ¨Gizmoé‡Œç”»ã€‚<br>ä½†å…¶å®è¿™ä¸ªæ˜¯Graphicçš„property ä¸çŸ¥é“æ€ä¹ˆåšé€šç”¨è§£å†³æ–¹æ¡ˆã€‚</p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>æŸ¥è¯¢Unity Objectåœ¨å·¥ç¨‹ä¸­çš„å¼•ç”¨</title>
    <url>/2020/11/21/20201121-find-asset-reference/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šå‘¨æŠŠbugä¿®å¾—å·®ä¸å¤šäº†ï¼Œè¿™å‘¨ç¨å¾®æœ‰ç‚¹ç©ºé—²æ—¶é—´äº†ï¼Œå°±æŠŠä»¥å‰æƒ³åšçš„ä¸€äº›ä¸œè¥¿å¤§æ¦‚çœ‹äº†ä¸€ä¸‹ã€‚<br>ä¹‹å‰å› ä¸ºæ¸…ç†æ–‡ä»¶æ²¡æœ‰åŠæ—¶æ¸…é™¤ç›¸å…³å¼•ç”¨ï¼Œç»“æœé¡¹ç›®è·‘èµ·æ¥çš„æ—¶å€™æœ‰å„ç§æ²™é›•æŠ¥é”™ã€‚åªèƒ½å†ä¸€ä¸ªä¸ªç‰©ä½“æ£€æŸ¥ï¼Œå¥½éº»çƒ¦ã€‚<br>äºæ˜¯æƒ³è¯•è¯•èƒ½ä¸èƒ½æŸ¥åˆ°æŸä¸ªç‰©ä½“è¢«å…¶å®ƒå“ªäº›ç‰©ä½“å¼•ç”¨ã€‚</p>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>å¥½åœ¨ Unityæä¾›äº†è¿™ä¸ªå‡½æ•° AssetDatabase.GetDependencies() ,å¯ä»¥è·å¾—æŸä¸ª asset çš„ä¾èµ–é¡¹ã€‚<br><a href="https://docs.unity3d.com/ScriptReference/AssetDatabase.GetDependencies.html" target="_blank" rel="noopener">AssetDatabase.GetDependencies()</a></p>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦çŸ¥é“ç‰©ä½“ A è¢«å“ªäº›å…¶ä»–çš„ç‰©ä½“å¼•ç”¨ã€‚é‚£å°±éå†æ‰€æœ‰ç‰©ä½“çš„ä¾èµ–é¡¹ï¼ŒæŠŠä¾èµ–é¡¹ä¸­åŒ…å«ç‰©ä½“ A çš„ç‰©ä½“ç­›é€‰å‡ºæ¥å³å¯ã€‚</p>
<h1 id="ä¸Šä»£ç "><a href="#ä¸Šä»£ç " class="headerlink" title="ä¸Šä»£ç "></a>ä¸Šä»£ç </h1><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// to find the reference of the target unity object</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">FindReferencesInProject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">TryFindReferenceOfUobject</span>(<span class="params">UnityEngine.Object uobject</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">bool</span> result = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">string</span> path = AssetDatabase.GetAssetPath(uobject);</span><br><span class="line">        <span class="keyword">if</span> (AssetDatabase.IsValidFolder(path))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// dun do it for a folder :)</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        FindObjectReference(uobject);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// why the order is like this?</span></span><br><span class="line">    [<span class="meta">MenuItem(<span class="meta-string">"Assets/Find References In Project"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">FindSelectedObjectReferences</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != Selection.activeObject)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span> path = AssetDatabase.GetAssetPath(Selection.activeObject);</span><br><span class="line">            <span class="keyword">if</span> (!AssetDatabase.IsValidFolder(path))</span><br><span class="line">            &#123;</span><br><span class="line">                FindObjectReference(Selection.activeObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">FindObjectReference</span>(<span class="params">UnityEngine.Object uobject</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        System.Diagnostics.Stopwatch stopWatcher = <span class="keyword">new</span> System.Diagnostics.Stopwatch();</span><br><span class="line">        stopWatcher.Start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">string</span> targetPath = AssetDatabase.GetAssetPath(uobject);</span><br><span class="line">        List&lt;<span class="keyword">string</span>&gt; referencesPaths = <span class="keyword">new</span> List&lt;<span class="keyword">string</span>&gt;();</span><br><span class="line">        Dictionary&lt;<span class="keyword">string</span>, List&lt;<span class="keyword">string</span>&gt;&gt; referenceCache = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">string</span>, List&lt;<span class="keyword">string</span>&gt;&gt;();</span><br><span class="line">        <span class="keyword">string</span>[] assetGuids = AssetDatabase.FindAssets(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; assetGuids.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">string</span> assetPath = AssetDatabase.GUIDToAssetPath(assetGuids[i]);</span><br><span class="line">            <span class="keyword">string</span>[] dependencies = AssetDatabase.GetDependencies(assetPath, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; dependencies.Length; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (dependencies[j] == targetPath)</span><br><span class="line">                &#123;</span><br><span class="line">                    referencesPaths.Add(assetPath);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        FindReferencesInProjectEditor.OpenWindow();</span><br><span class="line">        FindReferencesInProjectEditor window = FindReferencesInProjectEditor.GetWindow();</span><br><span class="line">        window.SetPaths(referencesPaths.ToArray());</span><br><span class="line">        window.SetTargetUobject(uobject);</span><br><span class="line"></span><br><span class="line">        stopWatcher.Stop();</span><br><span class="line">        Debug.Log(<span class="string">$"search references for <span class="subst">&#123;uobject.name&#125;</span> cost <span class="subst">&#123;stopWatcher.ElapsedMilliseconds&#125;</span>ms"</span>);</span><br><span class="line"></span><br><span class="line">        referenceCache.Clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// a simple window to show the result, and also we can ping those result object :D</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FindReferencesInProjectEditor</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Rect m_viewportRect = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">private</span> Rect m_listRect = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">private</span> Rect m_bottomRect = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> m_scrollPosition = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span>[] m_targetPaths = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">float</span> ELEMENT_HEIGHT = <span class="number">20.0f</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">float</span> ELEMENT_ICON_SIZE = <span class="number">20.0f</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">float</span> SCROLLER_WIDTH = <span class="number">15.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> m_hasGetGUIStyle = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GUIStyle m_scrollerStyle = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> GUIStyle m_buttonElementStyle = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UnityEngine.Object m_selectedUnityObject = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> System.Type m_uobjType = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OpenWindow</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        FindReferencesInProjectEditor window = GetWindow&lt;FindReferencesInProjectEditor&gt;();</span><br><span class="line">        Texture2D icon = EditorGUIUtility.Load(<span class="string">"icons/UnityEditor.ConsoleWindow.png"</span>) <span class="keyword">as</span> Texture2D;</span><br><span class="line">        window.titleContent = <span class="keyword">new</span> GUIContent(<span class="string">"reference find result"</span>, icon);</span><br><span class="line">        Vector2 minSize = <span class="keyword">new</span> Vector2(<span class="number">500.0f</span>, <span class="number">300.0f</span>);</span><br><span class="line">        window.minSize = minSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> FindReferencesInProjectEditor <span class="title">GetWindow</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> GetWindow&lt;FindReferencesInProjectEditor&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPaths</span>(<span class="params"><span class="keyword">in</span> <span class="keyword">string</span>[] paths</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_targetPaths = paths;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetTargetUobject</span>(<span class="params">UnityEngine.Object uobject</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_selectedUnityObject = uobject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawContent</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// only use half space of this shit window</span></span><br><span class="line">        m_viewportRect = <span class="keyword">new</span> Rect(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="keyword">this</span>.position.width - SCROLLER_WIDTH, <span class="keyword">this</span>.position.height * <span class="number">0.8f</span>);</span><br><span class="line">        m_listRect = <span class="keyword">new</span> Rect(<span class="number">0.0f</span>, <span class="number">0.0f</span>, m_viewportRect.width, m_viewportRect.height);</span><br><span class="line">        <span class="keyword">int</span> elementCount = m_targetPaths.Length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (elementCount &lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        GUI.BeginClip(m_listRect); <span class="comment">// to clip the overflow stuff</span></span><br><span class="line">        <span class="keyword">int</span> indexOffset = Mathf.FloorToInt(m_scrollPosition / ELEMENT_HEIGHT);</span><br><span class="line">        <span class="keyword">int</span> showCount = Mathf.CeilToInt(m_listRect.height / ELEMENT_HEIGHT);</span><br><span class="line">        showCount = showCount &gt; elementCount ? elementCount : showCount;</span><br><span class="line">        <span class="keyword">float</span> startPosY = (indexOffset * ELEMENT_HEIGHT) - m_scrollPosition;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; showCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Rect elementRect = <span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span> + startPosY + i * ELEMENT_HEIGHT, m_listRect.width, ELEMENT_HEIGHT);</span><br><span class="line">            DrawElement(elementRect, indexOffset + i);</span><br><span class="line">        &#125;</span><br><span class="line">        GUI.EndClip();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawElement</span>(<span class="params">Rect elementRect, <span class="keyword">int</span> dataIndex</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (dataIndex &lt; m_targetPaths.Length &amp;&amp; GUI.Button(elementRect, <span class="string">$"path <span class="subst">&#123;m_targetPaths[dataIndex]&#125;</span> ;"</span>, m_buttonElementStyle))</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">$"<span class="subst">&#123;m_targetPaths[dataIndex]&#125;</span>"</span>);</span><br><span class="line">            UnityEngine.Object targetObj = AssetDatabase.LoadAssetAtPath&lt;UnityEngine.Object&gt;(m_targetPaths[dataIndex]);</span><br><span class="line">            EditorGUIUtility.PingObject(targetObj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawScroller</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// draw scroller on the right correctly</span></span><br><span class="line">        <span class="keyword">int</span> elementCount = m_targetPaths.Length;</span><br><span class="line">        <span class="keyword">float</span> fullElementHeight = elementCount * ELEMENT_HEIGHT;</span><br><span class="line"></span><br><span class="line">        Rect scrollbarRect = <span class="keyword">new</span> Rect(m_viewportRect.x + m_viewportRect.width, m_viewportRect.y, SCROLLER_WIDTH, m_viewportRect.height);</span><br><span class="line">        m_scrollPosition = Mathf.Max(<span class="number">0</span>, GUI.VerticalScrollbar(scrollbarRect, m_scrollPosition, m_listRect.height, <span class="number">0</span>, Mathf.Max(fullElementHeight, m_listRect.height)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> controlId = GUIUtility.GetControlID(FocusType.Passive);</span><br><span class="line">        <span class="keyword">float</span> scrollSensitivity = ELEMENT_HEIGHT;</span><br><span class="line">        <span class="keyword">float</span> maxScrollPos = (fullElementHeight &gt; m_listRect.height) ? (fullElementHeight - m_listRect.height) : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (EventType.ScrollWheel == Event.current.GetTypeForControl(controlId))</span><br><span class="line">        &#123;</span><br><span class="line">            m_scrollPosition = Mathf.Clamp(m_scrollPosition + Event.current.delta.y * scrollSensitivity, <span class="number">0</span>, maxScrollPos);</span><br><span class="line">            Event.current.Use();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GetGUIStyle</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// scroller</span></span><br><span class="line">        m_scrollerStyle = <span class="keyword">new</span> GUIStyle(GUI.skin.verticalScrollbar);</span><br><span class="line">        m_scrollerStyle.stretchWidth = <span class="literal">false</span>;</span><br><span class="line">        m_scrollerStyle.fixedWidth = SCROLLER_WIDTH;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// button element</span></span><br><span class="line">        m_buttonElementStyle = <span class="keyword">new</span> GUIStyle(GUI.skin.button);</span><br><span class="line">        m_buttonElementStyle.alignment = TextAnchor.MiddleLeft;</span><br><span class="line"></span><br><span class="line">        m_uobjType = <span class="keyword">typeof</span>(UnityEngine.Object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawBottom</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_bottomRect = <span class="keyword">new</span> Rect(<span class="number">0.0f</span>, <span class="keyword">this</span>.position.height * <span class="number">0.8f</span>, <span class="keyword">this</span>.position.width, <span class="keyword">this</span>.position.height * <span class="number">0.2f</span>);</span><br><span class="line">        Rect fieldRect = <span class="keyword">new</span> Rect(<span class="number">10.0f</span>, m_bottomRect.y + <span class="number">10.0f</span>, <span class="number">100.0f</span>, <span class="number">20.0f</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == m_uobjType)</span><br><span class="line">            m_uobjType = <span class="keyword">typeof</span>(UnityEngine.Object);</span><br><span class="line"></span><br><span class="line">        m_selectedUnityObject = EditorGUI.ObjectField(fieldRect, m_selectedUnityObject, m_uobjType, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        Rect buttonRect = <span class="keyword">new</span> Rect(<span class="number">150.0f</span>, m_bottomRect.y, <span class="number">200.0f</span>, <span class="number">40.0f</span>);</span><br><span class="line">        <span class="keyword">if</span> (GUI.Button(buttonRect, <span class="string">"try find reference"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            FindObjectReference();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FindObjectReference</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == m_selectedUnityObject)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Clear();</span><br><span class="line">        FindReferencesInProject.TryFindReferenceOfUobject(m_selectedUnityObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Clear</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_targetPaths = System.Array.Empty&lt;<span class="keyword">string</span>&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!m_hasGetGUIStyle)</span><br><span class="line">        &#123;</span><br><span class="line">            GetGUIStyle();</span><br><span class="line">            m_hasGetGUIStyle = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        DrawContent();</span><br><span class="line">        DrawScroller();</span><br><span class="line">        DrawBottom();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2020/11/21/20201121-find-asset-reference/20201121-pic001.png" class="" title="split">
<img src="/2020/11/21/20201121-find-asset-reference/20201121-pic002.png" class="" title="split">
<p>æœç´¢ç»“æœæˆ‘é€‰æ‹©ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ editor window æ¥æ˜¾ç¤ºã€‚<br>åŒæ—¶è¿˜èƒ½å¡«å…¥æ–°çš„ç›®æ ‡ç‰©ä½“å†åšä¸€æ¬¡æœç´¢ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ€è¿‘éƒ½æ²¡æœ‰åšç¼–è¾‘å™¨è¿™è¾¹çš„å¼€å‘ï¼Œæ„Ÿè§‰ç›´æ¥é€€å›äº†èµ·ç‚¹ã€‚æ„Ÿè§‰Unityç¼–è¾‘å™¨çš„æ–‡æ¡£æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆè¯¦ç»†ï¼Œå¾ˆå¤šæ—¶å€™åè€Œæ²¡æœ‰é—®åŒäº‹æ¥å¾—æ–¹ä¾¿ã€‚å¯èƒ½è¯¥æé«˜è‡ªå·±çš„è‹±æ–‡æ°´å¹³äº†ã€‚</p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity UGUI ç®€å•å¾ªç¯æ»šåŠ¨åˆ—è¡¨</title>
    <url>/2022/03/13/20220313-recycle-grid-scrollview/</url>
    <content><![CDATA[<p>ä¹‹å‰åšäº†ä¸€ä¸ªè‡ªå¸¦ç®€å• GridLayout çš„å¾ªç¯æ»šåŠ¨åˆ—è¡¨ã€‚ä½†æ˜¯åŸºäºç»§æ‰¿çš„æ€è·¯åšçš„ã€‚å¯¼å¸ˆæŒ‡å‡ºäº†å…¶ä¸ä¾¿æŒ‡å‡ºï¼Œè€Œä¸”Unityå…¶å®æ˜¯æ¯”è¾ƒæå€¡å¤§å®¶ä½¿ç”¨ç»„åˆæ¨¡å¼çš„ï¼Œæ‰€ä»¥æˆ‘å†³å®šä¿®æ”¹ä¸€ä¸‹ã€‚</p>
<h1 id="å¾ªç¯æ»šåŠ¨"><a href="#å¾ªç¯æ»šåŠ¨" class="headerlink" title="å¾ªç¯æ»šåŠ¨"></a>å¾ªç¯æ»šåŠ¨</h1><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>å’Œåœ¨ç½‘ä¸Šèƒ½æœç´¢åˆ°çš„å¤§å¤šæ•°å¾ªç¯æ»šåŠ¨åˆ—è¡¨ä¸€æ ·ï¼Œæˆ‘æœ‰ä¸€ä¸ªç©ºçš„ Contentï¼Œè°ƒæ•´å…¶å°ºå¯¸æ¥æ¨¡æ‹Ÿåˆ—è¡¨çš„æ»šåŠ¨ï¼Œå†æ ¹æ®æ»šåŠ¨çš„å½“å‰ä½ç½®åœ¨è§†å£é‡ŒæŠŠUIç»„ä»¶éƒ½æ‘†æ”¾å¥½ã€‚</p>
<p>æˆ‘éœ€è¦ä½¿ç”¨Unityè‡ªå¸¦çš„æ»šåŠ¨è§†å¤–ï¼Œå¹¶ä¸”æˆ‘è¿˜å®šä¹‰äº†ç®€å•çš„ ListElement, ListView, ScrollrectController è¿™ä¸‰ä¸ªç±»ã€‚</p>
<p>ListElement å°±æ˜¯å®é™…éœ€è¦è¢«æ“ä½œçš„åˆ—è¡¨ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶è´Ÿè´£æä¾› RectTransform å’Œä¸€ä¸ª indexï¼Œ ä¿è¯å…¶èƒ½è¢«æˆ‘çš„ ScrollrectController æ“ä½œã€‚</p>
<p>ListView è´Ÿè´£ç®¡ç† ListElementï¼Œç”Ÿæˆé”€é­‚éƒ½å¯ä»¥ã€‚åŒæ—¶è¿˜æä¾›ç›´æ¥æ‹¿å–æ‰€æœ‰ ListElement çš„æ¥å£ã€‚</p>
<p>ScrollrectController æŒæœ‰ ListViewï¼Œå¹¶ä¸”æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„ä¸€ä¸ªæ•°æ®ä¸ªæ•°æ¥è¿›è¡Œå¾ªç¯æ»šåŠ¨çš„ç®¡ç†ã€‚åŒæ—¶æœ‰äº‹ä»¶å‘ŠçŸ¥æ¯æ¬¡çš„å¸ƒå±€åˆ·æ–°çš„å®Œæˆã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘è¿˜åšäº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ GridLayout ç»™ ScrollrectController æ§åˆ¶ã€‚</p>
<p>è‡³äºè§†å›¾å†…çš„æœ€å¤§å¯è§†æ¡ç›®æ•°ï¼Œè€å®è¯´æˆ‘æ„Ÿè§‰æˆ‘æ²¡æœ‰ç‰¹åˆ«å¥½çš„æ–¹æ³•å»è®¡ç®—ä¸€ä¸ªå‡†ç¡®çš„å€¼ã€‚æ‰€ä»¥å°±æŒ‰ç€ (row + 2) <em> (column </em> 2) æ¥è®¡ç®—äº†ï¼Œè™½ç„¶æœ‰ä¸€ç‚¹æµªè´¹å†…å­˜ï¼Œä½†åœ¨æˆ‘å½“å‰è®¾ç½®çš„æ»šåŠ¨é€Ÿåº¦ä¸‹æ˜¯å¤Ÿç”¨çš„ã€‚</p>
<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TempListElementUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Header(<span class="meta-string">"must have"</span>), Tooltip(<span class="meta-string">"should inherit from ISetupable"</span>)</span>]</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    Component m_dataReceiver;</span><br><span class="line">    [<span class="meta">SerializeField, Tooltip(<span class="meta-string">"better to manual drag it in"</span>)</span>]</span><br><span class="line">    RectTransform m_elementTransform;</span><br><span class="line">    [<span class="meta">SerializeField, ReadOnly</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> m_index = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> ElementIndex =&gt; m_index;</span><br><span class="line">    <span class="keyword">public</span> RectTransform ElementRectTransform</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (m_elementTransform == <span class="literal">null</span>)</span><br><span class="line">                m_elementTransform = GetComponent&lt;RectTransform&gt;();</span><br><span class="line">            <span class="keyword">return</span> m_elementTransform;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> Setup&lt;TData&gt;(TData data)</span><br><span class="line">    &#123;</span><br><span class="line">        SomeUtils.ISetup&lt;Component, TData&gt;(m_dataReceiver, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.gameObject.activeSelf)</span><br><span class="line">            <span class="keyword">this</span>.gameObject.SetActive(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hide</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.gameObject.activeSelf)</span><br><span class="line">            <span class="keyword">this</span>.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetIndex</span>(<span class="params"><span class="keyword">int</span> index</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_index = index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_elementTransform == <span class="literal">null</span>)</span><br><span class="line">            m_elementTransform = <span class="keyword">this</span>.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_elementTransform = <span class="keyword">this</span>.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TempListView</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// check when prefab change</span></span><br><span class="line">    <span class="comment">// [OnValueChanged("OnPrefabChanged")]</span></span><br><span class="line">    [<span class="meta">SerializeField, Header(<span class="meta-string">"place holder, the listview should only contains one type of element"</span>)</span>]</span><br><span class="line">    TempListElementUI m_elementPrefab;</span><br><span class="line">    RectTransform Container =&gt; transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">    [<span class="meta">SerializeField, ReadOnly</span>]</span><br><span class="line">    List&lt;TempListElementUI&gt; m_actualUsedComponents = <span class="keyword">new</span> List&lt;TempListElementUI&gt;(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> Count =&gt; m_actualUsedComponents.Count;</span><br><span class="line">    <span class="keyword">public</span> TempListElementUI <span class="keyword">this</span>[<span class="keyword">int</span> index] =&gt; m_actualUsedComponents[index];</span><br><span class="line">    <span class="keyword">public</span> IReadOnlyList&lt;TempListElementUI&gt; ElementList =&gt; m_actualUsedComponents;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TempListElementUI <span class="title">Add</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        TempListElementUI element = InternalAdd();</span><br><span class="line">        m_actualUsedComponents.Add(element);</span><br><span class="line">        element.Show();</span><br><span class="line">        <span class="keyword">return</span> element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Clear</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        TempListElementUI element = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (m_actualUsedComponents.Count &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            element = m_actualUsedComponents[m_actualUsedComponents.Count - <span class="number">1</span>];</span><br><span class="line">            m_actualUsedComponents.RemoveAt(m_actualUsedComponents.Count - <span class="number">1</span>);</span><br><span class="line">            InternalRemove(element);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Remove</span>(<span class="params">TempListElementUI instance</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_actualUsedComponents.Remove(instance))</span><br><span class="line">        &#123;</span><br><span class="line">            instance.Hide();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.LogError(<span class="string">$"listview_<span class="subst">&#123;<span class="keyword">this</span>.gameObject.name&#125;</span> does not contains <span class="subst">&#123;instance.ElementRectTransform.name&#125;</span>, remove failed"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RemoveAt</span>(<span class="params"><span class="keyword">int</span> index</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= m_actualUsedComponents.Count)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.LogError(<span class="string">$"<span class="subst">&#123;index&#125;</span> is invalid for SimpleListView"</span>, <span class="keyword">this</span>.gameObject);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TempListElementUI toRemove = m_actualUsedComponents[index];</span><br><span class="line">        m_actualUsedComponents.RemoveAt(index);</span><br><span class="line">        InternalRemove(toRemove);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InnerSwap</span>(<span class="params"><span class="keyword">int</span> indexA, <span class="keyword">int</span> indexB</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (indexA &lt; <span class="number">0</span> || indexA &gt; m_actualUsedComponents.Count - <span class="number">1</span> || indexB &lt; <span class="number">0</span> || indexB &gt; m_actualUsedComponents.Count - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TempListElementUI temp = m_actualUsedComponents[indexA];</span><br><span class="line">        <span class="keyword">int</span> transformIndexA = temp.ElementRectTransform.GetSiblingIndex();</span><br><span class="line">        <span class="keyword">int</span> transformIndexB = m_actualUsedComponents[indexB].ElementRectTransform.GetSiblingIndex();</span><br><span class="line">        m_actualUsedComponents[indexA] = m_actualUsedComponents[indexB];</span><br><span class="line">        m_actualUsedComponents[indexB] = temp;</span><br><span class="line">        m_actualUsedComponents[indexA].ElementRectTransform.SetSiblingIndex(transformIndexA);</span><br><span class="line">        m_actualUsedComponents[indexB].ElementRectTransform.SetSiblingIndex(transformIndexB);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>-1 means element is not in the list<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">IndexOf</span>(<span class="params">TempListElementUI instance</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> m_actualUsedComponents.IndexOf(instance);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (ArgumentOutOfRangeException)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> TempListElementUI <span class="title">InternalAdd</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// can apply object pool here</span></span><br><span class="line">        <span class="keyword">if</span> (Application.isEditor &amp;&amp; !Application.isPlaying)</span><br><span class="line">            <span class="keyword">return</span> UnityEditor.PrefabUtility.InstantiatePrefab(m_elementPrefab, Container) <span class="keyword">as</span> TempListElementUI;</span><br><span class="line">        <span class="keyword">return</span> Instantiate(m_elementPrefab, Container);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">InternalRemove</span>(<span class="params">TempListElementUI element</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// can apply object pool here</span></span><br><span class="line">        <span class="keyword">if</span> (element == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        element.Hide();</span><br><span class="line">        <span class="keyword">if</span> (Application.isEditor &amp;&amp; !Application.isPlaying)</span><br><span class="line">            GameObject.DestroyImmediate(element.ElementRectTransform.gameObject);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            GameObject.Destroy(element.ElementRectTransform.gameObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTransformChildrenChanged</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Application.isEditor &amp;&amp; !Application.isPlaying)</span><br><span class="line">            FindPrefabInstances();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnPrefabChanged</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// remove pre objects</span></span><br><span class="line">        <span class="keyword">int</span> amount = m_actualUsedComponents.Count;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_actualUsedComponents.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            GameObject.DestroyImmediate(m_actualUsedComponents[i].ElementRectTransform.gameObject);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (m_elementPrefab != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; amount; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                RectTransform rectTransform = (RectTransform)UnityEditor.PrefabUtility.InstantiatePrefab(m_elementPrefab, Container);</span><br><span class="line">                m_actualUsedComponents[i] = (rectTransform.GetComponent&lt;TempListElementUI&gt;());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            m_actualUsedComponents.Clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Retrieves prefab instances in the transform</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">ContextMenu(<span class="meta-string">"find prefab instances"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FindPrefabInstances</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">bool</span> hasPrefab = !(m_elementPrefab == <span class="literal">null</span>);</span><br><span class="line">        TempListElementUI elementPrefab = m_elementPrefab.GetComponent&lt;TempListElementUI&gt;();</span><br><span class="line">        m_actualUsedComponents.Clear();</span><br><span class="line">        List&lt;GameObject&gt; toDeleteObjectList = <span class="keyword">new</span> List&lt;GameObject&gt;();</span><br><span class="line">        <span class="keyword">foreach</span> (Transform child <span class="keyword">in</span> Container)</span><br><span class="line">        &#123;</span><br><span class="line">            TempListElementUI childElement = child.GetComponent&lt;TempListElementUI&gt;();</span><br><span class="line">            <span class="keyword">if</span> (childElement == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                toDeleteObjectList.Add(child.gameObject);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (hasPrefab)</span><br><span class="line">            &#123;</span><br><span class="line">                GameObject detectPrefabGo = UnityEditor.PrefabUtility.GetCorrespondingObjectFromSource(child.gameObject);</span><br><span class="line">                TempListElementUI detectPrefab = (detectPrefabGo == <span class="literal">null</span>) ? <span class="literal">null</span> : detectPrefabGo.GetComponent&lt;TempListElementUI&gt;();</span><br><span class="line">                <span class="keyword">if</span> (elementPrefab == detectPrefab)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// same source prefab</span></span><br><span class="line">                    m_actualUsedComponents.Add(childElement);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// different source prefab, delete this one</span></span><br><span class="line">                    toDeleteObjectList.Add(child.gameObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (UnityEditor.PrefabUtility.IsAnyPrefabInstanceRoot(child.gameObject))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// find the first prefab</span></span><br><span class="line">                GameObject prefab = UnityEditor.PrefabUtility.GetCorrespondingObjectFromSource(child.gameObject);</span><br><span class="line">                m_elementPrefab = prefab.GetComponent&lt;TempListElementUI&gt;();</span><br><span class="line">                m_actualUsedComponents.Add(childElement);</span><br><span class="line">                hasPrefab = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; toDeleteObjectList.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Application.isPlaying)</span><br><span class="line">                GameObject.Destroy(toDeleteObjectList[i]);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                GameObject.DestroyImmediate(toDeleteObjectList[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ContextMenu(<span class="meta-string">"editor time add"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">EditorTimeAdd</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Application.isPlaying) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (m_elementPrefab == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.LogError(<span class="string">"listview is missing element prefab"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        TempListElementUI spawnObject = (TempListElementUI)UnityEditor.PrefabUtility.InstantiatePrefab(m_elementPrefab, Container);</span><br><span class="line">        m_actualUsedComponents.Add(spawnObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ContextMenu(<span class="meta-string">"editor time clear"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">EditorTimeClear</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Application.isPlaying) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// remove pre objects</span></span><br><span class="line">        TempListElementUI[] preObjects = Container.GetComponentsInChildren&lt;TempListElementUI&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; preObjects.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            GameObject.DestroyImmediate(preObjects[i].ElementRectTransform.gameObject);</span><br><span class="line">        &#125;</span><br><span class="line">        m_actualUsedComponents.Clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ContextMenu(<span class="meta-string">"test print elements"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">TestPrintListElements</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_actualUsedComponents != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            StringBuilder printText = <span class="keyword">new</span> StringBuilder(<span class="string">$"temp list view children_<span class="subst">&#123;m_actualUsedComponents.Count&#125;</span> :\n"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_actualUsedComponents.Count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                printText.AppendLine(m_actualUsedComponents[i].ElementRectTransform.name);</span><br><span class="line">            &#125;</span><br><span class="line">            Debug.Log(printText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BoundlessScrollRectController</span> : <span class="title">UIBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    too much code, I will just show the draw</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawContentItem</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        IReadOnlyList&lt;TempListElementUI&gt; elementList = ElementList;</span><br><span class="line">        <span class="keyword">int</span> dataCount = m_simulatedDataCount;</span><br><span class="line">        <span class="comment">// TODO @Hiko use a general calculation later</span></span><br><span class="line">        <span class="keyword">bool</span> test = m_content.anchorMin != Vector2.up || m_content.anchorMax != Vector2.up || m_content.pivot != Vector2.up;</span><br><span class="line">        <span class="keyword">if</span> (test)</span><br><span class="line">        &#123;</span><br><span class="line">            m_content.anchorMin = Vector2.up;</span><br><span class="line">            m_content.anchorMax = Vector2.up;</span><br><span class="line">            m_content.pivot = Vector2.up;</span><br><span class="line">        &#125;</span><br><span class="line">        Vector3 dragContentAnchorPostion = m_content.anchoredPosition;</span><br><span class="line">        Vector3 contentMove = dragContentAnchorPostion - SomeUtils.GetOffsetLocalPosition(m_content, SomeUtils.UIOffsetType.TopLeft);</span><br><span class="line">        Vector2 itemSize = m_gridLayoutGroup.CellSize, spacing = m_gridLayoutGroup.Spacing;</span><br><span class="line"></span><br><span class="line">        RectOffset padding = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != m_gridLayoutGroup)</span><br><span class="line">            padding = m_gridLayoutGroup.RectPadding;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// need to know the moving direction, then adjust it to prevent wrong draw</span></span><br><span class="line">        <span class="keyword">float</span> xMove = contentMove.x &lt; <span class="number">0</span> ? (-contentMove.x - padding.horizontal) : <span class="number">0</span>;</span><br><span class="line">        xMove = Mathf.Clamp(xMove, <span class="number">0.0f</span>, Mathf.Abs(xMove));</span><br><span class="line">        <span class="keyword">float</span> yMove = contentMove.y &gt; <span class="number">0</span> ? (contentMove.y - padding.vertical) : <span class="number">0</span>;</span><br><span class="line">        yMove = Mathf.Clamp(yMove, <span class="number">0.0f</span>, Mathf.Abs(yMove));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the column index of the top left item</span></span><br><span class="line">        <span class="keyword">int</span> tempColumnIndex = Mathf.FloorToInt((xMove + spacing.x) / (itemSize.x + spacing.x));</span><br><span class="line">        <span class="keyword">if</span> (xMove % (itemSize.x + spacing.x) - itemSize.x &gt; spacing.x)</span><br><span class="line">            tempColumnIndex = Mathf.Clamp(tempColumnIndex - <span class="number">1</span>, <span class="number">0</span>, tempColumnIndex);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the row index of the top left item</span></span><br><span class="line">        <span class="keyword">int</span> tempRowIndex = Mathf.FloorToInt((yMove + spacing.y) / (itemSize.y + spacing.y));</span><br><span class="line">        <span class="keyword">if</span> (yMove % (itemSize.y + spacing.y) - itemSize.y &gt; spacing.y)</span><br><span class="line">            tempRowIndex = Mathf.Clamp(tempRowIndex - <span class="number">1</span>, <span class="number">0</span>, tempRowIndex);</span><br><span class="line"></span><br><span class="line">        Vector2Int rowTopLeftItemIndex = <span class="keyword">new</span> Vector2Int(tempRowIndex, tempColumnIndex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> rowDataCount = <span class="number">0</span>, columnDataCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (BoundlessGridLayoutData.Constraint.FixedColumnCount == m_gridLayoutGroup.constraint)</span><br><span class="line">        &#123;</span><br><span class="line">            rowDataCount = m_gridLayoutGroup.constraintCount;</span><br><span class="line">            columnDataCount = Mathf.CeilToInt((<span class="keyword">float</span>)dataCount / rowDataCount);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            columnDataCount = m_gridLayoutGroup.constraintCount;</span><br><span class="line">            rowDataCount = Mathf.CeilToInt((<span class="keyword">float</span>)dataCount / columnDataCount);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// x -&gt; element amount on horizontal axis</span></span><br><span class="line">        <span class="comment">// y -&gt; element amount on vertical axis</span></span><br><span class="line">        Vector2Int contentRowColumnSize = <span class="keyword">new</span> Vector2Int(rowDataCount, columnDataCount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// deal with content from left to right (simple case)</span></span><br><span class="line">        <span class="keyword">int</span> dataIndex = <span class="number">0</span>, uiItemIndex = <span class="number">0</span>;</span><br><span class="line">        Vector3 rowTopLeftPosition = <span class="keyword">new</span> Vector3(padding.left, -padding.top, <span class="number">0.0f</span>), itemTopLeftPosition = Vector3.zero;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> columnIndex = <span class="number">0</span>; columnIndex &lt; m_viewItemCountInColumn; columnIndex++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (columnIndex + rowTopLeftItemIndex.x == columnDataCount)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            rowTopLeftPosition = <span class="keyword">new</span> Vector3(padding.left, -padding.top, <span class="number">0.0f</span>) + Vector3.down * (columnIndex + rowTopLeftItemIndex.x) * (itemSize.y + spacing.y);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> rowIndex = <span class="number">0</span>; rowIndex &lt; m_viewItemCountInRow; rowIndex++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (rowIndex + rowTopLeftItemIndex.y == rowDataCount)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                Vector2Int elementIndex = <span class="keyword">new</span> Vector2Int(rowIndex + rowTopLeftItemIndex.y, columnIndex + rowTopLeftItemIndex.x);</span><br><span class="line">                dataIndex = CaculateDataIndex(elementIndex, contentRowColumnSize, GridLayoutData.startAxis, GridLayoutData.startCorner);</span><br><span class="line">                itemTopLeftPosition = rowTopLeftPosition + Vector3.right * (rowIndex + rowTopLeftItemIndex.y) * (itemSize.x + spacing.x);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// TODO @Hiko avoid overdraw</span></span><br><span class="line">                <span class="keyword">if</span> (uiItemIndex &gt; <span class="number">0</span> &amp;&amp; elementList[uiItemIndex - <span class="number">1</span>].ElementIndex == dataIndex)</span><br><span class="line">                    <span class="keyword">continue</span>; <span class="comment">// over draw case</span></span><br><span class="line">                <span class="keyword">if</span> (dataIndex &gt; <span class="number">-1</span> &amp;&amp; dataIndex &lt; dataCount)</span><br><span class="line">                &#123;</span><br><span class="line">                    elementList[uiItemIndex].ElementRectTransform.localPosition = itemTopLeftPosition;</span><br><span class="line">                    elementList[uiItemIndex].SetIndex(dataIndex);</span><br><span class="line">                    elementList[uiItemIndex].Show();</span><br><span class="line">                    uiItemIndex++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (uiItemIndex &lt; elementList.Count)</span><br><span class="line">        &#123;</span><br><span class="line">            elementList[uiItemIndex].SetIndex(<span class="number">-1</span>);</span><br><span class="line">            elementList[uiItemIndex].Hide();</span><br><span class="line">            elementList[uiItemIndex].ElementRectTransform.position = Vector3.zero;</span><br><span class="line">            uiItemIndex++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        NotifyOnContentItemFinishDrawing();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å†™å¯ä»¥ä¿è¯æˆ‘çš„è¿™ä¸ªå¾ªç¯æ»šåŠ¨çš„é€»è¾‘ä¸å®é™…çš„UIéœ€è¦æ˜¾ç¤ºçš„é€»è¾‘å°½å¯èƒ½åœ°åˆ†å¼€ã€‚éœ€è¦ä½¿ç”¨å¾ªç¯æ»šåŠ¨åŠŸèƒ½çš„æ—¶å€™ï¼Œå†æ·»åŠ è¿™äº›ç»„ä»¶å³å¯ã€‚</p>
<img src="/2022/03/13/20220313-recycle-grid-scrollview/20210131-scrollrect01.gif" class="" title="split">
<h1 id="é…åˆå®é™…æ˜¾ç¤ºç»„ä»¶ä½¿ç”¨"><a href="#é…åˆå®é™…æ˜¾ç¤ºç»„ä»¶ä½¿ç”¨" class="headerlink" title="é…åˆå®é™…æ˜¾ç¤ºç»„ä»¶ä½¿ç”¨"></a>é…åˆå®é™…æ˜¾ç¤ºç»„ä»¶ä½¿ç”¨</h1><p>åœ¨æ»šåŠ¨è§†å›¾æ‘†æ”¾å¥½ä½ç½®åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ListElement æä¾›çš„ç´¢å¼•çŸ¥é“å…¶å¯¹åº”æ•°æ®é›†é‡Œæ•°æ®ç´¢å¼•ã€‚æ‰€ä»¥éœ€è¦ä½¿ç”¨è¿™ä¸ªæ»šåŠ¨è§†å›¾çš„UIï¼Œè¦åŒæ—¶ç®¡ç† ListView å’Œ ScrollrectControllerã€‚</p>
<p>æˆ‘æ•´äº†ä¸€ä¸ªæ¥å£å’Œä¸€ä¸ªæ‰©å±•æ–¹æ³•ï¼Œç”¨äºæ˜¾ç¤ºæ•°æ®çš„UIç»„ä»¶éœ€è¦ç»§æ‰¿è¿™ä¸ªæ¥å£ã€‚å› ä¸ºæŒ‰ç…§æˆ‘çš„å†™æ³•ï¼Œä» ListView ä¸­åªèƒ½æ‹¿åˆ° ListElement æ²¡æ³•æ‹¿åˆ°å®é™…ç”¨äºè¡¨ç°çš„ UI ç»„ä»¶ã€‚ä½†æ˜¯é€šè¿‡è¿™ä¸ªæ¥å£å’Œ ListElement ä¸­çš„ä¸€ä¸ªæ³›å‹æ–¹æ³•å°±å¯ä»¥æŠŠå†…å®¹ä¼ è¿›å»ã€‚è™½ç„¶éœ€è¦åšä¸€æ¬¡ç±»å‹æ£€æŸ¥ï¼Œä½†ä¹Ÿåº”è¯¥è¿˜å¥½ã€‚æ¯•ç«Ÿä¸éœ€è¦GetComponentä¹Ÿä¸éœ€è¦å•ç‹¬ç»´æŠ¤ä¸€ä¸ªå…³äºå®é™…æ˜¾ç¤ºç»„ä»¶çš„æ•°ç»„ï¼Œç”¨èµ·æ¥è¿˜æ˜¯æŒºæ–¹ä¾¿çš„å‘€ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–æ¯”è¾ƒå‘çš„å°±æ˜¯è¿™æ ·å†™å¯¼è‡´ Unity çš„ Component éƒ½èƒ½è°ƒç”¨è¿™ä¸ªSetupçš„æ–¹æ³•ï¼Œè¿˜æŒºå±é™©çš„ï¼Œæ‰€ä»¥åŠ äº†ä¸ªæ³¨é‡Šã€‚å®é™…ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè®°å¾—è®©ç”¨äºè¡¨ç°çš„ UI ç»„ä»¶ç»§æ‰¿è¿™ä¸ªæ¥å£ã€‚</p>
<h2 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// apply this on the target shows actual data</span></span><br><span class="line">public interface ISetupable&lt;TData&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Setup</span>(<span class="params">TData data</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> target component should inherit from ISetupable</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="component"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="data"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name="TData"&gt;</span><span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> ISetup&lt;TComponent, TData&gt;(<span class="keyword">this</span> Component component, TData data) <span class="keyword">where</span> TComponent : Component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// I guess this check should be fine  :(</span></span><br><span class="line">    <span class="keyword">if</span> (component <span class="keyword">is</span> ISetupable&lt;TData&gt; target)</span><br><span class="line">    &#123;</span><br><span class="line">        target.Setup(data);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    UnityEngine.Debug.LogError(<span class="string">$"component_<span class="subst">&#123;component.name&#125;</span> is not a setupable"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¶å®è¿™ä¸ªåŠŸèƒ½ä¸¢å°½é¡¹ç›®é‡Œåç”¨çš„åœ°æ–¹ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥éƒ½æ˜¯éš”å‡ ä¸ªæœˆä¿®ä¸€ä¸‹ï¼Œæ¯æ¬¡éƒ½è¦çœ‹è‡ªå·±å†™çš„åƒåœ¾ä»£ç å¥½ä¹…ï¼Œå±å®å¤´ç—›äº†ã€‚<br>æ€»ç®—æ˜¯ç”¨èµ·æ¥æ¯”ä»¥å‰æ–¹ä¾¿ä¸å°‘äº†ã€‚æ¥ä¸‹æ¥å°±æŠŠä¸€äº›å°é—®é¢˜ä¿®ä¸€ä¿®å¥½äº†ã€‚</p>
<p>å›å¤´å†çœ‹å·²ç»å’Œè‡ªå·±åšçš„é‚£ä¸ªåˆç‰ˆå®Œå…¨ä¸ä¸€æ ·äº†ï¼Œä¸ªäººè®¤ä¸ºæ€è·¯æ¯”ä»¥å‰é‚£ä¸ªå¥½å¤šäº†ã€‚</p>
<p>å…¨éƒ¨ä»£ç ï¼š<br><a href="https://github.com/2C2C2C/MuyScrollRect" target="_blank" rel="noopener">https://github.com/2C2C2C/MuyScrollRect</a></p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity UGUI Ez Anchor</title>
    <url>/2022/04/23/20220423-ez-anchor/</url>
    <content><![CDATA[<p>ç»è¿‡äº†ä¸€æ¬¡ç”¨æˆ·æµ‹è¯•ä¹‹åï¼Œæ‹¿åˆ°çš„åé¦ˆè¯´æˆ‘ä»¬å¾ˆå¤šé¡µé¢çš„UXè®¾è®¡éƒ½ä¸è¡Œï¼Œåªèƒ½å„ç§é‡åšï¼Œä¸è®ºæ˜¯æˆ‘ç¨‹åºè¿™è¾¹è¿˜æ˜¯UXUIç»„é‚£è¾¹ï¼Œæˆ‘ä»¬éƒ½éœ€è¦é‡æ–°æ‹¼å¥½ä¸€äº› prefabã€‚</p>
<p>ç„¶åè¿˜æœ‰ä¸€äº›æ—§çš„ prefab æˆ‘ä»¬éœ€è¦æ¢çš®æ”¹å°ºå¯¸ä¹‹ç±»çš„ï¼Œè¿™æ¬¡å°±æ¥åˆ†äº«ä¸€ä¸ªç®€å•çš„å°å·¥å…·ï¼Œç”¨æ¥åšä¸€äº›ç®€å•çš„å°ºå¯¸é€‚é…ã€‚</p>
<img src="/2022/04/23/20220423-ez-anchor/20220423-pic001.gif" class="" title="split">
<p>RectTransform ä¸Š anchor çš„ Min, Max éƒ½æ˜¯å·²ç»åšäº†å½’ä¸€åŒ–çš„å€¼ã€‚ä¾é è°ƒæ•´ anchor çš„å€¼å°±å¯ä»¥è®¾ç½®å½“å‰å…ƒç´ åœ¨çˆ¶å…ƒç´ ä¸­çš„ç›¸å¯¹ä½ç½®å’Œé¢ç§¯å æ¯”ã€‚<br>å…·ä½“å‚è€ƒä¸‹é¢è¿™ç¯‡æ–‡ç« <br><a href="https://blog.csdn.net/ChinarCSDN/article/details/88983587" target="_blank" rel="noopener">https://blog.csdn.net/ChinarCSDN/article/details/88983587</a></p>
<h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="meta">InitializeOnLoad</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">RectTransformExtendedEditor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> EditContext</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> RectTransform Transform;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> EditContext m_context;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">bool</span> m_showTool;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">RectTransformExtendedEditor</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Selection.selectionChanged += OnSelectionChanged;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OnSelectionChanged</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        SceneView.duringSceneGui -= OnSceneGUI;</span><br><span class="line">        <span class="keyword">if</span> (Selection.activeTransform <span class="keyword">is</span> RectTransform rectTransform)</span><br><span class="line">        &#123;</span><br><span class="line">            m_context = <span class="keyword">new</span> EditContext()</span><br><span class="line">            &#123;</span><br><span class="line">                Transform = rectTransform</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            SceneView.duringSceneGui += OnSceneGUI;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OnSceneGUI</span>(<span class="params">SceneView sceneView</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Handles.BeginGUI();</span><br><span class="line">        <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">20</span>, <span class="number">20</span>), <span class="string">"T"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            m_showTool = !m_showTool;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (m_showTool)</span><br><span class="line">        &#123;</span><br><span class="line">            GUILayout.BeginArea(<span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">20</span>, <span class="number">120</span>, <span class="number">320</span>));</span><br><span class="line">            <span class="keyword">if</span> (GUILayout.Button(<span class="string">"Set Anchors"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                RectTransform rectTransform = m_context.Transform;</span><br><span class="line">                RectTransform parent = rectTransform.parent <span class="keyword">as</span> RectTransform;</span><br><span class="line"></span><br><span class="line">                Undo.RecordObject(rectTransform, <span class="string">"Set Anchors"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Vector2 anchorMin = <span class="keyword">new</span> Vector2(</span><br><span class="line">                        rectTransform.anchorMin.x + rectTransform.offsetMin.x / parent.rect.width,</span><br><span class="line">                        rectTransform.anchorMin.y + rectTransform.offsetMin.y / parent.rect.height);</span><br><span class="line"></span><br><span class="line">                    Vector2 anchorMax = <span class="keyword">new</span> Vector2(</span><br><span class="line">                        rectTransform.anchorMax.x + rectTransform.offsetMax.x / parent.rect.width,</span><br><span class="line">                        rectTransform.anchorMax.y + rectTransform.offsetMax.y / parent.rect.height);</span><br><span class="line"></span><br><span class="line">                    rectTransform.anchorMin = anchorMin;</span><br><span class="line">                    rectTransform.anchorMax = anchorMax;</span><br><span class="line">                    rectTransform.offsetMin = rectTransform.offsetMax = Vector2.zero;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            GUILayout.EndArea();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Handles.EndGUI();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>æœ‰äº†è¿™ä¸ª acnhor é€‚é…çœŸçš„æ–¹ä¾¿ä¸å°‘ã€‚æœ‰æ—¶å€™æˆ‘ä»¬åšå¥½ä¸€ä¸ª list elementï¼Œä½†åœ¨ä¸åŒçš„åœ°æ–¹ç”¨åˆ°çš„æ—¶å€™å¤§å°å¯èƒ½ä¸ä¸€æ ·ã€‚<br>ç”¨è¿™ä¸ªé€‚é…è°ƒæ•´ä»¥åå¯ä»¥é˜²æ­¢å„ç§å¥‡å¦™å‡ºæ ¼ï¼Œè€Œä¸”å°±ç‚¹ä¸¤ä¸‹æŒ‰é’®ï¼Œå¯¹äº UXUI å›¢é˜Ÿæ¥è¯´ä¹Ÿæ˜¯éå¸¸å®¹æ˜“ä¸Šæ‰‹çš„ã€‚</p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Hyperv è™šæ‹Ÿæœºå…±äº«VPNç»™å®¿ä¸»æœº</title>
    <url>/2022/05/15/20220515-hyperv-vpn-inside/</url>
    <content><![CDATA[<p>è¢«å°åœ¨é¼ çªé‡Œä¸¤ä¸ªæœˆäº†ï¼Œä¸€ç›´éƒ½æ˜¯åœ¨å®¶ç”¨è‡ªå·±çš„è€çˆ·å¤‡ç”¨æœºåšå·¥ä½œã€‚ä½†æ˜¯è€(é¡¹)çˆ·(ç›®)æœºçš„æ€§(ä¼˜)èƒ½(åŒ–)å®åœ¨æ˜¯å¤ªå·®äº†ã€‚<br>æ‰“å¼€ Unity éœ€è¦5åˆ†é’Ÿï¼Œç¼–è¯‘ä»£ç 3åˆ†é’Ÿï¼Œç‚¹ä¸€ä¸‹ play åˆæ˜¯2åˆ†é’Ÿã€‚è¿™æ®µæ—¶é—´æ¥å›ä¿®å„ç§BUGï¼Œåˆ‡æ¥åˆ‡å»æµªè´¹äº†å¾ˆå¤šæ—¶é—´ã€‚</p>
<p>å†³å®šè¿˜æ˜¯ç”¨å¤§å¥¶æœºå·¥ä½œäº†ï¼Œä½†åˆéå¸¸ä¸æ„¿æ„æŠŠå…¬å¸çš„é—´è°å…¨å®¶æ¡¶è£…åœ¨ç”µè„‘ä¸Šï¼Œå’‹åŠå‘¢ï¼Ÿ</p>
<p>ä¸Šç½‘æŸ¥äº†ä¸€ä¸‹ï¼Œå¤§å®¶è¯´å¯ä»¥æŠŠå…¨å®¶æ¡¶å…³åœ¨è™šæ‹Ÿæœºé‡Œï¼Œç„¶åå†æŠŠç½‘ç»œåˆ†äº«ç»™å®¿ä¸»æœºã€‚</p>
<h2 id="Hyper-V"><a href="#Hyper-V" class="headerlink" title="Hyper-V"></a>Hyper-V</h2><p>æœ€å¼€å§‹è¯•ç”¨äº† VirtualBox æ— è®ºæ˜¯è£…32ä½è¿˜æ˜¯64ä½çš„Win10æˆ–è€… WinServer éƒ½å¡åˆ°é£èµ·ã€‚å³ä½¿æŠŠè™šæ‹Ÿæœºçš„è™šæ‹Ÿç›˜æ”¾åœ¨ SSD ä¸Šä¹Ÿè¿˜æ˜¯å¡ã€‚<br>äº†è§£åˆ° Windows æœ‰è¿™ä¸ª Hyper-V è™šæ‹Ÿæœºå°±å†³å®šè¯•ç”¨ä¸€ä¸‹ã€‚</p>
<p>ç»“æœè¿™ä¸ªç©æ„å„¿æ€§èƒ½è¶…æ£’çš„å“¦ï¼æ”¾åœ¨ SSD ä¸Šå¯ä»¥è¯´æ˜¯ä¸æ€ä¹ˆå¡ã€‚è€Œä¸”ä¹Ÿèƒ½ç›´æ¥è¯»å®¿ä¸»æœºçš„ç¡¬ç›˜æˆ–æ²¹ç›˜ï¼Œéå¸¸çš„æ–¹ä¾¿ï¼Œè™½ç„¶è¯»ç›˜çš„æ—¶å€™ç¡¬ç›˜ä½¿ç”¨ç‡æ˜¾ç¤ºæ˜¯æ‹‰æ»¡çš„ã€‚</p>
<p>æˆ‘è®°å¾—ä»¥å‰å¦‚æœè¦è¦ä½¿ç”¨ VM æˆ–è€… VBox çš„è¯éœ€è¦å…³é—­ Hyper-V çš„åŠŸèƒ½ï¼Œä½†æ˜¯è‡ªä» Win10 20H2 è¿˜æ˜¯æŸä¸ªç‰ˆæœ¬ä¹‹åå°±ä¸éœ€è¦è¿™ä¹ˆåšäº†ã€‚</p>
<h3 id="è™šæ‹Ÿæœºå¯åŠ¨å°å‘"><a href="#è™šæ‹Ÿæœºå¯åŠ¨å°å‘" class="headerlink" title="è™šæ‹Ÿæœºå¯åŠ¨å°å‘"></a>è™šæ‹Ÿæœºå¯åŠ¨å°å‘</h3><p>â€œBoot Issue: Start PXE over IPv4â€</p>
<p>è£…å¥½ç³»ç»Ÿä»¥åä¿ºå¯åŠ¨è™šæ‹Ÿæœºå°±æŠ¥è¿™ä¸ªé”™è¯¯ã€‚<br>æŠŠç¡¬ç›˜ç§»åŠ¨åˆ°ç¬¬ä¸€ä½å°±å¥½äº†ã€‚</p>
<img src="/2022/05/15/20220515-hyperv-vpn-inside/20220515-pic004.png" class="" title="split">
<h2 id="é…ç½®è™šæ‹Ÿç½‘å¡"><a href="#é…ç½®è™šæ‹Ÿç½‘å¡" class="headerlink" title="é…ç½®è™šæ‹Ÿç½‘å¡"></a>é…ç½®è™šæ‹Ÿç½‘å¡</h2><p>å‚è€ƒäº†ç½‘ä¸Šçš„é€šç”¨æ–¹æ¡ˆï¼Œéœ€è¦ä¸¤å¼ è™šæ‹Ÿç½‘å¡ï¼Œä¸€å¼ æ¡¥æ¥ç”¨æ¥ä¸Šç½‘ï¼Œå¦ä¸€ä¸ªæ¥æ”¶å…¨å®¶æ¡¶çš„åˆ†äº«ã€‚</p>
<p>æ¡¥æ¥</p>
<p>æˆ‘è¿™è¾¹é€‰ç”¨çš„æ˜¯æœ‰çº¿ç½‘çš„æ¥å£</p>
<img src="/2022/05/15/20220515-hyperv-vpn-inside/20220515-pic001.png" class="" title="split">
<p>å†…éƒ¨ç½‘ç»œ</p>
<img src="/2022/05/15/20220515-hyperv-vpn-inside/20220515-pic002.png" class="" title="split">
<p>ipconfig ç»“æœ</p>
<img src="/2022/05/15/20220515-hyperv-vpn-inside/20220515-pic003.png" class="" title="split">
<h2 id="å®¿ä¸»æœºé…ç½®"><a href="#å®¿ä¸»æœºé…ç½®" class="headerlink" title="å®¿ä¸»æœºé…ç½®"></a>å®¿ä¸»æœºé…ç½®</h2><p>æ¥ä¸‹æ¥å°±æ˜¯é…ç½®å®¿ä¸»æœºï¼Œè¿™åˆæœ‰ä¸€ä¸ªä¸ä¸€æ ·çš„æƒ…å†µå‡ºç°äº†ã€‚</p>
<p>åœ¨ Hyper-V é‚£è¾¹æ·»åŠ äº†1ä¸ªè™šæ‹Ÿäº¤æ¢æœºä»¥å, å®¿ä¸»æœºè¿™è¾¹ä¼šå‡ºç°2ä¸ªé€‚é…å™¨ã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘è¿™è¾¹ç‰¹æœ‰çš„æƒ…å†µã€‚<br>æŠŠå†…éƒ¨ç½‘ç»œé€‚é…å™¨çš„IPåœ°å€è®¾ç½®åˆ° 192.168.137.0 ç½‘æ®µï¼Œæˆ‘è¿™è¾¹ä¿®æ”¹çš„æ˜¯è¿™ä¸ªåå­—ç›¸åŒçš„ã€‚</p>
<img src="/2022/05/15/20220515-hyperv-vpn-inside/20220515-pic005.png" class="" title="split">
<p>ç„¶åå®¿ä¸»æœºæ·»åŠ è½¬å‘å°±å¯ä»¥äº†ï¼Œä¸è¿‡é€Ÿåº¦ä¸å¤Ÿå¿«ï¼Œå…¨å®¶æ¡¶ç›´æ¥è£…å®¿ä¸»æœºä¸Šè¿˜æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">route add x.y.0.0 mask 255.255.0.0 192.168.137.1</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://yidianyidi.fun/VirtualBox/yidianyidi-1708121150.html" target="_blank" rel="noopener">https://yidianyidi.fun/VirtualBox/yidianyidi-1708121150.html</a></p>
<p><a href="https://www.youtube.com/watch?v=9Hc-5EOtaJs" target="_blank" rel="noopener">https://www.youtube.com/watch?v=9Hc-5EOtaJs</a></p>
]]></content>
      <categories>
        <category>VirtualMachine</category>
      </categories>
      <tags>
        <tag>Misc</tag>
        <tag>VirtualMachine</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity InputSystem ç®€å•ä¿å­˜æŒ‰é”®rebind</title>
    <url>/2022/04/05/20220404-input-sys-save-rebind-01/</url>
    <content><![CDATA[<p>Unity çš„ InputSystem æ­£å¼å‘å¸ƒä¹Ÿå¥½ä¸€æ®µæ—¶é—´äº†ã€‚æœ¬æ¥è¿™è¾¹ä¹Ÿæƒ³è‡ªå·±åšä¸€å¥—è¾“å…¥å¤„ç†ä½†æ˜¯çœ‹ Unity è¿™ä¸ªå®˜æ–¹çš„è¿˜æŒºæ–¹ä¾¿å°±æ‰“ç®—ç›´æ¥ç”¨ã€‚</p>
<h1 id="InputAction"><a href="#InputAction" class="headerlink" title="InputAction"></a>InputAction</h1><p>è¯´ä¸‹æˆ‘å¯¹è¿™ä¸ª InputAction çš„ç®€å•ç†è§£ã€‚</p>
<p>InputAction</p>
<pre><code>- Composite
    - Binding
- Binding
</code></pre><ul>
<li>Interaction</li>
<li>Processor</li>
</ul>
<p>InputAction æ˜¯å®šä¹‰çš„æœ€ä¸Šå±‚çš„äº¤äº’äº‹ä»¶ï¼Œæˆ‘è®¤ä¸ºä»–æ˜¯ç›´æ¥å’Œ gameplay å±‚é¢äº¤äº’çš„ï¼Œæä¾›å“åº”äº‹ä»¶å’Œè¾“å…¥è®¾å¤‡çš„æ•°æ®(æ¯”å¦‚é¼ æ ‡çš„ä½ç½®ï¼Œæˆ–æ˜¯çº¿æ€§æŒ‰é’®çš„æ•°å€¼)</p>
<p>Binding æ˜¯å…·ä½“åˆ°è¾“å…¥è®¾å¤‡ä¸ŠæŒ‰é”®ï¼Œçº¿æ€§è¾“å…¥çš„ä¸€ä¸ªæ•°æ®ç»“æ„</p>
<p>Composite æ˜¯æŠŠ Binding æä¾›çš„ç›´æ¥è¾“å…¥æ•°æ®å¤„ç†æˆæˆ‘ä»¬æƒ³è¦çš„æ•°æ®å¹¶æä¾›ç»™ InputActionã€‚</p>
<p>å¦å¤–ä¸¤ä¸ªå¯ä»¥åº”ç”¨äºInputActionï¼ŒComposite å’Œ Binding çš„ç»„ä»¶</p>
<p>Interaction æ˜¯ç”¨æ¥è§„å®šå½“å‰çš„ è¾“å…¥/è¡Œä¸º è§¦å‘çš„æœºåˆ¶ã€‚</p>
<p>Processor æ˜¯ç”¨æ¥å¯¹å½“å‰çš„è¾“å…¥æ•°æ®åšè¿½åŠ å¤„ç†çš„ã€‚</p>
<h1 id="rebind"><a href="#rebind" class="headerlink" title="rebind"></a>rebind</h1><p>æˆ‘åœ¨å®˜æ–¹çš„tank exampleä¸­åšçš„ rebind save</p>
<p>å¯¹äºç®€å•çš„ Button Action é‡Œçš„ Binding, rebind çš„æ—¶å€™æˆ‘ä»¬æ˜¯è¿½åŠ äº† OverridePath ç»™è¿™ä¸ª Button Action ä¸‹é¢çš„ Bindingã€‚</p>
<p>Path æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸², å¤§æ¦‚æ˜¯è¿™æ ·çš„ â€œ<Gamepad>/buttonSouthâ€ã€‚ é‡Œé¢åŒ…å«äº†è¾“å…¥è®¾å¤‡ç±»å‹å’Œå…·ä½“çš„æŒ‰é’®åã€‚(å…¶å®æˆ‘è§‰å¾—ï¼Œ <Gamepad> è¿™æ ·çš„æ–‡æœ¬å¯ä»¥æä¾›æˆä¸€ä¸ªConst string ï¼Œä¼šå¥½ç”¨å¾ˆå¤š)</p>
<p>å¯¹äºç®€å•çš„ rebind å­˜å‚¨ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æ‰€æœ‰çš„ Binding é‡Œçš„ override path ä¿å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡å¯åŠ¨æ¸¸æˆåŠ è½½äº†åŸæœ¬çš„ Action Map ä¹‹åå†æŠŠ Override Path ç»™èµ‹å€¼ä¸Šå»ã€‚</p>
<h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">InputBindSaveHelper</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="keyword">string</span> s_keyMappingPreferKey = <span class="string">"KeyMapping"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SaveActionMapRebinding</span>(<span class="params">InputActionMap actionMap</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Dictionary&lt;Guid, <span class="keyword">string</span>&gt; overridedActionPathDict = <span class="keyword">new</span> Dictionary&lt;Guid, <span class="keyword">string</span>&gt;();</span><br><span class="line">        UnityEngine.InputSystem.Utilities.ReadOnlyArray&lt;InputAction&gt; actions = actionMap.actions;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; actions.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            InputAction action = actions[i];</span><br><span class="line">            UnityEngine.InputSystem.Utilities.ReadOnlyArray&lt;InputBinding&gt; actionBindings = action.bindings;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; actionBindings.Count; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                InputBinding actionBinding = actionBindings[j];</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(actionBinding.overridePath))</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                overridedActionPathDict.Add(actionBinding.id, actionBinding.overridePath);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        BinaryFormatter binFormatter = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line">        MemoryStream mStream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">        binFormatter.Serialize(mStream, overridedActionPathDict);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] byteArr = mStream.ToArray();</span><br><span class="line">        <span class="comment">// idk why [Encoding.UTF8.GetString()] just doesnt work</span></span><br><span class="line">        <span class="keyword">string</span> encodingString = Convert.ToBase64String(byteArr, Base64FormattingOptions.InsertLineBreaks);</span><br><span class="line">        PlayerPrefs.SetString(s_keyMappingPreferKey, encodingString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">LoadActionMapRebinding</span>(<span class="params">InputActionMap actionMap</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">string</span> encodingString = PlayerPrefs.GetString(s_keyMappingPreferKey);</span><br><span class="line">        <span class="keyword">byte</span>[] byteArr = Convert.FromBase64String(encodingString);</span><br><span class="line"></span><br><span class="line">        BinaryFormatter binFormatter = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line">        MemoryStream mStream = <span class="keyword">new</span> MemoryStream(byteArr);</span><br><span class="line">        Dictionary&lt;Guid, <span class="keyword">string</span>&gt; rebindSavePairDict = binFormatter.Deserialize(mStream) <span class="keyword">as</span> Dictionary&lt;Guid, <span class="keyword">string</span>&gt;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rebindSavePairDict != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            UnityEngine.InputSystem.Utilities.ReadOnlyArray&lt;InputAction&gt; actions = actionMap.actions;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; actions.Count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                InputAction action = actions[i];</span><br><span class="line">                UnityEngine.InputSystem.Utilities.ReadOnlyArray&lt;InputBinding&gt; actionBindings = action.bindings;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; actionBindings.Count; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    InputBinding actionBinding = actionBindings[j];</span><br><span class="line">                    <span class="comment">// override</span></span><br><span class="line">                    <span class="keyword">if</span> (rebindSavePairDict.ContainsKey(actionBinding.id))</span><br><span class="line">                    &#123;</span><br><span class="line">                        actionBinding.overridePath = rebindSavePairDict[actionBinding.id];</span><br><span class="line">                        action.ApplyBindingOverride(actionBinding);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“å‰å› ä¸ºé¡¹ç›®é‡Œçš„å­˜æ¡£ç›¸å…³çš„åŠŸèƒ½è¿˜æ²¡åšå®Œï¼Œç»“æ„è¿˜æ²¡å®šä¸‹æ¥ï¼Œæ‰€ä»¥æˆ‘åªèƒ½æŠŠ rebind å­˜åœ¨PlayerPrefsé‡Œã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æˆ‘ä¹Ÿåªæ˜¯å¤§æ¦‚çœ‹äº†ä¸€ä¸‹ Unity çš„è¿™ä¸ª InputSystemï¼Œæ²¡æœ‰å¾ˆæ·±çš„å»ä½¿ç”¨ã€‚ä½†æ˜¯åˆæ­¥ä¸Šæ‰‹çš„æ—¶å€™å°±æ„Ÿè§‰ä»–çš„å°è£…å’Œæ‰©å±•æ€§å¯¹äºé‚£äº›æ“ä½œè¦æ±‚ä¸é«˜çš„æ¸¸æˆæ˜¯å·²ç»å¤Ÿç”¨çš„äº†ã€‚<br>æ¯”è¾ƒéº»çƒ¦çš„ä¸€ä¸ªç‚¹å°±æ˜¯ä»–çš„ Interaction, Processor å’Œ Binding çš„è¦†ç›–å…¨éƒ½éœ€è¦ç”¨ stringã€‚ç›´æ¥å†™çš„ string ä¼šéå¸¸ä¸æ–¹ä¾¿ï¼Œä¼°è®¡ä½¿ç”¨è€…å¾—è‡ªå·±æ€»ç»“ä¸€äº›å…¶å¸¸ç”¨çš„ const string å†™è¿›å˜é‡ç›´æ¥è°ƒç”¨ã€‚<br>è¿™æ ·æ‰èƒ½æ¯”è¾ƒå¥½çš„ç»´æŒä»£ç å¯è¯»æ€§ã€‚</p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity RectTransform å°ç¬”è®°</title>
    <url>/2022/08/14/20220814-unity-recttransform/</url>
    <content><![CDATA[<p>ä¹‹å‰çœ‹äº†ä¸€äº›å…³äºRectTransformçš„æ–‡ç« ï¼Œä½†æ˜¯æœ€ç»ˆè®°å¿†éƒ½ä¸æ˜¯å¾ˆæ·±åˆ»ã€‚è€Œä¸”è¦ç”¨çš„æ—¶å€™é‡æ–°æ‰¾è¿˜æŒºéº»çƒ¦çš„ã€‚<br>å¹²è„†æŠŠåˆ«äººçš„ç¬”è®°æŠ„æ¥ä¸€äº›å¥½äº†ï¼Œä»¥åä¹Ÿæ–¹ä¾¿å°±ç€è‡ªå·±çš„ç¬”è®°å’ŒUXUIåŒå­¦è§£é‡Šã€‚</p>
<h1 id="Pivot"><a href="#Pivot" class="headerlink" title="Pivot"></a>Pivot</h1><p>ä¸­å¿ƒç‚¹ï¼Œæ˜¯UIå…ƒç´ æ—‹è½¬/ç¼©æ”¾çš„ä¸­å¿ƒç‚¹ã€‚ä½¿ç”¨å½’ä¸€åŒ–Vector2è¡¨ç¤ºã€‚</p>
<h1 id="Anchor"><a href="#Anchor" class="headerlink" title="Anchor"></a>Anchor</h1><p>å…¶å®æ˜¯ç”±ä¸¤ä¸ªç‚¹ç»„æˆçš„(AnchorMin, AnchorMax)ã€‚å¹¶ä½¿ç”¨å½’ä¸€åŒ–Vector2æ¥è¡¨ç¤ºã€‚<br>æ•°å€¼ä»£è¡¨äº†åœ¨çˆ¶ç±»Xè½´å’ŒYè½´æ–¹å‘çš„ç™¾åˆ†æ¯”ã€‚</p>
<h2 id="ç»å¯¹å¸ƒå±€"><a href="#ç»å¯¹å¸ƒå±€" class="headerlink" title="ç»å¯¹å¸ƒå±€"></a>ç»å¯¹å¸ƒå±€</h2><blockquote>
<p>å½“anchorMaxä¸anchorMinç›¸ç­‰æ—¶ï¼ŒAnchorå‘ˆç°ä¸ºä¸€ä¸ªç‚¹ï¼Œç§°ä¹‹ä¸ºé”šç‚¹<br>åœ¨ä½¿ç”¨é”šç‚¹çš„æƒ…å†µä¸‹ï¼ŒanchoredPositionæ˜¯å…ƒç´ Pivotåˆ°Anchorçš„è·ç¦»</p>
</blockquote>
<p>æ­¤æ—¶ä¼šæœ‰4ä¸ªé‡è¦çš„å±æ€§ã€‚</p>
<ul>
<li>PosX, posY : ä¸­å¿ƒç‚¹åˆ°é”šç‚¹çš„å‚æ•°ï¼Œå®é™…åƒç´ å€¼</li>
<li>Width, Height : UI å…ƒç´ çš„å°ºå¯¸</li>
</ul>
<p>ç»å¯¹å¸ƒå±€çš„æƒ…å†µä¸‹æ— è®ºåˆ†è¾¨ç‡æ˜¯å¤šå°‘ï¼Œçˆ¶ç‰©ä½“å¤šå¤§ï¼Œè¯¥UIå…ƒç´ çš„å¤§å°æ˜¯æ’å®šçš„ã€‚</p>
<h2 id="ç›¸å¯¹å¸ƒå±€"><a href="#ç›¸å¯¹å¸ƒå±€" class="headerlink" title="ç›¸å¯¹å¸ƒå±€"></a>ç›¸å¯¹å¸ƒå±€</h2><blockquote>
<p>å½“anchorMaxä¸anchorMinä¸ç›¸ç­‰æ—¶ï¼ŒAnchorå‘ˆç°ä¸ºä¸€ä¸ªæ¡†ï¼Œç§°ä¹‹ä¸ºé”šæ¡†<br>åœ¨ä½¿ç”¨é”šæ¡†çš„æƒ…å†µä¸‹ï¼ŒanchoredPositionæ˜¯å…ƒç´ Pivotåˆ°é”šæ¡†ä¸­å¿ƒç‚¹çš„è·ç¦»</p>
</blockquote>
<p>è¿™ç§æƒ…å†µä¸‹UIå…ƒç´ çš„å››ä¸ªè§’ï¼Œè·ç¦»å››ä¸ªå¯¹åº”çš„é”šç‚¹çš„è·ç¦»æ˜¯ä¸å˜çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹RectTransformçš„å±æ€§åˆå˜ä¸ºäº†Left,Top,Right,Bottomã€‚</p>
<ul>
<li>Left,Top,Right,Bottom : å››ä¸ªç‚¹çš„æ•°å€¼åˆ†åˆ«æ˜¯(Left,Top,Right,Bottom)é”šç‚¹åˆ°å®é™…çš„rectçš„è¿™4ä¸ªä½ç½®çš„ç‚¹çš„è·ç¦»ã€‚</li>
</ul>
<h1 id="SizeDelta"><a href="#SizeDelta" class="headerlink" title="SizeDelta"></a>SizeDelta</h1><h2 id="OffsetMin-OffsetMax"><a href="#OffsetMin-OffsetMax" class="headerlink" title="OffsetMin/OffsetMax"></a>OffsetMin/OffsetMax</h2><p>minæ˜¯å®é™…UIåŸç´ ç›¸å¯¹äºAnchorMinçš„åç§»ï¼Œå¦å¤–ä¸€ä¸ªä¸è¨€è€Œå–».</p>
<p>sizeDeltaå°±æ˜¯offsetMax - offsetMinçš„å€¼ã€‚</p>
<blockquote>
<p>æ‰€ä»¥è¿™ä¸ªå±æ€§ä¹‹æ‰€ä»¥å«åšsizeDeltaï¼Œæ˜¯å› ä¸ºåœ¨é”šç‚¹æƒ…å†µä¸‹å…¶è¡¨å¾çš„æ˜¯sizeï¼ˆå¤§å°ï¼‰ï¼Œåœ¨é”šæ¡†çš„æƒ…å†µä¸‹å…¶è¡¨å¾çš„æ˜¯Deltaï¼ˆUIå…ƒç´ å®é™…çš„å±æ€§å€¼ä¸é”šæ¡†çš„å·®å€¼ï¼‰</p>
</blockquote>
<h1 id="Rect"><a href="#Rect" class="headerlink" title="Rect"></a>Rect</h1><p>rectä¸­çš„å±æ€§ï¼Œä¸ä¸UIå…ƒç´ æ‰€åœ¨çš„ä½ç½®æœ‰å…³ï¼Œåªå’Œå…¶è‡ªèº«å±æ€§ç›¸å…³ã€‚æ ¹æ®rectä¸­æä¾›çš„widthå’Œheightå¯ä»¥å¾—åˆ°UIå…ƒç´ å®é™…çš„å°ºå¯¸å¤§å°ã€‚</p>
<p>rect.positionæŒ‡çš„æ˜¯ä»¥Pivotä¸ºåŸç‚¹ï¼ŒUIå…ƒç´ å·¦ä¸‹è§’çš„åæ ‡ã€‚(right,up ä¸ºæ­£æ–¹å‘)</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://zhuanlan.zhihu.com/p/194317677" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/194317677</a><br><a href="https://blog.csdn.net/jmu201521121014/article/details/105725175" target="_blank" rel="noopener">https://blog.csdn.net/jmu201521121014/article/details/105725175</a></p>
<p>é¡ºä¾¿æ¨èä¸€ä¸‹åœ¨çº¿ç”»å›¾å°å·¥å…·ï¼Œä¸æ–¹ä¾¿è´´å›¾çš„æ—¶å€™ç”¨è¿™ä¸ªè¿˜æŒºä¸é”™çš„ã€‚<br><a href="https://asciiflow.com/#/" target="_blank" rel="noopener">https://asciiflow.com/#/</a><br><a href="https://textik.com/" target="_blank" rel="noopener">https://textik.com/</a></p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity Odin CustomValueDrawer å°å‘</title>
    <url>/2022/04/16/20220416-odin-custom-value-drawer/</url>
    <content><![CDATA[<p>ä¸ºäº†æ–¹ä¾¿ç­–åˆ’åœ¨ scriptable object ä¸Šé…ç½®æˆ‘ä»¬çš„ä»»åŠ¡ä»¥åŠäº‹ä»¶ç›¸å…³çš„æ–‡æœ¬ï¼Œæˆ‘åšäº†ä¸€ä¸ªç®€å•çš„ struct ã€‚é‡Œé¢åŒ…å«äº† I2 çš„ Lockey å’Œä¸€ä¸ªå‚æ•°æ•°ç»„ã€‚<br>æ—¢ç„¶è¦æ–¹ä¾¿ç­–åˆ’é…ç½®ï¼Œé‚£è‚¯å®šè¦åšä¸€ä¸ªç®€å•çš„é¢„è§ˆï¼Œè¿™æ ·ç­–åˆ’å°±èƒ½çŸ¥é“è‡ªå·±é…ç½®çš„æ–‡æœ¬å‚æ•°æ˜¯å¦æ­£ç¡®ã€‚</p>
<p>æ—¢ç„¶è¦åšé¢„è§ˆï¼Œé‚£è‚¯å®šå¾—å¾—è‡ªå·±å¤å†™ä¸€ä¸‹ä»–çš„ property draweräº†ã€‚å¯¹ä¸€ä¸ªå­—æ®µçš„ç¼–è¾‘å™¨ç»˜åˆ¶é‡å†™æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç»§æ‰¿ OdinValueDrawer classï¼Œ è¿˜æœ‰ä¸€ç§æ˜¯ CustomValueDrawer Attribute.</p>
<p><a href="https://odininspector.com/tutorials/how-to-create-custom-drawers-using-odin/how-to-create-a-custom-value-drawer" target="_blank" rel="noopener">https://odininspector.com/tutorials/how-to-create-custom-drawers-using-odin/how-to-create-a-custom-value-drawer</a><br><a href="https://odininspector.com/attributes/custom-value-drawer-attribute" target="_blank" rel="noopener">https://odininspector.com/attributes/custom-value-drawer-attribute</a></p>
<h1 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h1><p>æˆ‘å®šä¹‰çš„ç»“æ„æ˜¯è¿™æ ·çš„ã€‚</p>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ä»–å·²ç»èƒ½åœ¨ inspectorä¸Šç”»å‡ºæˆ‘çš„ Lockey å’Œæˆ‘çš„å‚æ•°æ•°ç»„ã€‚<br>å› ä¸ºè€ƒè™‘åˆ°ç»™æ•´ä¸ªç»“æ„åš OdinValueDrawer éœ€è¦è‡ªå·±ç”»æ•°ç»„æœ‰ç‚¹éº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©ç”¨ CustomValueDrawer åªé‡æ–°ç”» LocalizedStringã€‚</p>
<p>LocalizedString çš„é‡ç”»æˆ‘ç›´æ¥ç…§æ¬äº†åŒäº‹çš„ï¼Œä½†æ˜¯æˆ‘å‘ç°äº†ä¸€ä¸ªéå¸¸å¥‡æ€ªçš„é—®é¢˜ã€‚</p>
<p>æˆ‘åˆ›å»ºäº†ä¸€ä¸ªä¸‹æ‹‰é€‰æ¡†ï¼Œç„¶ååœ¨ç”¨æˆ·é€‰ä¸­ä¸€ä¸ªæ–°çš„ lockey çš„æ—¶å€™æˆ‘å¯¹ç»“æ„ä½“ä¸­çš„ lockey è¿›è¡Œæ›´æ–°ã€‚ä½†æˆ‘å‘ç°åœ¨ä¸‹æ‹‰é€‰æ¡†çš„é€‰ä¸­äº‹ä»¶è§¦å‘åè¿›è¡Œèµ‹å€¼ï¼Œç»˜åˆ¶å®Œæˆå†è¿”å›æ–°çš„ç»“æ„ï¼Œå¾—åˆ°çš„æ˜¯æ²¡æœ‰è¢«æ›´æ”¹çš„ç»“æœã€‚<br>ä½†æ˜¯åŒæ ·çš„ç»˜åˆ¶ä»£ç ï¼Œåœ¨ OdinValueDrawer ä¸­å´èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼ï¼ï¼CustomValueDrawer å’Œ OdinValueDrawer çš„åŸç†æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>OdinValueDrawer å°±æ˜¯ç›¸å½“äºä¸€ä¸ªæ›´å…ˆè¿›çš„ Property Drawer, åœ¨è¿™ä¸ªç»˜åˆ¶å™¨é‡Œæ˜¯å¯ä»¥è·å–åˆ°åŸæœ¬çš„å®é™…çš„å­—æ®µå€¼çš„ã€‚</p>
<p>CustomValueDrawer åˆ™åƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‡Œé¢åŒ…å«äº†ç»˜åˆ¶çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¸èƒ½å¤Ÿç›´æ¥æ“ä½œåŸæœ¬çš„å­—æ®µï¼Œéœ€è¦æœ€åæŠŠä½ æ›´æ–°åˆ°çš„å€¼è¿”å›å‡ºå»ï¼Œè¿™æ‰èƒ½å¤Ÿèµ‹å€¼ç»™å®é™…çš„é‚£ä¸ªå­—æ®µã€‚</p>
<p>ä»£ç ç»™å‡ºï¼Œæœ‰é—®é¢˜çš„åœ°æ–¹ä½¿ç”¨æ³¨é‡Šæ ‡æ˜äº†ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> LocalizationStringParmPack</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">CustomValueDrawer(<span class="meta-string">"DrawPreviewText"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> LocalizedString TextLoc;</span><br><span class="line">    <span class="keyword">public</span> LocalizationParamsManager.ParamValue[] ParmsArray;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">string</span> <span class="title">ToString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.GetRawEnglishString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> GUIStyle m_previewStyle;</span><br><span class="line">    <span class="keyword">static</span> GUIStyle PreviewStyle</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (m_previewStyle == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                m_previewStyle = <span class="keyword">new</span> GUIStyle(EditorStyles.textArea);</span><br><span class="line">                m_previewStyle.wordWrap = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> m_previewStyle;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use hacky stuff to get selected new lockey</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">string</span> s_wtfKey = <span class="keyword">string</span>.Empty;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">bool</span> s_hasChanged = <span class="literal">false</span>;</span><br><span class="line">    <span class="function">LocalizedString <span class="title">DrawPreviewText</span>(<span class="params">LocalizedString <span class="keyword">value</span>, GUIContent label</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.VerticalScope(UnityEditor.EditorStyles.helpBox))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// draw lockey</span></span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.HorizontalScope())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (label != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    EditorGUILayout.LabelField(label, GUILayout.Width(EditorGUIUtility.labelWidth));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// weird stuff happin in dropdown</span></span><br><span class="line">                <span class="keyword">if</span> (EditorGUILayout.DropdownButton(<span class="keyword">new</span> GUIContent(<span class="keyword">value</span>.mTerm), FocusType.Keyboard))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> terms = LocalizationManager.GetTermsList();</span><br><span class="line">                    <span class="keyword">var</span> selector = <span class="keyword">new</span> GenericSelector&lt;<span class="keyword">string</span>&gt;(<span class="string">"Select Term"</span>, terms);</span><br><span class="line">                    selector.EnableSingleClickToSelect();</span><br><span class="line">                    selector.SelectionConfirmed += s =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (s.Any())</span><br><span class="line">                        &#123;</span><br><span class="line">                            s_wtfKey = s.First();</span><br><span class="line">                            <span class="comment">// WEIRD STUFF HERE</span></span><br><span class="line">                            <span class="comment">/* if I do  </span></span><br><span class="line"><span class="comment">                            LocalizedString next = new LocalizedString(s.First());</span></span><br><span class="line"><span class="comment">                            and return 'next' and the end of method, it just doesnt work!!!</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                            cuz the GenericSelector is actually a editor window, and</span></span><br><span class="line"><span class="comment">                            */</span></span><br><span class="line">                            s_hasChanged = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    selector.ShowInPopup();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> mask = (<span class="keyword">value</span>.mRTL_IgnoreArabicFix ? <span class="number">0</span> : <span class="number">1</span>) +</span><br><span class="line">                           (<span class="keyword">value</span>.mRTL_ConvertNumbers ? <span class="number">0</span> : <span class="number">2</span>) +</span><br><span class="line">                           (<span class="keyword">value</span>.m_DontLocalizeParameters ? <span class="number">0</span> : <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">var</span> changed = <span class="keyword">new</span> EditorGUI.ChangeCheckScope())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">int</span> newMask = EditorGUILayout.MaskField(mask, <span class="keyword">new</span> <span class="keyword">string</span>[] &#123; <span class="string">"Arabic Fix"</span>, <span class="string">"Ignore Numbers in RTL"</span>, <span class="string">"Localize Parameters"</span> &#125;, GUILayout.Width(<span class="number">30</span>));</span><br><span class="line">                    <span class="keyword">if</span> (newMask != mask)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">value</span>.mRTL_IgnoreArabicFix = (newMask &amp; <span class="number">1</span>) == <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">value</span>.mRTL_ConvertNumbers = (newMask &amp; <span class="number">2</span>) == <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">value</span>.m_DontLocalizeParameters = (newMask &amp; <span class="number">4</span>) == <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (GUILayout.Button(<span class="string">$"Clear"</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">/* this will also work</span></span><br><span class="line"><span class="comment">                    LocalizedString next = new LocalizedString("[NULL]");</span></span><br><span class="line"><span class="comment">                    */</span></span><br><span class="line">                    s_wtfKey = <span class="string">"[NULL]"</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            LocalizedString next = s_hasChanged ? <span class="keyword">new</span> LocalizedString(s_wtfKey) : <span class="keyword">value</span>;</span><br><span class="line">            s_hasChanged = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            draw preview</span></span><br><span class="line"><span class="comment">            draw preview</span></span><br><span class="line"><span class="comment">            draw preview</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">return</span> next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">string</span> <span class="title">GetParamValue</span>(<span class="params"><span class="keyword">string</span> key</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ParmsArray.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ParmsArray[i].Name == key)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">string</span>.IsNullOrEmpty(ParmsArray[i].Value) ? key : ParmsArray[i].Value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="åˆè¸©å‘"><a href="#åˆè¸©å‘" class="headerlink" title="åˆè¸©å‘"></a>åˆè¸©å‘</h1><p>å› ä¸ºè¿™è¾¹ä½¿ç”¨äº†é™æ€å­—æ®µï¼Œæ‰€ä»¥å¦‚æœéœ€è¦åŒæ—¶ç»˜åˆ¶è¿™ä¸ªå­—æ®µä¸¤æ¬¡ï¼Œé‚£å°±ä¼šå‡ºé—®é¢˜ã€‚æ‰€ä»¥æœ€åæˆ‘è¿˜æ˜¯æ¢å›OdinValueDrawerã€‚<br>é™æ€å­—æ®µæœ€å¥½è¿˜æ˜¯åˆ«åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨å§ã€‚</p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ State Object æš‚å­˜ property drawer çš„çŠ¶æ€ã€‚</title>
    <url>/2022/07/30/20220730-unity-editor-stateobj/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨åšçº¢ç‚¹åŠŸèƒ½ï¼Œpathæ˜¯ç”¨stringæŒ‚åœ¨UIç‰©ä½“ä¸Šçš„ã€‚UIåŒå­¦é‚£è¾¹æƒ³è¦ä¸€ä¸ªæŒ‰é’®å¯ä»¥åˆ‡æ¢pathåœ¨inspectoræ˜¯å¯ç¼–è¾‘æˆ–ä¸å¯ç¼–è¾‘çš„çŠ¶æ€ã€‚<br>æœ€å¼€å§‹æ¯«æ— æ€è·¯ï¼Œå› ä¸ºæœ¬èº«pathæ˜¯ä¸€ä¸ªstringï¼Œæˆ‘è‡ªç„¶ä¸å¯ä»¥å®ƒèº«ä¸Šè®°å½•è¿™ä¸ªç¼–è¾‘ä¸å¦çš„çŠ¶æ€ã€‚åæ¥æƒ³ç€èƒ½ä¸èƒ½æŠŠè¿™ä¸ªçŠ¶æ€å­˜åœ¨pathçš„protperty drawerä¸Šã€‚é—®äº†ä¸‹å¯¼å¸ˆï¼Œå¯è¡Œï¼Œä½†æ˜¯æ²¡æ³•ç›´æ¥å­˜ã€‚</p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>åˆ›å»ºä¸€ä¸ªobjectå­˜å‚¨è¿™ä¸ªçŠ¶æ€ï¼Œè¿™ä¸ªobjectå­˜å…¥editorçš„state objecté‡Œã€‚<br>åœ¨Property drawerè¿›è¡Œç»˜åˆ¶çš„æ—¶å€™è·å–/æ›´æ–°è¿™ä¸ªobjectã€‚</p>
<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ä»£ç å¾ˆç®€å•</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UITagDrawer</span> : <span class="title">PropertyDrawer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// the object for string state</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">EditingState</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> IsEditing = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params">Rect position, SerializedProperty property, GUIContent label</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">/***/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// get state object</span></span><br><span class="line">        EditingState state = GUIUtility.GetStateObject(<span class="keyword">typeof</span>(EditingState), GUIUtility.GetControlID(FocusType.Passive)) <span class="keyword">as</span> EditingState;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.HorizontalScope(style))</span><br><span class="line">        &#123;</span><br><span class="line">            Rect editButtonRect = <span class="keyword">new</span> Rect(position.x, position.y, <span class="number">16f</span>, <span class="number">16f</span>);</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(editButtonRect, <span class="string">"E"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// well since it's a class we dun need to set it back :&gt;</span></span><br><span class="line">                state.IsEditing = !state.IsEditing;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (GUILayout.Button(<span class="string">"X"</span>, GUILayout.Width(<span class="number">18</span>)))</span><br><span class="line">            &#123;</span><br><span class="line">                state.IsEditing = !state.IsEditing;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (state.IsEditing)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// show text field</span></span><br><span class="line">                tagStr = EditorGUILayout.TextField(tagStr);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// show lable</span></span><br><span class="line">                EditorGUILayout.LabelField(tagStr);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>æŸ¥è¯¢MonoBehaviouråœ¨å·¥ç¨‹ä¸­çš„å¼•ç”¨</title>
    <url>/2022/07/24/20220724-find-script-reference/</url>
    <content><![CDATA[<p>ä»¥å‰å¼„è¿‡ä¸€ä¸ªåœ¨é¡¹ç›®ä¸­æŸ¥æ‰¾Assetå¼•ç”¨çš„ã€‚è™½ç„¶å¾ˆæ³›ç”¨ï¼Œä½†è·‘èµ·æ¥éå¸¸çš„æ…¢ã€‚<br>å…¶å®æˆ‘ä»¬å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šç»å¸¸åšæŸä¸€ç§æœç´¢(æ¯”å¦‚æŸ¥æ‰¾è„šæœ¬åœ¨é¢„åˆ¶ä½“ä¸Šçš„å¼•ç”¨)ã€‚å¯¹äºè¿™ç§éœ€è¦ä½¿ç”¨çš„ç‰¹å®šæ¡ä»¶çš„æŸ¥æ‰¾ï¼Œå•ç‹¬åšä¸€ä¸ªå°å·¥å…·å¯èƒ½æ•ˆç‡ä¼šæ›´é«˜ã€‚</p>
<p>æœ¬æ¥è¿˜åœ¨çƒ¦æ¼æ€ä¹ˆåšï¼Œå¯¼å¸ˆå¾ˆå¿«å°±åšå¥½äº†ï¼Œè·‘èµ·æ¥å¾ˆå¿«ã€‚ä»–å‘Šè¯‰æˆ‘ï¼Œç§˜è¯€æ˜¯ GetComponentã€‚</p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>ä»£ç ä¸æ–¹ä¾¿ç›´æ¥è´´å‡ºæ¥ï¼Œä½†è¿˜æ˜¯æƒ³åˆ†äº«(è®°å½•)ä¸€ä¸‹å‡ ä¸ªå…³é”®çš„æ­¥éª¤å’Œæ€è·¯~</p>
<h3 id="é€‰æ‹©è„šæœ¬"><a href="#é€‰æ‹©è„šæœ¬" class="headerlink" title="é€‰æ‹©è„šæœ¬"></a>é€‰æ‹©è„šæœ¬</h3><p>æˆ‘ä»¬éœ€è¦åœ¨ç¼–è¾‘å™¨ä¸Šç”¨ä¸€ä¸ª field å»æ”¾æˆ‘ä»¬æƒ³è¦æœå¯»çš„è„šæœ¬ã€‚<br>ä½†æ˜¯æ²¡åŠæ³•æ˜¯ç”¨åœ¨æ³›å‹ç±»ä¸Šã€‚éœ€è¦æŒ‡å®šå®é™…çš„ç±»å‹ã€‚</p>
<p>Interfaceä¹Ÿå¯ä»¥æŸ¥ï¼Œæ”¾å¿ƒç”¨ï¼</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">targetScript = EditorGUILayout.ObjectField(m_targetScript, <span class="keyword">typeof</span>(MonoScript), <span class="literal">false</span>) <span class="keyword">as</span> MonoScript;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">class SomeMono&lt;TData&gt; : MonoBehaviour</span></span><br><span class="line"><span class="comment">doesnt work on this case, the result will be null     </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Type targetType = m_targetScript.GetClass();</span><br></pre></td></tr></table></figure>
<h3 id="è·å–é¢„åˆ¶ä½“"><a href="#è·å–é¢„åˆ¶ä½“" class="headerlink" title="è·å–é¢„åˆ¶ä½“"></a>è·å–é¢„åˆ¶ä½“</h3><p>ä»æˆ‘ä»¬é€‰æ‹©çš„ç›®å½•ä¸‹è·å–æ‰€æœ‰çš„prefabï¼Œç›¸ä¿¡Unityï¼Œè¿™ä¸€æ­¥ä¸ä¼šå¾ˆæ…¢çš„ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// we can also set the folderPath to save our time :D </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> paths = AssetDatabase.FindAssets(<span class="string">$"t: prefab"</span>, <span class="keyword">new</span>[] &#123; folderPath &#125;);</span><br><span class="line">GameObject[] toCheck = <span class="keyword">new</span> GameObject[paths.Length];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; paths.Length; i++)</span><br><span class="line">    toCheck[i] = AssetDatabase.LoadAssetAtPath&lt;GameObject&gt;(AssetDatabase.GUIDToAssetPath(paths[i]));</span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥è¯¢å¼•ç”¨"><a href="#æŸ¥è¯¢å¼•ç”¨" class="headerlink" title="æŸ¥è¯¢å¼•ç”¨"></a>æŸ¥è¯¢å¼•ç”¨</h3><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Type targetType;</span><br><span class="line">GameObject prefab;</span><br><span class="line"><span class="keyword">var</span> components = prefab.GetComponents(targetType);</span><br><span class="line"><span class="comment">// if components is not empty, then you get your stuff :D</span></span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœè¦è¯´å­¦åˆ°äº†ä»€ä¹ˆçš„è¯ï¼Œå¤§æ¦‚æ˜¯åšå·¥å…·å‰è¦ææ˜ç™½å®ƒçš„ä½¿ç”¨æƒ…æ™¯ï¼Œä¸èƒ½å¤ªè„±èŠ‚Tw.T</p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>æ ¹æ®ä¸€ä¸ªUIç‰©ä½“çš„ä½ç½®æ‘†æ”¾å¦ä¸€ä¸ªUIç‰©ä½“</title>
    <url>/2023/03/26/20230326-ui-element-positioning/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨é‡åˆ°äº†ä¸€ä¸ªéœ€æ±‚ï¼Œè¦ç‚¹å‡»æŸä¸ªé“å…·UIä¹‹åï¼Œæ˜¾ç¤ºä¸€ä¸ªå°çš„å…³äºè¯¥é“å…·çš„ä¿¡æ¯æ¡†ã€‚<br>å¤§æ¦‚æ˜¯å…¥ä¸‹å›¾è¿™ä¸ªæ ·å­çš„ã€‚</p>
<img src="/2023/03/26/20230326-ui-element-positioning/20230326-pic001.png" class="" title="split">
<p>è¿˜å¥½ä¹‹å‰åšè¿‡ï¼Œäºæ˜¯ä¹ç›´æ¥ä¿®ä¿®è¡¥è¡¥è…¾è¿‡å»ã€‚è‡³äºä¸ºä»€ä¹ˆè¦ä¿®è¡¥ï¼Œæ˜¯å› ä¸ºåœ¨ä¹‹å‰çš„é¡¹ç›®é‡Œè™½ç„¶å†™äº†ä¸€äº›å’ŒRectTransformç›¸å…³çš„ä¸€äº›utilsï¼Œä½†éƒ½å› ä¸ºæ‡’å’Œèœï¼Œæ²¡æœ‰å»ç»´æŠ¤ã€‚æœ‰é‡å¤çš„æ–¹æ³•è¿˜æœ‰é”™è¯¯çš„æ–¹æ³•ï¼Œéº»äº†ã€‚<br>è¿™æ¬¡è¯´æ˜¯ä¿®è¡¥ï¼Œä¹Ÿç¨å¾®é‡å†™äº†ä¸€äº›å’ŒRectTransformç›¸å…³çš„ä¸€äº›utils,ä¹Ÿå‡†å¤‡å¸¦è¿›é¡¹ç›®é‡Œçœ‹çœ‹æœ‰æ²¡æœ‰åœ°æ–¹å¯ä»¥ç”¨çš„ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Temp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> RectPositionType</span><br><span class="line">    &#123;</span><br><span class="line">        Center = <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">        Top = <span class="number">1</span>,</span><br><span class="line">        Bottom = <span class="number">2</span>,</span><br><span class="line">        Left = <span class="number">3</span>,</span><br><span class="line">        Right = <span class="number">4</span>,</span><br><span class="line"></span><br><span class="line">        TopLeft = <span class="number">5</span>,</span><br><span class="line">        TopRight = <span class="number">6</span>,</span><br><span class="line"></span><br><span class="line">        BottomLeft = <span class="number">7</span>,</span><br><span class="line">        BottomRight = <span class="number">8</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIElementPositionSetter</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Target setting"</span>)</span>]</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> RectPositionType _targetRectPosition = RectPositionType.Center;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Vector2 _targetPivot = Vector2.zero;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Vector2 _extraOffset = Vector2.zero;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> RectOffset _adaptionOffset;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> _doScreenAdaption;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Other setting"</span>)</span>]</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> RectTransform _defaultBoundsCanvasTransform;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> _adjustHorizontal = <span class="literal">true</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> _adjustVertical = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPosition</span>(<span class="params">RectTransform target</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            RectTransform self = transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">            Vector3 spawnPos = GetLocalRectPosition(self, _targetRectPosition);</span><br><span class="line">            spawnPos += <span class="keyword">new</span> Vector3(_extraOffset.x, _extraOffset.y, <span class="number">0f</span>);</span><br><span class="line">            spawnPos = self.localToWorldMatrix.MultiplyPoint(spawnPos);</span><br><span class="line">            target.pivot = _targetPivot;</span><br><span class="line">            target.position = spawnPos;</span><br><span class="line">            <span class="keyword">if</span> (_doScreenAdaption)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// HACK @Hiko force rebuild to make sure the size is correct</span></span><br><span class="line">                LayoutRebuilder.ForceRebuildLayoutImmediate(target);</span><br><span class="line">                DoAdaption(target);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoAdaption</span>(<span class="params">RectTransform targetTransform</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_adjustHorizontal)</span><br><span class="line">            &#123;</span><br><span class="line">                AdjustHorizontal(targetTransform, _defaultBoundsCanvasTransform);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (_adjustVertical)</span><br><span class="line">            &#123;</span><br><span class="line">                AdjustVertical(targetTransform, _defaultBoundsCanvasTransform);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AdjustHorizontal</span>(<span class="params">RectTransform target, RectTransform outterBoundRectTransform</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Vector2 targetSize = target.rect.size;</span><br><span class="line">            Matrix4x4 targetLocalToWorld = target.localToWorldMatrix;</span><br><span class="line">            Matrix4x4 boundRectWorldToLocal = outterBoundRectTransform.worldToLocalMatrix;</span><br><span class="line">            Vector2 topLeftPos = GetLocalRectPosition(target, RectPositionType.TopLeft);</span><br><span class="line"></span><br><span class="line">            Vector3 checkWorldPoint = targetLocalToWorld.MultiplyPoint(topLeftPos + Vector2.down * targetSize.y * <span class="number">0.5f</span> + Vector2.left * _adaptionOffset.left);</span><br><span class="line">            Vector2 leftCheckLocalPoint = boundRectWorldToLocal.MultiplyPoint(checkWorldPoint);</span><br><span class="line">            Vector2 leftCheckBoundPoint = GetLocalRectPosition(outterBoundRectTransform, RectPositionType.Left);</span><br><span class="line">            <span class="keyword">bool</span> leftOut = leftCheckLocalPoint.x &lt; leftCheckBoundPoint.x;</span><br><span class="line"></span><br><span class="line">            checkWorldPoint = targetLocalToWorld.MultiplyPoint(topLeftPos + Vector2.down * targetSize.y * <span class="number">0.5f</span> + Vector2.right * targetSize.x + Vector2.right * _adaptionOffset.right);</span><br><span class="line">            Vector2 rightCheckLocalPoint = boundRectWorldToLocal.MultiplyPoint(checkWorldPoint);</span><br><span class="line">            Vector2 rightCheckBoundPoint = GetLocalRectPosition(outterBoundRectTransform, RectPositionType.Right);</span><br><span class="line">            <span class="keyword">bool</span> rightOut = rightCheckLocalPoint.x &gt; rightCheckBoundPoint.x;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (leftOut &amp;&amp; rightOut)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// outter bound is too small</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (leftOut)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">float</span> xDelta = leftCheckLocalPoint.x - leftCheckBoundPoint.x;</span><br><span class="line">                Vector3 tempPos = target.localPosition;</span><br><span class="line">                tempPos.x -= xDelta;</span><br><span class="line">                target.localPosition = tempPos;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (rightOut)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">float</span> xDelta = rightCheckLocalPoint.x - rightCheckBoundPoint.x;</span><br><span class="line">                Vector3 tempPos = target.localPosition;</span><br><span class="line">                tempPos.x -= xDelta;</span><br><span class="line">                target.localPosition = tempPos;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (leftOut || rightOut)</span><br><span class="line">            &#123;</span><br><span class="line">                LayoutRebuilder.ForceRebuildLayoutImmediate(target);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AdjustVertical</span>(<span class="params">RectTransform target, RectTransform outterBoundRectTransform</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Vector2 targetSize = target.rect.size;</span><br><span class="line">            Matrix4x4 targetLocalToWorld = target.localToWorldMatrix;</span><br><span class="line">            Matrix4x4 boundRectWorldToLocal = outterBoundRectTransform.worldToLocalMatrix;</span><br><span class="line">            Vector2 topLeftPos = GetLocalRectPosition(target, RectPositionType.TopLeft);</span><br><span class="line"></span><br><span class="line">            Vector3 checkWorldPoint = targetLocalToWorld.MultiplyPoint(topLeftPos + Vector2.right * targetSize.x * <span class="number">0.5f</span> + Vector2.up * _adaptionOffset.top);</span><br><span class="line">            Vector2 topCheckLocalPoint = boundRectWorldToLocal.MultiplyPoint(checkWorldPoint);</span><br><span class="line">            Vector2 topCheckBoundPoint = GetLocalRectPosition(outterBoundRectTransform, RectPositionType.Top);</span><br><span class="line">            <span class="keyword">bool</span> topOut = topCheckLocalPoint.y &gt; topCheckBoundPoint.y;</span><br><span class="line"></span><br><span class="line">            checkWorldPoint = targetLocalToWorld.MultiplyPoint(topLeftPos + Vector2.down * targetSize.y + Vector2.right * targetSize.x * <span class="number">0.5f</span> + Vector2.down * _adaptionOffset.bottom);</span><br><span class="line">            Vector2 bottomCheckLocalPoint = boundRectWorldToLocal.MultiplyPoint(checkWorldPoint);</span><br><span class="line">            Vector2 bottomCheckBoundPoint = GetLocalRectPosition(outterBoundRectTransform, RectPositionType.Bottom);</span><br><span class="line">            <span class="keyword">bool</span> bottomOut = bottomCheckLocalPoint.y &lt; bottomCheckBoundPoint.y;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (topOut &amp;&amp; bottomOut)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// outter bound is too small</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (topOut)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">float</span> yDelta = topCheckLocalPoint.y - topCheckBoundPoint.y;</span><br><span class="line">                Vector3 tempPos = target.localPosition;</span><br><span class="line">                tempPos.y -= yDelta;</span><br><span class="line">                target.localPosition = tempPos;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (bottomOut)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">float</span> yDelta = bottomCheckLocalPoint.y - bottomCheckBoundPoint.y;</span><br><span class="line">                Vector3 tempPos = target.localPosition;</span><br><span class="line">                tempPos.y -= yDelta;</span><br><span class="line">                target.localPosition = tempPos;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (topOut || bottomOut)</span><br><span class="line">            &#123;</span><br><span class="line">                LayoutRebuilder.ForceRebuildLayoutImmediate(target);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> position util</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector2 <span class="title">GetLocalRectPosition</span>(<span class="params">RectTransform target, RectPositionType offsetType</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> GetLocalRectPosition(target, offsetType, Vector2.zero);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector2 <span class="title">GetLocalRectPosition</span>(<span class="params">RectTransform target, RectPositionType offsetType, Vector2 offset</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> GetLocalRectPosition(target.rect.size, target.pivot, offsetType, offset);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector2 <span class="title">GetLocalRectPosition</span>(<span class="params">Vector2 targetSize, Vector2 targetPivot, RectPositionType offsetType, Vector2 offset</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Vector2 bottomLeft = Vector2.zero;</span><br><span class="line">            bottomLeft.x -= targetPivot.x * targetSize.x;</span><br><span class="line">            bottomLeft.y -= targetPivot.y * targetSize.y;</span><br><span class="line">            Vector2 result = bottomLeft;</span><br><span class="line">            <span class="keyword">switch</span> (offsetType)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.Top:</span><br><span class="line">                    result += Vector2.right * <span class="number">0.5f</span> * targetSize.x + Vector2.up * targetSize.y;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.Bottom:</span><br><span class="line">                    result += Vector2.right * <span class="number">0.5f</span> * targetSize.x;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.Left:</span><br><span class="line">                    result += Vector2.up * <span class="number">0.5f</span> * targetSize.y;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.Right:</span><br><span class="line">                    result += Vector2.right * targetSize.x + Vector2.up * <span class="number">0.5f</span> * targetSize.y;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.TopLeft:</span><br><span class="line">                    result += Vector2.up * targetSize.y;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.TopRight:</span><br><span class="line">                    result += Vector2.right * targetSize.x + Vector2.up * targetSize.y;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.BottomRight:</span><br><span class="line">                    result += Vector2.right * targetSize.x;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.BottomLeft:</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result + offset;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">RectPositionToWorld</span>(<span class="params">RectTransform rect, RectPositionType offsetType</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> RectPositionToWorld(rect, offsetType, Vector2.zero);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">RectPositionToWorld</span>(<span class="params">RectTransform rect, RectPositionType offsetType, Vector2 offset</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> localPosition = GetLocalRectPosition(rect, offsetType, offset);</span><br><span class="line">            <span class="keyword">return</span> rect.TransformPoint(localPosition);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Vector2 <span class="title">GetTargetRectPositionInLocalReference</span>(<span class="params">RectPositionType offsetType</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            RectTransform self = transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">            Vector2 targetPivotPos = GetLocalRectPosition(self, _targetRectPosition, _extraOffset);</span><br><span class="line">            Vector2 virtualCenterPos = targetPivotPos;</span><br><span class="line">            virtualCenterPos += GetLocalRectPosition(_targetSize, _targetPivot, offsetType, Vector2.zero);</span><br><span class="line">            <span class="keyword">return</span> virtualCenterPos;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Preview setting"</span>)</span>]</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Vector2 _targetSize = Vector2.one * <span class="number">128f</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Color _previewColor = Color.white;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> _doDrawAdaptionOffsetRect = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">System.Serializable</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">struct</span> TempCheckResult</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">bool</span> previewLeftOut;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">bool</span> previewRightOut;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">bool</span> previewTopOut;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">bool</span> previewBottomOut;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> TempCheckResult _checkResult;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> _previewLeftOut;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> _previewRightOut;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> _previewTopOut;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> _previewBottomOut;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDrawGizmosSelected</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// draw A box to show the position of target</span></span><br><span class="line">            RectTransform self = transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">            Vector2 localSpawnPos = GetLocalRectPosition(self, _targetRectPosition);</span><br><span class="line">            localSpawnPos += _extraOffset;</span><br><span class="line"></span><br><span class="line">            Vector2 pivot = _targetPivot;</span><br><span class="line">            Vector2 topLeftPos = localSpawnPos;</span><br><span class="line">            topLeftPos.x -= pivot.x * _targetSize.x;</span><br><span class="line">            topLeftPos.y -= (pivot.y - <span class="number">1f</span>) * _targetSize.y;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (_doScreenAdaption)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// do adaption</span></span><br><span class="line">                <span class="keyword">if</span> (_defaultBoundsCanvasTransform != <span class="literal">null</span>) <span class="comment">// if there is no bound, we can take the screen as the bound</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Matrix4x4 localToWorld = self.localToWorldMatrix;</span><br><span class="line">                    RectTransform outterBoundRectTransform = _defaultBoundsCanvasTransform;</span><br><span class="line">                    Matrix4x4 boundRectWorldToLocal = outterBoundRectTransform.worldToLocalMatrix;</span><br><span class="line"></span><br><span class="line">                    Vector3 checkWorldPoint = localToWorld.MultiplyPoint(topLeftPos + Vector2.down * _targetSize.y * <span class="number">0.5f</span> + Vector2.left * _adaptionOffset.left);</span><br><span class="line">                    Vector2 leftCheckLocalPoint = boundRectWorldToLocal.MultiplyPoint(checkWorldPoint);</span><br><span class="line">                    Vector2 leftCheckBoundPoint = GetLocalRectPosition(outterBoundRectTransform, RectPositionType.Left);</span><br><span class="line">                    _previewLeftOut = leftCheckLocalPoint.x &lt; leftCheckBoundPoint.x;</span><br><span class="line"></span><br><span class="line">                    checkWorldPoint = localToWorld.MultiplyPoint(topLeftPos + Vector2.down * _targetSize.y * <span class="number">0.5f</span> + Vector2.right * _targetSize.x + Vector2.right * _adaptionOffset.right);</span><br><span class="line">                    Vector2 rightCheckLocalPoint = boundRectWorldToLocal.MultiplyPoint(checkWorldPoint);</span><br><span class="line">                    Vector2 rightCheckBoundPoint = GetLocalRectPosition(outterBoundRectTransform, RectPositionType.Right);</span><br><span class="line">                    _previewRightOut = rightCheckLocalPoint.x &gt; rightCheckBoundPoint.x;</span><br><span class="line"></span><br><span class="line">                    checkWorldPoint = localToWorld.MultiplyPoint(topLeftPos + Vector2.right * _targetSize.x * <span class="number">0.5f</span> + Vector2.up * _adaptionOffset.top);</span><br><span class="line">                    Vector2 topCheckLocalPoint = boundRectWorldToLocal.MultiplyPoint(checkWorldPoint);</span><br><span class="line">                    Vector2 topCheckBoundPoint = GetLocalRectPosition(outterBoundRectTransform, RectPositionType.Top);</span><br><span class="line">                    _previewTopOut = topCheckLocalPoint.y &gt; topCheckBoundPoint.y;</span><br><span class="line"></span><br><span class="line">                    checkWorldPoint = localToWorld.MultiplyPoint(topLeftPos + Vector2.down * _targetSize.y + Vector2.right * _targetSize.x * <span class="number">0.5f</span> + Vector2.down * _adaptionOffset.bottom);</span><br><span class="line">                    Vector2 bottomCheckLocalPoint = boundRectWorldToLocal.MultiplyPoint(checkWorldPoint);</span><br><span class="line">                    Vector2 bottomCheckBoundPoint = GetLocalRectPosition(outterBoundRectTransform, RectPositionType.Bottom);</span><br><span class="line">                    _previewBottomOut = bottomCheckLocalPoint.y &lt; bottomCheckBoundPoint.y;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (_adjustHorizontal)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (_previewLeftOut &amp;&amp; _previewRightOut)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// bound too small</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">if</span> (_previewLeftOut)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">float</span> xDelta = leftCheckLocalPoint.x - leftCheckBoundPoint.x;</span><br><span class="line">                                Vector3 tempPos = topLeftPos;</span><br><span class="line">                                tempPos.x -= xDelta;</span><br><span class="line">                                topLeftPos = tempPos;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span> (_previewRightOut)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">float</span> xDelta = rightCheckLocalPoint.x - rightCheckBoundPoint.x;</span><br><span class="line">                                Vector3 tempPos = topLeftPos;</span><br><span class="line">                                tempPos.x -= xDelta;</span><br><span class="line">                                topLeftPos = tempPos;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (_adjustVertical)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (_previewTopOut &amp;&amp; _previewBottomOut)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// bound too small</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">if</span> (_previewTopOut)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">float</span> yDelta = topCheckLocalPoint.y - topCheckBoundPoint.y;</span><br><span class="line">                                Vector3 tempPos = topLeftPos;</span><br><span class="line">                                tempPos.y -= yDelta;</span><br><span class="line">                                topLeftPos = tempPos;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span> (_previewBottomOut)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">float</span> yDelta = bottomCheckLocalPoint.y - bottomCheckBoundPoint.y;</span><br><span class="line">                                Vector3 tempPos = topLeftPos;</span><br><span class="line">                                tempPos.y -= yDelta;</span><br><span class="line">                                topLeftPos = tempPos;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _checkResult.previewLeftOut = _previewLeftOut;</span><br><span class="line">            _checkResult.previewRightOut = _previewRightOut;</span><br><span class="line">            _checkResult.previewTopOut = _previewTopOut;</span><br><span class="line">            _checkResult.previewBottomOut = _previewBottomOut;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (_doDrawAdaptionOffsetRect &amp;&amp; _defaultBoundsCanvasTransform != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Vector2 innerBoundLeftPos = GetLocalRectPosition(_defaultBoundsCanvasTransform, RectPositionType.TopLeft, <span class="keyword">new</span> Vector2(_adaptionOffset.left, -_adaptionOffset.top));</span><br><span class="line">                Vector2 size = _defaultBoundsCanvasTransform.rect.size;</span><br><span class="line">                size.x -= _adaptionOffset.horizontal;</span><br><span class="line">                size.y -= _adaptionOffset.vertical;</span><br><span class="line">                DrawBox(_defaultBoundsCanvasTransform, innerBoundLeftPos, size, Color.blue);</span><br><span class="line">            &#125;</span><br><span class="line">            DrawBox(self, topLeftPos, _targetSize, _previewColor);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawBox</span>(<span class="params">RectTransform reference, Vector2 topLeftPos, Vector2 size, Color color</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Color cachedColor = Gizmos.color;</span><br><span class="line">            Gizmos.color = color;</span><br><span class="line">            Gizmos.DrawLine(reference.TransformPoint(topLeftPos), reference.TransformPoint(topLeftPos + Vector2.right * size.x));</span><br><span class="line">            Gizmos.DrawLine(reference.TransformPoint(topLeftPos), reference.TransformPoint(topLeftPos + Vector2.down * size.y));</span><br><span class="line">            Gizmos.DrawLine(reference.TransformPoint(topLeftPos + Vector2.right * size.x), reference.TransformPoint(topLeftPos + Vector2.right * size.x + Vector2.down * size.y));</span><br><span class="line">            Gizmos.DrawLine(reference.TransformPoint(topLeftPos + Vector2.down * size.y), reference.TransformPoint(topLeftPos + Vector2.right * size.x + Vector2.down * size.y));</span><br><span class="line">            Gizmos.color = cachedColor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2023/03/26/20230326-ui-element-positioning/20230326-pic002.gif" class="" title="split">
<p>è¿˜æ˜¯åƒä»¥å‰ä¸€æ ·ï¼Œå…ˆåœ¨debug drawé‡ŒæŠŠåŠŸèƒ½å®Œæˆå†ç»™ç§»åˆ°å®é™…çš„ç‰©ä½“ä¸Šã€‚<br>ä½†è¿™æ¬¡è¿˜æ˜¯å¾ˆå¯æƒœæ²¡æœ‰æŠŠåŠŸèƒ½å¾ˆå¥½æŠ½å‡ºæˆæ¯”è¾ƒå•ç‹¬çš„æ•°å­¦è¿ç®—ï¼Œè€Œä¸”æ„Ÿè§‰è¦ç”¨åˆ°çš„å‚æ•°å¥½å¤šä¹Ÿæ²¡æ³•æ‹†åˆ†ï¼Œæœ€åç•™äº†ä¸€ä¸ªå¤šå‚çš„å…¥å£ã€‚</p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Unityç¼–è¾‘å™¨å†…é™éŸ³Wwise</title>
    <url>/2023/06/17/20230617-editor-wwise-mute/</url>
    <content><![CDATA[<p>é¡¹ç›®å¼•å…¥Wwiseä»¥åï¼Œç›¸ä¿¡è›®å¤šäººéƒ½å’Œæˆ‘ä¸€æ ·ï¼Œå¹³æ—¶ä¸æƒ³å¬æ¸¸æˆå£°éŸ³å°±æƒ³å¬æ­Œæ¶ç ä¿®BUGçš„ã€‚ä½†æ˜¯UnityåŸæœ¬çš„muteæŒ‰é’®æ²¡æ³•ç›´æ¥ç›´æ¥å¯¹Wwiseé‚£è¾¹åšæ“ä½œã€‚<br>ä¸€å¼€å§‹ä¸çŸ¥é“æ˜¯æœç´¢å¼•æ“çš„ä½¿ç”¨å§¿åŠ¿ä¸å¯¹è¿˜æ˜¯å’‹çš„ï¼ŒæŸ¥äº†å¥½ä¹…éƒ½æ²¡æŸ¥å‡ºæ¥ã€‚å¯¼å¸ˆç ”ç©¶äº†ä¸€ä¸‹å¼„äº†ä¸€ä¸ªç‰ˆï¼Œå¤§å®¶ç”¨äº†æ„Ÿè§‰éƒ½å¾ˆä¸é”™ï¼Œå†³å®šåˆ†äº«å‡ºæ¥ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">EditorWwiseManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">bool</span> m_isPaused = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">EditorWwiseManager</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        EditorApplication.update += OnUpdate;</span><br><span class="line">        EditorApplication.pauseStateChanged += OnPauseStateChanged;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OnPauseStateChanged</span>(<span class="params">PauseState state</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">switch</span> (state)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> PauseState.Paused:</span><br><span class="line">                m_isPaused = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PauseState.Unpaused:</span><br><span class="line">                m_isPaused = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OnUpdate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (EditorUtility.audioMasterMute &amp;&amp; !m_isPaused)</span><br><span class="line">        &#123;</span><br><span class="line">            AkSoundEngine.Suspend(<span class="literal">true</span>);</span><br><span class="line">            m_isPaused = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!EditorUtility.audioMasterMute &amp;&amp; m_isPaused)</span><br><span class="line">        &#123;</span><br><span class="line">            AkSoundEngine.WakeupFromSuspend();</span><br><span class="line">            m_isPaused = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥é€šè¿‡Editor SceneViewä¸Šçš„muteæŒ‰é’®æŠŠWwiseé™éŸ³ï¼Œè¶…çº§æ–¹ä¾¿å‡¹ã€‚</p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>Rapid UI Creation Note</title>
    <url>/2022/10/05/20221005-rapid-UGUI-creation-note/</url>
    <content><![CDATA[<p>When I searching some articles about MVC and MVVM, I see this talk.<br>Basiclly they does same stuff as my current project, but we still have some differences on our implementation.<br>Iâ€™d like to share it and take some notes :D</p>
<p>Here is the talk abour UGUI implementation.<br><a href="https://www.youtube.com/watch?v=uDQU_dlO-ZM" target="_blank" rel="noopener">video</a>.<br><a href="https://www.gdcvault.com/play/1024453/Data-Binding-Architectures-for-Rapid" target="_blank" rel="noopener">ppt</a>.<br><a href="https://stackoverflow.com/questions/667781/what-is-the-difference-between-mvc-and-mvvm" target="_blank" rel="noopener">temp</a>.</p>
<h1 id="Main-note"><a href="#Main-note" class="headerlink" title="Main note"></a>Main note</h1><h2 id="Architecture-in-lt-Lost-Survivor-gt"><a href="#Architecture-in-lt-Lost-Survivor-gt" class="headerlink" title="Architecture in &lt; Lost Survivor &gt;"></a>Architecture in &lt; Lost Survivor &gt;</h2><ul>
<li>Artist works directly in Unity (Creating prefabs, setup aniamtions; well thatâ€™s what I my current project does, so I guess they did the same)</li>
<li>Dev works on GameLogic and UILogic</li>
<li>Dev/Art work decoupled</li>
<li>Dev/Art work parallel (This happens a lot in iteration)</li>
</ul>
<h2 id="The-Pattern-used-in-lt-Lost-Survivor-gt"><a href="#The-Pattern-used-in-lt-Lost-Survivor-gt" class="headerlink" title="The Pattern used in &lt; Lost Survivor &gt;"></a>The Pattern used in &lt; Lost Survivor &gt;</h2><h3 id="MVCVM-they-choose-this"><a href="#MVCVM-they-choose-this" class="headerlink" title="MVCVM (they choose this)"></a>MVCVM (they choose this)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                                                                                                                               </span><br><span class="line">                                                        +---------------------------------------+                              </span><br><span class="line">                                                        |                data binding           |                              </span><br><span class="line">                                                        |                    &lt;-&gt;                |                              </span><br><span class="line">                                                        |                                       |                              </span><br><span class="line">                                                        |                                       |                              </span><br><span class="line">+------------------------------+                        |                                       |                              </span><br><span class="line">|                              | +----------------------|-------+    +------------------------------+ +-----------------------+</span><br><span class="line">----------Controller------------ |         Model                |    |        View Model            | |    View (UGUI View)   |</span><br><span class="line">|                              | --------------------------------    -------------------------------- -------------------------</span><br><span class="line">| void GainXP();               | |      int XP;                 |    |                              | | Text XP;              |</span><br><span class="line">| void LevelUp();              | |      int Level;              |    |                              | | Text Attribute;       |</span><br><span class="line">|                              | |                              |    |                              | | Button ReAllocate;    |</span><br><span class="line">|                              | +--------------&#x2F;---------------+    +---------------\--------------+ | int WeaponATK;        |</span><br><span class="line">+---------------\--------------+              &#x2F;-                                      -\              |                       |</span><br><span class="line">                 \                          &#x2F;-                                          -\            +-----------&#x2F;-----------+</span><br><span class="line">                  -\                      &#x2F;-                                              \                      |             </span><br><span class="line">                    \                   &#x2F;-                                                 -\                    &#x2F;             </span><br><span class="line">            +---------------------------------------------------------------------------------------------------|-------+      </span><br><span class="line">            |                                                                                                           |      </span><br><span class="line">            |                                               Message Bus                                                 |      </span><br><span class="line">            +-----------------------------------------------------|-----------------------------------------------------+      </span><br><span class="line">                                                                  |                                                            </span><br><span class="line">                                                                  |                                                            </span><br><span class="line">                                                                  |                                                            </span><br><span class="line">                                                    +-------------|------------+                                               </span><br><span class="line">                                                    |                          |                                               </span><br><span class="line">                                                    |      server backend      |                                               </span><br><span class="line">                                                    |                          |                                               </span><br><span class="line">                                                    +--------------------------+</span><br></pre></td></tr></table></figure>
<p>This is the pattern they use for their project.<br>The one thing that I cant understand is that the View will receive events from MessageBus. IDK why they did like this. For me, I prefer to let view only receive direct events from VM, bind to many stuff to MessageBus will make it slow.</p>
<h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                                                                                                                                                                                                   </span><br><span class="line">                                   +------------------------------+                                    </span><br><span class="line">                                   |          Controller          |                                    </span><br><span class="line">+---------------------------------------------------------------------------------------------+        </span><br><span class="line">|         user action -&gt;           |  void GainXp();              |       update -&gt;           |        </span><br><span class="line">|                                  |  Void LevelUp();             |                           |        </span><br><span class="line">|                                  |  int GetAttribute(type);     |                           |        </span><br><span class="line">|                                  |                              |                           |        </span><br><span class="line">|                                  |                              |                           |        </span><br><span class="line">|                                  +-------|--------------|-------+                           |        </span><br><span class="line">|                                          |              |                                   |        </span><br><span class="line">|------------------------------+           |              |            +----------------------|-------+</span><br><span class="line">|    Character View            |           |              |            |         Model                |</span><br><span class="line">--------------------------------           |              |            --------------------------------</span><br><span class="line">| Text XP;                     |           |              |            | int AmountXp;                |</span><br><span class="line">| Text Attribute;              ------------+              |            | int AttributeTypeA;          |</span><br><span class="line">| Button ReAllocate;           | &lt;- update                |            | int AttributeTypeB;          |</span><br><span class="line">|                              |                          +-------------                              |</span><br><span class="line">|                              |                     &lt;- notify change? |                              |</span><br><span class="line">+------------------------------+                                       +------------------------------+</span><br></pre></td></tr></table></figure>
<p>Iâ€™m sure this pattern is kind of useful. I use this a lot when I did the first version of some UI pages. But later the Controller become a giant class.<br>And also I think the View and Controller in this pattern is not very reusable.</p>
<h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                                                                                                                            </span><br><span class="line">                                                                                            +------------------------------+</span><br><span class="line">                                                                                            |         Model Character      |</span><br><span class="line">                                                                            +-----------------------------------------------</span><br><span class="line">                                                                            |               | int AmountXp;                |</span><br><span class="line">                                                                            |               | int AttributeTypeA;          |</span><br><span class="line">                                                                            |               | int AttributeTypeB;          |</span><br><span class="line">                                                                            |               |                              |</span><br><span class="line">                                                                            |               |                              |</span><br><span class="line">                                                                            |               +------------------------------+</span><br><span class="line">+------------------------------+                     +----------------------|-------+                                       </span><br><span class="line">|      Character View          |   data binding &lt;-&gt;  |        View Model            |                                       </span><br><span class="line">--------------------------------   notifications &lt;-  --------------------------------                                       </span><br><span class="line">| Text XP;                     |   command -&gt;        |int AmountXP;                 |                                       </span><br><span class="line">| Text Attribute;              ----------------------+int WeaponATK;                |                                       </span><br><span class="line">| Button ReAllocate;           |                     |int WeaponLevel;              |       +------------------------------+</span><br><span class="line">| int WeaponATK;               |                     |                              |       |         Model Weapon         |</span><br><span class="line">|                              |                     |                              |       --------------------------------</span><br><span class="line">+------------------------------+                     +----------------------|-------+       | int ATK;                     |</span><br><span class="line">                                                                            |               | int Level;                   |</span><br><span class="line">                                                                            +----------------                              |</span><br><span class="line">                                                                                            +------------------------------+</span><br></pre></td></tr></table></figure>
<ul>
<li>ViewModel serves the View</li>
<li>One ViewModel per View</li>
<li>Based on Data Binding</li>
</ul>
<p>After a few iterations, I find this pattern is also a good solutions. And I feel that we can even use CompositePattern in ViewModel to create big ViewModel for some big views(resuable).</p>
<p>In my current project, for the UI-View, we create some basic view that can receive similar types of data. And the good thing from this pattern is that the VM can send notificaiton to View to update, then I dun need to have lots of update method from Controller to update different data (cuz some data update need aniamtion, I cant just update all).</p>
<h2 id="Problems"><a href="#Problems" class="headerlink" title="Problems"></a>Problems</h2><p>Previously it says that separating UIPrefabs creation and UILogic code may solve â€œNot my problem attitudeâ€. But actually not.<br>In production state, everyone is busy, and we are iterating View-Scripts and VM-Scripts together. Sometimes it is diffcult to tell that is code issues or setup issues. Unless we have solid View-Scripts.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>This talk has lots of similiar content as the DivisionUI talk. And I also realise that the game development has lots of unknow shit. Itâ€™s very difficult to have some resuable components that always works. Even the thougts are similar, the implementation can be different. A solution can be that having some solid, simple, basic and resuable compoents.</p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity Video Url source èµ‹å€¼å°å‘</title>
    <url>/2022/08/10/20220810-unity-video-url-delay/</url>
    <content><![CDATA[<p>è¿™å‘¨èµ¶ç‰ˆæœ¬ï¼Œæ¥åˆ°äº†ä¸€ä¸ªå‰åŒäº‹ç•™ä¸‹æ¥çš„bugã€‚æ˜¯è¯´UIä¸Šçš„æ•™ç¨‹è§†é¢‘ä¸€ç›´ä¸æ’­æ”¾ã€‚<br>æˆ‘ä»¬çš„è§†é¢‘èµ„æºæ˜¯åœ¨ StreamingAssets ä¸‹çš„ï¼Œç”¨pathè¿›è¡ŒåŠ è½½ã€‚<br>æ’­æ”¾ç›¸å…³çš„ä»£ç å¦‚ä¸‹ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_player.prepareCompleted += OnPrepareCompleted;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnPrepareCompleted</span>(<span class="params">VideoPlayer source</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Debug.Log(<span class="string">"OnPrepareCompleted"</span>);</span><br><span class="line">    m_player.Play();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetVideo</span>(<span class="params"><span class="keyword">string</span> path</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_player.source = VideoSource.Url;</span><br><span class="line">    <span class="comment">// I guess this process may not be finished now.</span></span><br><span class="line">    m_player.url = path;</span><br><span class="line">    m_player.Prepare();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥äº†ä¸€ä¸‹ï¼Œå‘ç°åœ¨è°ƒç”¨äº† SetVideo ä¹‹åï¼ŒOnPrepareCompletedæ²¡æœ‰è¢«è°ƒç”¨ï¼Œæ„æ€æ˜¯ VideoPlayerçš„prepareCompletedäº‹ä»¶æ²¡æœ‰è§¦å‘ã€‚<br>æˆ‘çŒœå‘ç”Ÿè¿™ä¸ªæƒ…å†µçš„åŸå› æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨urlæ¥è®¾ç½®è§†é¢‘èµ„æºçš„é‚£ä¸€å¸§ï¼ŒVideoPlayerè¿˜æ²¡èƒ½è·å–åˆ°è§†é¢‘èµ„æºçš„ä¸€äº›å±æ€§ï¼Œæˆ–æ˜¯ä¸Šä¸€ä¸ªè§†é¢‘èµ„æºè¿˜åœ¨å ç”¨ç€å½“å‰çš„æ’­æ”¾å™¨ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å¦‚æœè°ƒç”¨PrePareï¼Œå…¶å®æ˜¯æ²¡æœ‰ç”¨çš„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä½¿ç”¨çš„Hacky Fixæ˜¯åœ¨è®¾ç½®å®Œèµ„æºçš„URLä¹‹åï¼Œç­‰ä¸€å¸§å†è°ƒç”¨Prepareï¼Œç„¶åç­‰å¾… prepareCompleted äº‹ä»¶ã€‚</p>
<p>é¡ºä¾¿åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹ï¼Œä¹Ÿæœ‰äº›äººé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œè¯´æ˜¯èµ‹å€¼URLä¹‹åä¸çŸ¥é“è§†é¢‘èµ„æºä»€ä¹ˆæ—¶å€™æ‰èƒ½æ­£ç¡®æ’­æ”¾ã€‚<br>è®ºå›é‡Œæœ‰ä¸ªäººç»™å‡ºçš„è§£å†³æ–¹æ³•æ˜¯å»æ£€æŸ¥ VideoPlayer.isPrepared çš„è¿™ä¸ªå±æ€§ã€‚ä½†èµ‹å€¼URLä¹‹åè¿™ä¸ªå€¼å¹¶ä¸ä¼šåœ¨æŸä¸€æ—¶åˆ»å˜æˆtrueã€‚</p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
      </tags>
  </entry>
  <entry>
    <title>notes dat I took from the Divsion UI talk</title>
    <url>/2022/08/06/20220806-division-UI-talk-note/</url>
    <content><![CDATA[<p>Well just ignore dat weird tag. :D</p>
<p>Here is muy notes dat I learn from the Divsion UI talk.</p>
<p>The key is iteration, threading and data.</p>
<p>Iterate your stuff to make it better.</p>
<p>Threading and data driven make the work efficient.</p>
<p><a href="https://www.youtube.com/watch?v=H1MLtML0np0" target="_blank" rel="noopener">video</a>.</p>
<h1 id="Snow-drop-UI"><a href="#Snow-drop-UI" class="headerlink" title="Snow drop UI"></a>Snow drop UI</h1><ul>
<li>No canvas</li>
<li>Immediate Mode<ul>
<li>Constant cost (maybe itâ€™s more statble?).</li>
</ul>
</li>
<li>Vector Graphics<ul>
<li>Shapes(scaling friendly, dun rely on resolution) over textures masks.</li>
<li>Save GPU load by only rendering the pixels gonna be used.</li>
<li>Artist can play with it.</li>
</ul>
</li>
</ul>
<h1 id="Game-Data-amp-Node-graph"><a href="#Game-Data-amp-Node-graph" class="headerlink" title="Game Data &amp; Node graph"></a>Game Data &amp; Node graph</h1><ul>
<li><p>Lots of data getter (get pure data?) (in graph node), used in UI and also game play.</p>
</li>
<li><p>Auto conversion to save some performance.</p>
</li>
<li><p>custom UI logic components.</p>
</li>
<li><p>custom reusable compounds.</p>
</li>
</ul>
<h1 id="Iteration"><a href="#Iteration" class="headerlink" title="Iteration"></a>Iteration</h1><h2 id="For-coder"><a href="#For-coder" class="headerlink" title="For coder"></a>For coder</h2><h3 id="Reduce-complie-time"><a href="#Reduce-complie-time" class="headerlink" title="Reduce complie time"></a>Reduce complie time</h3><ul>
<li>Blob builds(idk what is this).</li>
<li>Header file reduction.</li>
<li>Keep refactoring code to make it efficient.</li>
<li>Remove nolonger used code.</li>
</ul>
<h3 id="Reduce-startup-time-and-Load-time"><a href="#Reduce-startup-time-and-Load-time" class="headerlink" title="Reduce startup time and Load time"></a>Reduce startup time and Load time</h3><ul>
<li>Only load needed stuff.</li>
<li>UI preview with live data for easy iteration.</li>
<li>Well some debug UI will also help :).</li>
</ul>
<p>(for my unity project)</p>
<ul>
<li>Have a UI preview scene (UI only, we can preview states and transitions).</li>
<li>Have simple a gym dat provide gameplay with enough content.</li>
</ul>
<h3 id="Coder-to-Artist"><a href="#Coder-to-Artist" class="headerlink" title="Coder to Artist"></a>Coder to Artist</h3><ul>
<li><p>Coder work with artist (react fast to feedbacks).</p>
</li>
<li><p>Resable compounds, arist can directly use.</p>
</li>
</ul>
<h2 id="Drawback-of-iteration"><a href="#Drawback-of-iteration" class="headerlink" title="Drawback of iteration"></a>Drawback of iteration</h2><ul>
<li>Hard to stop.</li>
<li>Set clear goals and deadlines. (do not waste time)</li>
<li>Greate for prototyping, risk for delivering. (need a lead to shut down iteration, make the decision)</li>
</ul>
<h1 id="Building-blocks-of-UI"><a href="#Building-blocks-of-UI" class="headerlink" title="Building blocks of UI"></a>Building blocks of UI</h1><p>To let arist and designers to have full(or more) control?</p>
<h2 id="Widget-and-Graphics"><a href="#Widget-and-Graphics" class="headerlink" title="Widget and Graphics"></a>Widget and Graphics</h2><p>Widget define space, accept input. Graphic improve widget, relative size, also accept input?</p>
<h2 id="5-Basic-widgets-with-a-few-variations"><a href="#5-Basic-widgets-with-a-few-variations" class="headerlink" title="5 Basic widgets with a few variations."></a>5 Basic widgets with a few variations.</h2><p>Use basic widgets, and use them to build functionalities.</p>
<ul>
<li><p>Window</p>
<ul>
<li>2D and 3D (anchoring functionalities, pixels or percentage; prepare some options for different auto scaling and apply to different UI widgets/graphic and situations).</li>
<li>Vertical Stack (stack the (children)widgets)</li>
<li>Layering</li>
</ul>
</li>
<li><p>Text</p>
<ul>
<li>JIT font generaion (wtf, keep memory down)</li>
<li>Fich text formatting lib to build customize text(icon, color â€¦).</li>
<li>Auto clip (no idea how to do it)</li>
</ul>
</li>
<li><p>Image</p>
<ul>
<li>Use color/gradient more. (looks good with vector graphic)</li>
<li>Texture and loose image(ikd this, no border image?) into sprite sheet.</li>
</ul>
</li>
<li><p>Stack container</p>
<ul>
<li>For sorting elements.</li>
<li>Spacing and padding (how to do it with stack)</li>
<li>Invert for quick right to left language fixes (wtf)</li>
</ul>
</li>
<li><p>Scroll Box</p>
<ul>
<li>Fixed size(viewport size) with a virtual inner space(content).</li>
</ul>
</li>
</ul>
<h2 id="7-Graphics-nodes"><a href="#7-Graphics-nodes" class="headerlink" title="7 Graphics (nodes)"></a>7 Graphics (nodes)</h2><ul>
<li>Text with effects.</li>
<li>Images(basic) with more shapes, flat or curved.</li>
<li>Lines(strait, curved list?, 3d)</li>
<li>Points, single point or large squares(for effects?)</li>
<li>Shapes </li>
<li>Sector (why? for their art style?)</li>
<li>Custom graphics</li>
</ul>
<h1 id="Simply-Ui-workflow"><a href="#Simply-Ui-workflow" class="headerlink" title="Simply Ui workflow"></a>Simply Ui workflow</h1><ul>
<li>Complex and powerful (lots of resuable compounds, and threading stuff)</li>
<li>Documentation and examples(I guess examples are better and save time)</li>
</ul>
<h2 id="For-coder-1"><a href="#For-coder-1" class="headerlink" title="For coder"></a>For coder</h2><ul>
<li>Simple code; Less code, less bugs </li>
<li>Simple Tools; Do not overthink. Simple base, complex behaviour.</li>
</ul>
<h2 id="For-UI-artist-designer"><a href="#For-UI-artist-designer" class="headerlink" title="For UI artist/designer"></a>For UI artist/designer</h2><ul>
<li>Communicate to avoid merge conflicts, get ahead of it (cuz yaml merge wont help u all the time).</li>
</ul>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
      </tags>
  </entry>
  <entry>
    <title>UnityåŠ¨ç”»æ§åˆ¶Layoutå‚æ•°</title>
    <url>/2023/06/18/20230618-animating-layout-params/</url>
    <content><![CDATA[<p>åœ¨å®é™…åˆ¶ä½œUIçš„æ—¶å€™ï¼Œä¸ºäº†å®Œæˆä¸€äº›æ’ç‰ˆè®¾è®¡ï¼Œæˆ‘ä»¬ä¼šç»å¸¸ç”¨åˆ°Unityçš„å¸ƒå±€(Layout)ç»„ä»¶ã€‚ç”šè‡³æœ‰äº›å¤æ‚çš„æ’ç‰ˆï¼Œæˆ‘ä¼šç”¨åµŒå¥—å¸ƒå±€æ¥å®ç°ã€‚<br>UIç¾æœ¯äººç»å¸¸å¸Œæœ›åœ¨è¿™äº›å¸ƒå±€ä¸ŠåŠ ä¸Šä¸€äº›è¿›åœºå‡ºåœºåŠ¨ç”»(ç”šè‡³åŒ…æ‹¬spacingå˜åŠ¨)ï¼Œä½†å¸ƒå±€ç»„ä»¶ä¸Šçš„æ•°å€¼æ˜¯æ²¡æ³•åœ¨åŠ¨ç”»ä¸­ä¿®æ”¹çš„ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>åœ¨å¸ƒå±€ä¸­æ·»åŠ ä¸€äº›ç©ºç‰©ä½“æˆ–æ˜¯åœ¨å¸ƒå±€å¤–é¢å¥—ç©ºç‰©ä½“ã€‚ç„¶åå†ä½¿ç”¨TweenåŠ¨ç”»æ¥å®ŒæˆUIç¾æœ¯ä»¬æƒ³è¦çš„é‚£äº›è¿›å‡ºåœºåŠ¨ç”»ã€‚<br>ç¾æœ¯äººä¸å¤ªå–œæ¬¢çš„æ–¹æ³•ï¼Œå› ä¸ºæœ‰é‚£ä¹ˆä¸€ç‚¹ç‚¹ä¸å¤ªæ–¹ä¾¿å’ŒAnimationç›´æ¥ä¸€èµ·é¢„è§ˆï¼Œä½†å¦‚æœæ•´ä½“è¿›å‡ºåœºåŠ¨ç”»ä¸ä¾èµ–UnityAnimationä¸”ä¸æ˜¯å¾ˆå¤æ‚ï¼Œè¿™ç§æ–¹æ³•å®Œå…¨å¤Ÿç”¨ã€‚</p>
<h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>ç”¨é€šè¿‡åŠ¨ç”»æ§åˆ¶è„šæœ¬ä¸Šçš„å¯åºåˆ—åŒ–çš„æ•°å€¼ï¼Œå†ä¼ é€’åˆ°å¸ƒå±€ç»„ä»¶ä¸Šã€‚<br>ä¸ªäººæ„Ÿè§‰è¿™ä¸ªæ–¹æ³•ä¹Ÿè¿˜ä¸é”™ï¼Œè¿˜èƒ½æ”¯æŒé¢„è§ˆï¼ŒUIç¾æœ¯æ›´åå‘äºè¿™ä¸€ä¸ªè§£å†³æ–¹æ³•ã€‚</p>
<p>ä½†æ˜¯åœ¨åŠ¨ç”»çª—å£é‡Œé‡Œçœ‹åˆ°çš„curveæ˜¯é”¯é½¿çŠ¶çš„ï¼Œå¾ˆå¥‡æ€ªã€‚ä¹‹åè¿˜éœ€è¦çœ‹ä¸‹å¦‚ä½•æ‰èƒ½åƒå…¶ä»–å±æ€§ä¸€æ ·æ‹‰æ­£å¸¸çš„æ›²çº¿ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line">[<span class="meta">ExecuteAlways</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LayoutGroupTempAnimationParam</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> LayoutGroup _target;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _left;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _right;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _top;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _bottom;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Header(<span class="meta-string">"GridLayout must use GridSpacing"</span>)</span>]</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> _alsoControlSpacing;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _normalSpacing = <span class="number">0</span>;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Vector2 _gridSpacing = Vector2.zero;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RectOffset m_targetPadding;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDidApplyAnimationProperties</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_target == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ApplyPadding();</span><br><span class="line">        <span class="keyword">if</span> (_alsoControlSpacing)</span><br><span class="line">        &#123;</span><br><span class="line">            ApplySpacing();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// need to notify refresh</span></span><br><span class="line">        RectTransform rectTransform = <span class="keyword">this</span>.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">        LayoutRebuilder.MarkLayoutForRebuild(rectTransform);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ApplyPadding</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_targetPadding = _target.padding;</span><br><span class="line">        <span class="keyword">if</span> (m_targetPadding != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            m_targetPadding.left = _left;</span><br><span class="line">            m_targetPadding.right = _right;</span><br><span class="line">            m_targetPadding.top = _top;</span><br><span class="line">            m_targetPadding.bottom = _bottom;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ApplySpacing</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_target <span class="keyword">is</span> HorizontalOrVerticalLayoutGroup layoutGroup)</span><br><span class="line">        &#123;</span><br><span class="line">            layoutGroup.spacing = _normalSpacing;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (_target <span class="keyword">is</span> GridLayoutGroup gridLayoutGroup)</span><br><span class="line">        &#123;</span><br><span class="line">            gridLayoutGroup.spacing = _gridSpacing;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnValidate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        ApplyPadding();</span><br><span class="line">        <span class="keyword">if</span> (_alsoControlSpacing)</span><br><span class="line">        &#123;</span><br><span class="line">            ApplySpacing();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!Application.isPlaying)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// need to notify refresh</span></span><br><span class="line">            RectTransform rectTransform = <span class="keyword">this</span>.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">            LayoutRebuilder.MarkLayoutForRebuild(rectTransform);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        _target = <span class="keyword">this</span>.GetComponent&lt;LayoutGroup&gt;();</span><br><span class="line">        m_targetPadding = _target.padding;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2023/06/18/20230618-animating-layout-params/20230618-animating-layout-params-01.gif" class="" title="split">]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>CSharpå­—å…¸ä½¿ç”¨enumçš„è£…ç®±</title>
    <url>/2023/07/09/20230709-dictionary-enum-boxing/</url>
    <content><![CDATA[<p>ä»Šå¤©çœ‹äº†ä¸‹Unityå®˜æ–¹2016å¹´å‘çš„ä¸€ä¸ªå…³äºç§»åŠ¨ç«¯å°ä¼˜åŒ–çš„ä¸€äº›åˆ†äº«è§†é¢‘ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªå…³äºæŠŠenumä½œä¸ºDictionaryä¸­çš„keyæ¥ä½¿ç”¨æ—¶çš„boxingä¼˜åŒ–ã€‚</p>
<img src="/2023/07/09/20230709-dictionary-enum-boxing/20230709-dictionary-enum-boxing-01.png" class="" title="split">
<p>è¿™ä¸ªç”¨æ³•åœ¨æˆ‘ä¹‹å‰çš„é¡¹ç›®é‡Œç”¨å¾—è¿˜æŒºå¤šå§ã€‚ç›´æ¥ä¸Šå›¾çœ‹IL codeã€‚</p>
<img src="/2023/07/09/20230709-dictionary-enum-boxing/20230709-dictionary-enum-boxing-02.png" class="" title="split">
<p>Dictionaryçš„å¢åˆ æŸ¥æ“ä½œå…¶å®éƒ½ä¼šæœ‰ç”¨comparer.Equals()æ¥åˆ¤æ–­æ˜¯å¦ç›¸ç­‰çš„æƒ…å†µã€‚<br>æ„å»ºDictionaryæ—¶å¦‚æœä¸ä¼ å…¥æŒ‡å®šçš„comparerï¼Œä»–ä¼šè‡ªå·±èµ‹äºˆä¸€ä¸ªâ€™é»˜è®¤çš„â€™ã€‚è¿™ä¸ªé»˜è®¤çš„æ˜¾ç„¶ä¸é€‚é‚£ä¹ˆçš„å‹å¥½ã€‚</p>
<img src="/2023/07/09/20230709-dictionary-enum-boxing/20230709-dictionary-enum-boxing-05.png" class="" title="split">
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªcomparerï¼Œç„¶åç›´æ¥çœ‹ä½¿ç”¨comparerå’Œä¸ä½¿ç”¨çš„ä¸¤ç§ä¸åŒæƒ…å†µä¸‹çš„IL codeã€‚</p>
<img src="/2023/07/09/20230709-dictionary-enum-boxing/20230709-dictionary-enum-boxing-03.png" class="" title="split">
<img src="/2023/07/09/20230709-dictionary-enum-boxing/20230709-dictionary-enum-boxing-04.png" class="" title="split">
<p>å¾ˆæ˜æ˜¾ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„comparerå¯ä»¥å…å»è£…ç®±çš„æ¶ˆè€—ã€‚</p>
<p>åæ¥æˆ‘åˆæ‹¿åˆ°Unityé‡Œè·‘äº†ä¸€ä¸‹çœ‹profilerã€‚å°è¯•è·‘äº†æŸ¥è¯¢å’Œæ·»åŠ ï¼Œå·®è·ç¡®å®æœ‰ï¼Œä½†æ˜¯ä»Profilerä¸­çœ‹ç»“æœï¼Œ200ä¸‡æ¬¡çš„æ“ä½œä¸‹ï¼ŒGCæ˜¯å·®ä¸å¤šçš„ï¼Œæ—¶é—´ä¸Šä½¿ç”¨comparerå¿«äº†1300å¤šmsã€‚<br>è¯´å®åœ¨çš„è§‰å¾—æ˜¯æˆ‘çš„æµ‹è¯•æ–¹æ³•æœ‰é—®é¢˜ã€‚è€Œä¸”æˆ‘è·‘åœ¨æ¡Œé¢ç«¯ï¼Œè¿™æ ·æµ‹è¯•ä¹Ÿä¸ä¸¥è°¨ã€‚</p>
]]></content>
      <categories>
        <category>CSharp</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>CSharp</tag>
      </tags>
  </entry>
  <entry>
    <title>UGUI PSDæ™ºèƒ½å¯¹è±¡å¯¼å›¾å°è®°</title>
    <url>/2023/10/15/20231015-psd-complexlayer-export/</url>
    <content><![CDATA[<p>å½“å‰çš„é¡¹ç›®é‡Œå› ä¸ºUIç¼ºä¹UIç¾æœ¯äººï¼Œæ²¡æœ‰äººåŠ›å¯¼å›¾æ‹¼å›¾ï¼Œæ‰€ä»¥ä½¿ç”¨äº†<a href="https://github.com/zouhunter/unity-psd-ugui" target="_blank" rel="noopener">PSD2UGUI</a>æ’ä»¶ã€‚è¿™ä¸ªæ’ä»¶åˆä¾èµ–ä¸€ä¸ªåˆ†æPSDçš„è§£æåº“<a href="https://github.com/NtreevSoft/psd-parser/tree/master" target="_blank" rel="noopener">psd-parser</a>ã€‚<br>è¿™ä¿©ä¸œè¥¿éƒ½å·²ç»æœ‰ç‚¹è€æ—§äº†ï¼Œç¾æœ¯é‚£è¾¹é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä»–ä»¬åšçš„æ™ºèƒ½å¯¹è±¡å›¾å±‚ä¸èƒ½æ­£ç¡®å¯¼å‡ºã€‚</p>
<img src="/2023/10/15/20231015-psd-complexlayer-export/20231015-psd-complexlayer-export-pic001.png" class="" title="split">
<p>ç›´æ¥ç”¨æ–‡å­—æœ‰ç‚¹éš¾æè¿°ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ã€‚ä»–ä»¬åšçš„æ™ºèƒ½å¯¹è±¡å¤§å°å°±å’Œå›¾é‡Œè¿™ä¸ªé»‘åº•ä¸€æ ·å¤§ï¼Œä½†å®é™…æœ‰å›¾æ¡ˆéƒ¨åˆ†å°±åƒçº¢æ¡†é‡Œçš„é‚£æ ·ï¼Œä¸ä¼šå æ»¡æ•´ä¸ªæ™ºèƒ½å¯¹è±¡çš„åŒºåŸŸã€‚<br>ç”¨å·¥å…·å¯¼å‡ºSpriteçš„æ—¶å€™ï¼Œåªä¼šå¯¼å‡ºçº¢æ¡†çš„å¤§å°ã€‚</p>
<hr>
<p>è§£å†³æ–¹æ³•æ¯”è¾ƒç®€å•ç²—æš´äº†ï¼Œå› ä¸º<a href="https://github.com/NtreevSoft/psd-parser/tree/master" target="_blank" rel="noopener">psd-parser</a>ä¼¼ä¹ä¸èƒ½å¾ˆæ–¹ä¾¿æ‹¿åˆ°æ™ºèƒ½å¯¹è±¡çš„å®é™…çš„åŒºåŸŸå°ºå¯¸ï¼Œæˆ‘åªèƒ½è®©ç¾æœ¯å¤šåšä¸€ä¸ªå’Œéœ€è¦å¯¼å‡ºçš„åªèƒ½å¯¹è±¡å°ºå¯¸å¤§å°ä¸€æ ·çš„çº¯è‰²ç©ºå›¾å±‚ã€‚<br>åŒæ—¶æ–°å¢ä¸¤ä¸ªåç¼€è§„åˆ™ï¼Œè®©è¿™ä¸ªçº¯è‰²ç©ºå›¾å±‚å’Œéœ€è¦ä¾ç…§æ™ºèƒ½å¯¹è±¡å°ºå¯¸å¯¼å‡ºçš„å›¾å±‚åˆ†åˆ«ä½¿ç”¨ã€‚</p>
<p>åœ¨<a href="https://github.com/zouhunter/unity-psd-ugui" target="_blank" rel="noopener">PSD2UGUI</a>ä¸­æ ¹æ®å›¾å±‚ç”ŸæˆTextureçš„ä»£ç ä¸­æ·»åŠ åç¼€æ£€æŸ¥,æ£€æµ‹åˆ°ç‰¹æ®Šè§„åˆ™çš„æ—¶å€™å»å»æ ¹æ®ç‰¹æ®Šçš„çº¯è‰²å›¾å±‚çš„å°ºå¯¸å†å»é‡æ–°ç»˜åˆ¶Textureã€‚åŒæ—¶åœ¨<a href="https://github.com/zouhunter/unity-psd-ugui" target="_blank" rel="noopener">PSD2UGUI</a>ä¸­æ ¹æ®å›¾å±‚åˆ›å»ºä»–çš„ImageNodeçš„æ—¶å€™æœ‰ä¸ªRectéœ€è¦è®¡ç®—ï¼Œè¿™ä¸ªRectè®¡ç®—ä¹Ÿè¦ä¿®æ”¹ã€‚</p>
]]></content>
      <categories>
        <category>UGUI</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼ å…¥Predicateçš„å°äº‹</title>
    <url>/2023/05/01/20230501-list-pass-predicate/</url>
    <content><![CDATA[<p>ç°åœ¨ä¾æ—§æ˜¯åœ¨é¡¹ç›®é‡Œè´Ÿè´£ä¸€äº›UIä¸šåŠ¡çš„ç¼–å†™ã€‚å‰æ®µæ—¶é—´éœ€è¦éœ€è¦ç»™æ¸¸æˆä¸­çš„ popupæç¤º åšä¸€äº›ç®€å•çš„é‡æ„ï¼Œæ­£å¥½å‘ç°äº†æˆ‘ä¸€ç›´ä»¥æ¥éƒ½è¯¯è§£çš„ä¸€ä¸ªå°ç‚¹ï¼Œå†³å®šè®°ä¸‹æ¥ã€‚</p>
<p>ä¸šåŠ¡çš„è¦æ±‚å°±æ˜¯åšé‚£ç§ä¼šå¼¹å‡ºæ¥ä¸€ä¼šå„¿å†æ¶ˆå¤±çš„æç¤ºï¼Œæ¯”å¦‚é“å…·è·å–ä¹‹ç±»çš„UIã€‚</p>
<p>æˆ‘çš„åšæ³•å°±æ˜¯ç”¨ä¸€ä¸ªlistå»å­˜ç€å½“å‰çš„æç¤ºï¼Œå¹¶ tick æ£€æŸ¥å®ƒä»¬æ˜¯å¦ç»“æŸï¼Œç„¶åç§»é™¤å·²ç»ç»“æŸçš„ç›¸å…³æ•°æ®ã€‚<br>å¤§æ¦‚çš„ç”¨æ³•å¦‚ä¸‹ã€‚</p>
<img src="/2023/05/01/20230501-list-pass-predicate/20230501-pic001.png" class="" title="split">
<p>ä½†å…¶å®å•Šï¼Œè¿™ä¸ªåšæ³•åœ¨ tick æ˜¯éå¸¸ä¸å¥½çš„ã€‚åŒäº‹å¾ˆå¿«åœ°é€šè¿‡ JetBrainsRider æŸ¥çœ‹ IL Code ï¼Œå¹¶å‘Šè¯‰æˆ‘ï¼Œç›´æ¥è¿™æ ·ä¼ å…¥ä¼šæ¯æ¬¡éƒ½ new obj ã€‚æœ‰æ¯”è¾ƒå¤§çš„æ¶ˆè€—ã€‚<br>æ‰€ä»¥åœ¨è¿™ç§éœ€è¦<strong>ç»å¸¸</strong> tick å¹¶ä¸”æ¡ä»¶<strong>æ¯”è¾ƒå›ºå®š</strong>çš„æƒ…å†µä¸‹ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¥½ predicate ç„¶åç›´æ¥é‡å¤ä½¿ç”¨(å¯ä»¥å­˜åœ¨æˆå‘˜å˜é‡é‡Œï¼Œè¿™é‡Œæ¼”ç¤ºå°±ç›´æ¥å­˜åœ¨æœ¬åœ°å˜é‡é‡Œäº†)ã€‚</p>
<img src="/2023/05/01/20230501-list-pass-predicate/20230501-pic002.png" class="" title="split">
<p>æœ€åé™„ä¸Šæµ‹è¯•ä»£ç å’Œç»“æœ æµ‹è¯• count ä¸º 100000</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PredicateTempTest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> TempPack</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> tempValue;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Random s_random = <span class="keyword">new</span> Random(DateTime.Now.Millisecond);</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TempPack <span class="title">CreateTempPack</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            TempPack pack = <span class="keyword">default</span>;</span><br><span class="line">            <span class="keyword">if</span> (s_random == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                s_random = <span class="keyword">new</span> Random(DateTime.Now.Millisecond);</span><br><span class="line">            &#125;</span><br><span class="line">            pack.tempValue = s_random.Next(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">            <span class="keyword">return</span> pack;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;List&lt;TempPack&gt;&gt; s_tempListContainer = <span class="keyword">new</span> List&lt;List&lt;TempPack&gt;&gt;(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DoTest</span>(<span class="params"><span class="keyword">int</span> tempCount</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        FillTestData(tempCount);</span><br><span class="line">        DoTestLambda();</span><br><span class="line">        DoTestPassMethod();</span><br><span class="line">        DoTestPassExistPredicate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">FillTestData</span>(<span class="params"><span class="keyword">int</span> tempCount</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        s_tempListContainer.Clear();</span><br><span class="line">        s_tempListContainer.Capacity = tempCount;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tempCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;TempPack&gt; tempList = <span class="keyword">new</span> List&lt;TempPack&gt;(tempCount);</span><br><span class="line">            s_tempListContainer.Add(tempList);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; tempCount; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                tempList.Add(TempPack.CreateTempPack());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DoTestLambda</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">""</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">"TestLambda start"</span>);</span><br><span class="line">        Stopwatch stopWatch = <span class="keyword">new</span> Stopwatch();</span><br><span class="line">        stopWatch.Start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, containerSize = s_tempListContainer.Count; i &lt; containerSize; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;TempPack&gt; tempList = s_tempListContainer[i];</span><br><span class="line">            tempList.Find((existPack) =&gt; existPack.tempValue % <span class="number">5</span> == <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        stopWatch.Stop();</span><br><span class="line">        Console.WriteLine(<span class="string">$"TestLambda end, result_<span class="subst">&#123;stopWatch.ElapsedMilliseconds&#125;</span>ms"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DoTestPassMethod</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">""</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">"PassMethod start"</span>);</span><br><span class="line">        Stopwatch stopWatch = <span class="keyword">new</span> Stopwatch();</span><br><span class="line">        stopWatch.Start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, containerSize = s_tempListContainer.Count; i &lt; containerSize; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;TempPack&gt; tempList = s_tempListContainer[i];</span><br><span class="line">            tempList.Find(CheckPack);</span><br><span class="line">        &#125;</span><br><span class="line">        stopWatch.Stop();</span><br><span class="line">        Console.WriteLine(<span class="string">$"PassMethod end, result_<span class="subst">&#123;stopWatch.ElapsedMilliseconds&#125;</span>ms"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DoTestPassExistPredicate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">""</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">"PassExistPredicate start"</span>);</span><br><span class="line">        Stopwatch stopWatch = <span class="keyword">new</span> Stopwatch();</span><br><span class="line">        stopWatch.Start();</span><br><span class="line">        Predicate&lt;TempPack&gt; predicate = <span class="keyword">new</span> Predicate&lt;TempPack&gt;(CheckPack);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, containerSize = s_tempListContainer.Count; i &lt; containerSize; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;TempPack&gt; tempList = s_tempListContainer[i];</span><br><span class="line">            tempList.Find(predicate);</span><br><span class="line">        &#125;</span><br><span class="line">        stopWatch.Stop();</span><br><span class="line">        Console.WriteLine(<span class="string">$"PassExistPredicate end, result_<span class="subst">&#123;stopWatch.ElapsedMilliseconds&#125;</span>ms"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">CheckPack</span>(<span class="params">TempPack pack</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> pack.tempValue % <span class="number">5</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2023/05/01/20230501-list-pass-predicate/20230501-pic003.png" class="" title="split">]]></content>
      <categories>
        <category>CSharp</category>
      </categories>
      <tags>
        <tag>CSharp</tag>
      </tags>
  </entry>
  <entry>
    <title>Unityç¼–è¾‘å™¨ä¸­ä»¥enumçš„æ–¹å¼ç»˜åˆ¶int</title>
    <url>/2023/07/23/20230723-int-draw-as-enum/</url>
    <content><![CDATA[<p>é¡¹ç›®é‡Œçš„UIæ¡†æ¶æœ‰éå¸¸æ–¹ä¾¿å®ç”¨çš„æ•°æ®ç»‘å®šåŠŸèƒ½ã€‚å„ç§UIè¡¨ç°ä»¶ä¹Ÿå¯ä»¥æ ¹æ®æ•°æ®é›†é‡Œçš„æŸä¸ªintæ”¹å˜UIè¡¨ç°ã€‚ä½†æ˜¯æ¯”è¾ƒé€†å¤©çš„æ˜¯æˆ‘ä»¬ç»å¸¸æŠŠenumè½¬intç„¶åå†åˆ°è¡¨ç°ä»¶ä¸Šå»è°ƒå¯¹åº”çš„å„ç§çŠ¶æ€ã€‚<br>å¯¹ç€magic numberè°ƒé…ç½®ç¡®å®å¾ˆè®©äººè‹¦æ¼ã€‚</p>
<p>æ€è·¯å°±æ˜¯å†éœ€è¦æ ¹æ®intæ¥è°ƒå¶é…ç½®çš„componentä¸Šæ·»åŠ ä¸€ä¸ªç¼–è¾‘å™¨é‡Œä¸“ç”¨çš„Typeå¯¹è±¡ï¼Œç„¶åæ ¹æ®è¿™ä¸ªå¯¹è±¡ç±»å‹å»ç”»intã€‚åŸºäºOdinåšçš„ï¼Œä½†æˆ‘è§‰å¾—è¿™ä¸ªæ€è·¯åº”è¯¥è¿˜ä¸é”™ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="comment">// use a string to temply store the type</span></span><br><span class="line"></span><br><span class="line">    [<span class="meta">AttributeUsage(AttributeTargets.Field)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EnumTypeQualifiedName</span>: <span class="title">Attribute</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">DrawerPriority(DrawerPriorityLevel.WrapperPriority)</span>]</span><br><span class="line">    public class EnumTypeQualifiedNameAttributeDrawer : OdinAttributeDrawer&lt;EnumTypeQualifiedName, string&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title">EditingState</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">static</span> IEnumerable&lt;Type&gt; tempQuery;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">bool</span> wannaSet = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">public</span> Type selectedType = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">DrawPropertyLayout</span>(<span class="params">GUIContent label</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">string</span> currentName = <span class="keyword">this</span>.ValueEntry.SmartValue;</span><br><span class="line">            Type enumType = <span class="keyword">string</span>.IsNullOrEmpty(currentName) ? <span class="literal">null</span> : Type.GetType(currentName);</span><br><span class="line">            <span class="keyword">string</span> enumTypeNiceName = enumType == <span class="literal">null</span> ? <span class="string">"invalid!!!"</span> : enumType.GetNiceName();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> controlId = GUIUtility.GetControlID(FocusType.Passive);</span><br><span class="line">            EditingState state = GUIUtility.GetStateObject(<span class="keyword">typeof</span>(EditingState), controlId) <span class="keyword">as</span> EditingState;</span><br><span class="line">            <span class="keyword">if</span> (state.wannaSet)</span><br><span class="line">            &#123;</span><br><span class="line">                currentName = state.selectedType.AssemblyQualifiedName;</span><br><span class="line">                state.selectedType = <span class="literal">null</span>;</span><br><span class="line">                state.wannaSet = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">this</span>.ValueEntry.SmartValue = currentName;</span><br><span class="line">            &#125;</span><br><span class="line">            EditorGUILayout.BeginVertical();</span><br><span class="line">            GUIStyle guiStyle = <span class="keyword">new</span> GUIStyle(EditorStyles.label);</span><br><span class="line">            guiStyle.alignment = TextAnchor.MiddleLeft;</span><br><span class="line">            EditorGUILayout.LabelField(<span class="keyword">this</span>.Property.NiceName, guiStyle);</span><br><span class="line"></span><br><span class="line">            guiStyle = <span class="keyword">new</span> GUIStyle(EditorStyles.popup);</span><br><span class="line">            guiStyle.alignment = TextAnchor.MiddleLeft;</span><br><span class="line">            <span class="keyword">if</span> (EditorGUILayout.DropdownButton(<span class="keyword">new</span> GUIContent(<span class="string">$"Preview Enum Type (<span class="subst">&#123;enumTypeNiceName&#125;</span>)"</span>), FocusType.Keyboard, guiStyle))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (EditingState.tempQuery == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    EditingState.tempQuery = GetTargetEnumTypes();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                TypeSelector selector = <span class="keyword">new</span> TypeSelector(EditingState.tempQuery, <span class="literal">false</span>);</span><br><span class="line">                selector.EnableSingleClickToSelect();</span><br><span class="line">                selector.ShowInPopup();</span><br><span class="line">                selector.SelectionConfirmed += selection =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> resultTypeArray = selection.ToArray();</span><br><span class="line">                    <span class="keyword">if</span> (resultTypeArray.Length &gt; <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Type selectedType = resultTypeArray.GetValue(<span class="number">0</span>) <span class="keyword">as</span> Type;</span><br><span class="line">                        EditingState state = GUIUtility.GetStateObject(<span class="keyword">typeof</span>(EditingState), controlId) <span class="keyword">as</span> EditingState;</span><br><span class="line">                        state.selectedType = selectedType;</span><br><span class="line">                        state.wannaSet = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            EditorGUILayout.EndVertical();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> IEnumerable&lt;Type&gt; <span class="title">GetTargetEnumTypes</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// TODO @Hiko here to get actual enum types</span></span><br><span class="line">            TypeCache.TypeCollection cache = TypeCache.GetTypesDerivedFrom&lt;Enum&gt;();</span><br><span class="line">            <span class="keyword">var</span> query = cache.Where(t =&gt; t.IsEnum &amp;&amp; t.IsPublic);</span><br><span class="line">            <span class="keyword">return</span> query;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// put temply data into a sturct </span></span><br><span class="line"></span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> IntAsEnumEditorPack</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> showIntAsEnumForTaggedField;</span><br><span class="line">        [<span class="meta">EnumTypeQualifiedName</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> enumTypeQualifiedName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IIntAsEnumPackHolder</span></span><br><span class="line">    &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        IntAsEnumEditorPack holderData &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// draw enum popup for int</span></span><br><span class="line"></span><br><span class="line">    [<span class="meta">AttributeUsage(AttributeTargets.Field)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IntAsEnumAttribute</span> : <span class="title">Attribute</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">DrawerPriority(DrawerPriorityLevel.WrapperPriority)</span>]</span><br><span class="line">    public class IntAsEnumAttributeDrawer : OdinAttributeDrawer&lt;IntAsEnumAttribute, int&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">DrawPropertyLayout</span>(<span class="params">GUIContent label</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">int</span> nextValue, prevValue = <span class="keyword">this</span>.ValueEntry.SmartValue;</span><br><span class="line">            InspectorProperty containerProterty = <span class="keyword">this</span>.ValueEntry.Property;</span><br><span class="line">            Type holderType = <span class="keyword">typeof</span>(IIntAsEnumPackHolder);</span><br><span class="line">            Type containerType = containerProterty.ParentType;</span><br><span class="line">            <span class="keyword">bool</span> doContinue = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">while</span> (doContinue)</span><br><span class="line">            &#123;</span><br><span class="line">                Type parentType = containerProterty.ParentType;</span><br><span class="line">                <span class="keyword">if</span> (parentType == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                containerType = parentType;</span><br><span class="line">                containerProterty = containerProterty.Parent;</span><br><span class="line">                <span class="keyword">if</span> (holderType.IsAssignableFrom(containerType))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            GUIStyle guiStyle = <span class="keyword">new</span> GUIStyle(EditorStyles.label);</span><br><span class="line">            guiStyle.alignment = TextAnchor.MiddleLeft;</span><br><span class="line">            <span class="keyword">if</span> (containerType != <span class="literal">null</span> &amp;&amp; holderType.IsAssignableFrom(containerType))</span><br><span class="line">            &#123;</span><br><span class="line">                IIntAsEnumPackHolder holder = containerProterty.ValueEntry.WeakSmartValue <span class="keyword">as</span> IIntAsEnumPackHolder;</span><br><span class="line">                IntAsEnumEditorPack packData = holder.holderData;</span><br><span class="line">                <span class="keyword">if</span> (packData.showIntAsEnumForTaggedField)</span><br><span class="line">                &#123;</span><br><span class="line">                    EditorGUILayout.BeginVertical();</span><br><span class="line">                    EditorGUILayout.LabelField(<span class="keyword">this</span>.Property.NiceName, guiStyle);</span><br><span class="line">                    Type enumType = <span class="keyword">string</span>.IsNullOrEmpty(packData.enumTypeQualifiedName) ? <span class="literal">null</span> : Type.GetType(packData.enumTypeQualifiedName);</span><br><span class="line">                    <span class="keyword">if</span> (enumType != <span class="literal">null</span> &amp;&amp; enumType.IsEnum)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Enum prevEnumValue;</span><br><span class="line">                        <span class="keyword">if</span> (!enumType.IsEnumDefined(prevValue))</span><br><span class="line">                        &#123;</span><br><span class="line">                            prevEnumValue = Enum.GetValues(enumType).GetValue(<span class="number">0</span>) <span class="keyword">as</span> Enum;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            prevEnumValue = (Enum)Enum.ToObject(enumType, prevValue);</span><br><span class="line">                        &#125;</span><br><span class="line">                        guiStyle = <span class="keyword">new</span> GUIStyle(EditorStyles.popup);</span><br><span class="line">                        guiStyle.stretchWidth = <span class="literal">false</span>;</span><br><span class="line">                        guiStyle.alignment = TextAnchor.MiddleLeft;</span><br><span class="line">                        Enum nextEnumValue = EditorGUILayout.EnumPopup(prevEnumValue, guiStyle);</span><br><span class="line">                        nextValue = Convert.ToInt32(nextEnumValue);</span><br><span class="line">                        <span class="keyword">this</span>.ValueEntry.SmartValue = nextValue;</span><br><span class="line">                        guiStyle = <span class="keyword">new</span> GUIStyle(EditorStyles.label);</span><br><span class="line">                        guiStyle.alignment = TextAnchor.MiddleLeft;</span><br><span class="line">                        guiStyle.stretchWidth = <span class="literal">false</span>;</span><br><span class="line">                        EditorGUILayout.LabelField(<span class="string">$"int value: (<span class="subst">&#123;nextValue&#125;</span>)"</span>, guiStyle);</span><br><span class="line">                    &#125;</span><br><span class="line">                    EditorGUILayout.EndVertical();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// can not find the target preview enum type, draw normal int field</span></span><br><span class="line">            EditorGUILayout.BeginHorizontal();</span><br><span class="line">            EditorGUILayout.LabelField(<span class="keyword">this</span>.Property.NiceName);</span><br><span class="line">            nextValue = EditorGUILayout.IntField(prevValue);</span><br><span class="line">            <span class="keyword">this</span>.ValueEntry.SmartValue = nextValue;</span><br><span class="line">            EditorGUILayout.EndHorizontal();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// test case</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TesterA</span> : <span class="title">MonoBehaviour</span>, <span class="title">IIntAsEnumPackHolder</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> IntAsEnumEditorPack intAsEnumEditorPack;</span><br><span class="line">        <span class="keyword">public</span> IntAsEnumEditorPack holderData =&gt; intAsEnumEditorPack;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">Serializable</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">struct</span> TempStructA</span><br><span class="line">        &#123;</span><br><span class="line">            [<span class="meta">IntAsEnum</span>]</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">int</span> tempInt;</span><br><span class="line">            <span class="keyword">public</span> Color tempColor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> TempStructA[] tempArray;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">IntAsEnum</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> tempIntA;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹<br><img src="/2023/07/23/20230723-int-draw-as-enum/20230723-int-draw-as-enum-pic001.png" class="" title="split"></p>
<p>ç”¨èµ·æ¥æ˜¯æ–¹ä¾¿äº†ï¼Œä½†æ˜¯ä¹Ÿå¼•å…¥äº†ä¸€ä¸ªé—®é¢˜ã€‚è¿™ä¸ªåšæ³•ä¼šéœ€è¦åºåˆ—åŒ–ä¸€è¿™ä¸¤ä¸ªå°å°çš„å­—æ®µåˆ°ç‰©ä½“ä¸Šã€‚å¯¼è‡´Prefabå˜è‚¥äº†ï¼Œä½†æ„Ÿè§‰æ‰“åŒ…çš„æ—¶å€™æ‰“å‡ºæ¥çš„prefabé‡Œåº”è¯¥ä¸ä¼šåŒ…å«è¿™ä¿©å­—æ®µï¼Œåº”è¯¥è¿˜å‡‘åˆå•¦ã€‚</p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>UGUI ä¸€äº›è‡ªç”¨UIè¡¨ç°ä»¶åŸºç¡€</title>
    <url>/2024/02/16/20240216-primitivebehaviour/</url>
    <content><![CDATA[<h1 id="Temp"><a href="#Temp" class="headerlink" title="Temp"></a>Temp</h1><p>è‡ªä»å¼€å§‹åŠ ç­ä»¥åå°±æ²¡ä»€ä¹ˆå¹²åŠ²äº†ã€‚è¿™æ®µæ—¶é—´é‡å¤´å·¥ä½œå°±æ˜¯æ¥ç”¨æˆ·SDKç„¶åè¡¥ä»¥å‰è½ä¸‹çš„ä¸€äº›ç»†èŠ‚éœ€æ±‚ã€‚</p>
<p>æ¯”è¾ƒèšŒåŸ ä½çš„æ˜¯ï¼Œè¿™æ®µæ—¶é—´å‘ç°äº†è‡ªå·±å†™çš„å¾ˆå¤šé‡å¤çš„UIç»„ä»¶ä»£ç ã€‚è€Œä¸”åœ¨è¿™ä¸ªæ—¶å€™å·²ç»ä¸æ–¹ä¾¿å†æ•´åˆæ›¿æ¢äº†ï¼Œæ•´åˆæ›¿æ¢å¯èƒ½ä¼šå¯¼è‡´çˆ†ç‚¸ã€‚</p>
<p>ä¸ºäº†å°½å¯èƒ½æœç»æ­¤ç±»äº‹æƒ…å‘ç”Ÿï¼Œå†³å®šå…ˆæŠŠç”¨åˆ°çš„ä¸€äº›åŸºç¡€ä»£ç æ€»ç»“ä¸€ä¸‹å†™åœ¨è¿™é‡Œï¼Œæ–¹ä¾¿ä¸‹æ¬¡ç›´æ¥è¿‡æ¥æŠ„è€Œä¸æ˜¯å†æ‰‹æ“äº†ã€‚</p>
<h1 id="ä¸Šä»£ç "><a href="#ä¸Šä»£ç " class="headerlink" title="ä¸Šä»£ç "></a>ä¸Šä»£ç </h1><h2 id="PrimitiveBehaviour-åŸºæœ¬ç»“æ„"><a href="#PrimitiveBehaviour-åŸºæœ¬ç»“æ„" class="headerlink" title="PrimitiveBehaviour(åŸºæœ¬ç»“æ„)"></a>PrimitiveBehaviour(åŸºæœ¬ç»“æ„)</h2><p>é¦–å…ˆå®šä¹‰è¡¨ç°ä»¶çš„æœ€åŸºæœ¬çš„ç»“æ„ã€‚å®è´¨å°±æ˜¯ä¸€ä¸ªæ¥æ”¶å€¼çš„æ›´æ–°ã€‚<br>æ­¤å¤–è¿˜å¤šäº†ä¸€ä¸ªæ ‡å¿—ï¼Œå¯ç”¨äºè°ƒæ•´è¯¥ç»„ä»¶æ˜¯å¦åœ¨ç¬¬ä¸€æ¬¡æ”¶åˆ°å€¼å¾—æ—¶å€™ä½¿ç”¨å¿«è¿›åŠ¨ç”»ã€‚<br>å› ä¸ºè¯¥åŠŸèƒ½åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œæ˜¯æ ¹æ®ç¾æœ¯çš„è¦æ±‚æ¥å†³å®šçš„ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—ä¸å†™åœ¨ä»£ç é‡Œè€Œæ˜¯å¼€æ”¾å‡ºæ¥ä¾›ç›´æ¥åœ¨prefabæ›´æ”¹ä¼šæ›´æ–¹ä¾¿ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Core.UI</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// where T : IComparable, IComparable&lt;T&gt;, IConvertible, IEquatable&lt;T&gt; å…¶å®å°±æ˜¯ä¸ºäº†é™åˆ¶ T å¿…é¡»æ˜¯è¿™äº›åŸºç¡€ç±»å‹ï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯æ²¡å¿…è¦è¿™ä¹ˆå†™</span></span><br><span class="line">    public interface IBehaviourDispatcher&lt;T&gt; where T : IComparable, IComparable&lt;T&gt;, IConvertible, IEquatable&lt;T&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">DispatchValueChange</span>(<span class="params">T nextValue, <span class="keyword">bool</span> instant</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract class PrimitiveBehaviour&lt;T&gt; : MonoBehaviour where T : IComparable, IComparable&lt;T&gt;, IConvertible, IEquatable&lt;T&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> m_instantApplyInitValue = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> m_hasInit = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">private</span> T m_currentValue;</span><br><span class="line">        <span class="keyword">private</span> T m_previousValue;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T currentValue =&gt; m_currentValue;</span><br><span class="line">        <span class="keyword">public</span> T previousValue =&gt; m_previousValue;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> hasInited =&gt; m_hasInit;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æŒæœ‰æ•°æ®çš„ä¸€æ–¹ä¸»åŠ¨è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä»¥å¯¹è¡¨ç°è¿›è¡Œæ›´æ–°</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="nextValue"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="instant"&gt;</span>instant changing value can also used to fast forward anim<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChangeValue</span>(<span class="params">T nextValue, <span class="keyword">bool</span> instant</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (m_hasInit)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!instant &amp;&amp; IsValueEqual(currentValue, nextValue))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                m_previousValue = m_currentValue;</span><br><span class="line">                m_currentValue = nextValue;</span><br><span class="line">                NotifyValueChanged(nextValue, instant);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            instant = instant || m_instantApplyInitValue;</span><br><span class="line">            NotifyValueChanged(nextValue, instant);</span><br><span class="line">            m_previousValue = m_currentValue = nextValue;</span><br><span class="line">            m_hasInit = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">bool</span> <span class="title">IsValueEqual</span>(<span class="params">T l, T r</span>)</span> =&gt; <span class="number">0</span> == l.CompareTo(r);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">NotifyValueChanged</span>(<span class="params">T nextValue, <span class="keyword">bool</span> instant</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="BoolBehaviour"><a href="#BoolBehaviour" class="headerlink" title="BoolBehaviour"></a>BoolBehaviour</h2><p>éœ€è¦ä¸‹å‘æ•°æ®çš„ä¸€æ–¹éœ€è¦æŒæœ‰ä¸€ä¸ª BoolBehaviourDispatcher å˜é‡ï¼Œå¹¶é€šè¿‡å…¶æŠŠæ•°æ®å˜æ›´ä¸‹å‘å‡ºå»ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Core.UI</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> BoolBehaviourDispatcher : IBehaviourDispatcher&lt;<span class="keyword">bool</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> BoolBehaviour[] m_behaviours;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DispatchValueChange</span>(<span class="params"><span class="keyword">bool</span> nextValue, <span class="keyword">bool</span> instant</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">int</span> count = m_behaviours.Length;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                BoolBehaviour behaviour = m_behaviours[i];</span><br><span class="line">                <span class="keyword">if</span> (behaviour.gameObject.activeInHierarchy &amp;&amp; behaviour.enabled)</span><br><span class="line">                &#123;</span><br><span class="line">                    behaviour.ChangeValue(nextValue, instant);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"FindInChildren"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FindInChildren</span>(<span class="params">GameObject source</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> behaviors = source.GetComponentsInChildren&lt;BoolBehaviour&gt;();</span><br><span class="line">            m_behaviours = behaviors;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract class BoolBehaviour : PrimitiveBehaviour&lt;bool&gt; </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Editor preview"</span>), NonReorderable</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> previewValue_editor = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> previrwInstant = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"SetValuePreview"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetValuePreview</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Application.isPlaying)</span><br><span class="line">            &#123;</span><br><span class="line">                NotifyValueChanged(previewValue_editor, previrwInstant);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            NotifyValueChanged(previewValue_editor, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="FloatBehaviour"><a href="#FloatBehaviour" class="headerlink" title="FloatBehaviour"></a>FloatBehaviour</h2><p>éœ€è¦ä¸‹å‘æ•°æ®çš„ä¸€æ–¹éœ€è¦æŒæœ‰ä¸€ä¸ª FloatBehaviourDispatcher å˜é‡ï¼Œå¹¶é€šè¿‡å…¶æŠŠæ•°æ®å˜æ›´ä¸‹å‘å‡ºå»ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Core.UI</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> FloatBehaviourDispatcher: IBehaviourDispatcher&lt;<span class="keyword">float</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> FloatBehaviour[] m_behaviours;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DispatchValueChange</span>(<span class="params"><span class="keyword">float</span> nextValue, <span class="keyword">bool</span> instant</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">int</span> count = m_behaviours.Length;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> behaviour = m_behaviours[i];</span><br><span class="line">                <span class="keyword">if</span> (behaviour.gameObject.activeInHierarchy &amp;&amp; behaviour.enabled)</span><br><span class="line">                &#123;</span><br><span class="line">                    behaviour.ChangeValue(nextValue, instant);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"FindInChildren"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FindInChildren</span>(<span class="params">GameObject source</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> behaviors = source.GetComponentsInChildren&lt;FloatBehaviour&gt;();</span><br><span class="line">            m_behaviours = behaviors;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract class FloatBehaviour : PrimitiveBehaviour&lt;float&gt;</span><br><span class="line">    &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Editor preview"</span>), NonReorderable</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">float</span> previewValue_editor = <span class="number">1f</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> previrwInstant = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"SetValuePreview"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetValuePreview</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Application.isPlaying)</span><br><span class="line">            &#123;</span><br><span class="line">                NotifyValueChanged(previewValue_editor, previrwInstant);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            NotifyValueChanged(previewValue_editor, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="IntBehaviour"><a href="#IntBehaviour" class="headerlink" title="IntBehaviour"></a>IntBehaviour</h2><p>éœ€è¦ä¸‹å‘æ•°æ®çš„ä¸€æ–¹éœ€è¦æŒæœ‰ä¸€ä¸ª IntBehaviourDispatcher å˜é‡ï¼Œå¹¶é€šè¿‡å…¶æŠŠæ•°æ®å˜æ›´ä¸‹å‘å‡ºå»ã€‚<br>IntBehaviour æˆ‘å®šä¹‰æˆä¸€ä¸ªæŠ½è±¡ç±»ã€‚å› ä¸ºå®é™…ä½¿ç”¨çš„æ—¶å€™(æˆ‘æš‚æ—¶é‡åˆ°çš„æƒ…å†µ)ï¼Œåœ¨UIè¡¨ç°ä¸Šä¼šéœ€è¦æœ‰æŒæœ‰ä¸€ä¸ªæ•°å€¼ï¼Œæ•°å€¼ç›¸åŒä¸åŒæ—¶çš„è¡¨ç°ï¼Œæˆ–æ˜¯UIæ”¶åˆ°ä¸åŒçš„æ•°å€¼å†æœ‰ä¸åŒçš„è¡¨ç°ã€‚<br>æ‰€ä»¥è¿™è¾¹åˆ†åšæˆäº†ä¸¤ä¸ª Beheaviour ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Core.UI</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> IntBehaviourDispatcher : IBehaviourDispatcher&lt;<span class="keyword">int</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> IntBehaviour[] m_behaviours;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DispatchValueChange</span>(<span class="params"><span class="keyword">int</span> nextValue, <span class="keyword">bool</span> instant</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">int</span> count = m_behaviours.Length;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> behaviour = m_behaviours[i];</span><br><span class="line">                <span class="keyword">if</span> (behaviour.gameObject.activeInHierarchy &amp;&amp; behaviour.enabled)</span><br><span class="line">                &#123;</span><br><span class="line">                    behaviour.ChangeValue(nextValue, instant);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"FindInChildren"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FindInChildren</span>(<span class="params">GameObject source</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> behaviors = source.GetComponentsInChildren&lt;IntBehaviour&gt;();</span><br><span class="line">            m_behaviours = behaviors;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract class IntBehaviour : PrimitiveBehaviour&lt;int&gt; </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Editor preview"</span>), NonReorderable</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> previewValue_editor = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> previrwInstant = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"SetValuePreview"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetValuePreview</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Application.isPlaying)</span><br><span class="line">            &#123;</span><br><span class="line">                NotifyValueChanged(previewValue_editor, previrwInstant);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            NotifyValueChanged(previewValue_editor, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®æ”¶åˆ°çš„å€¼ä¸åŒ è€Œä½œä¸åŒè¡¨ç°</span></span><br><span class="line">    public abstract class IntSwitchBehaviour&lt;T&gt; : PrimitiveBehaviour&lt;int&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">Serializable</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">struct</span> IntPack</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">int</span> intValue;</span><br><span class="line">            <span class="keyword">public</span> T targetValueDataPack;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Extra param"</span>)</span>]</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> m_hasDefaultPack = <span class="literal">false</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> m_defaultPackIndex = <span class="number">0</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> m_unapplyPrevPack = <span class="literal">true</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> IntPack[] m_packArray;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">sealed</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">NotifyValueChanged</span>(<span class="params"><span class="keyword">int</span> nextValue, <span class="keyword">bool</span> instant</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">int</span> length = m_packArray.Length;</span><br><span class="line">            <span class="keyword">int</span> meetIndex = <span class="number">-1</span>;</span><br><span class="line">            IntPack pack;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                pack = m_packArray[i];</span><br><span class="line">                <span class="keyword">if</span> (pack.intValue == nextValue)</span><br><span class="line">                &#123;</span><br><span class="line">                    meetIndex = i;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (m_unapplyPrevPack)</span><br><span class="line">                &#123;</span><br><span class="line">                    UnApplyPack(pack.targetValueDataPack);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (meetIndex &gt; <span class="number">0</span>) <span class="comment">// has meet</span></span><br><span class="line">            &#123;</span><br><span class="line">                pack = m_packArray[meetIndex];</span><br><span class="line">                ApplyPack(pack.targetValueDataPack, instant);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// apply default one</span></span><br><span class="line">            pack = m_packArray[m_defaultPackIndex];</span><br><span class="line">            ApplyPack(pack.targetValueDataPack, instant);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">ApplyPack</span>(<span class="params">T pack, <span class="keyword">bool</span> instant</span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">UnApplyPack</span>(<span class="params">T pack</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒæœ‰ä¸€ä¸ªæ•°å€¼ï¼Œåˆ¤æ–­ä¼ è¿›æ¥çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå†åšè¡¨ç°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">IntEqualBehaviour</span> : <span class="title">IntBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> m_targetValue;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> m_isPreviousValueEqual = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">sealed</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">NotifyValueChanged</span>(<span class="params"><span class="keyword">int</span> nextValue, <span class="keyword">bool</span> instant</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">bool</span> isEqual = IsValueEqual(nextValue, m_targetValue);</span><br><span class="line">            <span class="keyword">bool</span> hasChanged = isEqual != m_isPreviousValueEqual;</span><br><span class="line">            <span class="keyword">if</span> (hasInited)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (hasChanged)</span><br><span class="line">                &#123;</span><br><span class="line">                    NotifyValueEqual(isEqual, instant);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            NotifyValueEqual(isEqual, instant);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">NotifyValueEqual</span>(<span class="params"><span class="keyword">bool</span> equal, <span class="keyword">bool</span> instant</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ª FloatBehaviour å’Œ BoolBehaviour çš„ä¾‹å­ã€‚<br>åªéœ€è¦æ”¶åˆ°æ•°å€¼ï¼ŒFloatBehaviour å¯åŠ¨tweenå»ä¿®æ”¹ Image çš„å¡«å……/ BoolBehaviour å»å¼€å…³ç‰©ä½“ã€‚å…¶å®ƒè¿˜ä¼šç”¨åˆ°çš„è¡¨ç°è¿˜æœ‰æ›´æ”¹é¢œè‰²ï¼Œå¼€å…³ç‰©ä½“ä¹‹ç±»çš„ï¼Œ<br>å½“ç„¶å®é™…ä½¿ç”¨çš„æƒ…å†µè¿˜å¾—è€ƒè™‘ target æ˜¯å¦ä¼šæ— æ•ˆï¼Œä»¥åŠç‰©ä½“ä»æ¥æ²¡å¼€è¿‡ï¼Œå´è°ƒç”¨ NotifyValueChanged ä¹‹ç±»çš„ç»†èŠ‚é—®é¢˜çš„ã€‚</p>
<img src="/2024/02/16/20240216-primitivebehaviour/20240216-primitivebehaviour-pic001.png" class="" title="split">
<img src="/2024/02/16/20240216-primitivebehaviour/20240216-primitivebehaviour-pic002.png" class="" title="split">
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Core.UI</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">RequireComponent(typeof(Image))</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SlicesImageFill</span> : <span class="title">FloatBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Fields"</span>)</span>]</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Image m_target;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> m_reverse = <span class="literal">false</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Vector2 m_range = <span class="keyword">new</span> Vector2(<span class="number">0</span>, <span class="number">1f</span>);</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> m_doTweenFill = <span class="literal">false</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> TweenParameter m_tweenParameter;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Tween m_currentTween;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">NotifyValueChanged</span>(<span class="params"><span class="keyword">float</span> nextValue, <span class="keyword">bool</span> instant</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_currentTween?.Kill();</span><br><span class="line">            <span class="keyword">float</span> targetFill = CalculateFillValue(nextValue);</span><br><span class="line">            <span class="keyword">if</span> (instant || !m_doTweenFill)</span><br><span class="line">            &#123;</span><br><span class="line">                m_target.fillAmount = targetFill;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            m_currentTween = m_target.DOFillAmount(targetFill, m_tweenParameter.duration);</span><br><span class="line">            m_currentTween.ApplyParam(m_tweenParameter);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">float</span> <span class="title">CalculateFillValue</span>(<span class="params"><span class="keyword">float</span> rawValue</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> Mathf.Lerp(m_range.x, m_range.y, m_reverse ? <span class="number">1</span> - rawValue : rawValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDestroy</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_currentTween?.Kill();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_target = GetComponent&lt;Image&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BoolReactorObjectActive</span> : <span class="title">BoolBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">Serializable</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">struct</span> ObjectActivePack</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> GameObject target;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">bool</span> inverse;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Extra param"</span>)</span>]</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> ObjectActivePack[] m_packs;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">NotifyValueChanged</span>(<span class="params"><span class="keyword">bool</span> <span class="keyword">value</span>, <span class="keyword">bool</span> instant</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = m_packs.Length; i &lt; length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                ObjectActivePack pack = m_packs[i];</span><br><span class="line">                pack.target.SetActive(pack.inverse ? !<span class="keyword">value</span> : <span class="keyword">value</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1>]]></content>
      <categories>
        <category>UGUI</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity Serialization åºåˆ—åŒ–å°ç¬”è®°</title>
    <url>/2024/07/14/20240714-unity-serialization-1/</url>
    <content><![CDATA[<p>åºåˆ—åŒ–ï¼ˆserializationï¼‰åœ¨è®¡ç®—æœºç§‘å­¦çš„èµ„æ–™å¤„ç†ä¸­ï¼Œæ˜¯æŒ‡å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡çŠ¶æ€è½¬æ¢æˆå¯å–ç”¨æ ¼å¼ï¼ˆä¾‹å¦‚å­˜æˆæ–‡ä»¶ï¼Œå­˜äºç¼“å†²ï¼Œæˆ–ç»ç”±ç½‘ç»œä¸­å‘é€ï¼‰ï¼Œä»¥ç•™å¾…åç»­åœ¨ç›¸åŒæˆ–å¦ä¸€å°è®¡ç®—æœºç¯å¢ƒä¸­ï¼Œèƒ½æ¢å¤åŸå…ˆçŠ¶æ€çš„è¿‡ç¨‹ã€‚</p>
<h1 id="åºåˆ—åŒ–çš„å‘ç”Ÿ"><a href="#åºåˆ—åŒ–çš„å‘ç”Ÿ" class="headerlink" title="åºåˆ—åŒ–çš„å‘ç”Ÿ"></a>åºåˆ—åŒ–çš„å‘ç”Ÿ</h1><p>å½“æˆ‘ä»¬ç”¨(UnityEngine.Object.Instantiate())æ­¤æ–¹æ³•å»ç”Ÿæˆä¸€ä¸ª UnityObject æ—¶å€™ï¼Œå°±ç»å†äº†åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ“ä½œã€‚</p>
<blockquote>
<p>Original Object â€”serializeâ€”&gt; mid-data â€”deserializeâ€”&gt; Spawned Object</p>
</blockquote>
<h1 id="åºåˆ—åŒ–ä½¿ç”¨åœºæ™¯"><a href="#åºåˆ—åŒ–ä½¿ç”¨åœºæ™¯" class="headerlink" title="åºåˆ—åŒ–ä½¿ç”¨åœºæ™¯"></a>åºåˆ—åŒ–ä½¿ç”¨åœºæ™¯</h1><h2 id="ä¿å­˜ç›¸å…³èµ„äº§"><a href="#ä¿å­˜ç›¸å…³èµ„äº§" class="headerlink" title="ä¿å­˜ç›¸å…³èµ„äº§"></a>ä¿å­˜ç›¸å…³èµ„äº§</h2><p>æˆ‘ä»¬çš„è®¸å¤š UnityObject èµ„äº§ scene, prefab, material éƒ½æ˜¯ä»¥æ–‡æœ¬æ–‡ä»¶(YAML)çš„å½¢å¼ä¿å­˜åœ¨é¡¹ç›®ä¸­ã€‚ç¼–è¾‘å™¨æ—¶ï¼Œä¼šåœ¨ Library ä¸­å­˜æ”¾â€™ä¸­é—´ç‰©ä½“â€™ã€‚<br>æˆ‘çŒœæµ‹ï¼Œç¼–è¾‘å™¨æ—¶ä¼šä½¿ç”¨è¿™äº›â€™ä¸­é—´ç‰©ä½“â€™ä»¥å‡å°‘å®é™…åºåˆ—åŒ–çš„æ­¥éª¤æ¥åŠ é€Ÿè¿è¡Œã€‚</p>
<p>å½“æˆ‘ä»¬å°†ç£ç›˜é‡Œçš„ Asset åŠ è½½åˆ°æ¸¸æˆçš„è¿è¡Œæ—¶é‡Œçš„ UnityObject çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸€ä¸ªååºåˆ—åŒ–æ“ä½œï¼ŒæŠŠYAMLååºåˆ—åŒ–æˆ UnityObjectã€‚</p>
<p>åœ¨ç¼–è¾‘å™¨æ—¶ï¼Œæˆ‘ä»¬ä¼šä¿®æ”¹è„šæœ¬ï¼Œæ”¹å˜ä¸€äº›æ•°æ®ç±»å‹ã€‚æŠŠå­—æ®µåç§°ä¿®æ”¹åï¼ŒåŸæœ¬åºåˆ—åŒ–çš„å€¼ä¸¢å¤±äº†ã€‚æˆ‘çŒœæ˜¯å› ä¸ºé¡¹ç›®åœ¨ Refresh çš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠæ‰€æœ‰å¿…è¦çš„æ•°æ®éƒ½åºåˆ—åŒ–å­˜å…¥â€™ä¸­é—´ç‰©ä½“â€™ï¼Œç„¶åç­‰ä»£ç ç¼–è¯‘å®Œï¼Œç”Ÿæˆäº†æ–°çš„ç±»å‹ï¼Œå†å°è¯•æŠŠåŸæœ¬çš„â€™ä¸­é—´ç‰©ä½“â€™ç”¨æ–°çš„ç±»å‹ååºåˆ—åŒ–ç”Ÿæˆæ–°ç‰©ä½“å¹¶åœ¨åºåˆ—åŒ–ç”Ÿæˆæ–°çš„â€™ä¸­é—´ç‰©ä½“â€™ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ç”±äºæ˜¯ä½¿ç”¨æ–°ç±»å‹è¿›è¡Œååºåˆ—åŒ–äº†ï¼Œè‡ªç„¶ä¼šæŠ›å¼ƒæ–°ç±»å‹ä¸­æ²¡æœ‰çš„(ä¸åŒåä¸”ç±»å‹ä¸åŒ¹é…çš„)æ•°æ®ã€‚å¼•æ“C#å±‚é‡è½½ HotReloading ä¼šæŠ¥é”™ä½†æ˜¯æœ‰å¯èƒ½å‡‘åˆèƒ½è·‘ä¼°è®¡ä¹Ÿæ˜¯è¿™ä¸ªåŸå› ï¼Œæ‰€ä»¥ HotReloading å®é™…ä¸Šæ˜¯ä¸ºäº†è®©æˆ‘ä»¬å¿«é€Ÿä¿®æ”¹ä¸šåŠ¡é€»è¾‘çœ‹çœ‹æœ‰æ— ä¿®å¥½çš„ã€‚</p>
<p>FormerlySerializedAs(PROPERTY_NAME) è¿™ä¸ªç‰¹æ€§å¯ä»¥è§£å†³ä¸Šé¢è¯´çš„è¿™ä¸ªé—®é¢˜ï¼Œä½†å…¶å®å°±æ˜¯è¦æ±‚è¿™ä¸ªå­—æ®µåšåºåˆ—åŒ–ç›¸å…³æ“ä½œæ—¶æ²¿ç”¨æ—§çš„å­—æ®µå(PROPERTY_NAME)ã€‚è¿™æ ·åœ¨ prefab ä¸­åºåˆ—åŒ–ä¸‹æ¥è®°å½•çš„å­—æ®µåä¸€ç›´éƒ½æ˜¯é‚£ä¸ªæ—§çš„å­—æ®µåã€‚</p>
<!-- check https://zhuanlan.zhihu.com/p/139978773 -->
<h2 id="ç¼–è¾‘å™¨çš„å­—æ®µç»˜åˆ¶"><a href="#ç¼–è¾‘å™¨çš„å­—æ®µç»˜åˆ¶" class="headerlink" title="ç¼–è¾‘å™¨çš„å­—æ®µç»˜åˆ¶"></a>ç¼–è¾‘å™¨çš„å­—æ®µç»˜åˆ¶</h2><p>å½“æˆ‘ä»¬å¯¹å­—æ®µåšåšç¼–è¾‘å™¨ç»˜åˆ¶çš„æ—¶å€™ï¼Œä¹Ÿä¼šæœ‰åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–çš„æ“ä½œã€‚</p>
<blockquote>
<p>Inspector â€”update changesâ€”&gt; Serialized Properties â€”deserializeâ€”&gt; Spawned Object<br>Inspector &lt;â€”update viewâ€” Serialized Properties â€”serializeâ€”&gt; Spawned Object</p>
</blockquote>
<p>UnityObject ä¸­çš„å­—æ®µå€¼ä¼šè¢«åºåˆ—åŒ–åˆ° Serialized Properties é›†åˆä¸­ï¼Œç„¶åç¼–è¾‘å™¨ç»˜åˆ¶ç›¸å…³çš„ä»£ç æ‹¿åˆ°åºåˆ—åŒ–åå¾—åˆ°çš„æ•°æ®é›†åˆï¼Œå†æŠŠä»–ä»¬æå‡ºæ¥å¹¶æ ¹æ®æ•°æ®ç±»å‹ç”»ä¸åŒçš„æ ·å¼ã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ª PropertuDrawer çš„ä¾‹å­ï¼Œåœ¨ç»˜åˆ¶æ–¹æ³•çš„å‚æ•°ä¸­æœ‰ SerializedPropertyï¼Œè¿™ä¸ªå°±æ˜¯ç”¨äºå­˜æ”¾ UnityObject ä¸­è¢«åºåˆ—åŒ–å­—æ®µçš„ wrapperã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">[<span class="meta">CustomPropertyDrawer(typeof(NormalizedCurve))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NormalizedCurvePropertyDrawer</span> : <span class="title">PropertyDrawer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">string</span> CURVE_FIELD = <span class="string">"_curve"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> Rect RANGES = <span class="keyword">new</span> Rect(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params">Rect position, SerializedProperty property, GUIContent label</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        EditorGUI.BeginProperty(position, label, property);</span><br><span class="line">        <span class="keyword">var</span> curveProperty = property.FindPropertyRelative(CURVE_FIELD);</span><br><span class="line">		<span class="comment">// ....</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¯¹-UnityObject-å¼•ç”¨çš„åºåˆ—åŒ–"><a href="#å¯¹-UnityObject-å¼•ç”¨çš„åºåˆ—åŒ–" class="headerlink" title="å¯¹ UnityObject å¼•ç”¨çš„åºåˆ—åŒ–"></a>å¯¹ UnityObject å¼•ç”¨çš„åºåˆ—åŒ–</h2><p>å“¦æˆ‘çš„è€å…„ï¼Œè¿™ä¸ªå¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ã€‚ä»¥æ–‡æœ¬çš„å½¢å¼æ‰“å¼€æˆ‘ä»¬çš„ prefab åº·åº·ã€‚æ‘˜ä¸€æ®µ</p>
<p><a href="https://docs.unity3d.com/Manual/ClassIDReference.html" target="_blank" rel="noopener">UnityScriptClassType</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--- !u!114 &amp;7941049597127225971 &#x2F;&#x2F; !u!CLASS_TYPE &amp;OBJECT_FILE_ID</span><br><span class="line">MonoBehaviour:</span><br><span class="line">  m_ObjectHideFlags: 0</span><br><span class="line">  m_CorrespondingSourceObject: &#123;fileID: 0&#125;</span><br><span class="line">  m_PrefabInstance: &#123;fileID: 0&#125;</span><br><span class="line">  m_PrefabAsset: &#123;fileID: 0&#125;</span><br><span class="line">  m_GameObject: &#123;fileID: 3753066996938937369&#125;</span><br><span class="line">  m_Enabled: 1</span><br><span class="line">  m_EditorHideFlags: 0</span><br><span class="line">  m_Script: &#123;fileID: 11500000, guid: 43f865a8433367346843b29a2464c1a7, type: 3&#125; &#x2F;&#x2F; guid point to this object instance&#39;s asset source</span><br><span class="line">  m_Name: </span><br><span class="line">  m_EditorClassIdentifier: </span><br><span class="line">  m_Material: &#123;fileID: 0&#125;</span><br><span class="line">  m_Color: &#123;r: 1, g: 1, b: 1, a: 1&#125;</span><br><span class="line">  m_RaycastTarget: 1</span><br><span class="line">  m_RaycastPadding: &#123;x: 0, y: 0, z: 0, w: 0&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–è¡Œè¡¨æ˜äº†è¯¥ UnityObject çš„ç±»å‹ä»¥åŠå®ƒåœ¨è¿™ä¸ª Prefab ä¸­çš„å”¯ä¸€æ ‡è¯†IDã€‚<br>m_Script è¿™ä¸€è¡Œè¡¨æ˜äº†è¿™ä¸ªç‰©ä½“æ˜¯ä¸ª .cs è„šæœ¬ã€‚</p>
<p>æˆ‘ä»¬è¿˜èƒ½å‘ç°æœ‰äº›å­—æ®µåªè®°å½• { FileID }, æœ‰äº›å´è¦è®°å½•ä¸‰ä¸ªå‚æ•° {fileID, guid, type} ã€‚è®°å½•ä¸‰ä¸ªå‚æ•°çš„è¡¨æ˜çš„æ˜¯è¿™ä¸ª prefab å†…çš„ç‰©ä½“çš„å¤–éƒ¨æ¥æºã€‚å¬èµ·æ¥å¾ˆåˆ«æ‰­ï¼Œæˆ‘è¯´è¯¦ç»†ç‚¹å§ï¼Œå°±å¥½æ¯”è¯´ä¸€ä¸ª prefab A ä¸­åŒ…å«äº†ä¸€ä¸ª prefab Bï¼Œé‚£ä¹ˆ B ç‰©ä½“å°±æ˜¯éœ€è¦åœ¨ prefab A ä¸­ä»¥å¦‚ä¸Šæ–¹å¼è®°å½•ã€‚ å…¶ä¸­ guid æ˜¯ prefab B æ‰€åœ¨(å®šä¹‰å¤„)çš„èµ„æºæ–‡ä»¶çš„ guid, FileID åˆ™æ˜¯è¿™ä¸ªç‰©ä½“åœ¨èµ„æºå†…çš„å”¯ä¸€IDï¼Œtype æ˜¯è¿™ä¸ªç‰©ä½“çš„èµ„æºç±»å‹ã€‚</p>
<p>æ‰€ä»¥ UnityObject å¼•ç”¨çš„åºåˆ—åŒ–æ˜¯ä¾é ä»¥æ–‡æœ¬çš„å½¢å¼è®°å½•IDå®Œæˆçš„ã€‚</p>
<h2 id="å¯¹ç©ºå¼•ç”¨-null-çš„æ”¯æŒ"><a href="#å¯¹ç©ºå¼•ç”¨-null-çš„æ”¯æŒ" class="headerlink" title="å¯¹ç©ºå¼•ç”¨(null)çš„æ”¯æŒ"></a>å¯¹ç©ºå¼•ç”¨(null)çš„æ”¯æŒ</h2><p>ç©ºå¼•ç”¨åªæ”¯æŒ UnityObject æï¼Œå¦‚æœæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ C# class, åºåˆ—åŒ–æ—¶ä¼šç”Ÿæˆé»˜è®¤çš„ç»™ä»–ã€‚è¿™ä¸ªæ—¶å€™å¦‚æœæœ‰ç–¯ç‹‚åµŒå¥—çš„ C# classå°±ä¼šçˆ†ç‚¸äº†ï¼Œå› ä¸ºä»–ä¼šä¸€ç›´å¾€é‡Œå±‚ç”Ÿæˆé»˜è®¤å€¼ç»™è¿™äº›å¯åºåˆ—åŒ–çš„ C# Class objectã€‚</p>
<!-- ç›¸å…³èµ„æ–™ -->
<!-- https://zhuanlan.zhihu.com/p/565721314 -->]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>UGUI SafeArea é€‚é…</title>
    <url>/2023/07/30/20230730-ui-safe-area-rect/</url>
    <content><![CDATA[<p>æœ€è¿‘æœ‰åœ¨åšæ‰‹æ¸¸ã€‚å„ä¸ªå‚å•†æ‰‹æœºå±å¹•çš„å°ºå¯¸å’Œæ¯”ä¾‹éƒ½å„ä¸ç›¸åŒã€‚UIé€‚é…å¯ä»¥è¯´æ˜¯ä¸€å¤§éš¾é¢˜å»ã€‚UIç¾æœ¯é‚£è¾¹åœ¨åˆ¶ä½œçš„ä¹Ÿæœ‰è€ƒè™‘åˆ°é€‚é…æ–¹é¢çš„é—®é¢˜ï¼Œæœ‰è®¸å¤šå…ƒç´ æ˜¯éœ€è¦æˆ‘ä»¬æ ¹æ®å®‰å…¨åŒºæ¥é€‚é…çš„ã€‚<br>ä½†æ¯”è¾ƒå‘çˆ¹çš„ä¸€äº›æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œè¦æ±‚é¡µé¢Aä¸‹æ–¹æœ‰ä¸ªæŒ‰é’®æ‰˜ç›˜ï¼ŒæŒ‰é’®æ‰˜ç›˜æ‰“å¼€çš„æ—¶å€™è¦æœ‰ä¸€ä¸ªå¤§å›¾èƒŒæ™¯å»é˜»æŒ¡ç©å®¶ç‚¹å‡»åŸæœ¬é¡µé¢Aä¸Šçš„å…ƒç´ ã€‚è¿™ä¸ªæŒ‰é’®æ‰˜ç›˜è¿˜æ˜¯åœ¨å…¶ä»–é¡µé¢ä¸­ä¹Ÿæœ‰ç”¨åˆ°çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåšäº†ä¸¤ä¸ªRecté€‚é…çš„è„šæœ¬ã€‚<br>è¿˜æ²¡å®Œæˆï¼Œä½†æ˜¯æ„Ÿè§‰åŸºæœ¬èƒ½ç”¨ï¼Œå°±å…ˆæ‹‰ä¸Šæ¥è®°ä¸€ä¸‹ã€‚</p>
<p>è¿™ä¸¤ä¸ªè„šæœ¬éƒ½ä¾èµ–ä¸å½“å‰UIä½¿ç”¨çš„ç›¸æœºå’Œæ ¹Canvasã€‚æ‰€ä»¥åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™éœ€è¦å‡†å¤‡å¥½è¿™ä¸¤ä¸ªä¸œè¥¿ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">UIAreaRect</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Camera <span class="title">GetUICamera</span>(<span class="params"></span>)</span>;</span><br><span class="line">        <span class="function">Canvas <span class="title">GetRootCanvas</span>(<span class="params"></span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Refresh</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ExecuteAlways</span>]</span><br><span class="line">    [<span class="meta">RequireComponent(typeof(RectTransform))</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SafeAreaRect</span> : <span class="title">UIBehaviour</span>, <span class="title">ILayoutSelfController</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Vector2 s_specialPivot = Vector2.zero; <span class="comment">// HACK @Hiko self pivot</span></span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> RectOffset _rectOffset = <span class="keyword">new</span> RectOffset();</span><br><span class="line"></span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Camera _uiCamera;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Canvas _rootCanvas;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RectTransform m_rect;</span><br><span class="line">        <span class="keyword">private</span> DrivenRectTransformTracker m_tracker;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RectTransform selfRectTransform</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (m_rect == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    m_rect = GetComponent&lt;RectTransform&gt;();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> m_rect;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetLayoutHorizontal</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Refresh();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetLayoutVertical</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Refresh();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"Refresh"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Refresh</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">            RebuildTracker();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">            Canvas rootCanvas = GetRootCanvas();</span><br><span class="line">            Camera uiCamera = GetUICamera();</span><br><span class="line">            RectTransform rectTransform = selfRectTransform, rootCanvasRectTransform = rootCanvas.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">            RectTransform parent = rectTransform.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">            <span class="keyword">if</span> (parent == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.LogError(<span class="string">"This behaviour can not to be used on root recttransform"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (rootCanvas == <span class="literal">null</span> || uiCamera == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Rect safeRect = CalcultateCurrentSafeAreaRect();</span><br><span class="line">            rectTransform.pivot = s_specialPivot;</span><br><span class="line">            Vector3 worldUIPos;</span><br><span class="line">            Vector2 localPos = rootCanvasRectTransform.GetLocalRectPosition(RectPositionType.BottomLeft);</span><br><span class="line">            localPos.x += safeRect.x + _rectOffset.left;</span><br><span class="line">            <span class="keyword">float</span> deltaX = _rectOffset.horizontal;</span><br><span class="line">            rectTransform.SetSizeWithCurrentAnchors(RectTransform.Axis.Horizontal, safeRect.width - deltaX);</span><br><span class="line">            localPos.y += safeRect.y + _rectOffset.bottom;</span><br><span class="line">            <span class="keyword">float</span> deltaY = _rectOffset.vertical;</span><br><span class="line">            rectTransform.SetSizeWithCurrentAnchors(RectTransform.Axis.Vertical, safeRect.height - deltaY);</span><br><span class="line">            worldUIPos = rootCanvasRectTransform.TransformPoint(localPos);</span><br><span class="line">            rectTransform.position = worldUIPos;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Camera <span class="title">GetUICamera</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// TODO implement the actual code to get camera while in game or in editor </span></span><br><span class="line">            <span class="keyword">return</span> _uiCamera;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Canvas <span class="title">GetRootCanvas</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// TODO implement the actual code to get root canvas while in game or in editor </span></span><br><span class="line">            <span class="keyword">return</span> _rootCanvas;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Rect <span class="title">CalcultateCurrentSafeAreaRect</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Rect safeRect;</span><br><span class="line">            Canvas rootCanvas = GetRootCanvas();</span><br><span class="line">            RectTransform rootRectTransform = rootCanvas.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">            Rect rootCanvasRect = rootRectTransform.rect;</span><br><span class="line">            <span class="keyword">float</span> rootCanvasWidth = rootCanvasRect.width;</span><br><span class="line">            <span class="keyword">float</span> rootCanvasHeight = rootCanvasRect.height;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// temp pretend it is ip12</span></span><br><span class="line">            <span class="keyword">float</span> horizontalGap = <span class="number">0.055f</span>;</span><br><span class="line">            <span class="keyword">float</span> verticalGap = <span class="number">0.053f</span>;</span><br><span class="line">            <span class="keyword">switch</span> (SystemInfo.deviceType)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> DeviceType.Handheld:</span><br><span class="line">                    Rect deviceSafeRect = Screen.safeArea;</span><br><span class="line">                    <span class="keyword">if</span> (Mathf.Approximately(deviceSafeRect.x, <span class="number">0f</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// a device with saferect as fullrect</span></span><br><span class="line">                        safeRect = <span class="keyword">new</span> Rect(<span class="keyword">new</span> Vector2(rootCanvasWidth * horizontalGap, <span class="number">0f</span>), <span class="keyword">new</span> Vector2(rootCanvasWidth * (<span class="number">1f</span> - <span class="number">2</span> * horizontalGap), rootCanvasHeight * (<span class="number">1f</span> - verticalGap)));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        Resolution resolution = Screen.currentResolution;</span><br><span class="line">                        <span class="keyword">float</span> scale = rootCanvasWidth / resolution.width;</span><br><span class="line">                        safeRect = <span class="keyword">new</span> Rect(deviceSafeRect.x * scale, deviceSafeRect.y * scale, deviceSafeRect.width * scale, deviceSafeRect.height * scale);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="comment">// HACK @Hiko it's on PC, create a temp saferect and pretend it is ip12</span></span><br><span class="line">                    safeRect = <span class="keyword">new</span> Rect(<span class="keyword">new</span> Vector2(rootCanvasWidth * horizontalGap, <span class="number">0f</span>), <span class="keyword">new</span> Vector2(rootCanvasWidth * (<span class="number">1f</span> - <span class="number">2</span> * horizontalGap), rootCanvasHeight * (<span class="number">1f</span> - verticalGap)));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> safeRect;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RebuildTracker</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_tracker.Clear();</span><br><span class="line">            m_tracker.Add(<span class="keyword">this</span>, selfRectTransform, DrivenTransformProperties.All);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">base</span>.OnEnable();</span><br><span class="line">            RebuildTracker();</span><br><span class="line">            SetDirty();</span><br><span class="line">            <span class="keyword">if</span> (Application.isPlaying)</span><br><span class="line">            &#123;</span><br><span class="line">                Refresh();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_tracker.Clear();</span><br><span class="line">            LayoutRebuilder.MarkLayoutForRebuild(selfRectTransform);</span><br><span class="line">            <span class="keyword">base</span>.OnDisable();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetDirty</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!IsActive())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            LayoutRebuilder.MarkLayoutForRebuild(selfRectTransform);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Editor readonly debug stuff"</span>)</span>]</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Rect _editorSafeRect;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Vector2 _editorCurrentResolution;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Vector2 _editorScreenSize;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">float</span> _editorScreenFactor;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">float</span> _editorScreenDpi;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">float</span> _editorCanvasFactor;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Rect _editorRootCanvasRect;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDrawGizmosSelected</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            UpdateEditorPreviewData();</span><br><span class="line">            Color color = Color.blue;</span><br><span class="line">            Rect safeRect = CalcultateCurrentSafeAreaRect();</span><br><span class="line">            Canvas rootCanvas = GetRootCanvas();</span><br><span class="line">            RectTransform rootRectTransform = rootCanvas.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">            Vector2 bottomLeft = rootRectTransform.GetLocalRectPosition(RectPositionType.BottomLeft);</span><br><span class="line">            bottomLeft.x += safeRect.x;</span><br><span class="line">            bottomLeft.y += safeRect.y;</span><br><span class="line">            DrawBox(rootRectTransform, bottomLeft, safeRect.size, color);</span><br><span class="line">            <span class="comment">// draw safe area end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Mathf.Approximately(_rectOffset.horizontal, <span class="number">0f</span>) &amp;&amp; Mathf.Approximately(_rectOffset.vertical, <span class="number">0f</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Rect nextRect = safeRect;</span><br><span class="line">            nextRect.width -= _rectOffset.horizontal;</span><br><span class="line">            nextRect.height -= _rectOffset.vertical;</span><br><span class="line">            nextRect.x += _rectOffset.left;</span><br><span class="line">            nextRect.y += _rectOffset.bottom;</span><br><span class="line">            bottomLeft = rootRectTransform.GetLocalRectPosition(RectPositionType.BottomLeft);</span><br><span class="line">            bottomLeft.x += nextRect.x;</span><br><span class="line">            bottomLeft.y += nextRect.y;</span><br><span class="line">            color.a *= <span class="number">0.8f</span>;</span><br><span class="line">            DrawBox(rootRectTransform, bottomLeft, nextRect.size, color);</span><br><span class="line">            <span class="comment">// draw actual safe area end</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawBox</span>(<span class="params">RectTransform reference, Vector2 bottomLeftLocalPos, Vector2 size, Color color</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Color cachedColor = Gizmos.color;</span><br><span class="line">            Gizmos.color = color;</span><br><span class="line">            <span class="keyword">if</span> (reference != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Gizmos.DrawLine(reference.TransformPoint(bottomLeftLocalPos), reference.TransformPoint(bottomLeftLocalPos + Vector2.right * size.x));</span><br><span class="line">                Gizmos.DrawLine(reference.TransformPoint(bottomLeftLocalPos), reference.TransformPoint(bottomLeftLocalPos + Vector2.up * size.y));</span><br><span class="line">                Gizmos.DrawLine(reference.TransformPoint(bottomLeftLocalPos + Vector2.right * size.x), reference.TransformPoint(bottomLeftLocalPos + Vector2.right * size.x + Vector2.up * size.y));</span><br><span class="line">                Gizmos.DrawLine(reference.TransformPoint(bottomLeftLocalPos + Vector2.up * size.y), reference.TransformPoint(bottomLeftLocalPos + Vector2.right * size.x + Vector2.up * size.y));</span><br><span class="line">            &#125;</span><br><span class="line">            Gizmos.color = cachedColor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateEditorPreviewData</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            _editorSafeRect = CalcultateCurrentSafeAreaRect();</span><br><span class="line">            _editorScreenSize = <span class="keyword">new</span> Vector2(Screen.width, Screen.height);</span><br><span class="line">            _editorCurrentResolution = <span class="keyword">new</span> Vector2(Screen.currentResolution.width, Screen.currentResolution.height);</span><br><span class="line">            _editorScreenFactor = Screen.currentResolution.width / Screen.width;</span><br><span class="line">            _editorScreenDpi = Screen.dpi;</span><br><span class="line">            Canvas rootCanvas = GetRootCanvas();</span><br><span class="line">            <span class="keyword">if</span> (rootCanvas != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                _editorCanvasFactor = rootCanvas.scaleFactor;</span><br><span class="line">                _editorRootCanvasRect = (rootCanvas.transform <span class="keyword">as</span> RectTransform).rect;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     [<span class="meta">ExecuteAlways</span>]</span><br><span class="line">    [<span class="meta">RequireComponent(typeof(RectTransform))</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ScreenRawRect</span> : <span class="title">UIBehaviour</span>, <span class="title">ILayoutSelfController</span>, <span class="title">UIAreaRect</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Vector2 s_specialPivot = Vector2.zero; <span class="comment">// HACK @Hiko self pivot</span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> RectOffset _rectOffset = <span class="keyword">new</span> RectOffset();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RectTransform m_rect;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RectTransform selfRectTransform</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (m_rect == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    m_rect = GetComponent&lt;RectTransform&gt;();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> m_rect;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// temp solution for testing</span></span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Camera m_uiCamera;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Canvas m_rootCanvas;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> DrivenRectTransformTracker m_tracker;</span><br><span class="line">        <span class="keyword">private</span> RectTransform m_rectTransform;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RectTransform rectTransform</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (m_rectTransform == <span class="literal">null</span>)</span><br><span class="line">                    m_rectTransform = GetComponent&lt;RectTransform&gt;();</span><br><span class="line">                <span class="keyword">return</span> m_rectTransform;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetLayoutHorizontal</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Refresh();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetLayoutVertical</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Refresh();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"Refresh"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Refresh</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Camera uiCamera = GetUICamera();</span><br><span class="line">            Canvas rootCanvas = GetRootCanvas();</span><br><span class="line">            RectTransform rootCanvasRectTransform = rootCanvas.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">            Rect sizeRect = rootCanvasRectTransform.rect;</span><br><span class="line">            RectTransform selfRectTransform = rectTransform;</span><br><span class="line">            selfRectTransform.pivot = s_specialPivot;</span><br><span class="line">            Vector3 worldUIPos = RectTransformEx.ScreenToWorld(Vector2.zero, rootCanvas, uiCamera);</span><br><span class="line">            selfRectTransform.position = worldUIPos;</span><br><span class="line">            Vector2 localPos = selfRectTransform.localPosition;</span><br><span class="line">            <span class="keyword">float</span> leftOffset = _rectOffset.left;</span><br><span class="line">            localPos.x += leftOffset;</span><br><span class="line">            <span class="keyword">float</span> deltaX = _rectOffset.horizontal;</span><br><span class="line">            selfRectTransform.SetSizeWithCurrentAnchors(RectTransform.Axis.Horizontal, sizeRect.width - deltaX);</span><br><span class="line">            <span class="keyword">float</span> bottomOffset = _rectOffset.bottom;</span><br><span class="line">            localPos.y += bottomOffset;</span><br><span class="line">            <span class="keyword">float</span> deltaY = _rectOffset.vertical;</span><br><span class="line">            selfRectTransform.SetSizeWithCurrentAnchors(RectTransform.Axis.Vertical, sizeRect.height - deltaY);</span><br><span class="line">            selfRectTransform.localPosition = localPos;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Camera <span class="title">GetUICamera</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> m_uiCamera;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Canvas <span class="title">GetRootCanvas</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> m_rootCanvas;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetDirty</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!IsActive())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            LayoutRebuilder.MarkLayoutForRebuild(rectTransform);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RebuildTracker</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_tracker.Clear();</span><br><span class="line">            m_tracker.Add(<span class="keyword">this</span>, selfRectTransform, DrivenTransformProperties.All);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">base</span>.OnEnable();</span><br><span class="line">            RebuildTracker();</span><br><span class="line">            SetDirty();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_tracker.Clear();</span><br><span class="line">            LayoutRebuilder.MarkLayoutForRebuild(rectTransform);</span><br><span class="line">            <span class="keyword">base</span>.OnDisable();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Editor readonly debug stuff"</span>)</span>]</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Vector2 _editorCurrentResolution;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Vector2 _editorScreenSize;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">float</span> _editorScreenFactor;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">float</span> _editorScreenDpi;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">float</span> _editorCanvasFactor;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Rect _editorRootCanvasRect;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDrawGizmosSelected</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Color color = Color.blue;</span><br><span class="line">            UpdateEditorPreviewData();</span><br><span class="line">            Canvas rootCanvas = GetRootCanvas();</span><br><span class="line">            RectTransform rootRectTransform = rootCanvas.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">            Rect rect = rootRectTransform.rect;</span><br><span class="line">            Vector2 bottomLeft = rootRectTransform.GetLocalRectPosition(RectPositionType.BottomLeft);</span><br><span class="line">            DrawBox(rootRectTransform, bottomLeft, <span class="keyword">new</span> Vector2(rect.width, rect.height), color);</span><br><span class="line">            <span class="comment">// draw raw rect</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Mathf.Approximately(_rectOffset.horizontal, <span class="number">0f</span>) &amp;&amp; Mathf.Approximately(_rectOffset.vertical, <span class="number">0f</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            rect.width -= _rectOffset.horizontal;</span><br><span class="line">            rect.height -= _rectOffset.vertical;</span><br><span class="line">            bottomLeft.x += _rectOffset.left;</span><br><span class="line">            bottomLeft.y += _rectOffset.bottom;</span><br><span class="line">            DrawBox(rootRectTransform, bottomLeft, <span class="keyword">new</span> Vector2(rect.width, rect.height), color);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawBox</span>(<span class="params">RectTransform reference, Vector2 bottomLeftLocalPos, Vector2 size, Color color</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Color cachedColor = Gizmos.color;</span><br><span class="line">            Gizmos.color = color;</span><br><span class="line">            Gizmos.DrawLine(reference.TransformPoint(bottomLeftLocalPos), reference.TransformPoint(bottomLeftLocalPos + Vector2.right * size.x));</span><br><span class="line">            Gizmos.DrawLine(reference.TransformPoint(bottomLeftLocalPos), reference.TransformPoint(bottomLeftLocalPos + Vector2.up * size.y));</span><br><span class="line">            Gizmos.DrawLine(reference.TransformPoint(bottomLeftLocalPos + Vector2.right * size.x), reference.TransformPoint(bottomLeftLocalPos + Vector2.right * size.x + Vector2.up * size.y));</span><br><span class="line">            Gizmos.DrawLine(reference.TransformPoint(bottomLeftLocalPos + Vector2.up * size.y), reference.TransformPoint(bottomLeftLocalPos + Vector2.right * size.x + Vector2.up * size.y));</span><br><span class="line">            Gizmos.color = cachedColor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateEditorPreviewData</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            _editorScreenSize = <span class="keyword">new</span> Vector2(Screen.width, Screen.height);</span><br><span class="line">            _editorCurrentResolution = <span class="keyword">new</span> Vector2(Screen.currentResolution.width, Screen.currentResolution.height);</span><br><span class="line">            _editorScreenFactor = Screen.currentResolution.width / Screen.width;</span><br><span class="line">            _editorScreenDpi = Screen.dpi;</span><br><span class="line">            Canvas rootCanvas = GetRootCanvas();</span><br><span class="line">            <span class="keyword">if</span> (rootCanvas != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                _editorCanvasFactor = rootCanvas.scaleFactor;</span><br><span class="line">                _editorRootCanvasRect = (rootCanvas.transform <span class="keyword">as</span> RectTransform).rect;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">RectTransformEx</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">GetLocalRectPosition</span>(<span class="params"><span class="keyword">this</span> RectTransform target, RectPositionType offsetType</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Vector3 result = Vector3.zero;</span><br><span class="line">            Vector2 targetSize = target.rect.size;</span><br><span class="line">            Vector2 targetPivot = target.pivot;</span><br><span class="line"></span><br><span class="line">            Vector2 pivotOffset = Vector2.one * <span class="number">0.5f</span> - targetPivot;</span><br><span class="line">            pivotOffset.x *= targetSize.x;</span><br><span class="line">            pivotOffset.y *= targetSize.y;</span><br><span class="line"></span><br><span class="line">            result += (Vector3)pivotOffset;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (offsetType)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.Top:</span><br><span class="line">                    result.y += targetSize.y * <span class="number">0.5f</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.Bottom:</span><br><span class="line">                    result.y -= targetSize.y * <span class="number">0.5f</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.Left:</span><br><span class="line">                    result.x -= targetSize.x * <span class="number">0.5f</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.Right:</span><br><span class="line">                    result.x += targetSize.x * <span class="number">0.5f</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> RectPositionType.TopLeft:</span><br><span class="line">                    result.y += targetSize.y * <span class="number">0.5f</span>;</span><br><span class="line">                    result.x -= targetSize.x * <span class="number">0.5f</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> RectPositionType.TopRight:</span><br><span class="line">                    result.y += targetSize.y * <span class="number">0.5f</span>;</span><br><span class="line">                    result.x += targetSize.x * <span class="number">0.5f</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> RectPositionType.BottomLeft:</span><br><span class="line">                    result.y -= targetSize.y * <span class="number">0.5f</span>;</span><br><span class="line">                    result.x -= targetSize.x * <span class="number">0.5f</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> RectPositionType.BottomRight:</span><br><span class="line">                    result.y -= targetSize.y * <span class="number">0.5f</span>;</span><br><span class="line">                    result.x += targetSize.x * <span class="number">0.5f</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">ScreenToWorld</span>(<span class="params">Vector2 screenPoint, Canvas rootCanvas, Camera uiCamera</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">switch</span> (rootCanvas.renderMode)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> RenderMode.ScreenSpaceOverlay:</span><br><span class="line">                    <span class="keyword">return</span> screenPoint;</span><br><span class="line">                <span class="keyword">case</span> RenderMode.ScreenSpaceCamera:</span><br><span class="line">                    RectTransformUtility.ScreenPointToWorldPointInRectangle((RectTransform)rootCanvas.transform, screenPoint, uiCamera, <span class="keyword">out</span> Vector3 worldPoint);</span><br><span class="line">                    <span class="keyword">return</span> worldPoint;</span><br><span class="line">                <span class="keyword">case</span> RenderMode.WorldSpace:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> System.NotImplementedException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<img src="/2023/07/30/20230730-ui-safe-area-rect/20230730-ui-safe-area-rect-pic001.png" class="" title="split">
<p>æœ€å¼€å§‹åšçš„æ—¶å€™æˆ‘å¾ˆç²—å¿ƒçš„ç›´æ¥æŠŠ Screen.SafeArea çš„å¤§å°ç›´æ¥ç»™åº”ç”¨åˆ° RectTransform ä¸Šäº†ã€‚åæ¥å‘ç°è¿™æ ·æ˜¯ä¸å¯¹çš„ï¼ŒScreen.SafeArea è·å–åˆ°çš„æ˜¯å®é™…çš„ç‰©ç†å°ºå¯¸çš„å®‰å…¨åŒºã€‚<br>åæ¥æˆ‘æ˜¯ç®—å‡ºç‰©ç†å°ºå¯¸å’Œæ ¹Canvaså°ºå¯¸çš„ç¬”ç›´ï¼Œå†å»è®¡ç®—å‡ºå®é™…çš„RectTransformå¤§å°ã€‚</p>
<p>åŸºæœ¬ä¸Šå¯ä»¥å‡‘åˆä½¿ç”¨äº†ã€‚è¿˜æ¯”è¾ƒé—æ†¾çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘æ²¡æœ‰èƒ½å¤Ÿè®©å…¶æ”¯æŒåªé€‚é…å››ä¸ªæ–¹å‘ä¸­çš„ä»»1æˆ–è€…ä»»2æ–¹å‘ã€‚æ¯”è¾ƒç®€å•çš„è§£å†³æ–¹æ³•å°±æ˜¯è®©ä¸åŒé€‚é…çš„RectTransformäº’ç›¸å¥—ä¸€ä¸‹ã€‚</p>
<p>UIåŒå­¦åœ¨è°ƒæ•´åŠ¨æ•ˆä»¥åŠç‰©ä½“å¸ƒå±€çš„æ—¶å€™ï¼Œä¼šç”¨Unityä¸­çš„Device Simulatorå°è¯•åˆ‡æ¢ä¸åŒçš„æœºå‹æ¥æŸ¥çœ‹ä¸åŒè®¾å¤‡ä¸Šçš„UI é¢„è§ˆã€‚è¿™ä¸ªæ—¶å€™å¯èƒ½éœ€è¦æœ‰ä¸€ä¸ªç¼–è¾‘å™¨çš„ç›‘å¬å™¨å»ç›‘å¬è®¾å¤‡å˜æ›´çš„äº‹ä»¶ï¼Œç„¶åå‘èµ·å…¨éƒ¨UIå°ºå¯¸åˆ·æ–°çš„è¯·æ±‚ã€‚<br>è¿™æ ·ä¼šæ›´æ–¹ä¾¿ä»–ä»¬åšé¢„è§ˆã€‚</p>
]]></content>
      <categories>
        <category>UGUI</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity Library Artifacts ç›®å½•ä¸‹çš„æ–‡ä»¶åˆçœ‹ï¼</title>
    <url>/2024/07/13/20240713-unity-library-artifacts/</url>
    <content><![CDATA[<p>Library ç›®å½•ä¸‹æœ‰å¤§é‡çš„ç¼“å­˜æ–‡ä»¶ã€‚å…¶ä¸­åŒ…å«ç€å¯¼å…¥è¿›é¡¹ç›®é‡Œçš„èµ„æºæ–‡ä»¶ä»¥åŠä¸€äº›å¯¼å…¥èµ„æºåäº§ç”Ÿçš„ç”¨äºæ–‡ä»¶(å¯èƒ½æ˜¯ç”¨äºè®°å½•å…³ç³»æˆ–æ˜¯ä¸€äº›å…³äºèµ„æºçš„é¢å¤–çš„ç¼“å­˜æ•°æ®ï¼Ÿ)ã€‚</p>
<p>æ¯å½“æœ‰èµ„æºå¯¼å…¥/åˆ·æ–°ä¿®æ”¹æ—¶ï¼ŒLibrary éƒ½ä¼šæœ‰æ–‡ä»¶å‘ç”Ÿå˜æ›´(å¢åˆ æ”¹)ã€‚</p>
<h1 id="Artifacts-ç›®å½•"><a href="#Artifacts-ç›®å½•" class="headerlink" title="Artifacts ç›®å½•"></a>Artifacts ç›®å½•</h1><p>Unity æä¾›äº†ä¸€ä¸ªå·¥å…·å¯ä»¥æŠŠ Artifacts é‡Œçš„æ–‡ä»¶è½¬æˆäººè¯ </p>
<blockquote>
<p>C:\Program Files\Unity\Hub\Editor\UNITY_VERSION\Editor\Data\Tools\binary2text.exe</p>
</blockquote>
<p>Artifacts ç›®å½•ä¸‹å­˜æ”¾å„ä¸ªèµ„æºåœ¨å¯¼å…¥é˜¶æ®µåæœŸç”Ÿæˆçš„ç¼“å­˜æ–‡ä»¶ã€‚ä¼¼ä¹è¿™äº›æ–‡ä»¶ç”±èµ„äº§çš„å“ˆå¸Œå€¼ä½œä¸ºé”®æ¥å‘½åã€‚è¿™äº›æ–‡ä»¶åœ¨ Unity å†…éƒ¨è¢«ç§°ä¸º producedFiles (åœ¨ Log ä¸­ä½¿ç”¨æ”¹åå­—ç§°å‘¼è¿™äº›æ–‡ä»¶ï¼›ä½†åœ¨AssetV2ä¸­ä¼¼ä¹å·²ç»æ²¡æœ‰è¿™ä¸ªä¸œè¥¿)ã€‚</p>
<p>ä¸ºä»€ä¹ˆ Libraray ç›®å½•ä¼šæ¯” Asset å¤§å¾ˆå¤šï¼Œå…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯è¿™æ ·çš„ã€‚ä»¥è„šæœ¬æ–‡ä»¶ä¸¾ä¾‹ï¼Œåœ¨è¿™ä¸ªç¼“å­˜æ–‡ä»¶ä¸­ï¼Œä¸ä»…ä»…æœ‰è¯¥è„šæœ¬çš„ä»£ç æ–‡æœ¬ï¼ŒåŒæ—¶è¿˜ä»¥æ–‡æœ¬çš„å½¢å¼è®°å½•ç€è¯¥èµ„äº§ç›¸å…³çš„ä¸€äº›IDï¼Œä»¥åŠèµ„äº§çš„å­˜å‚¨ç±»å‹ï¼Ÿã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ID: 3 (ClassID: 1035) MonoImporter</span><br><span class="line">	m_ObjectHideFlags 0 (unsigned int)</span><br><span class="line">	m_CorrespondingSourceObject  (PPtr&lt;EditorExtension&gt;)</span><br><span class="line">		m_FileID 0 (int)</span><br><span class="line">		m_PathID 0 (SInt64) &#x2F;&#x2F; signed long?</span><br><span class="line">	m_PrefabInstance  (PPtr&lt;PrefabInstance&gt;)</span><br><span class="line">		m_FileID 0 (int)</span><br><span class="line">		m_PathID 0 (SInt64)</span><br><span class="line">	m_PrefabAsset  (PPtr&lt;Prefab&gt;)</span><br><span class="line">		m_FileID 0 (int)</span><br><span class="line">		m_PathID 0 (SInt64)</span><br><span class="line">	m_Name &quot;&quot; (string)</span><br><span class="line">	m_ExternalObjects  (map)</span><br><span class="line">		size 0 (int)</span><br><span class="line"></span><br><span class="line">	m_UsedFileIDs  (set)</span><br><span class="line">		size 1 (int)</span><br><span class="line">		data (SInt64) #0: 11500000</span><br><span class="line">	m_DefaultReferences  (vector)</span><br><span class="line">		size 0 (int)</span><br><span class="line"></span><br><span class="line">	executionOrder 0 (SInt16)</span><br><span class="line">	icon  (PPtr&lt;Texture2D&gt;)</span><br><span class="line">		m_FileID 0 (int)</span><br><span class="line">		m_PathID 0 (SInt64)</span><br><span class="line">	m_UserData &quot;&quot; (string)</span><br><span class="line">	m_AssetBundleName &quot;&quot; (string)</span><br><span class="line">	m_AssetBundleVariant &quot;&quot; (string)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ID: 11500000 (ClassID: 115) MonoScript</span><br><span class="line">	m_ObjectHideFlags 0 (unsigned int)</span><br><span class="line">	m_CorrespondingSourceObject  (PPtr&lt;EditorExtension&gt;)</span><br><span class="line">		m_FileID 0 (int)</span><br><span class="line">		m_PathID 0 (SInt64)</span><br><span class="line">	m_PrefabInstance  (PPtr&lt;PrefabInstance&gt;)</span><br><span class="line">		m_FileID 0 (int)</span><br><span class="line">		m_PathID 0 (SInt64)</span><br><span class="line">	m_PrefabAsset  (PPtr&lt;Prefab&gt;)</span><br><span class="line">		m_FileID 0 (int)</span><br><span class="line">		m_PathID 0 (SInt64)</span><br><span class="line">	m_Name &quot;IntEqualBehaviour&quot; (string)</span><br><span class="line">	m_Script &quot;using UnityEngine;</span><br><span class="line"></span><br><span class="line">&quot; (string) &#x2F;&#x2F; èµ„äº§çš„å­˜å‚¨ç±»å‹?</span><br><span class="line">	m_DefaultReferences  (map)</span><br><span class="line">		size 0 (int)</span><br><span class="line"></span><br><span class="line">	m_Icon  (PPtr&lt;Object&gt;)</span><br><span class="line">		m_FileID 0 (int)</span><br><span class="line">		m_PathID 0 (SInt64)</span><br><span class="line">	m_ExecutionOrder 0 (int)</span><br><span class="line">	m_ClassName &quot;IntEqualBehaviour&quot; (string)</span><br><span class="line">	m_Namespace &quot;Core.UI&quot; (string)</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€æ¡å¯¼å…¥çš„Log.</p>
<blockquote>
<p>[Worker0] Start importing Assets/Script/UI/Core/PrimitiveBehaviour/IntEqualBehaviour.cs using Guid(ce9400962fc00544a89e0e69c863b84c) Importer(815301076,1909f56bfc062723c751e8b465ee728b) [Worker0]  -&gt; (artifact id: â€˜840ab621654cd480e1699784fa88cf93â€™) in 0.005725 seconds </p>
</blockquote>
<p>â€˜ce9400962fc00544a89e0e69c863b84câ€™ æ˜¯è¯¥è„šæœ¬ä½œä¸ºèµ„äº§çš„GUIDï¼Œå’Œmetaæ–‡ä»¶ä¸­çš„GUIDä¸€è‡´ã€‚<br>Importer(815301076,1909f56bfc062723c751e8b465ee728b) çŒœæµ‹ä¸ºæŒ‡å‘å€’å…¥è¯¥èµ„æºä½¿ç”¨çš„å¯¼å…¥å™¨ç±»å‹ï¼Œä»¥åŠè¯¥å¯¼å…¥å™¨ä½œä¸º Asset æ—¶å€™çš„GUIDã€‚</p>
<p>å¦‚ä¸‹ä»£ç ç”¨äºè¿½è¸ªæŸä¸ªèµ„äº§åœ¨ Artifacts ä¸­çš„é”®åå’Œä½ç½®ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> guidString = AssetDatabase.AssetPathToGUID(assetPath);</span><br><span class="line"><span class="keyword">string</span> hash = AssetDatabaseExperimental.GetArtifactHash(guidString);</span><br><span class="line">AssetDatabaseExperimental.GetArtifactPaths(hash, <span class="keyword">out</span> <span class="keyword">var</span> paths);</span><br></pre></td></tr></table></figure>
<h2 id="ç¼“å­˜æŸåå¤„ç†"><a href="#ç¼“å­˜æŸåå¤„ç†" class="headerlink" title="ç¼“å­˜æŸåå¤„ç†"></a>ç¼“å­˜æŸåå¤„ç†</h2><p>è¿™ä¸ªé—®é¢˜é€ æˆçš„åŸå› å¾ˆå¤šï¼Œä½†æ˜¯åŸºæœ¬å°±æ˜¯ Artifacts é‡Œçš„å…³äºèµ„äº§çš„ç¼“å­˜æ–‡ä»¶åäº†ã€‚å…¶è¡¨ç°å°±æ˜¯é‚£ä¸ªèµ„äº§çš„å›¾æ ‡å˜æˆç™½çº¸ï¼Œç„¶åæ— æ³•ä½¿ç”¨äº†ã€‚<br>ä½†æ˜¯æœ‰æ—¶å€™å¯¹ç€è¿™ä¸ªèµ„äº§ç‚¹å‡» Reimport å¹¶ä¸èƒ½è§£å†³é—®é¢˜ã€‚</p>
<p>æˆ‘è®¤ä¸ºæ­£ç¡®çš„æ€è·¯å°±æ˜¯æŠŠè¿™ä¸ªåçš„ç¼“å­˜æ€æ‰ï¼Œå†ç”Ÿæˆä¸€ä¸ªæ–°çš„</p>
<ol>
<li>åªæœ‰å‡ ä¸ªèµ„äº§çš„ç¼“å­˜åæ‰çš„æƒ…å†µï¼Œå¯ä»¥æŠŠè¿™å‡ ä¸ªèµ„äº§ä»é¡¹ç›®ä¸­æ‹¿å‡ºæ¥ã€‚åˆ·æ–°é¡¹ç›®ï¼Œå†æŠŠèµ„äº§æ”¾å›å»ï¼Œé‡æ–°ç”Ÿæˆç¼“å­˜ã€‚</li>
<li>æœ‰å¤šä¸ªèµ„äº§ç¼“å­˜çˆ†ç‚¸çš„æƒ…å†µï¼Œéœ€è¦å…ˆæ”¶é›†èµ„äº§åˆ—è¡¨ï¼Œç„¶åç”¨ä¸Šé¢çš„ä»£ç è¿½æº¯æ‰€æœ‰åæ‰çš„ç¼“å­˜å¹¶æ€æ‰ï¼Œå†é‡æ–°å¯¼å…¥è¿™äº›èµ„äº§ã€‚(åªæ˜¯çŒœæµ‹ï¼Œå¹¶æœªå®è·µè¿‡ã€‚å› ä¸ºè¿™ä¸ªæƒ…å†µå¾ˆå°‘è§ï¼Œæ„Ÿè§‰ä¸å¦‚ç›´æ¥æŠŠLibraryæ€äº†å…¨éƒ¨é‡åˆ·ä¸‹ç­åƒé¥­)</li>
</ol>
<h2 id="èµ„æ–™æ¥æº"><a href="#èµ„æ–™æ¥æº" class="headerlink" title="èµ„æ–™æ¥æº"></a>èµ„æ–™æ¥æº</h2><p><a href="https://uninomicon.com/library" target="_blank" rel="noopener">ç½‘ä¸Šæ‰¾åˆ°çš„æ´»çˆ¹</a></p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>Unity Inspector ç»˜åˆ¶éåºåˆ—åŒ–å­—æ®µ</title>
    <url>/2024/06/29/20240629-drawnonserializefields/</url>
    <content><![CDATA[<p>åœ¨MonoBehaviouré‡Œç»™å­—æ®µæ‰“ä¸Š <code>[SerializedField]</code> ç‰¹æ€§æ ‡è®°å³å¯æŠŠè¿™ä¸ªå­—æ®µæ˜¾ç¤ºåœ¨ Inspector ä¸Šï¼ŒåŒæ—¶è¿˜ä¼šæŠŠè¿™ä¸ªå­—æ®µåºåˆ—åŒ–åˆ°èµ„æºé‡Œã€‚<br>åœ¨å®é™…å¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œæœ‰äº›å­—æ®µæˆ‘ä»¬åªæ˜¯æƒ³ä» Inspector ä¸Šçœ‹åˆ°æ•°å€¼ä»¥æ–¹ä¾¿å·®é”™ï¼Œå¹¶ä¸æƒ³åºåˆ—åŒ–è¿™ä¸ªå­—æ®µ(æµªè´¹ç©ºé—´)ã€‚åœ¨ Unity å•†åŸé‡Œæœ‰ Odin Inspectorï¼Œ Naughty Attributes ä¹‹ç±»çš„ç¼–è¾‘å™¨æ‹“å±•æ’ä»¶å¯ä»¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>æœ€è¿‘åœ¨åº§çš„é¡¹ç›®é‡Œä½¿ç”¨äº† Mirror Networking å’Œ Naughty Attributesï¼Œä½†æ˜¯æˆ‘å‘ç° Naughty Attributes çš„ <code>[ShowInInspector]</code> æ²¡æ³•ç”¨åœ¨ <code>Mirror.NerworkBehaviour</code> ä¸Šã€‚åªèƒ½ç…§ç€ Naughty Attributes æºç é‡Œçš„æ–¹å¼æŠŠ <code>[ShowInInspector]</code> çš„åŠŸèƒ½ç»™ <code>Mirror.NerworkBehaviour</code> åœ¨å®ç°ä¸€æ¬¡ï¼Œäºæ˜¯æœ‰äº†ä»Šå¤©è¿™ç¯‡ç¬”è®°ã€‚</p>
<h1 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h1><p>ä¸ºä»€ä¹ˆ <code>Mirror.NerworkBehaviour</code> æ— æ³•ä½¿ç”¨å¦ä¸€ä¸ªç¼–è¾‘å™¨æ’ä»¶é‡Œçš„ <code>[ShowInInspector]</code> å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡æŸ¥çœ‹æºç å¾—çŸ¥ï¼Œ Naughty Attributes ç¼–å†™äº†ä¸€ä¸ªåº”ç”¨äº UnityObject çš„ Inspector ç¼–è¾‘å™¨è„šæœ¬ï¼Œç”¨äºåœ¨é‡Œé¢è°ƒç”¨è‡ªå·± Attibutes çš„ç›¸å…³ç»˜åˆ¶æ–¹æ³•ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºåº”ç”¨äºå­ç±»ã€‚è€Œ <code>Mirror.NerworkBehaviour</code> æ­£å¥½ä¹Ÿæœ‰ä¸€ä¸ªè‡ªå·±ä¸“æœ‰çš„ Inspector ç»˜åˆ¶è„šæœ¬ï¼Œå¹¶ä¸”è¦åº”ç”¨äºå­ç±»ã€‚æ‰€ä»¥ç»§æ‰¿ <code>Mirror.NerworkBehaviour</code> çš„è„šæœ¬å°±ä½¿ç”¨äº† Mirror å‡†å¤‡çš„ç¼–è¾‘å™¨ç»˜åˆ¶è„šæœ¬ï¼Œæ— æ³•å†ä½¿ç”¨ Naughty Attributesï¼Œè€Œé¡¹ç›®é‡Œå…¶ä»– MonoBehaviour è¿˜ä»ç„¶ä½¿ç”¨ Naughty Attributes çš„ç¼–è¾‘å™¨ç»˜åˆ¶ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">CanEditMultipleObjects]</span><br><span class="line">[<span class="meta">CustomEditor(typeof(UnityEngine.Object), true)</span>]</span><br><span class="line">public class NaughtyInspector : UnityEditor.Editor</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">CustomEditor(typeof(NetworkBehaviour), true)</span>]</span><br><span class="line">[<span class="meta">CanEditMultipleObjects</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">NetworkBehaviourInspector</span> : <span class="title">Editor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæˆ‘çš„æ€è·¯å¾ˆç®€å•:</p>
<ol>
<li>åœ¨ Mirror ä¸­ä¹Ÿå®šä¹‰ä¸€ä¸ª <code>[ShowInInspector]</code> ç±»ä¼¼çš„ç‰¹æ€§</li>
<li>åœ¨ <code>Mirror.NerworkBehaviour</code> çš„Inspectorç»˜åˆ¶è„šæœ¬ä¸­å¯¹ <code>[Mirror.TempShowInInspector]</code> è¿›è¡Œæ£€æµ‹, æ”¶é›†æœ‰æ­¤ç‰¹æ€§çš„å­—æ®µ</li>
<li>åœ¨ <code>Mirror.NerworkBehaviour</code> çš„InspectoråŸæœ¬çš„ç»˜åˆ¶æ–¹æ³•ç»“æŸåï¼Œå¯¹æœ‰ <code>[Mirror.TempShowInInspector]</code> ç‰¹æ€§çš„å­—æ®µè¿›è¡Œç»˜åˆ¶</li>
</ol>
<h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>ä¸ºäº†è®©ä»£ç çœ‹èµ·æ¥å¹²å‡€æ•´æ´ï¼Œä¸‹é¢æ”¾å‡ºçš„ä»£ç æ˜¯ç”¨äºåœ¨ç©ºçš„Unityå·¥ç¨‹ä¸­å®ç° <code>[ShowInInspector]</code>ã€‚</p>
<p>å…ˆå®šä¹‰ç‰¹æ€§</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Core</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TempShowInInspectorAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> IsReadonlyField &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="isReadonly"&gt;</span>If this field is readonly in inspector.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Set it to readonly would save some performance<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TempShowInInspectorAttribute</span>(<span class="params"><span class="keyword">bool</span> isReadonly = <span class="literal">true</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            IsReadonlyField = isReadonly;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åç¼–å†™ä¸€ä¸ª Helper ç±»ã€‚åœ¨è¿™ä¸ª Helper ç±»ä¸­ï¼Œè¦ç¼–å†™æ–¹æ³•è·å–ä¸€ä¸ª UnityObject ä¸­çš„å­—æ®µã€‚<br>åŒæ—¶è¿˜è¦ç¼–å†™æ–¹æ³•å»ç»˜åˆ¶å­—æ®µã€‚ç»˜åˆ¶å­—æ®µçš„å‡½æ•°éå¸¸åºå¤§ï¼Œç”±äºåœ¨å®é™…é¡¹ç›®ä¸­ä¼šæœ‰ Struct åµŒå¥—çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘å†™äº†ä¸€ä¸ªå¯ä»¥é€’å½’è°ƒç”¨çš„æ–¹æ³•ä»¥å¤„ç†åµŒå¥—ã€‚<br>ä½†æˆ‘åªæ˜¯ç²—æš´çš„è®¾ç½®äº†å…è®¸åµŒå¥—çš„å±‚æ•°ï¼Œå› ä¸ºæˆ‘è§‰å¾—å®é™…ä½¿ç”¨æƒ…å¢ƒä¸­æ˜¯ä¸å¤ªä¼šæœ‰å¤ªæ·±å±‚çš„åµŒå¥—äº†ï¼Œå› ä¸ºæ­¤ç±»æ•°æ®ä¸€èˆ¬éƒ½æ˜¯ä»é…ç½®è¡¨ä¸­æ‹¿åˆ°æˆ–è€…æ˜¯ä¸€äº›è¿è¡Œæ—¶çš„å‚æ•°ç»„åˆã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Core.Editor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">TempGUIHelper</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> DRAW_DEPTH_LIMIT = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DrawTempShowInInspectorField</span>(<span class="params">UnityObject target, FieldInfo field, <span class="keyword">bool</span> isReadonly = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">object</span> <span class="keyword">value</span> = field.GetValue(target);</span><br><span class="line">            <span class="keyword">string</span> niceVariableName = ObjectNames.NicifyVariableName(field.Name);</span><br><span class="line">            <span class="keyword">if</span> (field.IsStatic)</span><br><span class="line">            &#123;</span><br><span class="line">                niceVariableName = <span class="string">$"<span class="subst">&#123;niceVariableName&#125;</span>(static) "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == <span class="keyword">value</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// TODO @Hiko if field is a class pack, better to spawn one for it; But why do ppl make a data pack into class, it should just be struct;</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (TryDrawField(<span class="keyword">value</span>, niceVariableName, field.FieldType, <span class="number">0</span>, <span class="keyword">out</span> <span class="keyword">object</span> nextValueObject, <span class="keyword">out</span> <span class="keyword">bool</span> setNextValue, isReadonly))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (setNextValue &amp;&amp; !isReadonly)</span><br><span class="line">                &#123;</span><br><span class="line">                    field.SetValue(target, nextValueObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">TryDrawField</span>(<span class="params"><span class="keyword">object</span> <span class="keyword">value</span>, <span class="keyword">string</span> lable, Type expectedType, <span class="keyword">int</span> depth, <span class="keyword">out</span> <span class="keyword">object</span> nextValue, <span class="keyword">out</span> <span class="keyword">bool</span> setNextValue, <span class="keyword">bool</span> readonlyField = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            nextValue = <span class="literal">null</span>;</span><br><span class="line">            setNextValue = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">string</span> showLableName = lable;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> &lt; depth) <span class="comment">// HACK @Hiko pad left</span></span><br><span class="line">            &#123;</span><br><span class="line">                showLableName = lable.PadLeft(lable.Length + depth * <span class="number">4</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (depth &gt;= DRAW_DEPTH_LIMIT)</span><br><span class="line">            &#123;</span><br><span class="line">                EditorGUILayout.BeginVertical();</span><br><span class="line">                EditorGUILayout.LabelField(<span class="string">$"<span class="subst">&#123;showLableName&#125;</span>(OutOfDrawDepthLimit):"</span>);</span><br><span class="line">                <span class="keyword">string</span> tempContent = <span class="keyword">value</span>.ToString();</span><br><span class="line">                tempContent = tempContent.PadLeft(tempContent.Length + depth * <span class="number">4</span>);</span><br><span class="line">                EditorGUILayout.LabelField(tempContent);</span><br><span class="line">                EditorGUILayout.EndVertical();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUI.DisabledScope(disabled: readonlyField))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">bool</span> isDrawn = <span class="literal">true</span>;</span><br><span class="line">                Type valueType = Equals(<span class="keyword">value</span>, <span class="literal">null</span>) ? expectedType : <span class="keyword">value</span>.GetType();</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == valueType)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(<span class="keyword">bool</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">bool</span> prevBool = (<span class="keyword">bool</span>)<span class="keyword">value</span>;</span><br><span class="line">                    <span class="keyword">bool</span> nextBool = EditorGUILayout.Toggle(showLableName, prevBool);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevBool != nextBool)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextBool;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(<span class="keyword">short</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">short</span> prevShort = (<span class="keyword">short</span>)<span class="keyword">value</span>;</span><br><span class="line">                    <span class="keyword">short</span> nextShort = (<span class="keyword">short</span>)Mathf.Clamp(EditorGUILayout.IntField(showLableName, (<span class="keyword">int</span>)prevShort), <span class="keyword">short</span>.MinValue, <span class="keyword">short</span>.MaxValue); <span class="comment">// need clamp</span></span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevShort != nextShort)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextShort;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(<span class="keyword">ushort</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">ushort</span> prevUshort = (<span class="keyword">ushort</span>)<span class="keyword">value</span>;</span><br><span class="line">                    <span class="keyword">ushort</span> nextUshort = (<span class="keyword">ushort</span>)Mathf.Clamp(EditorGUILayout.IntField(showLableName, (<span class="keyword">ushort</span>)<span class="keyword">value</span>), <span class="keyword">ushort</span>.MinValue, <span class="keyword">ushort</span>.MaxValue); <span class="comment">// need clamp</span></span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevUshort != nextUshort)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextUshort;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(<span class="keyword">int</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">int</span> prevInt = (<span class="keyword">int</span>)<span class="keyword">value</span>;</span><br><span class="line">                    <span class="keyword">int</span> nextInt = EditorGUILayout.IntField(showLableName, prevInt);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevInt != nextInt)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextInt;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(<span class="keyword">uint</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">uint</span> prevUint = (<span class="keyword">uint</span>)<span class="keyword">value</span>;</span><br><span class="line">                    <span class="keyword">uint</span> nextUint = (<span class="keyword">uint</span>)Mathf.Clamp(EditorGUILayout.LongField(showLableName, prevUint), <span class="keyword">uint</span>.MinValue, <span class="keyword">uint</span>.MaxValue); <span class="comment">// need clamp</span></span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevUint != nextUint)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextUint;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(<span class="keyword">long</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">long</span> prevLong = (<span class="keyword">long</span>)<span class="keyword">value</span>;</span><br><span class="line">                    <span class="keyword">long</span> nextLong = EditorGUILayout.LongField(showLableName, prevLong);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevLong != nextLong)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextLong;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(<span class="keyword">ulong</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">ulong</span> prevUlong = (<span class="keyword">ulong</span>)<span class="keyword">value</span>;</span><br><span class="line">                    <span class="keyword">string</span> nextUlongStr = EditorGUILayout.TextField(showLableName, prevUlong.ToString());</span><br><span class="line">                    nextUlongStr = Regex.Replace(nextUlongStr, <span class="string">@"[^a-zA-Z0-9 ]"</span>, <span class="string">""</span>); <span class="comment">// force convert all to number</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">ulong</span>.TryParse(nextUlongStr, <span class="keyword">out</span> <span class="keyword">ulong</span> nextUlong) &amp;&amp; (setNextValue = prevUlong != nextUlong))</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextUlongStr;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(<span class="keyword">float</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">float</span> prevFloat = (<span class="keyword">float</span>)<span class="keyword">value</span>;</span><br><span class="line">                    <span class="keyword">float</span> nextFloat = EditorGUILayout.FloatField(showLableName, (<span class="keyword">float</span>)<span class="keyword">value</span>);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = !Mathf.Approximately(prevFloat, nextFloat))</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextFloat;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(<span class="keyword">double</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">double</span> prevDouble = (<span class="keyword">double</span>)<span class="keyword">value</span>;</span><br><span class="line">                    <span class="keyword">double</span> nextDouble = EditorGUILayout.DoubleField(showLableName, prevDouble);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevDouble != nextDouble)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextDouble;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(<span class="keyword">string</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">string</span> prevString = (<span class="keyword">string</span>)<span class="keyword">value</span>;</span><br><span class="line">                    <span class="keyword">string</span> nextString = EditorGUILayout.TextField(showLableName, prevString);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevString != nextString)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextString;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(Vector2))</span><br><span class="line">                &#123;</span><br><span class="line">                    Vector2 prevVector2 = (Vector2)<span class="keyword">value</span>;</span><br><span class="line">                    Vector2 nextVector2 = EditorGUILayout.Vector2Field(showLableName, prevVector2);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevVector2 != nextVector2)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = prevVector2;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(Vector3))</span><br><span class="line">                &#123;</span><br><span class="line">                    Vector3 prevVector3 = (Vector3)<span class="keyword">value</span>;</span><br><span class="line">                    Vector3 nextVector3 = EditorGUILayout.Vector3Field(showLableName, prevVector3);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevVector3 != nextVector3)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextVector3;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(Vector4))</span><br><span class="line">                &#123;</span><br><span class="line">                    Vector4 prevVector4 = (Vector4)<span class="keyword">value</span>;</span><br><span class="line">                    Vector4 nextVector4 = EditorGUILayout.Vector4Field(showLableName, prevVector4);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevVector4 != nextVector4)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextVector4;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(Vector2Int))</span><br><span class="line">                &#123;</span><br><span class="line">                    Vector2Int prevV2int = (Vector2Int)<span class="keyword">value</span>;</span><br><span class="line">                    Vector2Int nextV2int = EditorGUILayout.Vector2IntField(showLableName, prevV2int);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevV2int != nextV2int)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextV2int;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(Vector3Int))</span><br><span class="line">                &#123;</span><br><span class="line">                    Vector3Int prevV3int = (Vector3Int)<span class="keyword">value</span>;</span><br><span class="line">                    Vector3Int nextV3int = EditorGUILayout.Vector3IntField(showLableName, prevV3int);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevV3int != nextV3int)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextV3int;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(Color))</span><br><span class="line">                &#123;</span><br><span class="line">                    Color prevColor = (Color)<span class="keyword">value</span>;</span><br><span class="line">                    Color nextColor = EditorGUILayout.ColorField(showLableName, prevColor);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevColor != nextColor)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextColor;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(Bounds))</span><br><span class="line">                &#123;</span><br><span class="line">                    Bounds prevBounds = (Bounds)<span class="keyword">value</span>;</span><br><span class="line">                    Bounds nextBounds = EditorGUILayout.BoundsField(showLableName, prevBounds);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevBounds != nextBounds)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextBounds;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(Rect))</span><br><span class="line">                &#123;</span><br><span class="line">                    Rect prevRect = (Rect)<span class="keyword">value</span>;</span><br><span class="line">                    Rect nextRect = EditorGUILayout.RectField(showLableName, prevRect);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevRect != nextRect)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextRect;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType == <span class="keyword">typeof</span>(RectInt))</span><br><span class="line">                &#123;</span><br><span class="line">                    RectInt prevRectInt = (RectInt)<span class="keyword">value</span>;</span><br><span class="line">                    RectInt nextRectInt = EditorGUILayout.RectIntField(showLableName, prevRectInt);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = !prevRectInt.Equals(nextRectInt))</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextRectInt;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(UnityObject).IsAssignableFrom(valueType))</span><br><span class="line">                &#123;</span><br><span class="line">                    UnityObject prevUnityObj = (UnityObject)<span class="keyword">value</span>;</span><br><span class="line">                    UnityObject nextUnityObj = EditorGUILayout.ObjectField(showLableName, prevUnityObj, valueType, <span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevUnityObj != nextUnityObj)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextUnityObj;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType.BaseType == <span class="keyword">typeof</span>(Enum))</span><br><span class="line">                &#123;</span><br><span class="line">                    Enum prevEnum = (Enum)<span class="keyword">value</span>;</span><br><span class="line">                    Enum nextEnum = EditorGUILayout.EnumPopup(showLableName, prevEnum);</span><br><span class="line">                    <span class="keyword">if</span> (setNextValue = prevEnum != nextEnum)</span><br><span class="line">                    &#123;</span><br><span class="line">                        nextValue = nextEnum;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (valueType.BaseType == <span class="keyword">typeof</span>(TypeInfo))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">bool</span> tempPrev = GUI.enabled;</span><br><span class="line">                    GUI.enabled = tempPrev;</span><br><span class="line">                    EditorGUILayout.TextField(showLableName, <span class="keyword">value</span>.ToString());</span><br><span class="line">                    GUI.enabled = tempPrev;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// TODO @Hiko add fold/unfold to save some space</span></span><br><span class="line">                    <span class="keyword">bool</span> isSerializable = <span class="literal">null</span> != valueType.GetCustomAttribute&lt;SerializableAttribute&gt;(); <span class="comment">// check if target is Serializable.</span></span><br><span class="line">                    <span class="keyword">if</span> (isSerializable)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">object</span> structValueObject = <span class="keyword">value</span>;</span><br><span class="line">                        EditorGUILayout.LabelField(showLableName);</span><br><span class="line">                        FieldInfo[] members = valueType.GetFields();</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = members.Length; i &lt; length; i++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            FieldInfo memberInfo = members[i];</span><br><span class="line">                            <span class="keyword">if</span> (MemberTypes.Field == memberInfo.MemberType &amp;&amp; !memberInfo.IsStatic) <span class="comment">// I dun need static/const field</span></span><br><span class="line">                            &#123;</span><br><span class="line">                                Type fieldType = memberInfo.FieldType; <span class="comment">// better to pass this type in, cuz value could be null</span></span><br><span class="line">                                <span class="keyword">object</span> prevValueObj = memberInfo.GetValue(<span class="keyword">value</span>);</span><br><span class="line">                                <span class="keyword">if</span> (TryDrawField(prevValueObj, memberInfo.Name, fieldType, depth + <span class="number">1</span>, <span class="keyword">out</span> <span class="keyword">object</span> nextValueObj, <span class="keyword">out</span> <span class="keyword">bool</span> setNext, readonlyField))</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="keyword">if</span> (setNext)</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        setNextValue = <span class="literal">true</span>;</span><br><span class="line">                                        memberInfo.SetValue(structValueObject, nextValueObj);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                                isDrawn = <span class="literal">true</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        nextValue = structValueObject;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        EditorGUILayout.BeginVertical();</span><br><span class="line">                        EditorGUILayout.LabelField(<span class="string">$"<span class="subst">&#123;showLableName&#125;</span>(NonSupprtType/NonSerializable):"</span>);</span><br><span class="line">                        <span class="keyword">string</span> valueStr = <span class="keyword">value</span>.ToString();</span><br><span class="line">                        valueStr = valueStr.PadLeft(valueStr.Length + (depth + <span class="number">1</span>) * <span class="number">4</span>);</span><br><span class="line">                        EditorGUILayout.LabelField(valueStr);</span><br><span class="line">                        EditorGUILayout.EndVertical();</span><br><span class="line">                        isDrawn = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> isDrawn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IEnumerable&lt;FieldInfo&gt; <span class="title">GetAllFields</span>(<span class="params"><span class="keyword">object</span> target, Func&lt;FieldInfo, <span class="keyword">bool</span>&gt; predicate</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (target == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.LogError(<span class="string">"The target object is null. Check for missing scripts."</span>);</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List&lt;Type&gt; types = GetSelfAndBaseTypes(target);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = types.Count - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            &#123;</span><br><span class="line">                IEnumerable&lt;FieldInfo&gt; fieldInfos = types[i]</span><br><span class="line">                    .GetFields(BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.DeclaredOnly)</span><br><span class="line">                    .Where(predicate);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">var</span> fieldInfo <span class="keyword">in</span> fieldInfos)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">yield</span> <span class="keyword">return</span> fieldInfo;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Type&gt; <span class="title">GetSelfAndBaseTypes</span>(<span class="params"><span class="keyword">object</span> target</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            List&lt;Type&gt; types = <span class="keyword">new</span> List&lt;Type&gt;()</span><br><span class="line">            &#123;</span><br><span class="line">                target.GetType()</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (types.Last().BaseType != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                types.Add(types.Last().BaseType);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> types;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±æ˜¯ç¼–å†™ä¸€ä¸ª Inpector è„šæœ¬äº†ã€‚æœ€åä¸€æ­¥ï¼Œéå¸¸ç®€å•ã€‚åœ¨é»˜è®¤çš„ç»˜åˆ¶ä¹‹åå†ç»˜åˆ¶æˆ‘ä»¬æ•æ‰åˆ°çš„éœ€è¦ç»˜åˆ¶çš„éåºåˆ—åŒ–å­—æ®µã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Core.Editor</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">CanEditMultipleObjects</span>]</span><br><span class="line">    [<span class="meta">CustomEditor(typeof(UnityObject), true)</span>]</span><br><span class="line">    public class TempInspector : UnityEditor.Editor</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> IEnumerable&lt;FieldInfo&gt; m_nonSerializedFields;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_nonSerializedFields = TempGUIHelper.GetAllFields(target, f =&gt; f.GetCustomAttributes(<span class="keyword">typeof</span>(TempShowInInspectorAttribute), <span class="literal">true</span>).Length &gt; <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnInspectorGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            DrawDefaultInspector(); <span class="comment">// draw default, make sure old stuff works</span></span><br><span class="line">            DrawNonSerializeFileds();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">DrawNonSerializeFileds</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (m_nonSerializedFields.Any())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">var</span> field <span class="keyword">in</span> m_nonSerializedFields)</span><br><span class="line">                &#123;</span><br><span class="line">                    TempShowInInspectorAttribute fieldAttribute = field.GetCustomAttribute&lt;TempShowInInspectorAttribute&gt;();</span><br><span class="line">                    <span class="keyword">bool</span> isReadonlyField = <span class="literal">null</span> == fieldAttribute || fieldAttribute.IsReadonlyField || field.IsStatic; <span class="comment">// make static fields readonly cuz I just think we should not change them</span></span><br><span class="line">                    TempGUIHelper.DrawTempShowInInspectorField(serializedObject.targetObject, field, isReadonlyField);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2024/06/29/20240629-drawnonserializefields/20240629-drawnonserializefields-pic001.png" class="" title="split">
<h1 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h1><p>å…¶å®è¿™ä¸ªç»˜åˆ¶çš„åŠŸèƒ½æ˜¯æˆ‘æœ€å¼€å§‹å·¥ä½œçš„æ—¶å€™ä¸€ç›´å¥½å¥‡ä¸”æƒ³å»åšçš„ï¼Œé‚£ä¸ªæ—¶å€™ä¹Ÿä¸Šç½‘çœ‹äº†ä¸‹è®ºå›å¾ˆå¿«å°±æ˜ç™½äº†åšæ³•ï¼Œä½†æ˜¯å› ä¸ºé¡¹ç›®ç»„ä¹°äº† Odin æ‰€ä»¥å°±æ²¡å¿…è¦æˆ‘å†åšä¸€æ¬¡äº†ã€‚<br>æ²¡æƒ³åˆ°è¿™æ®µæ—¶é—´å´å› ä¸ºé¡¹ç›®ä¸­ä½¿ç”¨çš„ä¸¤ä¸ªæ’ä»¶å†²çªè€Œæœ‰è¿™ä¸ªæœºä¼šå»ä¾è‘«èŠ¦ç”»ç“¢å®ç°ä¸€æ¬¡è¿™ä¸ªåŠŸèƒ½ï¼Œè¿˜æŒºå¼€å¿ƒçš„ã€‚</p>
<p>P.S: Mirror è¿˜å®šä¹‰äº†ä¸€ä¸ª Attribute å«åš <code>[Mirror.ShowInInspector]</code>ï¼Œå®ƒçš„ç”¨å¤„æ˜¯å±•ç¤º <code>SyncList</code> é‡Œçš„å†…å®¹ã€‚ä½†æ˜¯ï¼Œå®ƒå±•ç¤º <code>SyncList</code> å†…å®¹çš„æ–¹æ³•æ˜¯æŠŠæ¯ä¸ªå…ƒç´ éƒ½ ToStingã€‚<br>è¿™ä¸ªå‘æˆ‘ä¹Ÿæ˜¯çœ‹äº†ä»–çš„ä»£ç æ‰çŸ¥é“ï¼Œæˆ‘ä¸€å¼€å§‹è¿˜è§‰å¾—å®ƒç”»ä¸å‡º <code>SyncList&lt;CustomType&gt;</code> æ˜¯æˆ‘è‡ªå·±çš„é—®é¢˜ï¼Œæéº»äº†ã€‚</p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>TextMeshPro ä½¿ç”¨ç¬”è®°+ç®€æ˜“å›¾é›†å·¥å…·</title>
    <url>/2025/06/22/20250622-tmpspriteassetpacker/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>äº¤äº’å¸Œæœ›èƒ½åœ¨ç•Œé¢ä¸Šæ¯”è¾ƒæ–¹ä¾¿çš„æ˜¾ç¤º <code>ğŸŒ*5</code> è¿™æ ·çš„æ•ˆæœã€‚å¥½åœ¨å½“å‰çš„é¡¹ç›®ä½¿ç”¨TMPï¼Œåªéœ€è¦æŠŠå›¾æ ‡æ‰“æˆä¸€ä¸ªèµ„æºèµ‹ç»™TMPæ–‡æœ¬ç»„ä»¶ï¼Œå°±å¯ä»¥åœ¨æ–‡æœ¬ä¸­æ˜¾ç¤ºå›¾æ ‡ã€‚</p>
<p>ä¸ºäº†è®©äº¤äº’ç­–åˆ’èƒ½å¤Ÿè‡ªè¡Œè°ƒæ•´å›¾æ ‡ä½¿ç”¨çš„èŒƒå›´ä»¥åŠè´¨é‡ï¼Œæˆ‘éšæ‰‹æ“äº†ä¸€ä¸ªå°é…ç½®æ¥åšåˆ°è¿™ä¸ªäº‹æƒ…ã€‚<br>å½“å‰æˆ‘ä»¬çš„ç¾æœ¯èµ„æºè¿˜æ²¡æœ‰åšè§„èŒƒæ•´ç†ï¼Œæ‰€ä»¥é¡¹ç›®ä¸­å­˜åœ¨ç€å°ºå¯¸ä¸ä¸€è‡´çš„å›¾æ ‡ï¼Œä½†å¯¹äºæ–‡æœ¬ä¸Šä½¿ç”¨çš„å›¾æ ‡æ¥è¯´ï¼Œå°ºå¯¸å¤§æ¦‚æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥å›¾é›†é‡Œçš„å›¾æ ‡å°ºå¯¸ä¹Ÿåº”è¯¥è¦å›ºå®šä¸‹æ¥ã€‚<br>æœ€æœ€å¼€å§‹çš„æ—¶å€™æƒ³çš„æ˜¯ç›´æ¥å†™ä¸€ä¸ªåŒçº¿æ€§é‡‡æ ·çº¿è·‘è·‘ï¼Œåšä¸ªå¯ä»¥ç”¨çš„ç¨‹åº¦ï¼Œä½†æ˜¯ä¸æ˜¯å› ä¸ºæˆ‘å¯¹éœ€æ±‚çš„æè¿°ä¸å¤ªå¥½ï¼Œé—®Copilotå¹¶æ²¡æœ‰ç»™å‡ºæˆ‘è¦çš„åšæ³•ï¼Œæˆ‘åˆæ‡’å¾—è‡ªå·±å†™(å…¶å®æ˜¯åŠ ç­åŠ å‚»äº†ï¼Œç”¨<code>Texture2D.GetPixelBilinear()</code>å¯ä»¥)ï¼Œäºæ˜¯åˆå¼€è°·æ­Œæœä¸€ä¸‹ï¼Œå¾ˆå¿«å°±åœ¨è®ºå›é‡Œæ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„åšæ³•ã€‚</p>
<p>è¿™ä¸ªæ€è·¯æ˜¯è¿™æ ·çš„:<br>1 ä»¥æˆ‘ä»¬ç¼©æ”¾çš„ç›®æ ‡å°ºå¯¸åˆ›å»ºRTï¼Œä½œä¸ºæ¸²æŸ“ç›®æ ‡<br>2 æŠŠéœ€è¦ç¼©æ”¾çš„è´´å›¾ç”¨è¿™ä¸ªRTæ¸²æŸ“ä¸€æ¬¡<br>3 æ–°çš„è´´å›¾ç›´æ¥ä»æ¸²æŸ“ç»“æœä¸­å–è‰²<br>4 éå¸¸æ–¹ä¾¿ï¼Œè€Œä¸”æ¸²æŸ“æ—¶å¯ä»¥æŒ‡å®šè´´å›¾filteræ¨¡å¼ï¼Œä¾¿äºå¾—åˆ°è´¨é‡OKçš„å›¾å›¾</p>
<p>è¿™äº›å…¶å®éƒ½ä¸éš¾ï¼Œä¸œè¥¿äº¤æ‰‹ç»™äº¤äº’é‚£è¾¹ä»¥åæ‰å‘ç°ä¸€ä¸ªçœŸæ­£çš„éš¾é¢˜ï¼Œé‚£å°±æ˜¯è¦æ•™ä¼šä»–ä»¬å¦‚ä½•å»è°ƒæ•´è¿™ä¸ªå›¾æ ‡åœ¨æ–‡æœ¬é‡Œçš„å¯¹å…¶æ–¹å¼å’Œå°ºå¯¸ã€‚<br>è¿™éƒ¨åˆ†å·¥ä½œä»¥å‰æ˜¯å¯¼å¸ˆåšçš„ï¼Œæ²¡æƒ³åˆ°ç°åœ¨ä¹Ÿè½®åˆ°æˆ‘äº†ï¼Œå¿«é€ŸæŸ¥é˜…èµ„æ–™åï¼Œç®—æ˜¯å¤§æ¦‚æ˜ç™½äº†ã€‚</p>
<h1 id="å›¾æ ‡åœ¨æ–‡æœ¬ä¸­çš„æ˜¾ç¤ºä¸å¯¹å…¶"><a href="#å›¾æ ‡åœ¨æ–‡æœ¬ä¸­çš„æ˜¾ç¤ºä¸å¯¹å…¶" class="headerlink" title="å›¾æ ‡åœ¨æ–‡æœ¬ä¸­çš„æ˜¾ç¤ºä¸å¯¹å…¶"></a>å›¾æ ‡åœ¨æ–‡æœ¬ä¸­çš„æ˜¾ç¤ºä¸å¯¹å…¶</h1><p>æˆ‘æ¯”è¾ƒå·æ‡’ï¼Œæ²¡æœ‰æ‰¾åˆ°å®˜ä¸­çš„è§£è¯´ï¼Œæ‰€ä»¥ç”¨è‡ªå·±çš„è¯æ¥å¤§æ¦‚æè¿°ä¸€ä¸‹ï¼Œå¯èƒ½ä¼šæœ‰é”™ï¼Œä½†æ˜¯èƒ½å¤Ÿå¤§æ¦‚è®²æ˜å¦‚ä½•è°ƒæ•´(è¿™éƒ¨åˆ†ç¬”è®°æˆ‘ä¼šåŒæ­¥åˆ°é¡¹ç›®çš„ç¬”è®°ä¸­ç»™äº¤äº’åŒå­¦çœ‹)ã€‚</p>
<h2 id="åŸºå‡†çº¿"><a href="#åŸºå‡†çº¿" class="headerlink" title="åŸºå‡†çº¿"></a>åŸºå‡†çº¿</h2><p>ä»»ä½•çš„å­—å½¢ï¼Œå›¾æ ‡ï¼Œå¯¹äºTMPæ¥è¯´ï¼Œéƒ½æ˜¯ä¸€å°å—ç½‘æ ¼ã€‚æ‰€ä»¥ä»–ä»¬çš„æ‘†æ”¾çš„æ–¹å¼éƒ½æ˜¯ä¸€è‡´çš„ã€‚<br>TMPä½¿ç”¨æ–‡æœ¬â€œåŸºå‡†çº¿(baseline)â€æ¥ä½œä¸ºå­—å½¢(ä¹ŸåŒ…æ‹¬å›¾æ ‡ï¼Œåé¢å°±ä¸å¤šåŒºåˆ†äº†)æ‘†æ”¾ä½ç½®çš„å‚ç…§ã€‚åŸºå‡†çº¿å¯ä»¥è®¤ä¸ºæ˜¯ä¸ªæ¡Œé¢ï¼Œå¤§å¤šæ•°ä¸œè¥¿éƒ½åº”è¯¥â€œæ”¾åœ¨â€æ¡Œé¢ä¸Šã€‚<br>å½“ç„¶ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯æ‰€æœ‰çš„å­—å½¢éƒ½ä¼šå¾ˆåˆšå¥½çš„åº•éƒ¨ç´§è´´åŸºå‡†çº¿ã€‚</p>
<img src="/2025/06/22/20250622-tmpspriteassetpacker/20250622-pic001.png" class="" title="split">
<p>ä»¥è¿™å¼ å›¾ä¸ºä¾‹ï¼Œèƒ½å¾ˆæ˜æ˜¾çœ‹åˆ°æ–‡æœ¬ä»¥åŠå›¾æ ‡ä¸‹æ–¹æœ‰ä¸€æ¡çº¿ï¼Œè¿™ä¸ªå°±æ˜¯åŸºå‡†çº¿ã€‚é™¤äº†åŸºå‡†çº¿ä»¥å¤–ï¼Œè¿˜æœ‰ä¸Šå‡çº¿(ascentline)å’Œä¸‹é™çº¿(descentline)ã€‚<br>å¯ä»¥ç²—ç•¥çš„è®¤ä¸ºï¼Œä¸Šå‡çº¿å¯ä»¥ç²—ç•¥è®¤ä¸ºæ˜¯å­—å½¢å¯ä»¥è¾¾åˆ°çš„æœ€é«˜ç‚¹ï¼Œä¸‹é™çº¿æ˜¯å¯ä»¥è¾¾åˆ°çš„æœ€ä½ç‚¹ã€‚</p>
<h2 id="FaceInfo"><a href="#FaceInfo" class="headerlink" title="FaceInfo"></a>FaceInfo</h2><img src="/2025/06/22/20250622-tmpspriteassetpacker/20250622-pic002.png" class="" title="split">
<p>FaceInfo çš„ä½œç”¨å°±æ˜¯å‘ŠçŸ¥ä¸€äº›ç”¨äºè®¡ç®—å­—å½¢çš„åº¦é‡å€¼ã€‚<br>å…¶ä¸­æ¯”è¾ƒé‡è¦çš„å±æ€§ï¼š</p>
<ul>
<li>PointSize å‘ŠçŸ¥ç”¨äºé‡‡æ ·å›¾æ ‡çš„å°ºå¯¸(åªæœ‰è¿™ä¸ªæ•°å€¼æœ‰æ•ˆæ—¶ï¼Œå…¶å®ƒå±æ€§å€¼æ‰æœ‰æ•ˆ)</li>
<li>BaseLine ç”¨äºä¿®æ”¹å›¾æ ‡å®é™…çš„baseline</li>
</ul>
<p>é€šè¿‡ä»¥ä¸‹çš„ä»£ç å¯ä»¥çŸ¥é“ï¼Œå½“pointSizeæœªè¢«æ­£ç¡®è®¾ç½®æ—¶ï¼ŒTMPç»„ä»¶ä¼šé‡‡ç”¨å½“å‰æ–‡æœ¬ç»„ä»¶å­—ä½“é…ç½®é‡Œçš„PointSizeæ¥è®¡ç®—å›¾æ ‡æ˜¾ç¤ºçš„å¤§å°ã€‚<br>ä¸ºäº†å›¾æ ‡æ˜¾ç¤ºçš„è´¨é‡ä»¥åŠæ–¹ä¾¿åç»­çš„è°ƒæ•´ï¼Œæˆ‘å¼ºçƒˆå»ºè®®å¡«å†™FaceInfoã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (m_currentSpriteAsset.m_FaceInfo.pointSize &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> spriteScale = m_currentFontSize / m_currentSpriteAsset.m_FaceInfo.pointSize * m_currentSpriteAsset.m_FaceInfo.scale * (m_isOrthographic ? <span class="number">1</span> : <span class="number">0.1f</span>);</span><br><span class="line">    currentElementScale = sprite.m_Scale * sprite.m_Glyph.scale * spriteScale;</span><br><span class="line">    elementAscentLine = m_currentSpriteAsset.m_FaceInfo.ascentLine;</span><br><span class="line">    baselineOffset = m_currentSpriteAsset.m_FaceInfo.baseline * fontScale * m_fontScaleMultiplier * m_currentSpriteAsset.m_FaceInfo.scale;</span><br><span class="line">    elementDescentLine = m_currentSpriteAsset.m_FaceInfo.descentLine;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> spriteScale = m_currentFontSize / m_currentFontAsset.m_FaceInfo.pointSize * m_currentFontAsset.m_FaceInfo.scale * (m_isOrthographic ? <span class="number">1</span> : <span class="number">0.1f</span>);</span><br><span class="line">    currentElementScale = m_currentFontAsset.m_FaceInfo.ascentLine / sprite.m_Glyph.metrics.height * sprite.m_Scale * sprite.m_Glyph.scale * spriteScale;</span><br><span class="line">    <span class="keyword">float</span> scaleDelta = spriteScale / currentElementScale;</span><br><span class="line">    elementAscentLine = m_currentFontAsset.m_FaceInfo.ascentLine * scaleDelta;</span><br><span class="line">    baselineOffset = m_currentFontAsset.m_FaceInfo.baseline * fontScale * m_fontScaleMultiplier * m_currentFontAsset.m_FaceInfo.scale;</span><br><span class="line">    elementDescentLine = m_currentFontAsset.m_FaceInfo.descentLine * scaleDelta;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å­—å½¢å±æ€§"><a href="#å­—å½¢å±æ€§" class="headerlink" title="å­—å½¢å±æ€§"></a>å­—å½¢å±æ€§</h2><img src="/2025/06/22/20250622-tmpspriteassetpacker/20250622-pic003.png" class="" title="split">
<p>å­—å½¢çš„æœ¬è´¨ä¹Ÿå¯ä»¥ç²—ç•¥åœ°è®¤ä¸ºå°±æ˜¯ä¸€å¼ å›¾(è´´å›¾ä¸Šçš„æŸä¸€å—)ã€‚<br>æ‰€ä»¥å…¶å±æ€§å¤§æ¦‚åŒ…æ‹¬ä»¥ä¸‹åœ°ä¿¡æ¯ï¼š</p>
<ul>
<li>å¦‚ä½•åœ¨è‡ªè¡Œè´´å›¾ä¸­è·å–è¿™ä¸€å—å›¾</li>
<li>å­—å½¢çš„å¸ƒå±€åº¦é‡ï¼Œå…³ç³»ç€æ˜¾ç¤ºçš„å°ºå¯¸(å¹¶ä¸æ˜¯è´´å›¾ä¸­é‚£ä¸€å—çš„å¤§å°ï¼ï¼ï¼)</li>
<li>é¢å¤–æ–¹ä½å‚æ•°(BX,BY,ADV)ï¼Œå…³ç³»ç€å­—å½¢åœ¨æ–‡æœ¬ä¸­æ’å¸ƒæ—¶çš„å°ºå¯¸å’Œç©ºé—´</li>
</ul>
<h2 id="å›¾æ ‡çš„æ‘†æ”¾"><a href="#å›¾æ ‡çš„æ‘†æ”¾" class="headerlink" title="å›¾æ ‡çš„æ‘†æ”¾"></a>å›¾æ ‡çš„æ‘†æ”¾</h2><img src="/2025/06/22/20250622-tmpspriteassetpacker/20250622-pic004.png" class="" title="split">
<p>æœ€åå°±æ˜¯å®é™…å›¾æ ‡åœ°æ‘†æ”¾äº†ï¼Œè¿˜è¦äº†è§£çš„ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯æ¢è½´ç‚¹(pivot)ï¼Œè¿™ä¸ªæ˜¯å›¾æ ‡æ‘†æ”¾çš„å…³é”®ã€‚<br>æ¢è½´ä½ç½®å®šä¹‰äº†å›¾æ ‡çš„åŸç‚¹ã€‚å­—å½¢æ˜¾ç¤ºæ—¶ï¼Œåœ¨å‚ç›´ä¸ºä½ç½®ä¼šæŠŠæ¢è½´ç¨³æ”¾åœ¨åŸºå‡†çº¿çš„é«˜åº¦ä¸Šï¼Œåœ¨æ°´å¹³ä½ç½®ä¸Šåˆ™æ˜¯æ”¾åœ¨ å‰ä¸€ä¸ª å­—å½¢å®šä¹‰çš„å°¾éƒ¨ã€‚<br>æˆ‘å¼ºçƒˆå»ºè®®æŠŠå›¾æ ‡çš„æ¢è½´ç‚¹è®¾ç½®ä¸ºå·¦ä¸‹è§’ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿è°ƒæ•´ã€‚</p>
<p>ç„¶åè¿™é‡Œå°±å‘ç”Ÿäº†æˆ‘ä»¬æœ€ç»ˆä¼šé‡åˆ°çš„é—®é¢˜äº†ã€‚å›¾æ ‡å¾€å¾€çœ‹èµ·æ¥æ²¡æœ‰å±…ä¸­ã€‚<br>è¿™ä¸ªæ—¶å€™ï¼Œç»“åˆä¸Šé¢çš„ä¿¡æ¯æˆ‘ä»¬çŸ¥é“ï¼Œå›¾æ ‡æ‹œè®¿æ—¶ä¼šæŠŠè½´æ¢ç‚¹æ”¾åœ¨åŸºå‡†çº¿ä¸Šï¼ŒæŠŠè½´æ¢ç‚¹è®¾ä¸ºå·¦ä¸‹è§’ï¼Œå›¾æ ‡çš„åº•éƒ¨å°±ä¼šåœ¨åŸºå‡†çº¿ä¸Šã€‚<br>ä¸ºäº†è®©å›¾æ ‡å±…ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨FaceInfoä¸­ç›´æ¥è°ƒæ•´è¯¥å›¾æ ‡é›†çš„åŸºå‡†çº¿åç§»ï¼Œåˆæˆ–æ˜¯åœ¨å­—å½¢è¡¨åº•éƒ¨çš„å…¨å±€åç§»è¾“å…¥æ¡†ä¸­è°ƒæ•´Yåç§»è®©å…¶ç›´æ¥æŠŠåç§»å€¼åº”ç”¨åˆ°æ¯ä¸€ä¸ªå›¾æ ‡å­—å½¢ä¸Šã€‚</p>
<h1 id="å›¾é›†ç”Ÿæˆä»£ç "><a href="#å›¾é›†ç”Ÿæˆä»£ç " class="headerlink" title="å›¾é›†ç”Ÿæˆä»£ç "></a>å›¾é›†ç”Ÿæˆä»£ç </h1><p>æœ€åå°±æ˜¯ä»£ç äº†ï¼Œä¸å¤ªå®Œæ•´ï¼Œå‡‘åˆèƒ½ç”¨å§</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">UI.Editor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span> A shortcut to creatre TMP sprite asset <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TextMeshProIconPacker</span> : <span class="title">ScriptableObject</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Result Config"</span>)</span>]</span><br><span class="line">        [<span class="meta">SerializeField,</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">string</span> _textureOutPutName = <span class="string">"TempIconAtlas"</span>;</span><br><span class="line">        [<span class="meta">SerializeField,</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">string</span> m_spawnedAtlasPath;</span><br><span class="line">        [<span class="meta">SerializeField,</span>]</span><br><span class="line">        <span class="keyword">private</span> TMP_SpriteAsset m_target;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Header(<span class="meta-string">"Sprite Pack"</span>)</span>]</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> Sprite[] _spriteToPack;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> _maxSize = <span class="number">512</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> _iconSize = <span class="number">64</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> _padding = <span class="number">2</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">float</span> _iconScale = <span class="number">1.2f</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">SerializeField</span>]</span><br><span class="line">        <span class="keyword">private</span> SpriteRect[] m_spriteRects;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">MenuItem(<span class="meta-string">"Assets/UI/CreateTMPSpriteConfigTemplate"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InternalCreateTestAsset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            TextMeshProIconPacker asset = ScriptableObject.CreateInstance&lt;TextMeshProIconPacker&gt;();</span><br><span class="line">            <span class="comment">// TODO Change this path</span></span><br><span class="line">            <span class="keyword">string</span> assetPath = <span class="string">"Assets/TMPSpriteConfig/TMPSpriteConfigTemplate.asset"</span>;</span><br><span class="line">            UnityEditor.AssetDatabase.CreateAsset(asset, assetPath);</span><br><span class="line">            UnityEditor.AssetDatabase.SaveAssets();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"Create Sprite Atlas"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PackSpritesForTMP_EditorOnly</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == _spriteToPack || <span class="number">0</span> == _spriteToPack.Length)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// grab all sprite as textures</span></span><br><span class="line">            Texture2D[] sourceTextures = GatherTextures();</span><br><span class="line">            FixImportSettings(sourceTextures, <span class="literal">true</span>);</span><br><span class="line">            Texture2D[] texture2Pack = GetAdjustedT2D(sourceTextures);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// create sprite rects for atlas</span></span><br><span class="line">            Texture2D texture = <span class="keyword">new</span> Texture2D(_maxSize, _maxSize, TextureFormat.RGBA32, <span class="literal">false</span>);</span><br><span class="line">            Rect[] rects = texture.PackTextures(texture2Pack, _padding, _maxSize);</span><br><span class="line">            m_spriteRects = <span class="keyword">new</span> SpriteRect[rects.Length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rects.Length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                m_spriteRects[i] = <span class="keyword">new</span> SpriteRect()</span><br><span class="line">                &#123;</span><br><span class="line">                    name = texture2Pack[i].name,</span><br><span class="line">                    spriteID = GUID.Generate(),</span><br><span class="line">                    rect = ConvertToPixelRect(texture.width, texture.height, rects[i]),</span><br><span class="line">                    alignment = SpriteAlignment.BottomLeft, <span class="comment">// it's fine to put it here, cuz we gonna manulla adjust it later :D</span></span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            EditorUtility.SetDirty(<span class="keyword">this</span>);</span><br><span class="line">            AssetDatabase.SaveAssetIfDirty(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> path = AssetDatabase.GetAssetPath(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">string</span> folderPath = Path.GetDirectoryName(path);</span><br><span class="line">            <span class="keyword">string</span> pngPath = <span class="string">$"<span class="subst">&#123;folderPath&#125;</span>/<span class="subst">&#123;_textureOutPutName&#125;</span>Atlas.png"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// save sprite atlas</span></span><br><span class="line">            Texture2D decopmpresseTex = DeCompress(texture);</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = decopmpresseTex.EncodeToPNG();</span><br><span class="line">            File.WriteAllBytes(pngPath, bytes);</span><br><span class="line">            <span class="keyword">int</span> temp = name.Length + <span class="number">6</span>;</span><br><span class="line">            m_spawnedAtlasPath = path.Substring(<span class="number">0</span>, path.Length - temp) + <span class="string">$"<span class="subst">&#123;_textureOutPutName&#125;</span>Atlas.png"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// revert sprite readable</span></span><br><span class="line">            FixImportSettings(sourceTextures, <span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = texture2Pack.Length; i &lt; length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Texture.DestroyImmediate(texture2Pack[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            texture2Pack = <span class="literal">null</span>;</span><br><span class="line">            AssetDatabase.Refresh();</span><br><span class="line"></span><br><span class="line">            TextureImporter textureImporter = AssetImporter.GetAtPath(pngPath) <span class="keyword">as</span> TextureImporter;</span><br><span class="line">            textureImporter.textureType = TextureImporterType.Sprite;</span><br><span class="line">            textureImporter.spriteImportMode = SpriteImportMode.Multiple;</span><br><span class="line">            textureImporter.SaveAndReimport();</span><br><span class="line"></span><br><span class="line">            textureImporter = AssetImporter.GetAtPath(pngPath) <span class="keyword">as</span> TextureImporter;</span><br><span class="line">            SpriteDataProviderFactories factory = <span class="keyword">new</span>();</span><br><span class="line">            factory.Init();</span><br><span class="line">            ISpriteEditorDataProvider dataProvider = factory.GetSpriteEditorDataProviderFromObject(textureImporter);</span><br><span class="line">            dataProvider.InitSpriteEditorDataProvider();</span><br><span class="line">            dataProvider.SetSpriteRects(m_spriteRects);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Note: This section is only for Unity 2021.2 and newer</span></span><br><span class="line">            <span class="comment">// Register the new Sprite Rect's name and GUID with the ISpriteNameFileIdDataProvider</span></span><br><span class="line">            ISpriteNameFileIdDataProvider spriteNameFileIdDataProvider = dataProvider.GetDataProvider&lt;ISpriteNameFileIdDataProvider&gt;();</span><br><span class="line">            List&lt;SpriteNameFileIdPair&gt; nameFileIdPairs = spriteNameFileIdDataProvider.GetNameFileIdPairs().ToList();</span><br><span class="line">            nameFileIdPairs.AddRange(m_spriteRects.Select(spriteRect =&gt; <span class="keyword">new</span> SpriteNameFileIdPair(spriteRect.name, spriteRect.spriteID)));</span><br><span class="line">            spriteNameFileIdDataProvider.SetNameFileIdPairs(nameFileIdPairs);</span><br><span class="line"></span><br><span class="line">            dataProvider.Apply();</span><br><span class="line">            textureImporter.SaveAndReimport();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"Generate asset by sprite atlas"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ApplyAtlasToAsset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">string</span> path = AssetDatabase.GetAssetPath(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">string</span> folderPath = Path.GetDirectoryName(path);</span><br><span class="line">            <span class="keyword">string</span> pngPath = <span class="string">$"<span class="subst">&#123;folderPath&#125;</span>/<span class="subst">&#123;_textureOutPutName&#125;</span>Atlas.png"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == m_target)</span><br><span class="line">            &#123;</span><br><span class="line">                m_target = ScriptableObject.CreateInstance&lt;TMP_SpriteAsset&gt;();</span><br><span class="line">                m_target.name = _textureOutPutName;</span><br><span class="line">                m_target.spriteInfoList = <span class="keyword">new</span>();</span><br><span class="line">                AssetDatabase.CreateAsset(m_target, <span class="string">$"<span class="subst">&#123;folderPath&#125;</span>/<span class="subst">&#123;_textureOutPutName&#125;</span>.asset"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// seens like we dun need to destroy it</span></span><br><span class="line">                <span class="comment">//Material matToDestroy = m_target.material;</span></span><br><span class="line">                <span class="comment">//m_target.material = null;</span></span><br><span class="line">                <span class="comment">//Material.DestroyImmediate(matToDestroy);</span></span><br><span class="line">            &#125;</span><br><span class="line">            m_target.spriteSheet = AssetDatabase.LoadAssetAtPath&lt;Texture2D&gt;(pngPath);</span><br><span class="line">            AddDefaultMaterial(m_target);</span><br><span class="line"></span><br><span class="line">            Type hackType = <span class="keyword">typeof</span>(TMP_SpriteAssetMenu);</span><br><span class="line">            MethodInfo[] hackMethods = hackType.GetMethods(BindingFlags.NonPublic | BindingFlags.Static);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = hackMethods.Length; i &lt; length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                MethodInfo hackMethod = hackMethods[i];</span><br><span class="line">                ParameterInfo[] paramInfos = hackMethod.GetParameters();</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">1</span> == paramInfos.Length &amp;&amp; <span class="keyword">typeof</span>(TMP_SpriteAsset) == paramInfos[<span class="number">0</span>].ParameterType)</span><br><span class="line">                &#123;</span><br><span class="line">                    hackMethod.Invoke(<span class="literal">null</span>, <span class="keyword">new</span> <span class="keyword">object</span>[] &#123; m_target &#125;); <span class="comment">// actually this wont work, I have to manully press "Update info" on the TextMeshProSpriteAsset :D</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List&lt;TMP_SpriteCharacter&gt; characters = m_target.spriteCharacterTable;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = characters.Count; i &lt; length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                TMP_SpriteCharacter character = characters[i];</span><br><span class="line">                character.scale = _iconScale;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            EditorUtility.SetDirty(m_target);</span><br><span class="line">            AssetDatabase.SaveAssetIfDirty(m_target);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">ContextMenu(<span class="meta-string">"Clear result"</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Clear</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != m_target)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">string</span> taragetath = AssetDatabase.GetAssetPath(m_target);</span><br><span class="line">                AssetDatabase.DeleteAsset(taragetath);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrEmpty(m_spawnedAtlasPath))</span><br><span class="line">            &#123;</span><br><span class="line">                AssetDatabase.DeleteAsset(m_spawnedAtlasPath);</span><br><span class="line">            &#125;</span><br><span class="line">            m_target = <span class="literal">null</span>;</span><br><span class="line">            m_spawnedAtlasPath = <span class="keyword">string</span>.Empty;</span><br><span class="line">            m_spriteRects = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Texture2D[] <span class="title">GatherTextures</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            List&lt;Texture2D&gt; resultTexture = <span class="keyword">new</span> List&lt;Texture2D&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = _spriteToPack.Length; i &lt; length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Sprite existSprite = _spriteToPack[i];</span><br><span class="line">                <span class="keyword">string</span> assetPath = AssetDatabase.GetAssetPath(existSprite);</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(assetPath))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Texture2D loadedT2D = AssetDatabase.LoadAssetAtPath&lt;Texture2D&gt;(assetPath);</span><br><span class="line">                resultTexture.Add(loadedT2D);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> resultTexture.ToArray();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FixImportSettings</span>(<span class="params">Texture2D[] textures, <span class="keyword">bool</span> readable</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = textures.Length; i &lt; length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Texture2D texture = textures[i];</span><br><span class="line">                <span class="keyword">string</span> path = AssetDatabase.GetAssetPath(texture);</span><br><span class="line">                TextureImporter importer = AssetImporter.GetAtPath(path) <span class="keyword">as</span> TextureImporter;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (importer == <span class="literal">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">                importer.isReadable = readable;</span><br><span class="line">                importer.SaveAndReimport();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Rect <span class="title">ConvertToPixelRect</span>(<span class="params"><span class="keyword">int</span> width, <span class="keyword">int</span> height, Rect uvRect</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">float</span> pixelLeft = uvRect.x * width;</span><br><span class="line">            <span class="keyword">float</span> pixelTop = uvRect.y * height;</span><br><span class="line">            <span class="keyword">float</span> pixelWidth = uvRect.width * width;</span><br><span class="line">            <span class="keyword">float</span> pixelHeight = uvRect.height * height;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Rect(pixelLeft, pixelTop, pixelWidth, pixelHeight);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Texture2D <span class="title">DeCompress</span>(<span class="params">Texture2D source</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            RenderTexture renderTex = RenderTexture.GetTemporary(</span><br><span class="line">                source.width,</span><br><span class="line">                source.height,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                RenderTextureFormat.Default,</span><br><span class="line">                RenderTextureReadWrite.Linear);</span><br><span class="line"></span><br><span class="line">            Graphics.Blit(source, renderTex);</span><br><span class="line">            RenderTexture previous = RenderTexture.active;</span><br><span class="line">            RenderTexture.active = renderTex;</span><br><span class="line">            Texture2D readableText = <span class="keyword">new</span> Texture2D(source.width, source.height);</span><br><span class="line">            readableText.ReadPixels(<span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, renderTex.width, renderTex.height), <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            readableText.Apply();</span><br><span class="line">            RenderTexture.active = previous;</span><br><span class="line">            RenderTexture.ReleaseTemporary(renderTex);</span><br><span class="line">            <span class="keyword">return</span> readableText;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddDefaultMaterial</span>(<span class="params">TMP_SpriteAsset spriteAsset</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Shader shader = Shader.Find(<span class="string">"TextMeshPro/Sprite"</span>);</span><br><span class="line">            Material material = <span class="keyword">new</span> Material(shader);</span><br><span class="line">            material.SetTexture(ShaderUtilities.ID_MainTex, spriteAsset.spriteSheet);</span><br><span class="line"></span><br><span class="line">            spriteAsset.material = material;</span><br><span class="line">            material.hideFlags = HideFlags.HideInHierarchy;</span><br><span class="line">            AssetDatabase.AddObjectToAsset(material, spriteAsset);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Texture2D[] <span class="title">GetAdjustedT2D</span>(<span class="params">Texture2D[] source</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Texture2D[] result = <span class="keyword">new</span> Texture2D[source.Length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = source.Length; i &lt; length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Texture2D after = GPUTextureScaler.GetScaledResult(source[i], _iconSize, _iconSize);</span><br><span class="line">                result[i] = after;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// from https://discussions.unity.com/t/how-to-resize-scale-down-texture-without-losing-quality/810223/14</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GPUTextureScaler</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Returns a scaled copy of given texture.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="tex"&gt;</span>Source texure to scale<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="width"&gt;</span>Destination texture width<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="height"&gt;</span>Destination texture height<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="mode"&gt;</span>Filtering mode<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Texture2D <span class="title">GetScaledResult</span>(<span class="params">Texture2D src, <span class="keyword">int</span> width, <span class="keyword">int</span> height, FilterMode mode = FilterMode.Trilinear</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Rect texR = <span class="keyword">new</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">            DoGPUScale(src, width, height, mode);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Get rendered data back to a new texture</span></span><br><span class="line">            Texture2D result = <span class="keyword">new</span>(width, height, TextureFormat.ARGB32, <span class="literal">true</span>);</span><br><span class="line">            result.Reinitialize(width, height);</span><br><span class="line">            result.ReadPixels(texR, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">            result.name = src.name;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Scales the texture data of the given texture.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="tex"&gt;</span>Texure to scale<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="width"&gt;</span>New width<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="height"&gt;</span>New height<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="mode"&gt;</span>Filtering mode<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Scale</span>(<span class="params">Texture2D tex, <span class="keyword">int</span> width, <span class="keyword">int</span> height, FilterMode mode = FilterMode.Trilinear</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Rect texR = <span class="keyword">new</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">            DoGPUScale(tex, width, height, mode);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Update new texture</span></span><br><span class="line">            tex.Reinitialize(width, height);</span><br><span class="line">            tex.ReadPixels(texR, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">true</span>);</span><br><span class="line">            tex.Apply(<span class="literal">true</span>); <span class="comment">//Remove this if you hate us applying textures for you :)</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Internal unility that renders the source texture into the RTT - the scaling method itself.</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DoGPUScale</span>(<span class="params">Texture2D src, <span class="keyword">int</span> width, <span class="keyword">int</span> height, FilterMode fmode</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">//We need the source texture in VRAM because we render with it</span></span><br><span class="line">            src.filterMode = fmode;</span><br><span class="line">            src.Apply(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Using RTT for best quality and performance. Thanks, Unity 5</span></span><br><span class="line">            RenderTexture rtt = <span class="keyword">new</span>(width, height, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Set the RTT in order to render to it</span></span><br><span class="line">            Graphics.SetRenderTarget(rtt);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Setup 2D matrix in range 0..1, so nobody needs to care about sized</span></span><br><span class="line">            GL.LoadPixelMatrix(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Then clear &amp; draw the texture to fill the entire RTT.</span></span><br><span class="line">            GL.Clear(<span class="literal">true</span>, <span class="literal">true</span>, <span class="keyword">new</span> Color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">            Graphics.DrawTexture(<span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>), src);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p>æŸ¥äº†å¥½ä¸€äº›èµ„æ–™ï¼Œå…¶å®éƒ½æ²¡æœ‰å®Œå…¨çœ‹å®Œï¼Œç›¸ä¿¡çœ‹å®Œä¹‹åå¯¹å­—å½¢ä¼šæœ‰æ›´å¤šçš„äº†è§£</p>
<p><a href="https://zhuanlan.zhihu.com/p/627054602" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/627054602</a><br><a href="https://discussions.unity.com/t/scaling-inline-sprites-using-rich-text-tags-causes-weird-alignment/752114/4" target="_blank" rel="noopener">https://discussions.unity.com/t/scaling-inline-sprites-using-rich-text-tags-causes-weird-alignment/752114/4</a><br><a href="https://discussions.unity.com/t/understanding-baseline-alignment-in-textmesh-pro/836821" target="_blank" rel="noopener">https://discussions.unity.com/t/understanding-baseline-alignment-in-textmesh-pro/836821</a><br><a href="https://discussions.unity.com/t/misaligned-emojis-sprites/688473" target="_blank" rel="noopener">https://discussions.unity.com/t/misaligned-emojis-sprites/688473</a><br><a href="https://www.youtube.com/watch?app=desktop&amp;v=hlatyQC-xIg&amp;t=5m" target="_blank" rel="noopener">https://www.youtube.com/watch?app=desktop&amp;v=hlatyQC-xIg&amp;t=5m</a><br><a href="https://menma.top/unity/2161.html" target="_blank" rel="noopener">https://menma.top/unity/2161.html</a><br><a href="https://docs.unity3d.com/Packages/com.unity.textmeshpro@3.2/manual/FontAssetsLineMetrics.html" target="_blank" rel="noopener">https://docs.unity3d.com/Packages/com.unity.textmeshpro@3.2/manual/FontAssetsLineMetrics.html</a></p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®€å•çš„UIå›¾ç‰‡æŒ–å£</title>
    <url>/2024/12/07/20241207-simple-uiimage-cutout/</url>
    <content><![CDATA[<p>æœ¬å‘¨æ¥åˆ°äº†å¼ºåˆ¶å¼•å¯¼çš„åŠŸèƒ½éœ€æ±‚ï¼Œæœ¬å‘¨å°±è¦åšå¥½ã€‚æˆ‘ä¹‹å‰æ²¡æœ‰åšè¿‡è¿™ä¸ªéœ€æ±‚ï¼Œè¯´å®åœ¨çš„ä¸çŸ¥é“é‚£ä¸ªå›¾ä¸ŠæŒ–æ´çš„åŠŸèƒ½æ€ä¹ˆåšã€‚</p>
<img src="/2024/12/07/20241207-simple-uiimage-cutout/20241207-pic001.png" class="" title="split">
<p>å› ä¸ºæ—¶é—´ç´§è¿«ï¼Œç”¨ç°æœ‰çš„åŠŸèƒ½ç³Šå¼„äº†ä¸€ä¸ªï¼Œæ€è·¯æ¯”è¾ƒè ¢: æŒ–æ´åŒºåŸŸ(çˆ¶èŠ‚ç‚¹ï¼Œå¸¦Mask) -&gt; è¢«æŒ–æ´çš„ç›®æ ‡èƒŒæ™¯å›¾(å­èŠ‚ç‚¹ï¼Œä½¿ç”¨ç½‘ä¸Šçš„maskåè½¬ç»„ä»¶)<br>è¿™ä¸ªåšæ³•æœ‰ä¸ªå·¨éº»çƒ¦çš„ç‚¹å°±æ˜¯å½“éœ€è¦èšç„¦UIç©ºé—´çš„æ—¶å€™ï¼Œéœ€è¦å…ˆè®©çˆ¶èŠ‚ç‚¹å¯¹ç›®æ ‡UIï¼Œç„¶åè®©å­ç‰©ä½“è°ƒæ•´å°ºå¯¸æ’‘æ»¡å±å¹•ã€‚é¢„è§ˆèµ·æ¥ä¹Ÿå¾ˆéº»çƒ¦ã€‚</p>
<p>æœ€è¿‘ç¨å¾®çœ‹äº†ä¸‹ UI Mask çš„å·¥ä½œåŸç†ï¼Œæƒ³ç€è¦ä¸è‡ªå·±åšä¸€ä¸ªæ–¹ä¾¿ä¸€äº›çš„ã€‚äºæ˜¯å†³å®šå…ˆå‚è€ƒ RectMask2D çš„å·¥ä½œåŸç†åšä¸€ä¸ªã€‚</p>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>RectMask2D çš„å·¥ä½œæ–¹æ³•æ˜¯ ç»™ MaskableGraphic è®¾ç½®å‰ªè£åŒºåŸŸï¼ˆSetClipRectï¼‰ï¼ŒåŒºåŸŸå¤–çš„éƒ¨åˆ†éƒ½ä¼šè¢«è£åˆ‡ä¸æ˜¾ç¤ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">color.a *&#x3D; UnityGet2DClipping(IN.worldPosition.xy, _ClipRect);</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæˆ‘åªè¦ç¨å¾®åä¸€ä¸‹ï¼Œå°±å¯ä»¥å˜æˆåŒºåŸŸå†…çš„ä¸æ˜¾ç¤ºäº†ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">color.a *&#x3D; 1 - UnityGet2DClipping(IN.worldPosition.xy, _ClipRect);</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥æœ€åæˆ‘ä»¬éœ€è¦ä¸€ä¸ª UI Shader èµ‹ç»™è¢«è£åˆ‡çš„ç‰©ä½“ï¼Œå’Œä¸€ä¸ªå»è°ƒæ•´è£åˆ‡åŒºåŸŸçš„è„šæœ¬ã€‚</p>
<p>UI Shader (å’ŒUI DefaultåŸºæœ¬æ²¡åŒºåˆ«ï¼Œå°±æ˜¯è£åˆ‡åŒºåŸŸé‚£è¾¹åäº†ä¸€ä¸‹)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Shader &quot;UI&#x2F;CutTarget&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        [PerRendererData] _MainTex(&quot;Sprite Texture&quot;, 2D) &#x3D; &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Color(&quot;Tint&quot;, Color) &#x3D; (1,1,1,1)</span><br><span class="line"></span><br><span class="line">        _StencilComp(&quot;Stencil Comparison&quot;, Float) &#x3D; 8</span><br><span class="line">        _Stencil(&quot;Stencil ID&quot;, Float) &#x3D; 0</span><br><span class="line">        _StencilOp(&quot;Stencil Operation&quot;, Float) &#x3D; 0</span><br><span class="line">        _StencilWriteMask(&quot;Stencil Write Mask&quot;, Float) &#x3D; 255</span><br><span class="line">        _StencilReadMask(&quot;Stencil Read Mask&quot;, Float) &#x3D; 255</span><br><span class="line"></span><br><span class="line">        _ColorMask(&quot;Color Mask&quot;, Float) &#x3D; 15</span><br><span class="line"></span><br><span class="line">        [Toggle(UNITY_UI_ALPHACLIP)] _UseUIAlphaClip(&quot;Use Alpha Clip&quot;, Float) &#x3D; 0</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        SubShader</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Queue&quot; &#x3D; &quot;Transparent&quot;</span><br><span class="line">                &quot;IgnoreProjector&quot; &#x3D; &quot;True&quot;</span><br><span class="line">                &quot;RenderType&quot; &#x3D; &quot;Transparent&quot;</span><br><span class="line">                &quot;PreviewType&quot; &#x3D; &quot;Plane&quot;</span><br><span class="line">                &quot;CanUseSpriteAtlas&quot; &#x3D; &quot;True&quot;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Stencil</span><br><span class="line">            &#123;</span><br><span class="line">                Ref[_Stencil]</span><br><span class="line">                Comp[_StencilComp]</span><br><span class="line">                Pass[_StencilOp]</span><br><span class="line">                ReadMask[_StencilReadMask]</span><br><span class="line">                WriteMask[_StencilWriteMask]</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Cull Off</span><br><span class="line">            Lighting Off</span><br><span class="line">            ZWrite Off</span><br><span class="line">            ZTest[unity_GUIZTestMode]</span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            ColorMask[_ColorMask]</span><br><span class="line"></span><br><span class="line">            Pass</span><br><span class="line">            &#123;</span><br><span class="line">                Name &quot;Default&quot;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">                #pragma vertex vert</span><br><span class="line">                #pragma fragment frag</span><br><span class="line">                #pragma target 2.0</span><br><span class="line"></span><br><span class="line">                #include &quot;UnityCG.cginc&quot;</span><br><span class="line">                #include &quot;UnityUI.cginc&quot;</span><br><span class="line"></span><br><span class="line">                #pragma multi_compile_local _ UNITY_UI_CLIP_RECT</span><br><span class="line">                #pragma multi_compile_local _ UNITY_UI_ALPHACLIP</span><br><span class="line"></span><br><span class="line">                struct appdata_t</span><br><span class="line">                &#123;</span><br><span class="line">                    float4 vertex   : POSITION;</span><br><span class="line">                    float4 color    : COLOR;</span><br><span class="line">                    float2 texcoord : TEXCOORD0;</span><br><span class="line">                    UNITY_VERTEX_INPUT_INSTANCE_ID</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                struct v2f</span><br><span class="line">                &#123;</span><br><span class="line">                    float4 vertex   : SV_POSITION;</span><br><span class="line">                    fixed4 color : COLOR;</span><br><span class="line">                    float2 texcoord  : TEXCOORD0;</span><br><span class="line">                    float4 worldPosition : TEXCOORD1;</span><br><span class="line">                    UNITY_VERTEX_OUTPUT_STEREO</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                sampler2D _MainTex;</span><br><span class="line">                fixed4 _Color;</span><br><span class="line">                fixed4 _TextureSampleAdd;</span><br><span class="line">                float4 _ClipRect;</span><br><span class="line">                float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line">                v2f vert(appdata_t v)</span><br><span class="line">                &#123;</span><br><span class="line">                    v2f OUT;</span><br><span class="line">                    UNITY_SETUP_INSTANCE_ID(v);</span><br><span class="line">                    UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(OUT);</span><br><span class="line">                    OUT.worldPosition &#x3D; v.vertex;</span><br><span class="line">                    OUT.vertex &#x3D; UnityObjectToClipPos(OUT.worldPosition);</span><br><span class="line"></span><br><span class="line">                    OUT.texcoord &#x3D; TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line"></span><br><span class="line">                    OUT.color &#x3D; v.color * _Color;</span><br><span class="line">                    return OUT;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                fixed4 frag(v2f IN) : SV_Target</span><br><span class="line">                &#123;</span><br><span class="line">                    half4 color &#x3D; (tex2D(_MainTex, IN.texcoord) + _TextureSampleAdd) * IN.color;</span><br><span class="line"></span><br><span class="line">                    #ifdef UNITY_UI_CLIP_RECT</span><br><span class="line">                    &#x2F;&#x2F; only edit this line :D</span><br><span class="line">                    color.a *&#x3D; 1 - UnityGet2DClipping(IN.worldPosition.xy, _ClipRect);</span><br><span class="line">                    #endif</span><br><span class="line"></span><br><span class="line">                    #ifdef UNITY_UI_ALPHACLIP</span><br><span class="line">                    clip(color.a - 0.001);</span><br><span class="line">                    #endif</span><br><span class="line"></span><br><span class="line">                    return color;</span><br><span class="line">                &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;#ifndef UNITY_UI_INCLUDED</span><br><span class="line">&#x2F;&#x2F;#define UNITY_UI_INCLUDED</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;inline float UnityGet2DClipping(in float2 position, in float4 clipRect)</span><br><span class="line">&#x2F;&#x2F;&#123;</span><br><span class="line">&#x2F;&#x2F;    float2 inside &#x3D; step(clipRect.xy, position.xy) * step(position.xy, clipRect.zw);</span><br><span class="line">&#x2F;&#x2F;    return inside.x * inside.y;</span><br><span class="line">&#x2F;&#x2F;&#125;</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;inline fixed4 UnityGetUIDiffuseColor(in float2 position, in sampler2D mainTexture, in sampler2D alphaTexture, fixed4 textureSampleAdd)</span><br><span class="line">&#x2F;&#x2F;&#123;</span><br><span class="line">&#x2F;&#x2F;    return fixed4(tex2D(mainTexture, position).rgb + textureSampleAdd.rgb, tex2D(alphaTexture, position).r + textureSampleAdd.a);</span><br><span class="line">&#x2F;&#x2F;&#125;</span><br><span class="line">&#x2F;&#x2F;#endif</span><br></pre></td></tr></table></figure>
<p>è°ƒæ•´è£åˆ‡åŒºåŸŸçš„è„šæœ¬å¯ä»¥å‚è€ƒ RectMask2D æ¥å†™ï¼Œæˆ‘åªæ˜¯æµ…æµ…è¯•ä¸€è¯•ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="meta">ExecuteAlways, DisallowMultipleComponent, RequireComponent(typeof(RectTransform))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CutRectSetter</span> : <span class="title">UIBehaviour</span>, <span class="title">IClipper</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Canvas _canvas;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> MaskableGraphic _clipTarget;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> m_shouldRecalculateClipRects = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> Rect m_prevClipRect = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> m_hasClipped = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PerformClipping</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// IDK why unity use ReferenceEquals, I just copied it from RectMask2D.cs :(</span></span><br><span class="line">        <span class="keyword">if</span> (ReferenceEquals(_canvas, <span class="literal">null</span>) || <span class="literal">null</span> == _clipTarget)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        RectTransform selfRectTransform = transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">        RectTransform targetTectTransform = _clipTarget.transform <span class="keyword">as</span> RectTransform;</span><br><span class="line">        <span class="keyword">if</span> (!IsInsideRect(selfRectTransform, targetTectTransform))</span><br><span class="line">        &#123;</span><br><span class="line">            CancelClip();</span><br><span class="line">            m_prevClipRect = <span class="keyword">default</span>;</span><br><span class="line">            m_shouldRecalculateClipRects = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Rect currentRect = selfRectTransform.rect;</span><br><span class="line">        Vector2 selfPivot = selfRectTransform.pivot;</span><br><span class="line">        <span class="comment">// get pivot position</span></span><br><span class="line">        currentRect.position = SwitchToRectTransform(selfRectTransform, targetTectTransform);</span><br><span class="line">        <span class="comment">// rect's position is bottom left</span></span><br><span class="line">        Vector2 delta = <span class="keyword">new</span> Vector2(-currentRect.width * selfPivot.x, -currentRect.height * selfPivot.y);</span><br><span class="line">        currentRect.position += delta;</span><br><span class="line"></span><br><span class="line">        m_shouldRecalculateClipRects = m_shouldRecalculateClipRects || m_prevClipRect != currentRect;</span><br><span class="line">        <span class="keyword">if</span> (m_shouldRecalculateClipRects)</span><br><span class="line">        &#123;</span><br><span class="line">            _clipTarget.SetClipRect(<span class="keyword">default</span>, <span class="literal">true</span>);</span><br><span class="line">            _clipTarget.SetClipRect(currentRect, <span class="literal">true</span>);</span><br><span class="line">            _clipTarget.Cull(currentRect, <span class="literal">true</span>);</span><br><span class="line">            m_prevClipRect = currentRect;</span><br><span class="line">            m_shouldRecalculateClipRects = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ContextMenu(nameof(CancelClip))</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CancelClip</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        _clipTarget.SetClipRect(<span class="keyword">default</span>, <span class="literal">true</span>);</span><br><span class="line">        m_hasClipped = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">base</span>.OnEnable();</span><br><span class="line">        m_shouldRecalculateClipRects = <span class="literal">true</span>;</span><br><span class="line">        ClipperRegistry.Register(<span class="keyword">this</span>);</span><br><span class="line">        MaskUtilities.Notify2DMaskStateChanged(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">base</span>.OnDisable();</span><br><span class="line">        ClipperRegistry.Unregister(<span class="keyword">this</span>);</span><br><span class="line">        MaskUtilities.Notify2DMaskStateChanged(<span class="keyword">this</span>);</span><br><span class="line">        CancelClip();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnTransformParentChanged</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_shouldRecalculateClipRects = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnCanvasHierarchyChanged</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_shouldRecalculateClipRects = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">region</span> some utils</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Vector2 RECT_TOP = <span class="keyword">new</span> Vector2(<span class="number">0.5f</span>, <span class="number">1f</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Vector2 RECT_BOTTOM = <span class="keyword">new</span> Vector2(<span class="number">0.5f</span>, <span class="number">0f</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Vector2 RECT_LEFT = <span class="keyword">new</span> Vector2(<span class="number">0f</span>, <span class="number">0.5f</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Vector2 RECT_RIGHT = <span class="keyword">new</span> Vector2(<span class="number">1f</span>, <span class="number">0.5f</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Vector2 RECT_CENTER = <span class="keyword">new</span> Vector2(<span class="number">0.5f</span>, <span class="number">0.5f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Vector2 RECT_BOTTOM_LEFT = <span class="keyword">new</span> Vector2(<span class="number">0f</span>, <span class="number">0f</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Vector2 RECT_BOTTOM_RIGHT = <span class="keyword">new</span> Vector2(<span class="number">1f</span>, <span class="number">0f</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Vector2 RECT_TOP_LEFT = <span class="keyword">new</span> Vector2(<span class="number">0f</span>, <span class="number">1f</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Vector2 RECT_TOP_RIGHT = <span class="keyword">new</span> Vector2(<span class="number">1f</span>, <span class="number">1f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Vector2 <span class="title">SwitchToRectTransform</span>(<span class="params">RectTransform <span class="keyword">from</span>, RectTransform to</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector2 screenP = RectTransformUtility.WorldToScreenPoint(<span class="literal">null</span>, <span class="keyword">from</span>.position);</span><br><span class="line">        RectTransformUtility.ScreenPointToLocalPointInRectangle(to, screenP, <span class="literal">null</span>, <span class="keyword">out</span> Vector2 localPoint);</span><br><span class="line">        <span class="keyword">return</span> localPoint;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">bool</span> <span class="title">IsInsideRect</span>(<span class="params">RectTransform rectTransform, RectTransform outterRect</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 checkWorldPoint = RectOffsetToWorld(rectTransform, RECT_BOTTOM_LEFT);</span><br><span class="line">        <span class="keyword">bool</span> bottomLeftOut = !RectTransformUtility.RectangleContainsScreenPoint(outterRect, checkWorldPoint);</span><br><span class="line">        checkWorldPoint = RectOffsetToWorld(rectTransform, RECT_BOTTOM_RIGHT);</span><br><span class="line">        <span class="keyword">bool</span> bottomRightOut = !RectTransformUtility.RectangleContainsScreenPoint(outterRect, checkWorldPoint);</span><br><span class="line">        checkWorldPoint = RectOffsetToWorld(rectTransform, RECT_TOP_LEFT);</span><br><span class="line">        <span class="keyword">bool</span> topLeftOut = !RectTransformUtility.RectangleContainsScreenPoint(outterRect, checkWorldPoint);</span><br><span class="line">        checkWorldPoint = RectOffsetToWorld(rectTransform, RECT_TOP_RIGHT);</span><br><span class="line">        <span class="keyword">bool</span> topRightOut = !RectTransformUtility.RectangleContainsScreenPoint(outterRect, checkWorldPoint);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !(bottomLeftOut || bottomRightOut || topLeftOut || topRightOut);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Vector3 <span class="title">RectOffsetToWorld</span>(<span class="params">RectTransform rectTransform, Vector2 normalizedRectPosition</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Rect selfRect = rectTransform.rect;</span><br><span class="line">        Vector2 localposition = Vector2.zero;</span><br><span class="line">        <span class="keyword">if</span> (RECT_CENTER == normalizedRectPosition) <span class="comment">// RectPositionType.Center</span></span><br><span class="line">        &#123;</span><br><span class="line">            localposition = selfRect.center;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RECT_TOP == normalizedRectPosition) <span class="comment">// RectPositionType.Top</span></span><br><span class="line">        &#123;</span><br><span class="line">            localposition = <span class="keyword">new</span> Vector2(selfRect.center.x, selfRect.yMax);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RECT_BOTTOM == normalizedRectPosition) <span class="comment">// RectPositionType.Bottom</span></span><br><span class="line">        &#123;</span><br><span class="line">            localposition = <span class="keyword">new</span> Vector2(selfRect.center.x, selfRect.yMin);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RECT_LEFT == normalizedRectPosition) <span class="comment">// RectPositionType.Left</span></span><br><span class="line">        &#123;</span><br><span class="line">            localposition = <span class="keyword">new</span> Vector2(selfRect.xMin, selfRect.center.y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RECT_RIGHT == normalizedRectPosition) <span class="comment">// RectPositionType.Right</span></span><br><span class="line">        &#123;</span><br><span class="line">            localposition = <span class="keyword">new</span> Vector2(selfRect.xMax, selfRect.center.y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RECT_TOP_LEFT == normalizedRectPosition) <span class="comment">// RectPositionType.TopLeft</span></span><br><span class="line">        &#123;</span><br><span class="line">            localposition = <span class="keyword">new</span> Vector2(selfRect.xMin, selfRect.yMax);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RECT_TOP_RIGHT == normalizedRectPosition) <span class="comment">// RectPositionType.TopRight</span></span><br><span class="line">        &#123;</span><br><span class="line">            localposition = selfRect.max;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RECT_BOTTOM_LEFT == normalizedRectPosition) <span class="comment">// RectPositionType.BottomLeft</span></span><br><span class="line">        &#123;</span><br><span class="line">            localposition = selfRect.min;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RECT_BOTTOM_RIGHT == normalizedRectPosition) <span class="comment">// RectPositionType.BottomRight</span></span><br><span class="line">        &#123;</span><br><span class="line">            localposition = <span class="keyword">new</span> Vector2(selfRect.xMax, selfRect.yMin);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.LogError(<span class="string">$"<span class="subst">&#123;normalizedRectPosition&#125;</span> is not a normalized rect position"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rectTransform.TransformPoint(localposition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2024/12/07/20241207-simple-uiimage-cutout/20241207-pic002.gif" class="" title="split">
<p>è¯•äº†ä¸€ä¸‹æ„Ÿè§‰åŠŸèƒ½å¯ç”¨ï¼Œè°ƒæ•´æŒ–å£å¤§å°çš„å‚è€ƒç‰©ä½“æ— éœ€ä½œä¸ºè¢«æŒ–ç‰©ä½“çš„çˆ¶æˆ–å­ï¼Œæ•ˆæœé¢„è§ˆéå¸¸æ–¹ä¾¿ã€‚</p>
<p>ä½†è¿™ä¸ªåšæ³•æœ‰ä¸¤ä¸ªæ¯”è¾ƒå¯æƒœçš„ç‚¹<br>1 æ­¤åšæ³•åªèƒ½æŒ–æ”¾è¡Œçš„ç¼ºå£<br>2 å½“å‰åªæŒ–ç¼ºå£ï¼Œæ²¡æœ‰åšæŸ”è½¯å¤„ç†ï¼Œä¼°è®¡è¿˜å¾—ç…§ç€ RectMask2D çš„æ€è·¯å»åšè½¯åŒ–</p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2022/06/12/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>TextMeshPro å¯Œæ–‡æ–‡æœ¬è‡ªå®šä¹‰é¢œè‰²</title>
    <url>/2025/02/23/20250223-tmp-custom-richtext-color/</url>
    <content><![CDATA[<p>TextMeshPro æ”¯æŒå¯Œæ–‡æœ¬ï¼Œå¯Œæ–‡æœ¬æœ‰é¢œè‰²æ ‡ç­¾ã€‚å¯¹äºä¸€äº›æ­¦å™¨/æŠ€èƒ½æè¿°é‡Œçš„å…³é”®å­—ï¼Œåœ¨æ–‡æœ¬è¡¨é‡Œæˆ‘ä»¬éƒ½ä¼šç”¨ <code>&lt;color=#FFFFFF&gt;</code> è¿™æ ·çš„æ ‡è®°å»ç»™æ–‡æœ¬æ¢è‰²ã€‚<br>ä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸€äº›æ¯”è¾ƒéº»çƒ¦çš„é—®é¢˜ï¼Œæ¯”å¦‚å½“ç¾æœ¯å¸Œæœ›å…¨éƒ¨æŠŠé¢œè‰²æ¢æ‰æ—¶ï¼Œè¿™å†å»è¡¨æ ¼é‡Œåšæ›¿æ¢å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œè€Œä¸”ä¹Ÿæ— æ³•åŒºåˆ†ä¸¤ç§ç”¨é€”ä¸åŒä½†æ˜¯æ•°å€¼ä¸€æ ·çš„é¢œè‰²ã€‚</p>
<p>äºæ˜¯ä¹äº¤äº’å’Œç­–åˆ’é‚£è¾¹ææ¥äº†éœ€æ±‚å¸Œæœ›èƒ½åœ¨å¯Œæ–‡æœ¬é‡Œä½¿ç”¨è‡ªå®šä¹‰çš„é¢œè‰²tagï¼Œä¸ºäº†æ–¹ä¾¿åšæ•ˆæœçš„æµ‹è¯•å’Œè¿­ä»£ã€‚</p>
<p>å½“å‰æˆ‘ä»¬å·²ç»åœ¨ä½¿ç”¨è‡ªå®šä¹‰çš„ç»§æ‰¿TMPçš„æ–‡æœ¬ç»„ä»¶äº†ï¼Œè¾¾æˆè¿™ä¸ªåŠŸèƒ½å°±ä¼šæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦å¯¹TMPçš„ä»£ç åšä¸€äº›å°ä¿®æ”¹ç„¶åå†æ ¹æ®ä»–çš„è§„åˆ™ç»­å†™ä¸€ä¸‹æˆ‘ä»¬çš„è‡ªå®šä¹‰çš„é¢œè‰²è·å–å°±å¥½äº†ã€‚</p>
<h2 id="TextMeshPro-æºç è·å–"><a href="#TextMeshPro-æºç è·å–" class="headerlink" title="TextMeshPro æºç è·å–"></a>TextMeshPro æºç è·å–</h2><p>ç°åœ¨æˆ‘ä»¬éƒ½æ˜¯ä» PackageManager ä¸­ä¸‹è½½çš„ TMPï¼Œä¸€èˆ¬æ˜¯æ— æ³•ç›´æ¥ä¿®æ”¹çš„ã€‚éœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰èƒ½ä¿®æ”¹ï¼š</p>
<ul>
<li>ä» <code>PROJECT_ROOT/Library/PackageCache/</code> ä¸­æ‰¾åˆ° TMP çš„åŒ…ï¼Œåå­—åº”è¯¥æ˜¯ <code>com.unity.textmeshpro@x.x.x</code></li>
<li>æŠŠæ•´ä¸ªåŒ…æ‹–åˆ° <code>PROJECT_ROOT/Packages/</code> è¿™ä¸ªç›®å½•ä¸‹ï¼Œé‡å¯ Unity å·¥ç¨‹</li>
<li>ä» <code>PROJECT_ROOT/Packages/com.unity.textmeshpro@x.x.x/</code> çš„ç›®å½•ä¸‹éšæ„ä¿®æ”¹æºç </li>
</ul>
<h2 id="ä¿®æ”¹æ€è·¯"><a href="#ä¿®æ”¹æ€è·¯" class="headerlink" title="ä¿®æ”¹æ€è·¯"></a>ä¿®æ”¹æ€è·¯</h2><p><code>TMP_Asset.cs</code> è¿™ä¸ªæ–‡ä»¶æœ‰å·®ä¸å¤š9000è¡Œï¼Œéå¸¸åºå¤§ã€‚å…¶ä¸­æœ‰ä¸€å¤§éƒ¨åˆ†æ˜¯å…³äºå¯Œæ–‡æœ¬æ ‡ç­¾çš„è§£æçš„ã€‚</p>
<p>æˆ‘çœ‹åˆ°çš„å¤§æ¦‚çš„æ–‡æœ¬æ¸²æŸ“çš„æµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·çš„:</p>
<ul>
<li>æ–‡æœ¬èµ‹å€¼(ä»å±æ€§æˆ–é¢æ¿ä¸Šèµ‹å€¼)</li>
<li>æ ‡è®°éœ€è¦é‡å»ºç½‘æ ¼</li>
<li>(é‡å»ºç½‘æ ¼) ä½¿ç”¨ä¸€ä¸ª uint æ•°ç»„å¤‡ä»½å½“å‰è¾“å…¥çš„æ–‡æœ¬ã€‚å¦‚æœæ–‡æœ¬é•¿äºæ•°ç»„ï¼Œé‚£æ‰©å®¹åˆ°ç›®æ ‡é•¿åº¦ï¼Œå¦‚æœæ–‡æœ¬çŸ­äºæ•°ç»„ï¼Œç©ºä½å¡«0ã€‚</li>
<li>(é‡å»ºç½‘æ ¼) å‡†å¤‡ä¸€ä¸ª UnicodeChar(ç¼–ç ï¼ŒåŸé•¿åº¦ç­‰)ã€‚å¦‚æœæ–‡æœ¬é•¿äºæ•°ç»„ï¼Œé‚£æ‰©å®¹åˆ°2çš„næ¬¡å¹‚ï¼Œå¦‚æœæ–‡æœ¬çŸ­äºæ•°ç»„ï¼Œç©ºä½å¡«0ã€‚</li>
<li>(é‡å»ºç½‘æ ¼) å¡«å…… UnicodeChar æ•°ç»„ï¼Œç¼“å­˜å‡†å¤‡æ“ä½œçš„æ–‡æœ¬(ä¼šåŒºåˆ†æ¢è¡Œç¬¦å’Œä¸åŒå­—ç¬¦ä»¥åŠ br, style æ ‡ç­¾)ã€‚</li>
<li>(é‡å»ºç½‘æ ¼) éå† UnicodeChar æ•°ç»„ä»¥æ„å»ºç½‘æ ¼ã€‚</li>
<li>(é‡å»ºç½‘æ ¼) (éå† UnicodeChar æ•°ç»„) æ£€æŸ¥æ¯ä¸€ä¸ª UnicodeCharï¼Œå¦‚æœæ˜¯å¯ä»¥ç›´æ¥å±•ç¤ºçš„å­—ç¬¦ï¼Œåˆ™æ ¹æ®å½“å‰çš„å¯Œæ–‡æœ¬æ ‡ç­¾åŒºé—´å’Œå…¶å®ƒæ˜¾ç¤ºç›¸å…³çš„å‚æ•°æ¥ç»™ m_textInfo é‡Œçš„ characterInfo(ç¼“å­˜éœ€è¦ç»˜åˆ¶çš„å­—ç¬¦çš„ç½‘æ ¼ç›¸å…³çš„ä¿¡æ¯) æ•°ç»„ä¸­çš„å…ƒç´ èµ‹å€¼ã€‚</li>
<li>(é‡å»ºç½‘æ ¼) (éå† UnicodeChar æ•°ç»„) æ£€æŸ¥æ¯ä¸€ä¸ª UnicodeCharï¼Œæ ¹æ®ç»„ä»¶ä¸Šçš„å¤§å°å†™é£æ ¼å®šä¹‰æ¥æ¢ç®—å½“å‰å®é™…éœ€è¦ä½¿ç”¨çš„ char UnicodeCharã€‚</li>
<li>(é‡å»ºç½‘æ ¼) (éå† UnicodeChar æ•°ç»„) æ ¹æ®å®é™…ä½¿ç”¨çš„ char code å»æŸ¥è¯¢å­—å½¢(å¦‚æœæ˜¯åŠ¨æ€çš„è´´å›¾ï¼ŒæŸ¥ä¸åˆ°çš„ä¼šåˆ›å»ºå¹¶å†™å…¥è´´å›¾)ã€‚</li>
<li>(é‡å»ºç½‘æ ¼) (éå† UnicodeChar æ•°ç»„) æ ¹æ®å„ç§æ•ˆæœå¤„ç†åçš„ç»“æœï¼Œæ›´æ–°m_textInfo é‡Œçš„ characterInfo(ç¼“å­˜éœ€è¦ç»˜åˆ¶çš„å­—ç¬¦çš„ç½‘æ ¼ç›¸å…³çš„ä¿¡æ¯) æ•°ç»„ä¸­çš„å…ƒç´ ã€‚</li>
<li>(é‡å»ºç½‘æ ¼) æ ¹æ®æ•´ä½“çš„å¯¹é½æ¨¡å¼è®¡ç®—æ•´ä½“çš„åç§»ï¼Œä¹‹åç”¨äºé‡æ–°æ›´æ–°m_textInfo é‡Œçš„ characterInfoã€‚</li>
<li>(é‡å»ºç½‘æ ¼) æ¥ä¸‹æ¥è¿˜æœ‰ä¸€ç³»åˆ—å¤„ç†æˆ‘å¤´å¤§äº†çœ‹ä¸ä¸‹å»äº† :)</li>
</ul>
<p>æ•´ä¸ªæµç¨‹å¾ˆé•¿æˆ‘æ²¡çœ‹å®Œï¼Œä½†è¿˜æ˜¯çœ‹åˆ°äº†æˆ‘éœ€è¦çš„å…³é”®éƒ¨åˆ†ã€‚<code>internal bool ValidateHtmlTag(UnicodeChar[] chars, int startIndex, out int endIndex)</code> è¿™ä¸ªå‡½æ•°ä¸­å°±æœ‰å¯Œæ–‡æœ¬æ ‡ç­¾çš„è§£æè€Œä¸”æ­£å¥½æœ‰æ ¹æ®é¢œè‰²æ ‡ç­¾æ¥è®¡ç®—é¢œè‰²çš„éƒ¨åˆ†ã€‚å†è¿™ä¸ªéƒ¨åˆ†(TMP_Text.cs line 7766)ä¸­å°±æ­£å¥½æ˜¯æ ¹æ®é¢œè‰²åå­—æ¥èµ‹é¢œè‰²ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åŠ ä¸Šç”¨äºè§£æè‡ªå®šä¹‰é¢œè‰²çš„å‡½æ•°å°±å¯ä»¥äº†</p>
<h2 id="TextMeshPro-è¶…é“¾æ¥ç‚¹å‡»"><a href="#TextMeshPro-è¶…é“¾æ¥ç‚¹å‡»" class="headerlink" title="TextMeshPro è¶…é“¾æ¥ç‚¹å‡»"></a>TextMeshPro è¶…é“¾æ¥ç‚¹å‡»</h2><p>è¿™ä¸ªåŠŸèƒ½ä¹Ÿæ˜¯æˆ‘æœ€å¼€å§‹æåˆ°çš„å¯¹äºæ­¦å™¨/æŠ€èƒ½æè¿°é‡Œçš„å…³é”®å­—ä¼šéœ€è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç‚¹å‡»è¶…é“¾æ¥æ–‡æœ¬æ‰“å¼€æŸæŸç•Œé¢å±•ç¤ºä¸‹è¯¦æƒ…ã€‚é…åˆ TMP ä¹Ÿéå¸¸å¥½å¥½å®Œæˆã€‚<br>éœ€è¦ä¸€ä¸ªå“åº”ç‚¹å‡»çš„è„šæœ¬æŒ‚åœ¨æœ‰ TMP çš„ç‰©ä½“ä¸Šæˆ–è€…ç›´æ¥ç»§æ‰¿ TMP ç„¶åä¹Ÿç»§æ‰¿å“åº”ç‚¹å‡»çš„è¿™ä¸ªæ¥å£ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ˜ç¡®å¾—åˆ°ç‚¹å‡»çš„å¯Œæ–‡æœ¬é“¾æ¥å†…å®¹ï¼Œéœ€è¦æ‰“å¼€ç•Œé¢çš„æƒ…å†µå°±è‡ªå·±åˆ‡å‰²å‚æ•°è§£æå³å¯ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TempTMP</span> : <span class="title">TextMeshProUGUI</span>, <span class="title">IPointerClickHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPointerClick</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">int</span> linkIndex = TMP_TextUtilities.FindIntersectingLink(<span class="keyword">this</span>, eventData.position, eventData.pressEventCamera);</span><br><span class="line">        <span class="keyword">if</span> (linkIndex != <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            * e.g. &lt;link="a2,b2"&gt;Mesh&lt;/link&gt;</span></span><br><span class="line"><span class="comment">            * linkInfo.GetLinkID() will "get a2,b2"</span></span><br><span class="line"><span class="comment">            * linkInfo.GetLinkText() will get "Mesh"</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            TMP_LinkInfo linkInfo = <span class="keyword">this</span>.textInfo.linkInfo[linkIndex];</span><br><span class="line">            Debug.Log(<span class="string">$"linkId <span class="subst">&#123;linkInfo.GetLinkID()&#125;</span> / linkText <span class="subst">&#123;linkInfo.GetLinkText()&#125;</span>"</span>);</span><br><span class="line">            <span class="comment">// Do stuff u want here :D</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>UGUI</tag>
      </tags>
  </entry>
  <entry>
    <title>Unityèµ„æºé“¾æ¥</title>
    <url>/2025/05/10/20250510-assetpath/</url>
    <content><![CDATA[<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¾ˆå¤šèµ„æºéƒ½æ˜¯æ‰“åˆ°ABé‡Œäº†ï¼Œè¿™ä¸ªæƒ…å†µä¸‹å¾ˆå¤šPrefab,Scriptableä¸Šæƒ³è¦é…ç½®ä¸€äº›èµ„æºåªèƒ½å¡«èµ„æºçš„è·¯å¾„ã€‚ä½†æ˜¯å¡«è·¯å¾„çœŸçš„å¾ˆéº»çƒ¦ï¼Œä¸‡ä¸€èµ„æºå‘ç”Ÿä½ç½®å˜æ›´å°±éº»çƒ¦äº†ã€‚<br>åœ¨è¿™ä¸ªæƒ…å†µä¸‹æƒ³åˆ°çš„ä¸€ä¸ªæ–¹æ¡ˆå°±æ˜¯åšä¸€ä¸ª â€œèµ„æºé“¾æ¥â€ å¯¹è±¡ï¼Œåœ¨é¢æ¿ä¸Šä»ç„¶ç»˜åˆ¶UnityObjectï¼Œä½†æ˜¯å®é™…å­˜å‚¨çš„æ˜¯è·¯å¾„ã€‚</p>
<p>ç»“åˆä¹‹å‰çš„é¡¹ç›®é‡Œçš„éœ€æ±‚å¤§æ¦‚çœ‹äº†ä¸‹ï¼Œå…·ä½“çš„å®ç°æ€è·¯çœŸçš„æŒºç®€å•çš„ï¼Œåœ¨ç¼–è¾‘å™¨æ—¶å­˜æ”¾èµ„æºå¼•ç”¨å’Œèµ„æºçš„guidï¼Œèµ„æºæ„å»ºæ—¶é€šè¿‡guidè¡¥å……èµ„æºçš„å®é™…è·¯å¾„ã€‚<br>è¿™ä¸ªæ€è·¯ä¸‹æœ‰ä¸¤ä¸ªç—›ç‚¹:<br>1 æ— æ³•å¤„ç†èµ„æºé‡å‘½åæ—¶å€™ä¼š å¶å°” å¯¼è‡´çš„guidå˜æ›´æƒ…å†µ<br>2 æ„å»ºæ—¶çš„è·¯å¾„è¡¥å……å®ç°éº»çƒ¦</p>
<p>ç¬¬1ä¸ªç—›ç‚¹å…¶å®æ˜¯å®ç°å®Œæˆäº†æ‰å‘ç°çš„ï¼Œæš‚æ—¶è¿˜æ²¡æƒ³æ¸…æ¥šæ€ä¹ˆå¤„ç†ï¼Œå› ä¸ºä¸€æ—¦guidå‘ç”Ÿå˜æ›´é‚£å…¶å®è¿™ä»½èµ„æºçš„ç¼“å­˜å¯èƒ½å·²ç»æ— æ•ˆäº†ï¼Œæ‰¾å›ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œé™¤éç›‘å¬æ›´å¤šçš„èµ„æºå˜æ›´äº‹ä»¶ä»¥åŠæ„å»ºè‡ªå·±çš„èµ„æºæ•°æ®åº“ã€‚</p>
<p>å…³äºç¬¬2ä¸ªç—›ç‚¹çš„è·¯å¾„è¡¥å……ï¼Œæˆ‘æœ‰ä¸¤ç§æ–¹æ³•ï¼š<br>1 æ— è®ºå¦‚ä½•è¿™ä¸ª èµ„æºé“¾æ¥ å¯¹è±¡æ€»éœ€è¦ä¸€ä¸ªå®¿ä¸»ã€‚è¿™ä¸ªå®¿ä¸»æœ€ç»ˆä¼šæ˜¯ä¸€ä¸ªUnityObjectæˆ–èƒ½ç»§ç»­åœ¨çˆ¶çº§ä¸Šæ‰¾åˆ°ä¸€ä¸ªUnityObjectã€‚é‚£ä¹ˆåªéœ€è¦åœ¨å®¿ä¸»ä¸Šå®ç°ä¸€ä¸ª<strong>èµ„æºæ„å»ºå‰</strong>ä¼šè°ƒç”¨çš„æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œå®Œæˆè·¯å¾„çš„è¡¥å……å°±å¥½ã€‚<br>2 æˆ–è€…ç”¨æˆ‘<a href="https://2c2c2c.github.io/2025/02/21/20250221-unity-findref-guid/" target="_blank" rel="noopener">ä¹‹å‰çš„ç¬”è®°</a>æåˆ°çš„ï¼Œåšæ–‡æœ¬çš„åŒ¹é…å†æ›¿æ¢</p>
<p>åœ¨ä¸‹é¢æˆ‘ä¼šé€‰æ‹©ç¬¬2ç§æ–¹å¼æ¥ç®€å•å®ç°ä»¥ä¸‹ï¼Œå®é™…å·¥ç¨‹ä¸­æœ€å¥½æ˜¯å…ˆå®ç°ç¬¬1ç§æ¯”è¾ƒå¥½ï¼Œå› ä¸ºæœ‰å¯èƒ½æ°¸è¿œä¹Ÿä¸ä¼šé‡åˆ°éœ€è¦ç”¨åˆ°ç¬¬2ç§æ–¹æ³•è§£å†³çš„æƒ…å½¢ã€‚</p>
<h4 id="èµ„æºé“¾æ¥å¯¹è±¡"><a href="#èµ„æºé“¾æ¥å¯¹è±¡" class="headerlink" title="èµ„æºé“¾æ¥å¯¹è±¡"></a>èµ„æºé“¾æ¥å¯¹è±¡</h4><p>é¦–å…ˆæ˜¯èµ„æºé“¾æ¥å¯¹è±¡æœ¬èº«ï¼Œåšäº†ä¸€ä¸ªæ³›å‹åŸºç±»ï¼Œå¯¹äºç›®æ ‡çš„èµ„æºç±»å‹ï¼Œéœ€è¦æ–°å®ç°ä¸€ä¸ªç©ºå­ç±»è€Œå·²ï¼Œè¡Œä¸ºåœ¨åŸºç±»å·²ç»éƒ½è¾¾æˆäº†ã€‚<br>è¿™ä¸ªæ³›å‹åŸºç±»æ˜¯ä¸ºäº†ä¹‹åçš„ç¼–è¾‘å™¨ç»˜åˆ¶è€Œä½¿ç”¨çš„å¦¥åæ–¹æ¡ˆã€‚</p>
<p>çœŸæœºè¿è¡Œæ—¶åªéœ€è¦pathï¼Œguidå’Œèµ„æºç¼“å­˜éƒ½æ˜¯ç¼–è¾‘å™¨æ—¶æ‰æœ‰çš„å­—æ®µ</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityObject = UnityEngine.Object;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line">public abstract class AssetPath&lt;T&gt; where T : UnityObject</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">implicit</span> <span class="keyword">operator</span> <span class="title">string</span>(<span class="params">AssetPath&lt;T&gt; p</span>)</span> =&gt; p.Pathlink;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">string</span> m_path;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">string</span> m_guid;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">protected</span> UnityObject m_assetCache;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Pathlink</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR // in editor time, it is no need to save the actual path, just use guid to get the path</span></span><br><span class="line">            <span class="keyword">if</span> (Application.isPlaying)</span><br><span class="line">            &#123;</span><br><span class="line">                m_path = AssetDatabase.GUIDToAssetPath(m_guid);</span><br><span class="line">                <span class="keyword">return</span> m_path;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">string</span> path = AssetDatabase.GUIDToAssetPath(m_guid);</span><br><span class="line">            <span class="keyword">return</span> path;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> // in build, just return path</span></span><br><span class="line">            <span class="keyword">return</span> m_path;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line">public class PrefabPath : AssetPath&lt;GameObject&gt; &#123; &#125;</span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line">public class MaterialPath : AssetPath&lt;Material&gt; &#123; &#125;</span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line">public class ScriptableObjectPath : AssetPath&lt;ScriptableObject&gt; &#123; &#125;</span><br></pre></td></tr></table></figure>
<h4 id="èµ„æºé“¾æ¥ç›¸å…³çš„ç¼–è¾‘å™¨ç»˜åˆ¶"><a href="#èµ„æºé“¾æ¥ç›¸å…³çš„ç¼–è¾‘å™¨ç»˜åˆ¶" class="headerlink" title="èµ„æºé“¾æ¥ç›¸å…³çš„ç¼–è¾‘å™¨ç»˜åˆ¶"></a>èµ„æºé“¾æ¥ç›¸å…³çš„ç¼–è¾‘å™¨ç»˜åˆ¶</h4><p>è¿™è¾¹å°±æ²¡ä»€ä¹ˆéš¾åº¦çš„ï¼Œè·å–åˆ°åºåˆ—åŒ–çš„å­—æ®µç„¶åç”»å‡ºæ¥å°±å¥½äº†ï¼<br>åˆšæ‰æåˆ°çš„æ³›å‹åªæ˜¯ä¸ºäº†åœ¨ä¸‹é¢ç»˜åˆ¶ ObjectField æ—¶ç”¨æ¥ä¾¿æ·è·å–èµ„æºç±»å‹çš„ã€‚</p>
<img src="/2025/05/10/20250510-assetpath/20250510-assetpath-pic001.png" class="" title="split">
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="meta">CustomPropertyDrawer(typeof(AssetPath&lt;&gt;), true)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AssetPathDrawer</span> : <span class="title">PropertyDrawer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">float</span> <span class="title">GetPropertyHeight</span>(<span class="params">SerializedProperty property, GUIContent label</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">float</span> baseHeight = <span class="keyword">base</span>.GetPropertyHeight(property, label);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3f</span> * baseHeight; <span class="comment">// we need 3 line to show stuff</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params">Rect position, SerializedProperty property, GUIContent label</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        EditorGUI.BeginProperty(position, label, property);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Draw label</span></span><br><span class="line">        position = EditorGUI.PrefixLabel(position, GUIUtility.GetControlID(FocusType.Passive), label);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> elementHeight = <span class="keyword">base</span>.GetPropertyHeight(property, label);</span><br><span class="line">        SerializedProperty guidProperty = property.FindPropertyRelative(<span class="string">"m_guid"</span>);</span><br><span class="line">        SerializedProperty pathProperty = property.FindPropertyRelative(<span class="string">"m_path"</span>);</span><br><span class="line"></span><br><span class="line">        GUIStyle buttonStyle = <span class="keyword">new</span> GUIStyle(GUI.skin.button);</span><br><span class="line">        buttonStyle.alignment = TextAnchor.MiddleLeft;</span><br><span class="line">        Rect rect = <span class="keyword">new</span> Rect(position.x, position.y, position.width, elementHeight);</span><br><span class="line">        <span class="keyword">string</span> guidText = guidProperty.stringValue;</span><br><span class="line">        <span class="keyword">if</span> (GUI.Button(rect, <span class="keyword">new</span> GUIContent(<span class="string">$"Guid: <span class="subst">&#123;guidText&#125;</span>"</span>), buttonStyle))</span><br><span class="line">        &#123;</span><br><span class="line">            GUIUtility.systemCopyBuffer = guidText; <span class="comment">// copy to clipboard</span></span><br><span class="line">            Debug.Log(<span class="string">$"Copy guid text '<span class="subst">&#123;guidText&#125;</span>' to clipboard"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        rect = <span class="keyword">new</span> Rect(position.x, position.y + elementHeight, position.width, elementHeight);</span><br><span class="line">        <span class="keyword">string</span> pathText = pathProperty.stringValue;</span><br><span class="line">        <span class="keyword">if</span> (GUI.Button(rect, <span class="keyword">new</span> GUIContent(<span class="string">$"Path: <span class="subst">&#123;pathText&#125;</span>"</span>), buttonStyle))</span><br><span class="line">        &#123;</span><br><span class="line">            GUIUtility.systemCopyBuffer = pathText; <span class="comment">// copy to clipboard</span></span><br><span class="line">            Debug.Log(<span class="string">$"Copy path text '<span class="subst">&#123;guidText&#125;</span>' to clipboard"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        rect = <span class="keyword">new</span> Rect(position.x, position.y + elementHeight * <span class="number">2</span>, position.width, elementHeight);</span><br><span class="line">        SerializedProperty assetProperty = property.FindPropertyRelative(<span class="string">"m_assetCache"</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != assetProperty)</span><br><span class="line">        &#123;</span><br><span class="line">            UnityObject assetValue = assetProperty.objectReferenceValue;</span><br><span class="line">            Type assetType;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == assetValue)</span><br><span class="line">            &#123;</span><br><span class="line">                Type fieldType = fieldInfo.FieldType;</span><br><span class="line">                Type[] genericTypes = fieldType.BaseType.GenericTypeArguments;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == genericTypes || <span class="number">0</span> == genericTypes.Length)</span><br><span class="line">                &#123;</span><br><span class="line">                    assetType = <span class="keyword">typeof</span>(UnityObject);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    assetType = genericTypes[<span class="number">0</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                assetType = assetValue.GetType();</span><br><span class="line">            &#125;</span><br><span class="line">            UnityObject next = EditorGUI.ObjectField(rect, assetValue, assetType, <span class="literal">false</span>); <span class="comment">// do not allow scene obj so it will actually be asset</span></span><br><span class="line">            <span class="keyword">if</span> (next != assetValue) <span class="comment">// value has changed, set guid and path</span></span><br><span class="line">            &#123;</span><br><span class="line">                pathText = AssetDatabase.GetAssetPath(next);</span><br><span class="line">                guidText = AssetDatabase.AssetPathToGUID(pathText);</span><br><span class="line">                pathProperty.stringValue = pathText;</span><br><span class="line">                guidProperty.stringValue = guidText;</span><br><span class="line">                assetProperty.objectReferenceValue = next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        EditorGUI.EndProperty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="èµ„æºæ„å»ºå‰çš„è·¯å¾„è¡¥å……"><a href="#èµ„æºæ„å»ºå‰çš„è·¯å¾„è¡¥å……" class="headerlink" title="èµ„æºæ„å»ºå‰çš„è·¯å¾„è¡¥å……"></a>èµ„æºæ„å»ºå‰çš„è·¯å¾„è¡¥å……</h4><p>åœ¨æ„å»ºå‰é€šè¿‡guidæˆ–ç¼“å­˜çš„èµ„æºï¼Œå»æŠŠè·¯å¾„åˆ·æ–°ï¼Œç„¶åå°±å¯ä»¥å®‰å¿ƒæ‰“æ„å»ºäº†ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">BundlePreprocess_AssetPath</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PreProcess_AssetPathSoftLink</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * @Hiko</span></span><br><span class="line"><span class="comment">        * </span></span><br><span class="line"><span class="comment">        * Need to match case below, then we get guid, parse actual path</span></span><br><span class="line"><span class="comment">        * m_path: Assets/XX/resource.xx</span></span><br><span class="line"><span class="comment">        * m_guid: 382c74c3721d4f3480e557657b6cbc27</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">DoTextReplace</span>(<span class="params"><span class="keyword">string</span>[] assetGUIDs</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// I have 0 knowledge of Regex, so I ask AI do it :)</span></span><br><span class="line">            <span class="comment">// HACK put 4 space here is becuz there is at least 4 spc before the field name if you take a look into asset yaml file</span></span><br><span class="line">            <span class="keyword">string</span> patternAsSingleField = <span class="string">@"\s*\s\s\s\s\m_path:\s*(?&lt;path&gt;.*)?\s*m_guid:\s*(?&lt;guid&gt;[a-fA-F0-9]*)?"</span>;</span><br><span class="line">            <span class="comment">// if it is a array element, there should be a '-'</span></span><br><span class="line">            <span class="keyword">string</span> patternAsArrayElement = <span class="string">@"\s*-\m_path:\s*(?&lt;path&gt;.*)?\s*m_guid:\s*(?&lt;guid&gt;[a-fA-F0-9]*)?"</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, assetCount = assetGUIDs.Length; i &lt; assetCount; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">string</span> assetGuid = assetGUIDs[i];</span><br><span class="line">                <span class="keyword">string</span> assetPath = AssetDatabase.GUIDToAssetPath(assetGuid);</span><br><span class="line">                <span class="keyword">if</span> (assetPath.StartsWith(<span class="string">"Packages"</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">continue</span>; <span class="comment">// dun know hot to use asset search fitler, skip asset in package here</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">string</span> assetFullpath = Application.dataPath + assetPath.Substring(<span class="string">"Assets"</span>.Length);</span><br><span class="line">                <span class="keyword">string</span> assetText = File.ReadAllText(assetFullpath);</span><br><span class="line">                <span class="keyword">string</span> resultText = assetText;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// AssetPath as normal field</span></span><br><span class="line">                MatchCollection matchCollection = Regex.Matches(assetText, patternAsSingleField, RegexOptions.Multiline);</span><br><span class="line">                <span class="keyword">ulong</span> execCount = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">int</span> matchCount = matchCollection.Count;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> &lt; matchCount)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> matchIndex = <span class="number">0</span>; matchIndex &lt; matchCount; matchIndex++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Match match = matchCollection[matchIndex];</span><br><span class="line">                        <span class="keyword">if</span> (match.Success)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">string</span> matchContent = match.Value;</span><br><span class="line">                            <span class="keyword">int</span> spaceCount = matchContent.IndexOf(<span class="string">"p"</span>) - <span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">string</span> guidString = match.Groups[<span class="string">"guid"</span>].Value;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(guidString) || <span class="number">36</span> &gt; guidString.Length) <span class="comment">// invalid guid</span></span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">string</span> space = <span class="keyword">new</span> <span class="keyword">string</span>(<span class="string">' '</span>, spaceCount); <span class="comment">// add space</span></span><br><span class="line">                            <span class="keyword">string</span> path = AssetDatabase.GUIDToAssetPath(guidString);</span><br><span class="line">                            <span class="keyword">string</span> result1 = <span class="string">$"m_path: <span class="subst">&#123;path&#125;</span>"</span>;</span><br><span class="line">                            <span class="keyword">string</span> result2 = <span class="string">$"m_guid: <span class="subst">&#123;guidString&#125;</span>"</span>;</span><br><span class="line">                            <span class="keyword">string</span> result = <span class="string">$"\n<span class="subst">&#123;space&#125;</span><span class="subst">&#123;result1&#125;</span>\n<span class="subst">&#123;space&#125;</span><span class="subst">&#123;result2&#125;</span>"</span>;</span><br><span class="line">                            resultText = resultText.Replace(matchContent, result);</span><br><span class="line">                            ++execCount;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Asset Path as array element</span></span><br><span class="line">                assetText = resultText;</span><br><span class="line">                matchCollection = Regex.Matches(assetText, patternAsArrayElement, RegexOptions.Multiline);</span><br><span class="line">                matchCount = matchCollection.Count;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> &lt; matchCount)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> matchIndex = <span class="number">0</span>; matchIndex &lt; matchCount; matchIndex++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Match match = matchCollection[matchIndex];</span><br><span class="line">                        <span class="keyword">if</span> (match.Success)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">string</span> matchContent = match.Value;</span><br><span class="line">                            <span class="keyword">int</span> spaceCount = matchContent.IndexOf(<span class="string">"p"</span>) - <span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">string</span> guidString = match.Groups[<span class="string">"guid"</span>].Value;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(guidString) || <span class="number">36</span> &gt; guidString.Length) <span class="comment">// invalid guid</span></span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">string</span> space = <span class="keyword">new</span> <span class="keyword">string</span>(<span class="string">' '</span>, spaceCount); <span class="comment">// add space</span></span><br><span class="line">                            <span class="keyword">string</span> path = AssetDatabase.GUIDToAssetPath(guidString);</span><br><span class="line">                            <span class="keyword">string</span> result1 = <span class="string">$"- m_path: <span class="subst">&#123;path&#125;</span>"</span>;</span><br><span class="line">                            <span class="keyword">string</span> result2 = <span class="string">$"m_guid: <span class="subst">&#123;guidString&#125;</span>"</span>;</span><br><span class="line">                            <span class="keyword">string</span> result = <span class="string">$"\n<span class="subst">&#123;new <span class="keyword">string</span>(<span class="string">' '</span>, spaceCount - <span class="number">2</span>)&#125;</span><span class="subst">&#123;result1&#125;</span>\n<span class="subst">&#123;space&#125;</span><span class="subst">&#123;result2&#125;</span>"</span>;</span><br><span class="line">                            resultText = resultText.Replace(matchContent, result);</span><br><span class="line">                            ++execCount;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> &lt; execCount) <span class="comment">// has changes</span></span><br><span class="line">                &#123;</span><br><span class="line">                    File.WriteAllText(assetFullpath, resultText);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// do stuff for SO first</span></span><br><span class="line">        <span class="keyword">string</span>[] guids = AssetDatabase.FindAssets(<span class="string">$"t: <span class="subst">&#123;<span class="keyword">nameof</span>(ScriptableObject)&#125;</span>"</span>);</span><br><span class="line">        DoTextReplace(guids);</span><br><span class="line">        <span class="comment">// then prefab</span></span><br><span class="line">        guids = AssetDatabase.FindAssets(<span class="string">$"t: prefab"</span>);</span><br><span class="line">        DoTextReplace(guids);</span><br><span class="line">        <span class="comment">// finally scenes</span></span><br><span class="line">        guids = AssetDatabase.FindAssets(<span class="string">$"t: scene"</span>);</span><br><span class="line">        DoTextReplace(guids);</span><br><span class="line">        <span class="comment">// refresh assets</span></span><br><span class="line">        AssetDatabase.Refresh();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™è¾¹å¦‚æœä½¿ç”¨çš„è®©å®¿ä¸»æ¥åˆ·æ–°çš„æ–¹æ³•ï¼Œé‚£æˆ‘è§‰å¾—ä¼šæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„å°ç‚¹ã€‚<br>è¿™ä¸ªæƒ…å†µä¸‹åˆ·æ–°æ“ä½œå…¶å®åº”è¯¥æ³¨æ„å¯¹èµ„æºå¤„ç†çš„é¡ºåºï¼Œæ¯”å¦‚å…ˆå¤„ç† ScriptableObject å†åˆ° Prefabï¼Œæœ€åæ‰æ˜¯ Scene<br>è¿™ä¸ªæ“ä½œçš„å®è´¨æ˜¯ä¿®æ”¹ asset ç„¶åå†æŠŠä¿®æ”¹ç»“æœå†™å›ç£ç›˜ï¼Œå®¿ä¸»å¯¹ä¿®æ”¹çš„å¤„ç†æ–¹å¼å¯èƒ½ä¼šå’Œæˆ‘ä»¬æƒ³çš„ä¸å¤ªä¸€æ ·ã€‚</p>
<p>æ¯”å¦‚è¯´ Scene ä¸­å¾ˆå¯èƒ½ä¼šåŒ…å« prefabï¼Œå¦‚æœå…ˆè®© Scene æ–‡ä»¶æ‰§è¡Œè¿™ä¸ªåˆ·æ–°ï¼Œå¦‚æœç›‘æµ‹å’Œæ£€æŸ¥æ²¡æœ‰åšå……åˆ†çš„æƒ…å†µä¸‹ä¼šæŠ“åˆ° Scene é‡Œçš„ Prefab ç„¶åè®©å…¶åœ¨ Scene é‡Œåšäº†æ›´æ”¹ï¼Œå¹¶å› æ­¤åœ¨ Scene æ–‡ä»¶äº†å¤šå†™äº†ä¸€è¡Œ override ä¿¡æ¯ã€‚<br>åŒæ ·çš„ï¼ŒNested Prefab ä¹Ÿä¼šé‡åˆ°åŒæ ·çš„é—®é¢˜ã€‚è‡³äºå¦‚ä½•æ’å¸ƒèµ„æºå¤„ç†çš„é¡ºåºå¯èƒ½è¿˜å¾—æ ¹æ®å®é™…é¡¹ç›®çš„æƒ…å†µæ¥æŒ‡å®šå…·ä½“çš„è§„åˆ™ã€‚</p>
<p>ä½†æ˜¯ï¼ï¼ï¼å¦‚æœç”¨ç¬¬ä¸€ç§æ–¹æ³•å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºä»…åŒ¹é…ç›®æ ‡æ–‡æœ¬çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šäº§ç”Ÿå¤šä½™çš„ä¿®æ”¹ï¼Œæ‰€æœ‰åŒ¹é…åˆ°çš„ä½ç½®éƒ½æ˜¯è¿™ä¸ªèµ„æºé“¾æ¥ç›´æ¥çš„å®¿ä¸»ã€‚</p>
]]></content>
      <tags>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>æŸ¥è¯¢Assetåœ¨å·¥ç¨‹ä¸­çš„å¼•ç”¨(GUID)</title>
    <url>/2025/02/21/20250221-unity-findref-guid/</url>
    <content><![CDATA[<p>ä¹‹å‰æˆ‘ç”¨Unityè‡ªå¸¦çš„APIå»æŸ¥è¯¢ä¸€äº›ç‰©ä½“çš„å¼•ç”¨ï¼Œç»“æœå½“ç„¶æ˜¯è¶…è¶…è¶…è¶…è¶…çº§æ…¢ï¼Œå¯¹äºé‚£äº›æŠŠé¡¹ç›®å·¥ç¨‹æ”¾åœ¨è¾£é¸¡æœºæ¢°ç›˜ä¸Šçš„åŒäº‹ï¼Œè¿™ä¸ªå·¥å…·æ ¹æœ¬æ˜¯æ²¡æ³•å¥½å¥½ç”¨çš„ã€‚è€Œä¸”å› ä¸ºè¦ç”¨Unityçš„APiï¼Œè‡ªç„¶æ˜¯æ²¡åŠæ³•ä½¿ç”¨asyncçš„ã€‚</p>
<p>æœ€è¿‘å¯¼å¸ˆæ‹¿åˆ°QAé‚£è¾¹æä¾›çš„ä¸€ä¸ªç±»ä¼¼çš„å·¥å…·ï¼Œæ”¹äº†ä¸€ä¸‹ï¼Œåšäº†ä¸€ä¸ªè¶…çº§å¿«çš„ç‰ˆæœ¬ã€‚</p>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>æ€è·¯å…¶å®æ˜¯éå¸¸ç®€å•çš„ã€‚æˆ‘ä»¬çŸ¥é“Unity Assetä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„GUIDï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªGUIDå»æŸ¥è¯¢å…¶å¼•ç”¨ã€‚<br>æŸ¥è¯¢çš„æ—¶å€™æˆ‘ä»¬ä¹Ÿä¸éœ€è¦ä½¿ç”¨Unity APIå»æ£€æŸ¥å¼•ç”¨ï¼Œè€Œæ˜¯æŠŠæˆ‘ä»¬çš„å„ç§Assetéƒ½å½“æˆæ–‡æœ¬æ–‡ä»¶ç›´æ¥è¯»å–ï¼Œç„¶åç›´æ¥åœ¨è¿™äº›æ–‡æœ¬é‡Œå»åŒ¹é…æˆ‘ä»¬éœ€è¦æŸ¥è¯¢çš„GUIDã€‚</p>
<h1 id="ç‰¹æ®Šç”¨é€”"><a href="#ç‰¹æ®Šç”¨é€”" class="headerlink" title="ç‰¹æ®Šç”¨é€”"></a>ç‰¹æ®Šç”¨é€”</h1><p>æœ€è¿‘ç»™é¡¹ç›®é‡Œå¯¼å…¥äº†ä¸€äº›æ–°çš„UIç»„ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç»§æ‰¿TMPåæ‹“å±•çš„å¥½ç”¨çš„UXTMP(ç»§æ‰¿äºTMP)ã€‚äº¤äº’é‚£è¾¹æäº†ä¸ªéœ€æ±‚æ˜¯è¦æ±‚æŠŠå½“å‰UI Prefabé‡Œæ‰€æœ‰çš„TMPæ¢æˆUXTMPã€‚æ²¡æƒ³åˆ°è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„è¿™ä¸ªå·¥å…·åˆæœ‰äº†å¤§ç”¨äº†ã€‚<br>æˆ‘ä»¬ç”¨æ–‡æœ¬çš„æ–¹å¼æ‰“å¼€prefabï¼Œç„¶å¹´åæ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹é‡Œçš„è¿™ä¸€è¡Œ <code>m_Script: {fileID: xxxxxxxx, guid: f46886236gsd6437aeb418b961at14c5, type: 3}</code> æŠŠguidæ”¹æˆUXTMPçš„guidå°±å¥½äº†ï¼Œ<a href="https://2c2c2c.github.io/2024/07/14/20240714-unity-serialization-1/" target="_blank" rel="noopener">è¯¦æƒ…å‚è€ƒç€ä¸€ç¯‡ç¬”è®°</a>ã€‚è¿™ä¸€è¡Œæ˜¯æè¿°æŸä¸ªç»„ä»¶å¯¹åº”çš„ç±»çš„ç±»å‹ã€‚æ—¢ç„¶UXTMPç»§æ‰¿è‡ªTMPï¼Œé‚£æˆ‘ä»¬ä¹Ÿä¸éœ€è¦è°ƒæ•´åºåˆ—åŒ–çš„å­—æ®µèµ‹å€¼ã€‚</p>
<h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p>å®é™…æ‰§è¡Œçš„æ–‡ä»¶æ“ä½œ</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">public interface IFileOperation&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> FileCount &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">int</span> Operated &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    Task&lt;T&gt; OperationTask &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">float</span> PercentCompletion &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">string</span> CurrentOperationMessage &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">bool</span> Running &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Cancel</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class FileAnalysis : IFileOperation&lt;string[]&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span>[] m_folders;</span><br><span class="line">    <span class="keyword">private</span> Predicate&lt;<span class="keyword">string</span>&gt; m_fileFilter;</span><br><span class="line">    <span class="keyword">private</span> Regex m_regexCheck;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CancellationTokenSource m_tokenSource;</span><br><span class="line">    <span class="keyword">private</span> CancellationToken m_cachedToken;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Task&lt;<span class="keyword">string</span>[]&gt; OperationTask &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> PercentCompletion &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> CurrentOperationMessage &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> FileCount &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> Operated &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> Running =&gt; OperationTask.Status <span class="keyword">switch</span></span><br><span class="line">    &#123;</span><br><span class="line">        TaskStatus.RanToCompletion =&gt; <span class="literal">false</span>,</span><br><span class="line">        TaskStatus.Faulted =&gt; <span class="literal">false</span>,</span><br><span class="line">        TaskStatus.Canceled =&gt; <span class="literal">false</span>,</span><br><span class="line">        _ =&gt; <span class="literal">true</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CancellationToken Token =&gt; m_cachedToken;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IFileOperation&lt;<span class="keyword">string</span>[]&gt; AnalyzeFolders(<span class="keyword">string</span>[] folders, Predicate&lt;<span class="keyword">string</span>&gt; fileFilter, Regex regexCheck)</span><br><span class="line">    &#123;</span><br><span class="line">        FileAnalysis operation = <span class="keyword">new</span> FileAnalysis(folders, fileFilter, regexCheck);</span><br><span class="line">        operation.DoOperation();</span><br><span class="line">        <span class="keyword">return</span> operation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FileAnalysis</span>(<span class="params"><span class="keyword">string</span>[] folders, Predicate&lt;<span class="keyword">string</span>&gt; fileFilter, Regex regexCheck</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_folders = folders;</span><br><span class="line">        m_fileFilter = fileFilter;</span><br><span class="line">        m_regexCheck = regexCheck;</span><br><span class="line">        m_tokenSource = <span class="keyword">new</span> CancellationTokenSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Cancel</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != m_tokenSource)</span><br><span class="line">        &#123;</span><br><span class="line">            m_tokenSource.Cancel();</span><br><span class="line">            m_tokenSource.Dispose();</span><br><span class="line">            m_tokenSource = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoOperation</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == OperationTask)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                OperationTask = Task.Factory.StartNew&lt;<span class="keyword">string</span>[]&gt;(CheckFolders, cancellationToken: m_cachedToken = m_tokenSource.Token);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception _) &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">string</span>[] <span class="title">CheckFolders</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">string</span>[] files = m_folders.SelectMany(folder =&gt; Directory.GetFiles(folder, <span class="string">"*"</span>, SearchOption.AllDirectories)).ToArray();</span><br><span class="line">        List&lt;<span class="keyword">string</span>&gt; result = <span class="keyword">new</span> List&lt;<span class="keyword">string</span>&gt;(<span class="number">200</span>);</span><br><span class="line">        <span class="keyword">int</span> count = files.Length;</span><br><span class="line">        FileCount = count;</span><br><span class="line">        Operated = <span class="number">0</span>;</span><br><span class="line">        PercentCompletion = <span class="number">0f</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Token.ThrowIfCancellationRequested();</span><br><span class="line">            <span class="keyword">string</span> filePath = files[i];</span><br><span class="line">            <span class="keyword">if</span> (m_fileFilter(filePath))</span><br><span class="line">            &#123;</span><br><span class="line">                CurrentOperationMessage = filePath;</span><br><span class="line">                <span class="keyword">if</span> (CheckFile(filePath, m_regexCheck))</span><br><span class="line">                &#123;</span><br><span class="line">                    result.Add(filePath.Replace(<span class="string">'\\'</span>, <span class="string">'/'</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                Operated++;</span><br><span class="line">                PercentCompletion = (i / (<span class="keyword">float</span>)count) * <span class="number">100f</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.ToArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">bool</span> <span class="title">CheckFile</span>(<span class="params"><span class="keyword">string</span> filepath, Regex check</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">string</span> assetText = File.ReadAllText(filepath);</span><br><span class="line">        MatchCollection matches = check.Matches(assetText);</span><br><span class="line">        <span class="keyword">bool</span> result = matches.Count &gt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class FileTextReplace : IFileOperation&lt;string[]&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span>[] m_fullPaths;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> m_prevText;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> m_nextText;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CancellationTokenSource m_tokenSource;</span><br><span class="line">    <span class="keyword">private</span> CancellationToken m_cachedToken;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Task&lt;<span class="keyword">string</span>[]&gt; OperationTask &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> PercentCompletion &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> CurrentOperationMessage &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> FileCount &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> Operated &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> Running =&gt; OperationTask.Status <span class="keyword">switch</span></span><br><span class="line">    &#123;</span><br><span class="line">        TaskStatus.RanToCompletion =&gt; <span class="literal">false</span>,</span><br><span class="line">        TaskStatus.Faulted =&gt; <span class="literal">false</span>,</span><br><span class="line">        TaskStatus.Canceled =&gt; <span class="literal">false</span>,</span><br><span class="line">        _ =&gt; <span class="literal">true</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CancellationToken Token =&gt; m_cachedToken;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IFileOperation&lt;<span class="keyword">string</span>[]&gt; ReplaceText(<span class="keyword">string</span>[] fullpaths, <span class="keyword">string</span> prevText, <span class="keyword">string</span> nextText)</span><br><span class="line">    &#123;</span><br><span class="line">        FileTextReplace operation = <span class="keyword">new</span> FileTextReplace(fullpaths, prevText, nextText);</span><br><span class="line">        operation.DoOperation();</span><br><span class="line">        <span class="keyword">return</span> operation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FileTextReplace</span>(<span class="params"><span class="keyword">string</span>[] fullpaths, <span class="keyword">string</span> prevText, <span class="keyword">string</span> nextText</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_fullPaths = fullpaths;</span><br><span class="line">        m_prevText = prevText;</span><br><span class="line">        m_nextText = nextText;</span><br><span class="line">        m_tokenSource = <span class="keyword">new</span> CancellationTokenSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoOperation</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == OperationTask)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                OperationTask = Task.Factory.StartNew&lt;<span class="keyword">string</span>[]&gt;(DoReplaceToFiles, cancellationToken: m_cachedToken = m_tokenSource.Token);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception _) &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Cancel</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != m_tokenSource)</span><br><span class="line">        &#123;</span><br><span class="line">            m_tokenSource.Cancel();</span><br><span class="line">            m_tokenSource.Dispose();</span><br><span class="line">            m_tokenSource = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">string</span>[] <span class="title">DoReplaceToFiles</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        List&lt;<span class="keyword">string</span>&gt; temp = <span class="keyword">new</span> List&lt;<span class="keyword">string</span>&gt;();</span><br><span class="line">        Operated = <span class="number">0</span>;</span><br><span class="line">        FileCount = m_fullPaths.Length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = m_fullPaths.Length; i &lt; length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Token.ThrowIfCancellationRequested();</span><br><span class="line">            <span class="keyword">string</span> assetFullPath = m_fullPaths[i];</span><br><span class="line">            <span class="keyword">string</span> assetText = File.ReadAllText(assetFullPath);</span><br><span class="line">            <span class="keyword">string</span> nextAssetText = assetText.Replace(m_prevText, m_nextText);</span><br><span class="line">            File.WriteAllText(assetFullPath, nextAssetText);</span><br><span class="line">            temp.Add(assetFullPath);</span><br><span class="line">            Operated++;</span><br><span class="line">            CurrentOperationMessage = assetFullPath;</span><br><span class="line">            PercentCompletion = (i / (<span class="keyword">float</span>)length) * <span class="number">100f</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> &lt; temp.Count)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> temp.ToArray();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AssetUsageSearchWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Flags</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">enum</span> AssetFilter</span><br><span class="line">    &#123;</span><br><span class="line">        Asset = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,</span><br><span class="line">        Material = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</span><br><span class="line">        Prefab = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</span><br><span class="line">        Scene = <span class="number">1</span> &lt;&lt; <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">struct</span> SearchRequest</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> searchTextOnly;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> targetString;</span><br><span class="line">        <span class="keyword">public</span> UnityObject Asset</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">string</span> path = AssetPath;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(path))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> AssetDatabase.LoadAssetAtPath&lt;UnityObject&gt;(path);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> != <span class="keyword">value</span> &amp;&amp; AssetDatabase.TryGetGUIDAndLocalFileIdentifier&lt;UnityObject&gt;(<span class="keyword">value</span>, <span class="keyword">out</span> <span class="keyword">string</span> guid, <span class="keyword">out</span> _))</span><br><span class="line">                &#123;</span><br><span class="line">                    targetString = guid;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> AssetPath =&gt; searchTextOnly ? <span class="keyword">string</span>.Empty : AssetDatabase.GUIDToAssetPath(targetString);</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">long</span> FileID</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                UnityObject asset = Asset;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> != asset &amp;&amp; AssetDatabase.TryGetGUIDAndLocalFileIdentifier(asset, <span class="keyword">out</span> _, <span class="keyword">out</span> <span class="keyword">long</span> fileId))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> fileId;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">struct</span> AssetResult</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> fullPath;</span><br><span class="line">        <span class="keyword">public</span> UnityObject asset;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span>// <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>// used to ping the actual asset dat has the direct reference</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>// <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment">//public UnityObject subAssetIfNeed;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> only search specify text from asset</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> m_searchTextOnly = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AssetFilter m_filter = (AssetFilter)~<span class="number">0</span>; <span class="comment">// Everything by default</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;<span class="keyword">string</span>&gt; m_searchFolders = <span class="keyword">new</span> List&lt;<span class="keyword">string</span>&gt;();</span><br><span class="line">    <span class="keyword">private</span> SearchRequest m_search;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IFileOperation&lt;<span class="keyword">string</span>[]&gt; m_operationTask = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> m_waitForResult = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> AssetResult[] m_assetResults = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Regex m_pathFilterRegex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Vector2 m_scrollPos;</span><br><span class="line">    <span class="keyword">private</span> Stopwatch m_processTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> m_searchReplaceText = <span class="keyword">string</span>.Empty;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> IsBusy =&gt; <span class="literal">null</span> != m_operationTask &amp;&amp; m_operationTask.Running;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">MenuItem(<span class="meta-string">"Tools/Temp Asset Usage Search"</span>, priority = 4)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OpenWindowLah</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (EditorWindow.HasOpenInstances&lt;AssetUsageSearchWindow&gt;())</span><br><span class="line">        &#123;</span><br><span class="line">            UnityDebug.LogError(<span class="string">$"Editor window <span class="subst">&#123;<span class="keyword">nameof</span>(AssetUsageSearchWindow)&#125;</span> can only have 1 instance."</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        AssetUsageSearchWindow window = CreateWindow&lt;AssetUsageSearchWindow&gt;();</span><br><span class="line">        window.Show();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// init</span></span><br><span class="line">        window.titleContent = <span class="keyword">new</span> GUIContent(<span class="string">"Asset Usage Search"</span>);</span><br><span class="line">        window.RefreshPathFilter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.VerticalScope(EditorStyles.helpBox))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">bool</span> isSearching = <span class="literal">null</span> != m_operationTask &amp;&amp; m_operationTask.OperationTask.Status == TaskStatus.Running;</span><br><span class="line">            <span class="keyword">bool</span> isFaulted = <span class="literal">null</span> != m_operationTask &amp;&amp; m_operationTask.OperationTask.Status == TaskStatus.Faulted;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUI.DisabledGroupScope(IsBusy))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// draw search info</span></span><br><span class="line">                m_searchTextOnly = EditorGUILayout.Toggle(<span class="string">"Search Text Only"</span>, m_searchTextOnly);</span><br><span class="line">                <span class="keyword">string</span> searchLable = m_searchTextOnly ? <span class="string">"Search for string (Text)"</span> : <span class="string">"Search for Asset (GUID)"</span>;</span><br><span class="line">                SearchRequest request = m_search;</span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.HorizontalScope())</span><br><span class="line">                &#123;</span><br><span class="line">                    EditorGUILayout.PrefixLabel(searchLable);</span><br><span class="line">                    <span class="keyword">if</span> (m_searchTextOnly)</span><br><span class="line">                    &#123;</span><br><span class="line">                        request.targetString = EditorGUILayout.TextField(request.targetString);</span><br><span class="line">                        m_searchReplaceText = EditorGUILayout.TextField(<span class="string">"Replace Text"</span>, m_searchReplaceText);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">bool</span> prev = GUI.enabled;</span><br><span class="line">                        GUI.enabled = <span class="literal">false</span>;</span><br><span class="line">                        request.targetString = EditorGUILayout.TextField(request.targetString);</span><br><span class="line">                        GUI.enabled = prev;</span><br><span class="line">                        request.Asset = EditorGUILayout.ObjectField(request.Asset, <span class="keyword">typeof</span>(UnityObject), <span class="literal">false</span>);</span><br><span class="line">                        <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUI.DisabledGroupScope(<span class="literal">true</span>))</span><br><span class="line">                        &#123;</span><br><span class="line">                            EditorGUILayout.TextField(<span class="string">"FileID: "</span>, request.FileID.ToString());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                m_search = request;</span><br><span class="line">                m_filter = (AssetFilter)EditorGUILayout.EnumFlagsField(<span class="string">"Asset Filter"</span>, m_filter);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Draw folder</span></span><br><span class="line">                EditorGUILayout.LabelField(<span class="string">"Target folders:"</span>);</span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.VerticalScope(EditorStyles.helpBox))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (GUILayout.Button(<span class="string">"Add Folder"</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        m_searchFolders.Add(Application.dataPath);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_searchFolders.Count; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.HorizontalScope())</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">if</span> (GUILayout.Button(<span class="string">"X"</span>, EditorStyles.miniButton, GUILayout.Width(<span class="number">26</span>)))</span><br><span class="line">                            &#123;</span><br><span class="line">                                m_searchFolders.RemoveAt(i);</span><br><span class="line">                                i--;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">string</span> folderResult = DrawSelectFolder(m_searchFolders[i]);</span><br><span class="line">                            m_searchFolders[i] = <span class="keyword">string</span>.IsNullOrEmpty(folderResult) ? m_searchFolders[i] : folderResult;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// search button</span></span><br><span class="line">                <span class="keyword">if</span> (GUILayout.Button(<span class="string">$"Search References for  \"<span class="subst">&#123;m_search.targetString&#125;</span>\""</span>) &amp;&amp; !<span class="keyword">string</span>.IsNullOrEmpty(m_search.targetString))</span><br><span class="line">                &#123;</span><br><span class="line">                    DoSearch();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// replace button</span></span><br><span class="line">                <span class="keyword">if</span> (!IsBusy &amp;&amp; !isSearching &amp;&amp; !isFaulted &amp;&amp; m_searchTextOnly &amp;&amp; (<span class="literal">null</span> != m_assetResults &amp;&amp; <span class="number">0</span> &lt; m_assetResults.Length))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (GUILayout.Button(<span class="string">$"Replace Text"</span>))</span><br><span class="line">                    &#123;</span><br><span class="line">                        DoTextReplace(); <span class="comment">// TODO @Hiko use task to prevent editor window STUCK :(</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isSearching) DrawOperatingGUI();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (isFaulted) EditorGUILayout.HelpBox(<span class="string">$"Error while running search:\n<span class="subst">&#123;m_operationTask.OperationTask.Exception&#125;</span>"</span>, MessageType.Error);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (m_assetResults != <span class="literal">null</span>) DrawOperationResultGUI();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">string</span> <span class="title">DrawSelectFolder</span>(<span class="params"><span class="keyword">string</span> folderPath</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.HorizontalScope())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">bool</span> prev = GUI.enabled;</span><br><span class="line">            GUI.enabled = <span class="literal">false</span>;</span><br><span class="line">            EditorGUILayout.TextField(folderPath);</span><br><span class="line">            GUI.enabled = prev;</span><br><span class="line">            <span class="keyword">if</span> (GUILayout.Button(<span class="string">"Select"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                folderPath = EditorUtility.OpenFolderPanel(<span class="string">"Select target folder"</span>, Application.dataPath, <span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> folderPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DoTextReplace</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        List&lt;<span class="keyword">string</span>&gt; pathList = <span class="keyword">new</span> List&lt;<span class="keyword">string</span>&gt;(m_assetResults.Length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = m_assetResults.Length; i &lt; length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            AssetResult searchResult = m_assetResults[i];</span><br><span class="line">            <span class="comment">//if (searchResult.subAssetIfNeed)</span></span><br><span class="line">            <span class="comment">//&#123;</span></span><br><span class="line">            <span class="comment">//    continue;</span></span><br><span class="line">            <span class="comment">//&#125;</span></span><br><span class="line">            pathList.Add(searchResult.fullPath);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> &lt; pathList.Count)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (EditorUtility.DisplayDialog(<span class="string">"Are you sure?"</span>, <span class="string">"The operation can not be canceled"</span>, <span class="string">"Yes just do it"</span>, <span class="string">"Dun do it"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                m_assetResults = Array.Empty&lt;AssetResult&gt;();</span><br><span class="line">                m_processTime = Stopwatch.StartNew();</span><br><span class="line">                m_operationTask = FileTextReplace.ReplaceText(pathList.ToArray(), m_search.targetString, m_searchReplaceText);</span><br><span class="line">                m_waitForResult = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DoSearch</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_assetResults = Array.Empty&lt;AssetResult&gt;();</span><br><span class="line">        m_processTime = Stopwatch.StartNew();</span><br><span class="line">        RefreshPathFilter();</span><br><span class="line">        m_operationTask = FileAnalysis.AnalyzeFolders(m_searchFolders.Count &gt; <span class="number">0</span> ? m_searchFolders.ToArray() : <span class="keyword">new</span> <span class="keyword">string</span>[] &#123; Application.dataPath &#125;, FilterPath, <span class="keyword">new</span> Regex(m_search.targetString));</span><br><span class="line">        m_waitForResult = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">bool</span> <span class="title">FilterPath</span>(<span class="params"><span class="keyword">string</span> path</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == m_pathFilterRegex)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> m_pathFilterRegex.IsMatch(path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawOperatingGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        EditorGUILayout.LabelField(<span class="string">$"Operating: <span class="subst">&#123;m_operationTask.PercentCompletion:F2&#125;</span>%"</span>);</span><br><span class="line">        EditorGUILayout.LabelField(m_operationTask.CurrentOperationMessage);</span><br><span class="line">        <span class="keyword">if</span> (GUILayout.Button(<span class="string">"Cancel"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            m_operationTask.Cancel();</span><br><span class="line">            <span class="comment">//m_operationTask = null;</span></span><br><span class="line">            m_processTime.Stop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawOperationResultGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        EditorGUILayout.LabelField(<span class="string">$"Result <span class="subst">&#123;m_assetResults.Length&#125;</span> assets:"</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != m_processTime)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (m_processTime.IsRunning)</span><br><span class="line">            &#123;</span><br><span class="line">                m_processTime.Stop();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (m_operationTask <span class="keyword">is</span> FileAnalysis)</span><br><span class="line">            &#123;</span><br><span class="line">                EditorGUILayout.LabelField(<span class="string">$"Operation time <span class="subst">&#123;m_processTime.ElapsedMilliseconds&#125;</span>ms, <span class="subst">&#123;m_operationTask.Operated&#125;</span>/<span class="subst">&#123;m_operationTask.FileCount&#125;</span> files scanned"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (m_operationTask <span class="keyword">is</span> FileTextReplace)</span><br><span class="line">            &#123;</span><br><span class="line">                EditorGUILayout.LabelField(<span class="string">$"Operation time <span class="subst">&#123;m_processTime.ElapsedMilliseconds&#125;</span>ms, <span class="subst">&#123;m_operationTask.Operated&#125;</span>/<span class="subst">&#123;m_operationTask.FileCount&#125;</span> files got text replced"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.HorizontalScope())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (GUILayout.Button(<span class="string">"Copy list to clipboard"</span>, EditorStyles.miniButton))</span><br><span class="line">            &#123;</span><br><span class="line">                GUIUtility.systemCopyBuffer = <span class="keyword">string</span>.Join(<span class="string">"\n"</span>, m_assetResults.Select(rst =&gt; rst.fullPath));</span><br><span class="line">            &#125;</span><br><span class="line">            GUILayout.FlexibleSpace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// since we dun have tons of result, we dun need to apply recycle scroll view here</span></span><br><span class="line">        <span class="keyword">using</span> (EditorGUILayout.ScrollViewScope scrollview = <span class="keyword">new</span> EditorGUILayout.ScrollViewScope(m_scrollPos, EditorStyles.helpBox))</span><br><span class="line">        &#123;</span><br><span class="line">            m_scrollPos = scrollview.scrollPosition;</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.VerticalScope())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_assetResults.Length; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">using</span> (<span class="keyword">new</span> EditorGUILayout.HorizontalScope(EditorStyles.helpBox))</span><br><span class="line">                    &#123;</span><br><span class="line">                        AssetResult result = m_assetResults[i];</span><br><span class="line">                        Rect foldoutRect = GUILayoutUtility.GetRect(<span class="number">20</span>, EditorGUIUtility.singleLineHeight, GUILayout.Width(<span class="number">20</span>));</span><br><span class="line">                        EditorGUILayout.ObjectField(result.asset, <span class="keyword">typeof</span>(UnityObject), <span class="literal">false</span>);</span><br><span class="line">                        <span class="keyword">string</span> assetFullPath = result.fullPath;</span><br><span class="line">                        <span class="keyword">if</span> (GUILayout.Button(<span class="keyword">new</span> GUIContent(assetFullPath, result.fullPath)))</span><br><span class="line">                        &#123;</span><br><span class="line">                            UnityDebug.Log(<span class="string">$"copy full path <span class="subst">&#123;assetFullPath&#125;</span> to clipboard"</span>);</span><br><span class="line">                            GUIUtility.systemCopyBuffer = assetFullPath;</span><br><span class="line">                            EditorGUIUtility.PingObject(result.asset);</span><br><span class="line">                        &#125;</span><br><span class="line">                        m_assetResults[i] = result;</span><br><span class="line">                        EditorGUILayout.EndFoldoutHeaderGroup();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != m_operationTask)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (m_operationTask.OperationTask.Status == TaskStatus.Running)</span><br><span class="line">            &#123;</span><br><span class="line">                Repaint();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (m_operationTask.OperationTask.Status == TaskStatus.RanToCompletion &amp;&amp; m_waitForResult)</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (m_operationTask <span class="keyword">is</span> FileAnalysis) &#123; &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (m_operationTask <span class="keyword">is</span> FileTextReplace)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">string</span>[] results = m_operationTask.OperationTask.Result;</span><br><span class="line">                    <span class="keyword">string</span> tempLog = <span class="keyword">string</span>.Empty;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, length = results.Length; i &lt; length; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">string</span> assetFullPath = results[i];</span><br><span class="line">                        AssetDatabase.ImportAsset(assetFullPath);</span><br><span class="line">                        <span class="keyword">string</span> assetPath = assetFullPath.Substring(Application.dataPath.Length - <span class="number">6</span>);</span><br><span class="line">                        tempLog += <span class="string">$"<span class="subst">&#123;assetPath&#125;</span>\n"</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    UnityDebug.Log(<span class="string">$"Do Text reaplce for asset:\n <span class="subst">&#123;tempLog&#125;</span>"</span>);</span><br><span class="line">                    EditorUtility.DisplayDialog(<span class="string">"Done"</span>, <span class="string">$"Did text replace for <span class="subst">&#123;results.Length&#125;</span> files"</span>, <span class="string">"OK"</span>);</span><br><span class="line">                    AssetDatabase.Refresh();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Result filling is done here because it needs to run on main thread</span></span><br><span class="line">                m_waitForResult = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">string</span>[] result = m_operationTask.OperationTask.Result;</span><br><span class="line">                <span class="keyword">int</span> count = result.Length;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> == count)</span><br><span class="line">                &#123;</span><br><span class="line">                    m_assetResults = Array.Empty&lt;AssetResult&gt;();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="literal">null</span> == m_assetResults)</span><br><span class="line">                    &#123;</span><br><span class="line">                        m_assetResults = <span class="keyword">new</span> AssetResult[count];</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (m_assetResults.Length != count)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Array.Resize(<span class="keyword">ref</span> m_assetResults, count);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">string</span> assetPath = <span class="string">$"Assets<span class="subst">&#123;result[i].Substring(Application.dataPath.Length)&#125;</span>"</span>;</span><br><span class="line">                    UnityObject asset = AssetDatabase.LoadAssetAtPath&lt;UnityObject&gt;(assetPath);</span><br><span class="line">                    m_assetResults[i] = <span class="keyword">new</span> AssetResult</span><br><span class="line">                    &#123;</span><br><span class="line">                        fullPath = result[i],</span><br><span class="line">                        asset = asset,</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">                Repaint();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RefreshPathFilter</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">string</span> extensionFilter = GetExtensionFilter(m_filter);</span><br><span class="line">        m_pathFilterRegex = <span class="keyword">new</span> Regex(<span class="keyword">string</span>.Format(<span class="string">@"^.*\.(&#123;0&#125;)$"</span>, extensionFilter));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">string</span> <span class="title">GetExtensionFilter</span>(<span class="params">AssetFilter filter</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        List&lt;<span class="keyword">string</span>&gt; extensions = <span class="keyword">new</span> List&lt;<span class="keyword">string</span>&gt;();</span><br><span class="line">        <span class="keyword">if</span> (filter.HasFlag(AssetFilter.Asset))</span><br><span class="line">        &#123;</span><br><span class="line">            extensions.Add(<span class="string">"asset"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (filter.HasFlag(AssetFilter.Material))</span><br><span class="line">        &#123;</span><br><span class="line">            extensions.Add(<span class="string">"mat"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (filter.HasFlag(AssetFilter.Prefab))</span><br><span class="line">        &#123;</span><br><span class="line">            extensions.Add(<span class="string">"prefab"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (filter.HasFlag(AssetFilter.Scene))</span><br><span class="line">        &#123;</span><br><span class="line">            extensions.Add(<span class="string">"unity"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">string</span> extensionFilter = <span class="keyword">string</span>.Join(<span class="string">"|"</span>, extensions);</span><br><span class="line">        <span class="keyword">return</span> extensionFilter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³é”®ä»£ç å’ŒUnity APIæ¯«æ— å…³ç³»ï¼Œç”¨Taskè·‘è¿˜å¯ä»¥å¯ä»¥é¿å…é•¿æ—¶é—´çš„å¡æ­»ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿèƒ½åŠ å…¥å–æ¶ˆçš„åŠŸèƒ½ã€‚å¦‚æœåœ¨ä¹æ€§èƒ½çš„è¯å¯ä»¥è¿˜å¯ä»¥åœ¨è¯»æ–‡ä»¶æ£€æŸ¥è¿™è¾¹åšä¼˜åŒ–ã€‚ä¸è¿‡æ„Ÿè§‰è¿™æ ·å·²ç»æ¯”ä¹‹å‰å¿«äº†è®¸å¤šäº†ã€‚</p>
]]></content>
      <categories>
        <category>UnityEditor</category>
      </categories>
      <tags>
        <tag>Unity</tag>
        <tag>UnityEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»™PrimeTweenæ–°å¢å°å°çš„å¼‚æ­¥ä»£ç æ”¯æŒ</title>
    <url>/2024/10/29/20241029-primetween-async-extension/</url>
    <content><![CDATA[<p>æœ€è¿‘åšçš„æ–°é¡¹ç›®æ²¡æœ‰ä½¿ç”¨ DOTween äº†ï¼Œè½¬è€Œä½¿ç”¨æ€§èƒ½æ¯”è¾ƒé«˜çš„ <a href="https://github.com/KyryloKuzyk/PrimeTween" target="_blank" rel="noopener">PrimeTween</a>ã€‚è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„æ’ä»¶ï¼Œçœ‹äº†ä¸‹å¤§æ¦‚æ˜¯å‰ä¸¤å¹´ä¸Šæ¶çš„ã€‚<br>æ¯”èµ·å†å²æ‚ ä¹…çš„ DOTween ç›¸æ¯”ï¼Œ PrimeTween è™½ç„¶æ€§èƒ½å¾ˆé«˜ï¼Œä½†æ˜¯ä¸åƒ DOTween æœ‰ä¸°å¯Œçš„ç‰¹æ€§ä»¥åŠä¸€äº›é¢å¤–çš„å…¶å®ƒæ’ä»¶çš„è”åŠ¨æ”¯æŒã€‚</p>
<p>å…·ä½“çš„å°±è¯´ UniTask å§ï¼Œä»–æœ‰ä¸€ä¸ªä¸“é—¨çš„<a href="https://github.com/Cysharp/UniTask/blob/master/src/UniTask/Assets/Plugins/UniTask/Runtime/External/DOTween/DOTweenAsyncExtensions.cs" target="_blank" rel="noopener">æ‹“å±•ç±»</a>ç»™äºˆ DOTwee å¼‚æ­¥ç›¸å…³çš„æ”¯æŒã€‚è¿™é‡Œé¢æœ‰æˆ‘ç°åœ¨é©¬ä¸Šå°±éœ€è¦ç”¨åˆ°çš„ â€œä½¿ç”¨ CancellationToken å–æ¶ˆå¯¹ Tween çš„å¼‚æ­¥ç­‰å¾…â€ çš„åŠŸèƒ½ã€‚</p>
<p>PrimeTween æ²¡æœ‰è¿™ä¸ªæ”¯æŒï¼Œæ²¡å…³ç³»ï¼Œæˆ‘åªè¦ç…§ç€è¿™ä¸ªæ‹“å±•ç±»æŠ„ä¸€ä¸ªå°±å¥½ï¼Œè™½ç„¶è¿™ä¿©Tweençš„å®ç°ä¸å¤ªä¸€æ ·ï¼Œä½†æ˜¯æ ¸å¿ƒçš„è¡Œä¸ºè¿˜æ˜¯éå¸¸ç›¸ä¼¼çš„ã€‚</p>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>ç¨å¾®ç‚¹F12è·³ä¸¤ä¸‹å°±å‘ç°ï¼Œå…¶å®è¿™ä¸ªåŠŸèƒ½çš„å®ç°æ€è·¯å°±æ˜¯é€šè¿‡æ–¹æ³• <a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.cancellationtoken.register?view=net-8.0" target="_blank" rel="noopener">CancellationToken.Register</a> å»ç»™C ancellationToken æ”¶åˆ°å–æ¶ˆè¯·æ±‚çš„æ—¶æœºæ³¨å†Œä¸€ä¸ªå›è°ƒã€‚åœ¨è¿™ä¸ªå›è°ƒä¸­å»å¤„ç†å…³äºTweençš„å„ç§å¤„ç†ã€‚</p>
<p>DOTween çš„æ‹“å±•å¤„ç†ä¸­ä¼šæŠŠåŸæœ¬ Tween çš„æ­£å¸¸æ’­æ”¾å®Œæˆç›¸å…³å›è°ƒæ‹¿å‡ºæ¥ç„¶åç¼“å­˜åœ¨è‡ªå·±çš„ç»“æ„ä¸­å¹¶æ¢ä¸Šè‡ªå·±çš„å“åº”åŠ¨ç”»çš„æ­£å¸¸å®Œæˆã€‚PrimeTween å’Œ DOTween ä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äº PrimeTween çš„å›è°ƒä¸èƒ½é‡å¤ç»‘å®šï¼Œæ‰€ä»¥ç…§ç€æŠ„çš„æ—¶å€™ä¸ºäº†ä¿è¯ä»£ç çš„ä¸€è‡´æ€§ï¼Œæˆ‘é€‰æ‹©ç”¨ PrimeTween æ’ä»¶ä¸­çš„ Sequence æŠŠåŸæœ¬çš„ Tween/Sequence åŒ…è£…èµ·æ¥ï¼Œä¼¼ä¹è¿™ä¸ªåº”è¯¥æ˜¯ä»–æ’ä»¶æœ¬èº«å°±æ¨èçš„åšæ³•ã€‚å½“ç„¶åŒ…èµ·æ¥ä»¥åå°±ä¸å¯ä»¥å†ç¼–è¾‘åŸ Tween çš„ä¸€äº›å‚æ•°äº†ã€‚</p>
<p>PrimeTween é«˜æ€§èƒ½çš„åŸå› ä¼¼ä¹æ˜¯ä»–æŠŠå®é™…æ‰§è¡Œ Tween è¡Œä¸ºçš„å®ä¾‹éƒ½ç”¨å¯¹è±¡æ± ç®¡ç†èµ·æ¥äº†ï¼Œä¸åƒ DOTween éœ€è¦ç”¨æˆ·è‡ªå·±ç®¡ç†åŠ¨ç”»å®ä¾‹å¯¹è±¡ã€‚è€Œä¸” DOTween çš„ç”¨äºå­˜æ”¾ç›¸å…³åŠ¨ç”»å‚æ•°çš„æ•°æ®ç»“æ„ TweenSetting å¥½åƒä¹Ÿæ˜¯ç±»ï¼Œè¿™ç‚¹å…¶å®è®©æˆ‘æœ‰ç‚¹è®¨åŒã€‚</p>
<h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cysharp.Threading.Tasks</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> TweenCancelBehaviour</span><br><span class="line">    &#123;</span><br><span class="line">        KillAndCancelAwait,</span><br><span class="line">        <span class="comment">// TODO @Hiko finish those cancel behaviour if really need :)</span></span><br><span class="line">        <span class="comment">// Kill,</span></span><br><span class="line">        <span class="comment">//KillWithCompleteCallback,</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">PrimeTweenAsyncExtensions</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">struct</span> TweenAwaiter : ICriticalNotifyCompletion</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">readonly</span> Tween tween;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">readonly</span> Sequence warppedSequence;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// killed(non active) as completed.</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">bool</span> IsCompleted =&gt; !tween.isAlive;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">TweenAwaiter</span>(<span class="params">Tween tween</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">this</span>.tween = tween;</span><br><span class="line">                warppedSequence = Sequence.Create(<span class="keyword">this</span>.tween);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> TweenAwaiter <span class="title">GetAwaiter</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetResult</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                UnsafeOnCompleted(continuation);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UnsafeOnCompleted</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="comment">// onKill is called after OnCompleted, both Complete(false/true) and Kill(false/true).</span></span><br><span class="line">                warppedSequence.OnComplete(PooledPrimeTweenCallback.Create(continuation));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TweenAwaiter <span class="title">GetAwaiter</span>(<span class="params"><span class="keyword">this</span> Tween tween</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TweenAwaiter(tween);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UniTask <span class="title">WithCancellation</span>(<span class="params"><span class="keyword">in</span> <span class="keyword">this</span> Tween tween, CancellationToken cancellationToken</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!tween.isAlive) <span class="keyword">return</span> UniTask.CompletedTask;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> UniTask(TweenConfiguredSource.Create(tween, TweenCancelBehaviour.KillAndCancelAwait, cancellationToken, <span class="keyword">out</span> <span class="keyword">var</span> token, <span class="keyword">out</span> _), token);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UniTask <span class="title">WithCancellation</span>(<span class="params"><span class="keyword">in</span> <span class="keyword">this</span> Tween tween, CancellationToken cancellationToken, <span class="keyword">out</span> Sequence warppedTween</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            warppedTween = <span class="keyword">default</span>;</span><br><span class="line">            <span class="keyword">if</span> (!tween.isAlive) <span class="keyword">return</span> UniTask.CompletedTask;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> UniTask(TweenConfiguredSource.Create(tween, TweenCancelBehaviour.KillAndCancelAwait, cancellationToken, <span class="keyword">out</span> <span class="keyword">var</span> token, <span class="keyword">out</span> warppedTween), token);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private sealed class TweenConfiguredSource : IUniTaskSource, ITaskPoolNode&lt;TweenConfiguredSource&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> TaskPool&lt;TweenConfiguredSource&gt; s_pool;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> TweenConfiguredSource m_nextNode;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> Tween m_tween;</span><br><span class="line">            <span class="comment">// use sequence to warp the original tween cuz original tween may already bind a completion callback</span></span><br><span class="line">            <span class="keyword">private</span> Sequence m_warppedSequence;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> TweenCancelBehaviour m_cancelBehaviour;</span><br><span class="line">            <span class="keyword">private</span> CancellationToken m_cancellationToken;</span><br><span class="line">            <span class="keyword">private</span> CancellationTokenRegistration m_cancellationRegistration;</span><br><span class="line">            <span class="keyword">bool</span> m_isCanceled;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> UniTaskCompletionSourceCore&lt;AsyncUnit&gt; m_core;</span><br><span class="line"></span><br><span class="line">            <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">            <span class="comment"><span class="doctag">///</span> event will be triggered when the tween completes normally</span></span><br><span class="line">            <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">readonly</span> Action m_tweenCompleteNotifyCallback;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">ref</span> TweenConfiguredSource NextNode =&gt; <span class="keyword">ref</span> m_nextNode;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">static</span> <span class="title">TweenConfiguredSource</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                TaskPool.RegisterSizeGetter(<span class="keyword">typeof</span>(TweenConfiguredSource), () =&gt; s_pool.Size);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">private</span> <span class="title">TweenConfiguredSource</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                m_tweenCompleteNotifyCallback = OnTweenCompleteCallbackDelegate;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IUniTaskSource <span class="title">Create</span>(<span class="params">Tween tween, TweenCancelBehaviour cancelBehaviour, CancellationToken cancellationToken, <span class="keyword">out</span> <span class="keyword">short</span> token</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">return</span> Create(tween, cancelBehaviour, cancellationToken, <span class="keyword">out</span> token, <span class="keyword">out</span> _);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IUniTaskSource <span class="title">Create</span>(<span class="params">Tween tween, TweenCancelBehaviour cancelBehaviour, CancellationToken cancellationToken, <span class="keyword">out</span> <span class="keyword">short</span> token, <span class="keyword">out</span> Sequence warppedTween</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cancellationToken.IsCancellationRequested)</span><br><span class="line">                &#123;</span><br><span class="line">                    DoCancelBeforeCreate(tween, cancelBehaviour);</span><br><span class="line">                    warppedTween = <span class="keyword">default</span>;</span><br><span class="line">                    <span class="keyword">return</span> AutoResetUniTaskCompletionSource.CreateFromCanceled(cancellationToken, <span class="keyword">out</span> token);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!s_pool.TryPop(<span class="keyword">out</span> <span class="keyword">var</span> result))</span><br><span class="line">                &#123;</span><br><span class="line">                    result = <span class="keyword">new</span> TweenConfiguredSource();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                result.m_tween = tween;</span><br><span class="line">                result.m_cancelBehaviour = cancelBehaviour;</span><br><span class="line">                result.m_cancellationToken = cancellationToken;</span><br><span class="line">                result.m_isCanceled = <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// warp the original tween and bind our comlete callback</span></span><br><span class="line">                result.m_warppedSequence = Sequence.Create(result.m_tween);</span><br><span class="line">                result.m_warppedSequence.OnComplete(result.m_tweenCompleteNotifyCallback);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (cancellationToken.CanBeCanceled)</span><br><span class="line">                &#123;</span><br><span class="line">                    result.m_cancellationRegistration = cancellationToken.RegisterWithoutCaptureExecutionContext(x =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        TweenConfiguredSource source = (TweenConfiguredSource)x;</span><br><span class="line">                        <span class="keyword">switch</span> (source.m_cancelBehaviour)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">case</span> TweenCancelBehaviour.KillAndCancelAwait:</span><br><span class="line">                            <span class="keyword">default</span>:</span><br><span class="line">                                <span class="comment">// token canceled stop tween</span></span><br><span class="line">                                source.m_isCanceled = <span class="literal">true</span>;</span><br><span class="line">                                source.m_warppedSequence.Stop();</span><br><span class="line">                                source.OnTweenCompleteCallbackDelegate();</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, result);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                TaskTracker.TrackActiveTask(result, <span class="number">3</span>);</span><br><span class="line">                token = result.m_core.Version;</span><br><span class="line">                warppedTween = result.m_warppedSequence;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DoCancelBeforeCreate</span>(<span class="params">Tween tween, TweenCancelBehaviour tweenCancelBehaviour</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">switch</span> (tweenCancelBehaviour)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">case</span> TweenCancelBehaviour.KillAndCancelAwait:</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        tween.Stop();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> UniTaskStatus <span class="title">UnsafeGetStatus</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">return</span> m_core.UnsafeGetStatus();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action&lt;<span class="keyword">object</span>&gt; continuation, <span class="keyword">object</span> state, <span class="keyword">short</span> token</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                m_core.OnCompleted(continuation, state, token);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetResult</span>(<span class="params"><span class="keyword">short</span> token</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    m_core.GetResult(token);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">finally</span></span><br><span class="line">                &#123;</span><br><span class="line">                    TryReturnSelfToPool();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> UniTaskStatus <span class="title">GetStatus</span>(<span class="params"><span class="keyword">short</span> token</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">return</span> m_core.GetStatus(token);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">private</span> <span class="keyword">bool</span> <span class="title">TryReturnSelfToPool</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                TaskTracker.RemoveTracking(<span class="keyword">this</span>);</span><br><span class="line">                m_core.Reset();</span><br><span class="line">                m_cancellationRegistration.Dispose();</span><br><span class="line"></span><br><span class="line">                m_tween = <span class="keyword">default</span>;</span><br><span class="line">                m_warppedSequence = <span class="keyword">default</span>;</span><br><span class="line">                m_cancellationToken = <span class="keyword">default</span>;</span><br><span class="line">                <span class="keyword">return</span> s_pool.TryPush(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">            <span class="comment"><span class="doctag">///</span> Tween completes normally</span></span><br><span class="line">            <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">            <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTweenCompleteCallbackDelegate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">if</span> (m_isCanceled)</span><br><span class="line">                &#123;</span><br><span class="line">                    m_core.TrySetCanceled(m_cancellationToken);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    m_core.TrySetResult(AsyncUnit.Default);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//----------------------------------</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">struct</span> SequenceAwaiter : ICriticalNotifyCompletion</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">readonly</span> Sequence originSequence;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">readonly</span> Sequence warppedSequence;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// killed(non active) as completed.</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">bool</span> IsCompleted =&gt; !originSequence.isAlive;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">SequenceAwaiter</span>(<span class="params">Sequence sequence</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                originSequence = sequence;</span><br><span class="line">                warppedSequence = Sequence.Create();</span><br><span class="line">                warppedSequence.Insert(<span class="number">0f</span>, sequence);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> SequenceAwaiter <span class="title">GetAwaiter</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetResult</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                UnsafeOnCompleted(continuation);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UnsafeOnCompleted</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="comment">// onKill is called after OnCompleted, both Complete(false/true) and Kill(false/true).</span></span><br><span class="line">                warppedSequence.OnComplete(PooledPrimeTweenCallback.Create(continuation));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SequenceAwaiter <span class="title">GetAwaiter</span>(<span class="params"><span class="keyword">this</span> Sequence tween</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SequenceAwaiter(tween);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UniTask <span class="title">WithCancellation</span>(<span class="params"><span class="keyword">in</span> <span class="keyword">this</span> Sequence sequence, CancellationToken cancellationToken</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!sequence.isAlive) <span class="keyword">return</span> UniTask.CompletedTask;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> UniTask(SequenceConfiguredSource.Create(sequence, TweenCancelBehaviour.KillAndCancelAwait, cancellationToken, <span class="keyword">out</span> <span class="keyword">var</span> token, <span class="keyword">out</span> _), token);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UniTask <span class="title">WithCancellation</span>(<span class="params"><span class="keyword">in</span> <span class="keyword">this</span> Sequence sequence, CancellationToken cancellationToken, <span class="keyword">out</span> Sequence warppedTween</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            warppedTween = <span class="keyword">default</span>;</span><br><span class="line">            <span class="keyword">if</span> (!sequence.isAlive) <span class="keyword">return</span> UniTask.CompletedTask;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> UniTask(SequenceConfiguredSource.Create(sequence, TweenCancelBehaviour.KillAndCancelAwait, cancellationToken, <span class="keyword">out</span> <span class="keyword">var</span> token, <span class="keyword">out</span> warppedTween), token);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private sealed class SequenceConfiguredSource : IUniTaskSource, ITaskPoolNode&lt;SequenceConfiguredSource&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> TaskPool&lt;SequenceConfiguredSource&gt; s_pool;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> SequenceConfiguredSource m_nextNode;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> Sequence m_originSequence;</span><br><span class="line">            <span class="comment">// use sequence to warp the original sequence cuz original tween may already bind a completion callback</span></span><br><span class="line">            <span class="keyword">private</span> Sequence m_warppedSequence;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> TweenCancelBehaviour m_cancelBehaviour;</span><br><span class="line">            <span class="keyword">private</span> CancellationToken m_cancellationToken;</span><br><span class="line">            <span class="keyword">private</span> CancellationTokenRegistration m_cancellationRegistration;</span><br><span class="line">            <span class="keyword">bool</span> m_isCanceled;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> UniTaskCompletionSourceCore&lt;AsyncUnit&gt; m_core;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">readonly</span> Action m_SequenceCompleteNotifyCallback;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">ref</span> SequenceConfiguredSource NextNode =&gt; <span class="keyword">ref</span> m_nextNode;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">static</span> <span class="title">SequenceConfiguredSource</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                TaskPool.RegisterSizeGetter(<span class="keyword">typeof</span>(SequenceConfiguredSource), () =&gt; s_pool.Size);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">private</span> <span class="title">SequenceConfiguredSource</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                m_SequenceCompleteNotifyCallback = OnSequenceCompleteCallbackDelegate;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IUniTaskSource <span class="title">Create</span>(<span class="params">Sequence Sequence, TweenCancelBehaviour cancelBehaviour, CancellationToken cancellationToken, <span class="keyword">out</span> <span class="keyword">short</span> token</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">return</span> Create(Sequence, cancelBehaviour, cancellationToken, <span class="keyword">out</span> token, <span class="keyword">out</span> _);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IUniTaskSource <span class="title">Create</span>(<span class="params">Sequence Sequence, TweenCancelBehaviour cancelBehaviour, CancellationToken cancellationToken, <span class="keyword">out</span> <span class="keyword">short</span> token, <span class="keyword">out</span> Sequence warppedSequence</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cancellationToken.IsCancellationRequested)</span><br><span class="line">                &#123;</span><br><span class="line">                    DoCancelBeforeCreate(Sequence, cancelBehaviour);</span><br><span class="line">                    warppedSequence = <span class="keyword">default</span>;</span><br><span class="line">                    <span class="keyword">return</span> AutoResetUniTaskCompletionSource.CreateFromCanceled(cancellationToken, <span class="keyword">out</span> token);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!s_pool.TryPop(<span class="keyword">out</span> <span class="keyword">var</span> result))</span><br><span class="line">                &#123;</span><br><span class="line">                    result = <span class="keyword">new</span> SequenceConfiguredSource();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                result.m_originSequence = Sequence;</span><br><span class="line">                result.m_cancelBehaviour = cancelBehaviour;</span><br><span class="line">                result.m_cancellationToken = cancellationToken;</span><br><span class="line">                result.m_isCanceled = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                result.m_warppedSequence = Sequence.Create();</span><br><span class="line">                result.m_warppedSequence.Insert(<span class="number">0f</span>, result.m_originSequence);</span><br><span class="line">                result.m_warppedSequence.OnComplete(result.m_SequenceCompleteNotifyCallback);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (cancellationToken.CanBeCanceled)</span><br><span class="line">                &#123;</span><br><span class="line">                    result.m_cancellationRegistration = cancellationToken.RegisterWithoutCaptureExecutionContext(x =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        SequenceConfiguredSource source = (SequenceConfiguredSource)x;</span><br><span class="line">                        <span class="keyword">switch</span> (source.m_cancelBehaviour)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">case</span> TweenCancelBehaviour.KillAndCancelAwait:</span><br><span class="line">                                source.m_isCanceled = <span class="literal">true</span>;</span><br><span class="line">                                source.m_warppedSequence.Stop();</span><br><span class="line">                                source.OnSequenceCompleteCallbackDelegate();</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">default</span>:</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, result);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                TaskTracker.TrackActiveTask(result, <span class="number">3</span>);</span><br><span class="line">                token = result.m_core.Version;</span><br><span class="line">                warppedSequence = result.m_warppedSequence;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DoCancelBeforeCreate</span>(<span class="params">Sequence Sequence, TweenCancelBehaviour tweenCancelBehaviour</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">switch</span> (tweenCancelBehaviour)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">case</span> TweenCancelBehaviour.KillAndCancelAwait:</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        Sequence.Stop();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> UniTaskStatus <span class="title">UnsafeGetStatus</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">return</span> m_core.UnsafeGetStatus();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action&lt;<span class="keyword">object</span>&gt; continuation, <span class="keyword">object</span> state, <span class="keyword">short</span> token</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                m_core.OnCompleted(continuation, state, token);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetResult</span>(<span class="params"><span class="keyword">short</span> token</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    m_core.GetResult(token);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">finally</span></span><br><span class="line">                &#123;</span><br><span class="line">                    TryReturnSelfToPool();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> UniTaskStatus <span class="title">GetStatus</span>(<span class="params"><span class="keyword">short</span> token</span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">return</span> m_core.GetStatus(token);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">private</span> <span class="keyword">bool</span> <span class="title">TryReturnSelfToPool</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                TaskTracker.RemoveTracking(<span class="keyword">this</span>);</span><br><span class="line">                m_core.Reset();</span><br><span class="line">                m_cancellationRegistration.Dispose();</span><br><span class="line"></span><br><span class="line">                m_originSequence = <span class="keyword">default</span>;</span><br><span class="line">                m_warppedSequence = <span class="keyword">default</span>;</span><br><span class="line">                m_cancellationToken = <span class="keyword">default</span>;</span><br><span class="line">                <span class="keyword">return</span> s_pool.TryPush(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnSequenceCompleteCallbackDelegate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>            &#123;</span><br><span class="line">                <span class="keyword">if</span> (m_isCanceled)</span><br><span class="line">                &#123;</span><br><span class="line">                    m_core.TrySetCanceled(m_cancellationToken);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    m_core.TrySetResult(AsyncUnit.Default);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">PooledPrimeTweenCallback</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> ConcurrentQueue&lt;PooledPrimeTweenCallback&gt; s_pool = <span class="keyword">new</span> ConcurrentQueue&lt;PooledPrimeTweenCallback&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> Action m_runDelegate;</span><br><span class="line">        <span class="keyword">private</span> Action m_continuation;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">PooledPrimeTweenCallback</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_runDelegate = Run;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">MethodImpl(MethodImplOptions.AggressiveInlining)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Action <span class="title">Create</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!s_pool.TryDequeue(<span class="keyword">out</span> PooledPrimeTweenCallback item))</span><br><span class="line">            &#123;</span><br><span class="line">                item = <span class="keyword">new</span> PooledPrimeTweenCallback();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            item.m_continuation = continuation;</span><br><span class="line">            <span class="keyword">return</span> item.m_runDelegate;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">MethodImpl(MethodImplOptions.AggressiveInlining)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Action call = m_continuation;</span><br><span class="line">            m_continuation = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (call != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                s_pool.Enqueue(<span class="keyword">this</span>);</span><br><span class="line">                call.Invoke();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
      </tags>
  </entry>
</search>
